pareto-optimal phylogenetic tree reconciliation motivation: phylogenetic tree reconciliation is a widely used method for reconstructing the evolutionary histories of gene families and species , hosts and parasites and other dependent pairs of entities. reconciliation is typically performed using maximum parsimony, in which each evolutionary event type is assigned a cost and the objective is to find a reconciliation of minimum total cost. it is generally understood that reconciliations are sensitive to event costs, but little is understood about the relationship between event costs and solutions. moreover, choosing appropriate event costs is a notoriously difficult problem. results: we address this problem by giving an efficient algorithm for computing pareto-optimal sets of reconciliations, thus providing the first systematic method for understanding the relationship between event costs and reconciliations. this, in turn, results in new techniques for computing event support values and, for cophylogenetic analyses, performing robust statistical tests. we provide new software tools and demonstrate their use on a number of datasets from evolutionary gen-omic and cophylogenetic studies.phylogenetic tree reconciliation is a fundamental technique for studying the evolution of pairs of entities such as gene families and species, parasites and hosts and species and geographical regions. recent algorithmic advances in tree reconciliation have led to seminal biological discoveries. among these are the finding that 426 of extant gene families arose during the archaean period between 3.33 and 2.85 billion years ago , a study showing that interactions of species and their ecological niches are strongly conserved across the entire tree of life (g), and new insights into the relationship between pathogenic rna viruses and their hosts . the reconciliation problem takes as input two trees and the associations between their leaves and seeks a mapping of one tree onto the other such that incongruence between the two trees is accounted for by a set of evolutionary events. in the context of gene family evolution, the two trees are the gene tree and the species tree, and in the well-studied duplication-transfer-loss model (dtl), the events are speciation, duplication, transfer and loss. unlike the simpler duplication-loss (dl) reconciliation model , dtl accounts for transfer events and is thus broadly applicable across the tree of life. in the context of parasites and their hosts, the corresponding events are co-speciation, independent speciation, host switch and loss, respectively. in the context of species and area cladograms, these four events correspond to vicariance, sympatric speciation, dispersal and loss, respectively . henceforth, we refer to this set of events as the dtl model and use the dtl event names. dtl-reconciliation is generally performed in a maximum parsimony framework in which each event type has an associated user-defined cost and the objective is to find a reconciliation of minimum total cost. probabilistic approaches for dtl reconciliation, which do not require event cost assignments, also exist , but these require estimates of other parameters, such as species divergence times, and are prohibitively slow for trees with more than a few leaves. if the species trees are fully dated, then maximum parsimony reconciliations can be found in polynomial time . however, accurately dating the internal nodes of a phylogenetic tree is generally difficult . in the absence of dates, reconciliations may be time-inconsistent in the sense that they can induce contradictory constraints on the relative order of the internal nodes. the problem of finding optimal time-consistent dtl-reconciliations in undated trees is known to be np-hard . therefore, a common approach, and the one followed in this article, is to relax the time-consistency requirement , which permits an optimal (although not necessarily time-consistent) solution to be found in o(mn) time , where m and n denote the number of nodes in the gene (parasite) and species (host) trees, respectively. experimental evidence suggests that the solutions found using this approach are generally timeconsistent ; but see also. maximum parsimony reconciliations depend on the event costs. in the dtl model, speciations are considered null events and are therefore typically assigned a cost of 0 while duplications, transfers and losses are assigned positive costs.shows a species (host) tree in black and a gene (parasite) tree in gray along with associations between their leaves. if duplication, transfer and loss each cost 1, then the reconciliation inis optimal, comprises one speciation and one transfer and has total cost 1. however, if duplication and loss cost 1 and transfer costs 5, then the maximum parsimony reconciliation inis optimal, comprises one speciation, one duplication and three losses and has total cost 4. even small differences in event costs to whom correspondence should be addressed. the author 2014. published by oxford university press. this is an open access article distributed under the terms of the creative commons attribution non-commercial license (http://creativecommons.org/licenses/by/3.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. for commercial re-use, please contact journals.permissions@oup.com. can induce different solutions when the trees are larger. for example, we have found that in many datasets, the default costs used in treemap and jane give rise to different reconciliations than those using the default costs in angst and rangerdtl . despite great advances in the efficiency and accuracy of dtlreconciliation, little is understood about the relationship between event costs and the resulting maximum parsimony reconciliations. a systematic way to handle the difficulty in determining appropriate event costs is to optimize for event counts rather than total numerical cost. we define an event count vector for a reconciliation to be a triple h; ; i, denoting the number of duplications, transfers and losses, respectively. these vectors do not explicitly count the number of speciation events because the number of speciations is implicit (it is m 1). an event count vector v=h; ; i is strictly better than an event count vector v 0 =h 0 ; 0 ; 0 i if each entry of v is less than or equal to the corresponding entry in v 0 and at least one entry of v is less than its corresponding entry in v 0. a reconciliation is pareto-optimal if there is no reconciliation with a strictly better event count vector. we use the term pareto-optimal for both reconciliations and their corresponding event count vectors. given the set of all pareto-optimal event count vectors, we can partition the space of possible event cost assignments into equivalence classes, or regions, such that any two event cost assignments within the same region lead to the same optimal reconciliations. these regions provide insights into the relationships between event costs and maximum parsimony reconciliations and have numerous applications, including new definitions and algorithms for computing event consensus support.in this section, we demonstrate the utility of our algorithms and tools on a diverse collection of datasets. currently, reconciliation analyses infer evolutionary events by choosing a set of event costs (often the default costs in the software, although most tools recommend experimenting with different costs) and constructing reconciliations based on these costs. because event costs are not easily estimated and the choice of costs affects the reconciliations, we seek here to understand the impact of event costs on the resulting reconciliations. we first analyzed a biological dataset consisting of predominantly prokaryotic species sampled broadly from across the tree of life . this consisted of 4860 gene trees (with at least two extant genes) over 100 species, but, for efficiency, we restricted our analyses to a subset of 3433 gene families from 20 randomly sampled species and evaluated event counts and their corresponding event cost regions for transfer and loss costs ranging from 0.5 to 2 (with respect to the unit cost of duplication). the results presented here exclude 34 (51.0) gene families for which eventscape used more than the allocated 5 gb of ram in our experimental setup. using the costscape tool, we observed that 85.8 (2917) of the gene families induce at least two regions, 37.5 (1274) have at least five regions and that the number of regions grows as a function of tree size . thus, the common practice of selecting a single cost setting or a small fixed number of cost settings [e.g.,considered three settings, andcan result in missing potentially important parts of the solution space. additionally, many regions have zero area (e.g. lines or points), meaning that the associated reconciliations are unlikely to be discovered by an ad hoc choice of event costs: for this dataset, 54.1 (1839) of the gene families have at least one region with zero area, and for 19.7 (669) of the gene families, more than half of the regions have zero area. we also found that a systematic choice of event costs (e.g. using costscape) can cover a substantial portion of the solution space. for example, for all gene families studied here, an appropriately selected subset of five or fewer regions covers the majority (450) of the event cost space , and coverage of the event cost space appears to follow a power law distribution (supplementary). although these results seem to suggest that a small set of event costs (and their associated regions) is representative of the entire event cost space, we note that coverage of event cost space is a biased measure, as some large regions may include cost ratios that are biologically unrealistic while other regions containing biologically plausible ratios might cover a small fraction of the event cost space. regions of zero area, for example, are generally abundant and may contain a biologically relevant solution. while these results provide some preliminary understanding of the relationship of event costs and the space of maximum parsimony reconciliations, further research is needed to understand the properties of this space and, ultimately, to determine appropriate event costs. next, we focus on the identification of well-supported events across the event cost space. given a user-specified event cost space, that is, a range of costs on transfer and loss (with respect to the unit cost of duplication), we used the eventscape tool to infer the pareto-optimal regions and the sets of events that are common to 1;. .. ; k regions, where k is the total number of regions in the event cost space. we define an event to have consensus support s, 0 s 1 (with respect to the event cost space), if the event is found in every reconciliation in at least a fraction s (inclusive) of the regions. note that this is one of many possible measures of event support, and our algorithms can be used to define and compute other measures.fig. 2. pareto-regions for the (a) gopher-louse and (b) indigobird-finch datasets. colors are arbitrary and are used to match regions with the event counts in the legend. the displayed event counts comprise the number of speciations in addition to the number of duplications, transfers and losses. in addition, the count field indicates the number of distinct reconciliations in each region. while most regions are polygons, regions may also be points or lines, such as in the first region in the legend in (a). (c) results of a permutation test on the gopher-louse dataset using 1000 random trials. for (c) only, green indicates significance at the 0.01 level, yellow represents significance between 0.01 and 0.05 and red indicates lack of significance at the 0.05 level. brightness of green, yellow and red indicates differences in p-values, with brighter shades indicating smaller p-values.using this definition, we investigated the fraction of events supported at various support thresholds . almost universally, speciations are the best supported type of event, with $33.2 of speciations supported under strict consensus (that is, found in all regions). manual inspection revealed that speciations found near the root of the tree were often conserved across multiple regions. however, when analyzing gene family evolution, we are typically interested in the inferred duplications, transfers and losses (collectively, the dtl events), and we found that few of these have high support. for example, only 2.1 of duplications, 15.1 of transfers and 2.1 of losses have at least 80 support (though the percentage of events with at least 50 support is substantially higher, with 56.8 of duplications, 41.4 of transfers and 34.9 of losses supported at that level). interestingly, we observed a jump in the number of supported events around a support threshold of 50. also, in general, for most support thresholds, duplications are the most supported type of event (after speciation), followed by transfers, then losses; however, for low support thresholds, the three types of dtl events show roughly equal support. these results have important implications for existing analyses that rely on dtl reconciliation and suggest that many inferred events are highly specific to the user-defined event costs. in this study, we have investigated a specific range of event costs (transfer and loss ranging from 0.5 to 2 relative to the unit cost of duplication). the number of regions, and thus the level of consensus support, depends on this range. moreover, our analyses permitted cost combinations in which duplications are more expensive or less expensive than transfers and losses. adding constraints on these cost relationships could alter the levels of support. we also note that manual inspection revealed that loss events, and to a lesser extent transfers, are often fungible in the sense that they can be moved from one location to another without changing the total cost of the solution, and thus any individual loss or transfer event is not likely to be strongly supported. by looking at the event cost space and supported events, our tools allow the elucidation of the complex interplay between event cost assignments and event support under various ranges and constraints of event costs. for completeness, we also determined event support as measured by fraction of the event cost space (rather than fraction of the number of regions) covered , yielding similar results. the main difference between these two measures is that event support increases gradually with increasing region coverage but tends to jump with increasing event cost space coverage; this confirms our finding that the event cost space is dominated by a few large regions. otherwise, duplications also show a clear demarcation from no support to high support at $66.7 coverage. to demonstrate the applicability of our tools on cophylogenetic datasets, we performed similar analyses on five hostparasite datasets and found results consistent with those above (supplementary section s3, supplementary). finally, the average runtimes for our tools is on the order of seconds (supplementary). to demonstrate scalability, we also ran costscape on the full 100-taxa tree of life dataset (also using transfer and loss costs ranging from 0.5 to 2) and found that the median runtime remains 51 min.whereas a sampling approach would necessarily capture only a subset of the event cost space. using the tools based on our algorithms, we have conducted experiments on a broad array of datasets. these results show that the space of maximum parsimony solutions is complex and sensitive to the event costs, and thus, choosing ad hoc event costs may result in misrepresenting evolutionary histories. at the same time, we cannot discount ad hoc procedures for finding event costs [for example, through comparison to event inferences on a biological dataset, as in. in particular, such approaches may elucidate the boundaries for biologically reasonable event cost assignments, which could then be used as input into our tools for more systematic analysis. in addition, by defining notions of consensus support based on the number of regions that share an event, we found that while many speciation events have high consensus support, most other events do not. thus, inferring events based on non-systematically selected event costs is likely to provide only a piece of a complex picture, and our tools motivate further investigation into the robustness of analyses based on dtl reconciliation. there are numerous interesting directions for future work. in particular, this work affords opportunities to explore many variants of event consensus support. for example, our work uses the most specific definition of an event in computing support: for a speciation, duplication or transfer to be supported across different reconciliations, a gene (parasite) tree node must map to the same species (host) tree node and to the same event, and transfers must also yield the same transfer edge. similarly, for two losses to be supported across different reconciliations, they must be found along the same branch of both the gene tree and species tree. in some cases, analyses only require the species mapping or event mapping , and thus the support values must be considered for these relaxed definitions of events. our algorithms can be modified accordingly. in addition to identifying highly supported events, it is desirable to find highly supported whole reconciliations. in the spirit of promising recent work on this problem for fixed event costs , one promising research direction is to identify and succinctly represent whole reconciliations that are robust across the space of event costs. in summary, this work provides techniques and tools that are immediately useful in the phylogenomic, cophylogenetic and biogeography analyses and offers avenues for further research that leverages the pareto-optimal reconciliation methods developed here  
