large-scale machine learning for metagenomics sequence classification motivation: metagenomics characterizes the taxonomic diversity of microbial communities by sequencing dna directly from an environmental sample. one of the main challenges in metage-nomics data analysis is the binning step, where each sequenced read is assigned to a taxonomic clade. because of the large volume of metagenomics datasets, binning methods need fast and accurate algorithms that can operate with reasonable computing requirements. while standard alignment-based methods provide state-of-the-art performance, compositional approaches that assign a taxonomic class to a dna read based on the k-mers it contains have the potential to provide faster solutions. results: we propose a new rank-flexible machine learning-based compositional approach for taxo-nomic assignment of metagenomics reads and show that it benefits from increasing the number of fragments sampled from reference genome to tune its parameters, up to a coverage of about 10, and from increasing the k-mer size to about 12. tuning the method involves training machine learning models on about 10 8 samples in 10 7 dimensions, which is out of reach of standard softwares but can be done efficiently with modern implementations for large-scale machine learning. the resulting method is competitive in terms of accuracy with well-established alignment and composition based tools for problems involving a small to moderate number of candidate species and for reasonable amounts of sequencing errors. we show, however, that machine learning-based compositional approaches are still limited in their ability to deal with problems involving a greater number of species and more sensitive to sequencing errors. we finally show that the new method outperforms the state-of-the-art in its ability to classify reads from species of lineage absent from the reference database and confirm that compositional approaches achieve faster prediction times, with a gain of 217 times with respect to the bwa-mem short read mapper, depending on the number of candidate species and the level of sequencing noise. availability and implementation: data and codes are available atrecent progress in next-generation sequencing technologies allow to access large amounts of genomic data within a few hours at a reasonable cost . in metagenomics, next-generation sequencing is used to analyze the genomic content of microbial communities by sequencing all dna present in an environmental sample . it gives access to all organisms present in the sample even if they do not grow on culture media and allows us to characterize with an unprecedented level of resolution the diversity of the microbial realm . the raw output of a metagenomics experiment is a large set of short dna sequences (reads) obtained by high-throughput sequencing of the dna present in the sample. there exist two main approaches to analyze these data, corresponding to slightly different goals. on the one hand, taxonomic profiling aims to estimate the relative abundance of the members of the microbial community, without necessarily assigning each read to a taxonomic class. recent works like wgsquikr or gasic proved to be very efficient for this purpose. taxonomic binning methods, on the other hand, explicitly assign each read to a taxonomic clade. this process can be unsupervised, relying on clustering methods to assign reads to several bins (i.e. clusters), or supervised, in which case reads are individually assigned to nodes of the taxonomy . while binning is arguably more challenging than profiling, it is a necessary step for downstream applications which require draft-genome reconstruction. this may notably be the case in a diagnostics context, where further analyses could aim to detect pathogen microorganisms or antibiotic resistance mechanisms . in this article, we focus on the problem of supervised taxonomic binning, where we wish to assign each read in a metagenomics sample to a node of a pre-defined taxonomy. two main computational strategies have been proposed for that purpose: (i) alignment-based approaches, where the read is searched against a reference sequence database with sequence alignment tools like blast or short read mapping tools (e.g. bwa,) and (ii) compositional approaches, where a machine learning model such as a naive bayes (nb) classifier or a support vector machine (svm,) is trained to label the read based on the set of k-mers it contains. recently, a very fast compositional approach using long k-mers and not based on machine learning models, called kraken , has also been proposed. since the taxonomic classification of a sequence by compositional approaches is only based on the set of k-mers it contains, they can offer significant gain in terms of classification time over similaritybased approaches. training a machine learning model for taxonomic binning can, however, be computationally challenging. indeed, compositional approaches must be trained on a set of sequences with known taxonomic labels, typically obtained by sampling error-free fragments from reference genomes. in the case of nb classifiers, explicit sampling of fragments from reference genomes is not needed to train the model: instead, a global profile of k-mer abundance from each reference genome is sufficient to estimate the parameters of the nb model, leading to simple and fast implementations . on the other hand, in the case of svm and related discriminative methods, an explicit sampling of fragments from reference genomes to train the model based on the k-mer content of each fragment is needed, which can be a limitation for standard svm implementations. for example,sampled approximately 10 000 fragments from 1768 genomes to train a structured svm (based on a k-mer representation with k 4, 5, 6) and reported an accuracy competitive with similarity-based approaches. increasing the number of fragments sampled to train a svm may improve its accuracy and allow us to investigate larger values of k. however, it also raises computational challenges, as it involves machine learning problems where a model must be trained from potentially millions or billions of training examples, each represented by a vector in 10 7 dimensions for, e.g. k 12. in this work, we investigate the potential of compositional approaches for taxonomic label assignment using modern, largescale machine learning algorithms. we propose a new, rank-flexible compositional approach trained with large-scale machine learning methods and assess its performance in different situations. we show that it provides an interesting trade-off in speed and accuracy compared to the state-of-the-art, particularly when confronted to species absent from the reference database, and for a moderate number of candidate species.in this work, we investigate the potential of modern, large-scale machine learning approaches for taxonomic binning of metagenomics data and propose a new rank-flexible classification strategy.. abundance profiles obtained with vw (a) and kraken (b) on the hmp spiked dataset. abundance profiles are presented at the genus level, with colors corresponding to the different predicted species, restricted to species accounting for at least 0.2) of the samples. light-gray fractions of the bars correspond to genus-level predictionswe extensively evaluate its performance when the scale of the problem increases regarding (i) the length of the k-mers considered to represent a sequence, (ii) the number of fragments used to learn the model and (iii) the number of candidate species involved in the reference database. we also investigate in details its robustness to sequencing errors using simulated reads. we consider three baselines for this evaluation: a comparative approach based on the bwa-mem sequence aligner and two compositional approaches based on the generative nb classifier and based on kraken. we demonstrate in particular that increasing the number of fragments used to train the model has a significant impact on the accuracy of the model and allows to estimate models based on longer k-mers. while this could be expected and was already highlighted by previous studies, the resulting configurations are out of reach of standard svm implementations. we also show that discriminatively trained compositional models usually offer significantly higher performances than generative nb classifiers. the resulting models are competitive with well-established alignment tools and with kraken for problems involving a small to moderate number of candidate species and for realistic amounts of sequencing errors. our results suggest, however, that machine learning-based compositional approaches, both discriminative and generative, are still limited in their ability to deal with problems involving more than a few hundreds species. in this case, indeed, compositional approaches exhibit lower performance than alignment-based approaches and are much more negatively impacted by sequencing errors. when confronted with species absent from the training set, we show that our model is more accurate than kraken, which has a larger level of rejection due to its use of longer k-mers, and affects more reads too specifically to species of the reference dataset. finally, we confirm that compositional approaches achieve faster prediction times. this is indeed systematically the case in the various configurations listed above, with predictions obtained 217 times faster by compositional approaches, and, interestingly, depends on the number of candidate species. we note in particular, that for problems involving fewer than 100 candidate species, which may arise in diagnostic applications involving specific types of specimens, vw can achieve faster prediction times than kraken. at the extreme, for the binary problem aiming to separate bacterial from human reads, which is commonly used while analyzing a microbiome sample, vw can offer a 9-fold increase in terms of prediction time with respect to kraken. we emphasize, however, that fast predictions can only be obtained provided that the classification models are loaded in memory, hence for a memory footprint that scales linearly with the number of candidate species and exponentially with the size of the k-mers, which can become important for large reference databases and long k-mers. at least three simple extensions could be envisioned to make compositional approaches more competitive in accuracy with the alignment-based approach, faster and to limit their memory footprint. first, the robustness to sequencing errors may be improved by learning models from simulated reads instead of fragments. this could indeed allow to tune the model to the sequencing technology producing the reads to be analyzed, provided its error model is properly known and characterized. second, introducing a sparsity-inducing penalty while learning the model would have the effect of reducing the number of features entering the model, hence to reduce the memory footprint required to load the model into memory. finally, alternative strategies, known as error correcting tournaments , could be straightforwardly considered to reduce the number of models to learn, hence to store into memory during prediction, to address a multiclass problem. our results indeed suggest that addressing these issues is critical to build state-of-the-art compositional classifiers to analyze metagenomics samples that may involve a broad spectrum of species.  
