large-scale automated identification of mouse brain cells in confocal light sheet microscopy images motivation: recently, confocal light sheet microscopy has enabled high-throughput acquisition of whole mouse brain 3d images at the micron scale resolution. this poses the unprecedented challenge of creating accurate digital maps of the whole set of cells in a brain. results: we introduce a fast and scalable algorithm for fully automated cell identification. we obtained the whole digital map of purkinje cells in mouse cerebellum consisting of a set of 3d cell center coordinates. the method is accurate and we estimated an f 1 measure of 0.96 using 56 representative volumes, totaling 1.09 gvoxel and containing 4138 manually annotated soma centers. availability and implementation: source code and its documentation are available at http://bcfind.dinfo.unifi.it/. the whole pipeline of methods is implemented in python and makes use of pylearn2 and modified parts of scikit-learn. brain images are available on request.understanding the cytoarchitecture of the mammalian central nervous system on a brain-wide scale is becoming a compelling need in neuroscience . in fact, single-neuron projections often span through the whole encephalon , supporting functional connection between anatomically distant regions. therefore, charting cellular localizations and projections throughout the whole brain is a mandatory step to afford a comprehensive view of brain function. many efforts are thus devoted to build cellular-resolution, brain-wide neuroanatomical atlases of the mouse brain . such maps would eventually allow characterizing on a structural basis the physiology and pathology of the central nervous system at various stages, ranging from development to neurodegeneration. to map the structure of the mouse brain, in the past years several high-throughput imaging techniques have been developed. electron microscopy coupled with automatic tissue sectioning has been exploited to reconstruct neuronal wiring with nanometric resolution ; however, its use is still limited to small brain regions because the slow imaging rates makes whole-brain measurements impossible at the moment . on the other hand, optical methods have coarser resolution, but can be used to image the entirety of mouse brain . the three main optical approaches used to map mouse brain anatomy are micro-optical sectioning tomography (most) , serial two-photon tomography (stp) and light sheet microscopy (lsm) . the former technique allows mouse brain reconstruction with high contrast and resolution in 3d, but imaging time can reach even 1 month for a single brain . stp shows the excellent contrast and resolution characteristic of multiphoton microscopy, but it operates with rough axial sampling [1 m section every 50 m (] and to our knowledge no full sampling reconstruction of a whole mouse brain has been demonstrated with this technique. lsm, coupled with chemical clearing procedures to render the brain transparent , permits reconstruction of the whole mouse brain with micron-scale resolution in a timescale ranging from hours to a few days . the contrast affordable with this latter method is usually lower than the one of most and stp, because of residual light scattering inside the cleared tissue. however, lsm currently is the only method allowing acquiring a significant number of samples with full 3d resolution. furthermore, an implementation called confocal light sheet microscopy (clsm) shows 100 contrast increase with respect to conventional lsm, allowing to distinguish neuronal somata in whole-brain tomographies . in this technique, however, different fixation efficiencies within the whole organ and inhomogeneous optical clearing give rise to a large variability in contrast throughout the entire volume (as an example, three regions are shown at the top of). because of this heterogeneity, na ve segmentation or localization methods (e.g. thresholding) cannot be applied to analyze whole-brain datasets obtained with clsm. the availability of advanced imaging techniques for whole brain mapping introduces the new challenge of extracting quantitative human-readable information from the data . there exist several proposals for automatic localization or segmentation of cell bodies in 2d and 3d microscopy .presented a method based on image filtering and object morphology analysis that automatically counts the number of dying cells in images of drosophila embryos collected at the confocal microscope. the method was tested on small stacks of 130mvoxels and it attained a recall, precision and f 1 to whom correspondence should be addressed. the author 2014. published by oxford university press. this is an open access article distributed under the terms of the creative commons attribution non-commercial license (http://creativecommons.org/licenses/by-nc/3.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. for commercial re-use, please contact journals.permissions@oup.com of 0.98, 0.97 and 0.97, respectively (see section 3.1.2 for definitions).propose an algorithm for segmenting neuronal mouse cells in 3d images of somatosensory cortex of 14 day old rats collected using a confocal laser scanner. the method, which needs information obtained in a 2d segmentation stage, was tested on a volume containing, in total, 600700 neurons belonging to three different cortical layers (15.4 mvoxels). this method achieved a recall, precision and f 1 ranging in (0.95, 0.99), (0.94, 0.95) and (0.95, 0.97), respectively.presented a neuron soma localization method, based on a minimization problem, which was tested on an image dataset of brain coronal profile of transgenic fluorescence mice (210 weeks old) collected using a fluorescence most system. the size of tested stack was 1300 1850 voxels (361 mvoxels) and the algorithm localized $2500 neurons with a recall of 0.88. in this article, we address the two major challenges that arise when attempting to perform information extraction from clsm images: large datasets, and significant contrast heterogeneity. a mouse brain has a volume of the order of 1 cm 3 , yielding image sizes in the terabyte scale at the micron-resolution. in these cases, the only alternative to the massive use of manwork [as in ] is the development of fully automatic tools. to achieve this goal, the inherent contrast variability in clsm requires sufficient robustness with respect to the parameters of the extraction algorithms: fine-tuning of parameters on different regions [as suggested e.g. by] may be practically unfeasible with images containing hundreds of thousands of neurons. the method presented in this article is based on three core algorithmic ideas: mean shift clustering to detect soma centers (section 2.2), supervised semantic deconvolution by means of neural networks for image enhancement (section 2.3) and manifold learning for filtering false positives (fps) (section 2.4). the implementation makes use of pylearn2 and modified parts of scikit-learn . to demonstrate its capabilities, we applied the algorithm to localize and count the purkinje cells in the cerebellum of an l7-gfp mouse , a transgenic animal in which this neuronal population is labeled with enhanced green fluorescent protein (egfp). we obtained an f 1-measure of 0.96 and an area under the recallprecision curve of 0.97. to our knowledge, this is the first complete map of a selected neuronal population in a large area of the mouse brain.quantitative histological measurements are typically restricted to small portions of tissue. in fact, on the one hand, conventional microscopy techniques are unable to generate large-scale volumetric datasets . on the other hand, currently available algorithms for cell segmentation or localization usually require carefully tuned parameters and therefore cannot cope with the image variability that may be present in large-scale datasets. the only well-established quantitative method to investigate cytoarchitecture on a brain-wide scale is stereology , which, however, provides only estimates of the number of cells, without a precise map of their spatial distribution. furthermore, stereological estimates rely on a priori assumptions about the imaged tissue, which make the final result dependent on the starting hypothesis . here, we presented an algorithm for fully automatic detection of neuronal soma in clsm fluorescence images, in which human supervision is needed only for the initial training of a neural network. after training on a small sample of substacks, the neural network is able to generalize well on different brain regions. this suggests that the network trained on one cell type and one brain will be able to perform semantic deconvolution equally well for the same cell type of other brains within a uniform population of animals. the robustness of the method when applied to heterogeneous samples should be further investigated. in particular, it might be necessary to collect larger and more representative datasets if one wants to detect cells with different sizes/shapes or in comparative studies involving animals with anatomical variations or disease models. in our experience, the overall work devoted to labeling was modest compared with the work devoted to sample preparation and image acquisition. the capabilities of this algorithm have been demonstrated by localizing all the purkinje neurons in a whole mouse cerebellum. the algorithm is robust against the contrast variability in different image regions. the sensitivity of performance with respect to the mean shift kernel radius and the manifold filter distance is modest and the seed selection parameter r can be chosen according to the expected size of visible soma. one possible future extension to improve our quantitative results is to associate a confidence score or a probability to each detection. our method obtains the best results when the manifold filter is used. this can be a limitation, as the cellular subset under investigation might be scattered in all the three dimensions, without any apparent uniformity in the spatial distribution. further, even if neurons lie on a manifold in physiological conditions, this regularity might disappear (at least partly) in presence of a pathology. thus, if one wants to compare healthy and unhealthy subjects, a manifold-independent localization pipeline could provide more reliable results. anyhow, the modeling of the manifold can be useful also in this case, allowing a quantitative description of the spatial scattering of neurons. the combination of the method presented here with genetically targeted expression of fluorescent proteins, or with whole-brain immunohistochemistry , will allow precisely localizing and counting selected neuronal populations throughoutthe entire encephalon, eventually leading to a set of brain-wide cytoarchitectonic maps of the various cell types.we presented an automated pipeline for the localization of neuronal soma in large-scale images obtained with clsm. the method has been validated on images of the cerebellum of an l7-gfp mouse. we found that semantic deconvolution significantly boosted performance at a modest cost in terms of hand labeling. we obtained an f 1 value of 0.96. while some margin for improvement may remain, human labeling disagreement suggests that f 1 values 40.98 are unlikely to be attainable. we further demonstrate the algorithm by producing the full map of purkinje cells in the whole mouse cerebellum.  
