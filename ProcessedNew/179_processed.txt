gene expression a hierarchical model of transcriptional dynamics allows robust estimation of transcription rates in populations of single cells with variable gene copy number motivation: cis-regulatory dna sequence elements, such as enhan-cers and silencers, function to control the spatial and temporal expression of their target genes. although the overall levels of gene expression in large cell populations seem to be precisely controlled, transcription of individual genes in single cells is extremely variable in real time. it is, therefore, important to understand how these cis-regulatory elements function to dynamically control transcription at single-cell resolution. recently, statistical methods have been proposed to back calculate the rates involved in mrna transcription using parameter estimation of a mathematical model of transcription and translation. however, a major complication in these approaches is that some of the parameters, particularly those corresponding to the gene copy number and transcription rate, cannot be distinguished; therefore, these methods cannot be used when the copy number is unknown. results: here, we develop a hierarchical bayesian model to estimate biokinetic parameters from live cell enhancerpromoter reporter measurements performed on a population of single cells. this allows us to investigate transcriptional dynamics when the copy number is variable across the population. we validate our method using synthetic data and then apply it to quantify the function of two known developmental enhancers in real time and in single cells. availability: supporting information is submitted with the article.the rate of transcription of rna polymerase ii transcribed genes is determined by interactions between general transcription factors assembled at the core promoter and sequence-specific transcription factors bound to cis-regulatory dna sequences, such as enhancers. experiments in cell populations have suggested that enhancers function either as rheostats, by increasing the rate of transcription initiation from a promoter in a graded manner, or as on/off switches increasing the proportion of cells transcribing a gene without affecting the rate . however, recent studies have shown that even though gene expression levels seem to be precise when averaged over a large population of cells, the process of transcription in individual cells is stochastic . a mammalian gene has intermittent random bursts of expression in a single cell separated by refractory periods of inactivity with the kinetics of this process varying widely between genes . this results in variability in protein expression both within individual cells and between cells in a population . although the kinetics of transcription has been studied in single cells, the ability of enhancers to regulate transcription at single-cell resolution remains poorly understood. studies with stable cell lines containing integrated luminescent and fluorescent reporters have been used to measure fine-scale dynamics of transcription . this approach could, in theory, be used for large-scale analyses of enhancer function, but transient transfection is more amenable because of the numbers of constructs involved. however, transient transfection has a major disadvantage in that the variation in copy number makes the reliability of any quantification problematic. it is, therefore, of considerable interest to provide a method that can deal with copy number variation and estimate transcription rates using transient transfection. to address this problem, we have developed a hierarchical bayesian model to estimate transcriptional dynamics in single cells, and we have used it to gain a more detailed understanding of cis-regulatory enhancer function. our hierarchical model builds on previous models of gene transcription and uses the linear noise approximation to establish a likelihood function that enables us to estimate the model parameters using markov chain monte carlo (mcmc) . this forms the first layer of the hierarchical structure of the model and incorporates the variation within an to whom correspondence should be addressed.we have presented a method of extracting comparable transcription rates from populations of single cells with variable copy number and validated it on synthetic datasets. previously, all single-cell analysis would have been performed on a population of cells with a known copy number, as this unknown variable renders any robust analysis of transcription intractable. with our method, constructed under the assumption that the rates involved in transcription are drawn from a statistical distribution, we can decouple the processes involved in transcription, allowing the estimation of values relative to each other. as such, this method is especially suited to the analysis of a large number of cells transiently transfected with a suitable reporter protein. this removes the significant overhead of constructing a stable cell line with fixed copy number for each construct; hence, it facilitates large-scale investigations of transcriptional output. although in this study, the algorithm was run on all the cell data at once, the nature of the hierarchical distribution means that the copy number, translation rate and other distributions can be used as a fixed prior in subsequent analysis; hence, comparison between separate runs will still be valid. also, if experiments were undertaken to investigate the nature of these distributions, the hierarchical model would provide a framework in which this information could be incorporated into the estimation procedure. however, care must be taken to ensure that there is no reason to believe that the distributions will be different in the separate experiments. another strength of this hierarchical procedure is that it is inherently flexible and could potentially be used to answer a number of other biological questions, such as how certain stimuli affect the transcription of a gene in a population of cells. the form of the hierarchical distributions can be chosen to fit the investigation, and it would even be possible to incorporate mixtures of distributions or a class allocation methodology if the application warranted it. furthermore, the model can easily be extended to incorporate oscillatory systems, such as the nf-b system without requiring a full mathematical model of the entire network . this is because the likelihood for each individual cell is fundamentally based on a changepoint model; therefore, we can model oscillations by the addition of more changepoints, similar to the non-hierarchical model in. we applied this method to data gathered from live cell imaging to investigate how the enhancer function of two known cis-regulatory elements affects transcription rates in cell populations. our results confirmed and extended findings based on bulk cell measurements, namely, that the presence of these enhancers leads to increased transcription rates, but we were also able to investigate how each individual cell contributes to the output. our results indicated a lower fold change than results obtained using bulk cell measurements with the luciferase reporter.taining the promoter only (top left), the proximal enhancer (top right) and the distal enhancer (bottom) estimated using the full hierarchical model. the coloured bars represent the distribution of the markov chain estimates for that cell in which a high-probability mass corresponds to a light colour ranging to a dark colour for low-probability mass. population-level relative transcription rate mean, standard deviation and coefficient of variation estimated for each promoter constructnote: the above the statistic denotes those obtained directly from the hierarchical distribution, and the above the statistic denotes that the population statistics are calculated from the mean values of the individual mcmc estimate. these values are conditional on the common copy number distribution and do not represent the absolute transcription rates. all units are arbitrary.however, these experiments are unlikely to be directly comparable, as we use a fluorescent reporter and specifically measure differences in active transcription in our algorithm, whereas the previous test measured luminescence at a single time point regardless of transcriptional activity at that time. using our method, we were able to establish that these enhancers do not engender increased transcription rates across all cells, but act to substantially increase transcription rates in a proportion of the population. this implies that transcription of a gene is not always affected by the presence of an enhancer, but those that are affected transcribe at a higher rate. this may be because the transcription factors that interact with an enhancer may not be present or active in every cell; therefore, transcription occurs at a similar level as when the enhancer is not present. furthermore, by analysing the single-cell estimates we can distinguish between a binary and graded response to the enhancer module and provide a more detailed description of cis-regulatory element function. our data show that both the proxenh and distenh increase transcription rates in a graded fashion in the responding cells, i.e. in the proportion of cells that have a higher transcription rate than the promoter alone. it will be of interest to test, using a range of enhancers, whether the proportion of responding cells is modulated by enhancer strength. these insights into the nature of transcriptional regulation would be difficult to uncover without recourse to single-cell analysis. our hierarchical model enables studies of systems involving intricate transcriptional dynamics and can easily be extended to large-scale investigations by accounting for uncontrolled reporter gene copy numbers inherent in transient transfections. the approach can feasibly be expanded to systematically measure the activity of several hundred cis-regulatory element promoter reporter variants in parallel and infer gene regulatory logic. undertaking very high-throughput studies similar to  
