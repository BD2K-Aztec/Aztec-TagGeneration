high-quality sequence clustering guided by network topology and multiple alignment likelihood motivation: proteins can be naturally classified into families of homologous sequences that derive from a common ancestor. the comparison of homologous sequences and the analysis of their phylogenetic relationships provide useful information regarding the function and evolution of genes. one important difficulty of clustering methods is to distinguish highly divergent homologous sequences from sequences that only share partial homology due to evolution by protein domain rearrangements. existing clustering methods require parameters that have to be set a priori. given the variability in the evolution pattern among proteins, these parameters cannot be optimal for all gene families. results: we propose a strategy that aims at clustering sequences homologous over their entire length, and that takes into account the pattern of substitution specific to each gene family. sequences are first all compared with each other and clustered into pre-families, based on pairwise similarity criteria, with permissive parameters to optimize sensitivity. pre-families are then divided into homogeneous clusters, based on the topology of the similarity network. finally, clusters are progressively merged into families, for which we compute multiple alignments, and we use a model selection technique to find the optimal tradeoff between the number of families and multiple alignment likelihood. to evaluate this method, called hifix, we analyzed simulated sequences and manually curated datasets. these tests showed that hifix is the only method robust to both sequence divergence and domain rearrangements. hifix is fast enough to be used on very large datasets. availability and implementation: the python software hifix is freely available at http://lbbe.univgenomes are the result of a long evolutionary process that began 3 billion years ago. reconstructing the evolutionary history of genes contained within these genomes is of major interest, not only to uncover the phylogeny of organisms, but also to understand to whom correspondence should be addressed. the functioning of living systems. thanks to the progress of genome sequencing projects, millions of protein-coding genes, from thousands of species, are now available in sequence databases. several specialized databases have been developed with the aim of providing systematic information about the homology relationships between these sequences, either at the level of protein domains [such as prodom or pfam (, or among entire proteins, considered as a whole [such as cog , treefam , ensembl compara or hogenom (. the systematic analysis of homology relationships among sequences typically involves two steps: (i) pairwise comparison of all proteins to detect homology (e.g. with blast) and (ii) clustering of homologous proteins (or protein domains) into families. the choice of the clustering strategy is crucial for all subsequent analyses, and depends on the purpose of the study. here, we will discuss specifically clustering strategies that aim at describing homology relationships between entire proteins, not protein domains. by definition, a family of homologous sequences is a set of sequences that derive from a common ancestor. hence, in principle, modular proteins containing domains with distinct evolutionary histories should not be included in the same family. the main problem is that the detection of homology by sequence similarity search is subject both to false positive (fp) and false negative (fn) errors. typically, homology cannot be detected by sequence similarity when proteins have diverged too much. given that the rate of evolution often varies along proteins, some sequences that are homologous over their entire length may be only locally alignable. such cases would be erroneously considered as partially homologous, and will lead to fns. conversely, it has been shown that similarity search programs, such as blast, sometimes tend to extend the local alignment beyond the actual homologous domain . thus, in some cases, modular proteins sharing only partial homology can be aligned over their entire length, and hence be classified in the same family (fps, see). the rate of fps can be decreased by using more stringent sequence similarity criteria, but this necessarily leads to an increase in the rate of fns. all clustering methods have some parameters that can be tuned to optimize the tradeoff between sensitivity and specificity. however, the choice of these parameters is totally empirical, and the default parameters that are proposed by the authors generally reflect the result of trial and error on a limited benchmark set of sequences . one other problem. example of over-extension of blast local alignment. the two protein sequences (query and sbjct) were obtained by simulation of sequence evolution performed with indelible . each protein consists of two domains of equal size: the n-terminal domain (plain line), which is homologous between both proteins, and a specific, nonhomologous c-terminal domain (in dotted and dashed line, respectively). although these proteins share homology only in the n-terminal domain, the blast alignment extends over the entire length of both proteins. such an overextension can also be found with natural protein sequences . is that the tempo of sequence evolution is highly variable among proteins, and hence optimal parameters may vary among families. moreover, the optimal parameters may also vary according to the size of the sequence dataset. for example, we recently developed a clustering software, based on a sophisticated divide-and-conquer procedure, which presents the advantage of being extremely fast and memory efficient, and hence can be used on very large sequence datasets (contrarily to most other existing methods). benchmark tests showed that on average, silix performs as well (or even better) than other methods in term of clustering quality . however, given that silix is based on transitive clustering, this method is expected to lead to fps among large protein families, because the risk of illegitimately grouping gene families increases with the number of sequences. to circumvent these problems, we propose here a new clustering strategy. the main idea is that the decision to include or not a protein in a given family should be based on the examination of multiple sequence alignments, not simply on the analysis of pairwise sequence similarities. indeed, a multiple alignment contains information about the mode and tempo of evolution at each aminoacid position of a given protein family, which can be used to decide whether or not a new sequence belongs to that family. the strategy we propose consists in three steps:to evaluate the results of hifix and compare them to those of other methods, we used several benchmark sets of known homologous protein families. on each set of sequences, we first compared all proteins against all with blastp . the blast results were then analyzed with different clustering methods. for each method, each reference family of the benchmark set was compared with the results of the clustering to identify the cluster with the highest number of corresponding sequences (target cluster). each sequence of the reference family that was absent from the target cluster was counted as a fn. each sequence of the target cluster that was present or absent from the reference family was counted as a true positive (tp) or a fp, respectively. we computed sensitivity tp/(tp+fn) and specificity tp/(tp+fp) for each cluster and report their values averaged over all reference families. we also report f-measure ii, a weighted harmonic mean between sensitivityand specificity that was introduced in [see details in supplementary material and also (. this procedure was used to evaluate silix, used alone, or followed by the two additional hifix steps: step 2: decomposition of pre-families into communities with louvain; step 3: hierarchical clustering into meta-communities that are the final families. to quantify the gain due to the third step, we also analyzed the results of the first two steps, i.e. silix followed by louvain, assuming that the found communities are the protein families. for a comparison, we also performed the clustering with several other methods that were recently evaluated among the best currently available: mcl , hcluster_sg and transclust . we first tested these methods on sets of homologous protein families that have been manually analyzed by experts. unfortunately, there are only a limited number of such benchmark sets and they tend to be biased toward relatively small families. furthermore, even expert analyses cannot fully guarantee the absence of fp or fn in the reference set. to circumvent these limitations, we also performed tests on sets of simulated sequences for which, by construction, homology relationships are perfectly known.proteins are the result of an evolutionary process, and can therefore naturally be classified into families of homologous sequences. we propose here a clustering method (hifix) that relies on three steps: (i) permissive clustering of sequences in pre-families; (ii) sub-clustering of pre-families into homogeneous clusters; and (iii) progressive merging of clusters into families, with evaluation of the quality of the multiple alignment at each step. the goal of this strategy is to maximize sensitivity (i.e. families should be as exhaustive as possible), while preserving the quality of the final multiple alignment (i.e. two clusters can be merged, as long as they are homologous over their entire length). the logics behind this strategy is to cluster all homologous sequences that are similar enough to obtain a reliable multiple alignment, from which it will be possible to construct a phylogenetic tree. we evaluated the quality of the clustering with several manually curated or simulated benchmark datasets. as expected, the clustering obtained after step 2 (louvain) shows a higher specificity but lower sensitivity than after step 1 (silix) (  
