sequence analysis quantifying tumor heterogeneity in whole-genome and whole-exome sequencing data motivation: most tumor samples are a heterogeneous mixture of cells, including admixture by normal (non-cancerous) cells and sub-populations of cancerous cells with different complements of somatic aberrations. this intra-tumor heterogeneity complicates the analysis of somatic aberrations in dna sequencing data from tumor samples. results: we describe an algorithm called theta2 that infers the composition of a tumor sampleincluding not only tumor purity but also the number and content of tumor subpopulationsdirectly from both whole-genome (wgs) and whole-exome (wxs) high-throughput dna sequencing data. this algorithm builds on our earlier tumor heterogeneity analysis (theta) algorithm in several important directions. these include improved ability to analyze highly rearranged gen-omes using a variety of data types: both wgs sequencing (including low $7 coverage) and wxs sequencing. we apply our improved theta2 algorithm to wgs (including low-pass) and wxs sequence data from 18 samples from the cancer genome atlas (tcga). we find that the improved algorithm is substantially faster and identifies numerous tumor samples containing subclonal populations in the tcga data, including in one highly rearranged sample for which other tumor purity estimation algorithms were unable to estimate tumor purity. availability and implementation: an implementation of theta2 is available atseveral recent studies indicate that most tumor samples are a heterogeneous mixture of cells, including admixture by normal (non-cancerous) cells and subpopulations of cancerous cells with different complements of somatic aberrations . characterizing this intra-tumor heterogeneity is essential for several reasons. first, an estimate of tumor purity, the fraction of cancerous cells in a tumor, is necessary for accurate identification of somatic aberrations of all types in the sample. most cancer genome sequencing studies use a re-sequencing approach to detect somatic aberrations. reads from a tumor sample (and usually a matched normal sample) are aligned to the human reference genome. differences in the sequence of aligned reads, the number of aligned reads or the configuration of aligned reads (e.g. split reads or discordant pairs) are used to infer the presence of single nucleotide or other small variants, copy number aberrations or structural aberrations, respectively . however, the presence of intra-tumor heterogeneity can dilute the signals required to identify somatic aberrations. second, estimates of the composition of a tumor sample including not only the tumor purity, but also the number and fractions of subpopulations of tumor cellsprovide useful for understanding tumor progression and determining possible treatment strategies . in particular, clonal somatic aberrations that exist in all tumor cells are likely early mutational events and their identification sheds light on the early stages of cancer. conversely, subclonal somatic aberrations might reveal properties shared by a subset of tumor cells, such as drug resistance or ability to metastasize. identification of such aberrations and subpopulations of tumor cells might inform treatment strategies, and/or help predict metastasis/relapse. in the past few years, several methods to infer tumor purity and/or tumor composition have been developed. these methods generally fall into two categories: (i) methods that use somatic single-nucleotide variants (snvs) and (ii) methods that use somatic copy number aberrations. snv-based methods such as expands , pyclone and many others use clustering of variant allele frequencies to determine tumor populations and frequencies. while these types of methods are able to derive multiple tumor subpopulations, they often require estimates of copy number for each region containing snvs. deriving such estimates for highly rearranged aneuploid tumors is as difficult as the estimation of intra-tumor heterogeneity itself. moreover, these approaches require high-coverage sequencing to overcome the high variance in read counts at individual snvs. for example, both pyclone and phylosub explicitly require deeply sequenced data. thus, less expensive low-coverage sequence data as generated in tcga is not amenable to these approaches. copy number-based methods such as absolute and cnanorm use observed shifts in read depth due to copy number aberrations to predict to whom correspondence should be addressed. y the authors wish it to be known that, in their opinion, the first two authors should be regarded as joint first authors. tumor purity, but do not explicitly consider multiple tumor subpopulations, and therefore may return purity estimates that only reflect a single subpopulation of tumor cells in a sample. in, we introduced the tumor heterogeneity analysis (theta) algorithm to infer the composition of a tumor sampleincluding both the percentage of normal admixture and the fraction and content of one or more tumor subpopulations that differ by copy number aberrations. in this article, we present theta2, which extends the theta algorithm in several important directions. first, we substantially improve the computation for the case of multiple distinct tumor subpopulations in a sample. second, we extend theta to infer tumor composition for highly rearranged genomes using a twostep procedure where initial estimates are made using highconfidence regions of the genome, and then are extended to the entire genome. third, we devise a probabilistic model of b-allele frequencies (bafs), which can be used to solve the identifiability issue when read depth alone is consistent with multiple possible tumor compositions. finally, we extend theta to analyze whole-exome (wxs) sequencing data. we apply our new algorithm to both whole-genome (wgs) (including low-pass) and wxs sequence data from 18 samples from the cancer genome atlas (tcga). we find that the improved algorithm is substantially faster and able to analyze highly rearranged genomesidentifying numerous tumors with subclonal tumor populations in the tcga data. where available, we compare our purity estimates to published values for absolute . while the purity estimates are largely in agreement for higher purity samples, we find cases where absolute fails or underestimates purity, but theta2 identifies multiple tumor subpopulations. these improvements greatly expand the range of sequencing data and tumors for which we can infer tumor composition.we ran theta2 on simulated data, wgs (including low-pass data 57 coverage) and wxs data from 18 breast carcinoma, ovarian carcinoma, glioblastoma multiforme, kidney renal clear cell and lung squamous cell carcinoma samples from tcga (supplementary). where available, we compare our estimates of tumor purity to the estimates reported by the absolute algorithm that estimates purity from snp array data. the rest of this section is organized as follows. first, we discuss results on simulated data. second, we demonstrate theta2s performance on wxs data, including comparison of results for samples for which both wgs and wxs data were available. next, we present in-depth analysis of several wgs samples to demonstrate the efficacy of theta2 on highly rearranged genomes, using both low-pass and moderate coverage sequence data. finally, we apply our probabilistic model of bafs to one sample and disambiguate between two equally likely solutions.we introduced an algorithm to infer tumor composition of highly rearranged genomes from wgs (high or low coverage) or wxs dna sequencing data. these are implemented as improvements to our theta algorithm. the theta2 algorithm is able to analyze highly rearranged, aneuploid samples that are beyond the scope of existing algorithms that infer tumor heterogeneity. a recently published comparison of algorithms for inferring tumor purity showed that our original theta algorithm performed well, but sometimes underestimated tumor purity when run to only consider normal cells and one tumor subpopulation. we argue that this purity underestimation is likely a result of not directly considering all tumor subpopulations in the sample. in every sample that we analyzed with the new algorithm, tumor purity was higher when considering multiple tumor subpopulations. although the improved theta2 presented here is useful on a wide range of sequencing data from different tumors, some limitations remain. first, theta2 is unable to distinguish tumor subpopulations that are not differentiated by copy number aberrations. as copy number aberrations are ubiquitous in most solid tumors , we expect that theta2 will be applicable to many genomes. however, for some diploid tumors, snv analysis is preferable. incorporation of additionaljiwgs j[jiwxs j where i wgs and i wxs are the interval partitions for the wgs and whole-exome data, respectively, and i is the set of intervals longer than 100 kb contained in both i wgs and i wxs. cna sim is the fraction of i where the copy number estimates are the same between the two data types. indicates that the sample did not pass the criteria to be considered for multiple tumor populations (see supplemental material). a for sample tcga-06-0214, wgs data were aligned to hg18 and wxs data aligned to hg19. see supplementaryfor purity estimates across all genomes analyzed and results using an additional similarity metric. bolding indicates the sample for which theta2 can estimate purity, but absolute reports as highly non-clonal and is unable to estimate purity. information, such as bafs for somatic and germ line snps, into the model may also increase the scope of samples for which theta2 is applicable. second, while the improvements presented here greatly decrease the computational burden of the algorithm when considering multiple tumor populations, the algorithm remains exponential in the size of the interval partition of the reference genomemaking it impractical to infer tumor composition with more than a handful of subpopulations in many cases. identification of further mathematical restrictions to the domain of interval count matrices, or use of sampling techniques in place of complete enumeration are future avenues of investigation, which may prove useful in this respect. additionally, when considering multiple tumor subpopulations, the quality of the results is limited by features of the data including the presence of copy number aberrations that distinguish subpopulations as well as the number of sequence reads available to identify these aberrations. the later is a function of sequencing coverage, aberration length and proportion of cells that have the aberration. while the limited number of tumor subpopulations that theta2 analyzes may not be sufficient to fully analyze tumor progression, theta2s ability to recover subpopulations with relatively low-coverage sequencing data can provide some insight into tumor subpopulations in cases where methods that rely on high-coverage data cannot. combining theta2s output with other methods that do explicitly consider the phylogenetic history of a tumor such asmay prove a useful avenue of exploration. the two-step procedure introduced here allows us to infer subclonal copy number aberrations at much smaller scales. however, some care is required to avoid overfitting the data,particularly for small, subclonal copy number aberrations where gc bias or other sequencing artifacts may lead to incorrect inferences. incorporating more sophisticated segmentation procedures that account for such effects and appropriately scale read counts are useful directions for future research. finally, this work focuses on the important first step of quantifying intra-tumor heterogeneity from a single mixed tumor sample. downstream analysis including the clinical and functional impact of the inferred tumor composition is an important area for future work.we present a new algorithm, theta2, to infer the composition of a tumor sampleincluding both the percentage of normal admixture and the fraction and content of one or more of tumor subpopulations that differ by copy number aberrations. the new algorithm builds on our theta algorithm , and includes several improvements that allow us to analyze highly rearranged genomes from wgs (high and low coverage) or wxs sequencing data. in addition, the new algorithm is orders of magnitude faster and allows us to use bafs to distinguish between different reconstructions.  
