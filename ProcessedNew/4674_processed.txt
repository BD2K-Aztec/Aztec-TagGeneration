sequence analysis tipp: taxonomic identification and phylogenetic profiling motivation: abundance profiling (also called phylogenetic profiling) is a crucial step in understanding the diversity of a metagenomic sample, and one of the basic techniques used for this is taxonomic identification of the metagenomic reads. results: we present taxon identification and phylogenetic profiling (tipp), a new marker-based taxon identification and abundance profiling method. tipp combines sate-enabled phylogenetic placement a phylogenetic placement method, with statistical techniques to control the classification precision and recall, and results in improved abundance profiles. tipp is highly accurate even in the presence of high indel errors and novel genomes, and matches or improves on previous approaches, including nbc, motu, phymmbl, metaphyler and metaphlan. availability and implementation: software and supplementary materials are available atmetagenomic studies of microbial communities commonly generate millionsto hundreds ofmillionsofsequencingreads.theassignment of accurate taxonomic labels to these sequences is a critical componentinmanyanalyses,butiscomplicatedbythefactthatthemajority ofthe organisms found in environmental or host-associated communities cannot be easily cultured in a laboratory, and of the organisms that can be cultured, an even smaller number have been sequenced, even partially. thus, these commonly encountered organisms are largely absent from existing databases of known genomes and genes. providing taxonomic labels to metagenomic sequences requires extrapolating the knowledge contained in sequence databases to previously unseen deoxyribonucleic acid (dna) strings. simple similarity-based approaches (e.g. picking the best database hit as the best guess at the taxonomic label) have been shown to be insufficiently accurate , leading to the development of new and more sophisticated methods. recently developed methods improving on the simple similarity-based approaches include (a) composition-based approaches that rely on various machine learning techniques (support vector machines in phylopythia and phylopythias , interpolated markov models in phymm , bayesian models in nbc), or neural networks ] to classify sequences based on their dna composition (usually based on the frequency of short k-mers), (b) more sophisticated analyses of similarity search results [e.g. using lowest common ancestor aggregation in megan , or classifiers built from similarity search results as done in metaphyler , metaphlan and motu or protein profiles in carma ], and (c) combinations of multiple approaches (e.g., composition and similarity based approaches in phymmbl . some of these approaches (e.g. most of the composition-based approaches) can be applied to any dna sequence. however, others are specific to a reference collection of carefully selected genes (e.g. metaphyler, metaphlan and motu use a collection of universal or cladespecific marker genes), and so are called marker-based methods. abundance profiling, also called phylogenetic profiling, seeks to estimate the relative abundance of the species (or genera, or families, etc.) within a sequence dataset. while many methods produce these estimates by characterizing most (or all) of the sequences in the dataset, marker-based methods produce these estimates by characterizing only those sequences that match the marker genes they rely on. the marker genes used by some of these methods (e.g. metaphyler and motu) are supposed to be single copy and universal; thus, the estimates produced using such markers can be used for profiling without needing to correct for copy number or missing data. we present taxon identification and phylogenetic profiling (tipp), a new marker-based method for taxon identification and abundance profiling. we explore tipp for abundance profiling using metaphylers collection of 30 marker genes, but tipp can be used with any single-copy gene for which a dense enough sample of full-length sequences is available. tipp is implemented in python and can be run on unix and mac.experiment 1: easy datasets. our first experiment explored datasets with low error rates coming from known genomes. on the long read easy datasets, motu had generally poor performance (supplementary), and also failed to run on some of these datasets (terminated with an error message, see supplementary section s1.6); we, therefore, omit motu from the long read results.shows the average hellinger distances on the easy datasets; figures and tables for individual datasets can be found in supplementary section s1.1. results on the long read datasets (left subfigure) show that tipp had the best overall accuracy, followed by nbc. metaphlan was in third place in terms of overall performance (though metaphyler was more accurate than metaphlan at the class level). finally, phymmbl was theall easy datasets easy short read datasets excluding metaphlan datasets. experiment 1: errors in abundance profile estimates on easy datasets. we show average hellinger distance for different methods on simulated metagenome datasets containing known genomes and query sequences with low rates of sequencing error (seefor list of datasets). we omit motu from the long read results because it failed to complete on the facs hc and webcarma datasets. results are shown for (a) all datasets, and (b) easy short read datasets after excluding the metaphlan datasets (thus on webcarma illumina and facs hc illumina datasets). see section s1.1 for results on individual datasets least accurate on these data. on the short read datasets (right subfigure), results were somewhat different. first, while motu had poor performance on the long read datasets, motu had the best overall accuracy of all methods on the short read datasets. at the species level, metaphlan tied with motu for first place, followed by tipp and then nbc. at the genus level, motu had the best accuracy, but tipp and metaphlan were very close seconds. results at the family through class levels showed tipp and motu tying for first, with metaphlan in third place. finally, at the phylum level, tipp, metaphlan, metaphyler and motu tied for first, with much better accuracy than nbc or phymmbl. because metaphlan was trained on its datasets, we removed metaphlans datasets and re-evaluated performance . on this reduced set, metaphlan tied for first at the species level (slightly less accurate than motu, but equal to tipp), but was much less accurate than tipp at all other levels. tipp had the best overall performance on these data, though it tied for first with motu at the genus level, and tied for first with phymmbl at the phylum level. experiment 2: datasets with known genomes and high rates of indel errors.shows the average performance of different methods on datasets with known genomes and simulated with high rates of indel errors. we omit results for motu because it terminated with error messages on all these datasets (see supplementary section s1.6). we also omit results for metaphlan, metaphyler and nbc on the long read datasets as they estimated taxonomic profiles that were completely unclassified on some of the long read datasets. on the long read datasets (left subfigure), only tipp and phymmbl successfully ran on all the datasets. other methods either terminated early or could not classify fragments on some of the datasets. tipp had the best accuracy of all methods at all taxonomic levels. phymmbl was the next best method. on the short read datasets (right subfigure), metaphlan and tipp had the best results, with metaphlan more accurate than tipp at the species level but the two methods generally having indistinguishable performance at the other levels. phymmbl had the least accurate results of all methods, followed by nbc.shows results for datasets with little to no indel errors, and the bottom row shows results for datasets with high rates of indel errors (12 insertion and 2 deletion errors per base). the left column shows results for datasets containing long reads, and the right column shows results for datasets containing short reads. see section s1.3 for results on individual datasets. experiment 2: error in abundance profiles for datasets with known genomes and high indel error rates. we show average hellinger distance for different methods on simulated metagenome datasets with known genomes and simulated with indel errors. we omit motu from the results because it failed to complete on any of these datasets. we omit metaphlan, metaphyler, and nbc from the long read datasets as they could not classify any reads from at least one of the following datasets: webcarma (metaphlan), facs hc (nbc and metaphyler), and fames lc (metaphyler). see section s1.2 for results on individual datasets 3553 tipp characterized very few reads (see supplementary). finally, phymmbl was clearly more accurate than metaphlan, which was more accurate then nbc. on the short read novel genome datasets (right column), tipp and metaphyler were distinctly more accurate than all other methods for both easy datasets and high indel datasets (with tipp slightly more accurate in the presence of high indels, and metaphyler slightly more accurate on the easy datasets). the performance of motu was interesting: on the easy short read novel genome datasets, motu was very close to phymmbl but slightly less accurate; however, motu failed to complete on the high indel short read datasets (terminated with an error message, see supplementary section s1.6). the other methods were largely indistinguishable from each other, but much less accurate than both tipp and metaphyler.the study compared four marker-based methods (motu, tipp, metaphyler and metaphlan) and two composition-based methods (phymmbl and nbc) on a collection of datasets. on the easy datasets with only known genomes (experiment 1), many methods produced highly accurate abundance profiles, although which method was the best depended on the read length. on the easy short read datasets the most accurate methods were motu, metaphlan and tipp, while the most accurate methods on the easy long read datasets were tipp and nbc, with metaphlan a close third. however, when datasets had novel genomes or high indel error rates, the performance of most methods degraded significantly. for example, while nbc had excellent accuracy on the easy long read datasets, it had poor accuracy in the presence of high indel rates. similarly, although motu had excellent accuracy on easy short read datasets with known genomes, it had poor performance on short read datasets with novel genomes and terminated with an error message on the datasets with high indel rates. we also saw that metaphyler had difficulties on datasets with long sequences and high indels (experiments 2 and 3). tipp did well on the easy datasets (known genomes with low sequencing error rates), where it tied for first with other methods. however, tipp was the only method that was robust to all the tested model conditions (short versus long reads, novel versus known genomes, low indel versus high indel error rates), so that it was either first or tied for first under even very difficult conditions (novel genomes with high indel rates). consequently, tipp dominated the other methods in terms of overall performance. thus, one of the main features of tipp is its relative robustness to sequencing errors (both substitutions and indels) and its ability to perform well on novel genomes. we conjecture that the hmm family technique within tipp provides this robustness, which uses hmms in a divide-and-conquer framework, and also benefits from the use of local alignment techniques. therefore, the high error rates commonly encountered in single-molecule sequencing technologies [up to 14 indel rate for pacific biosciences technologies (] that are likely to be increasingly used in the context of metagenomic data may not be particularly problematic for tipp, even when the data contain novel genomes. instead, our results indicate that tipp may well continue to have good accuracy with new sequencing technologies that result in reduced data quality. one of the interesting observations in this study is that the marker-based methods (tipp, metaphlan, motu and metaphyler) often gave more accurate abundance profiles than the composition-based methods (nbc and phymmbl), even though marker-based methods estimate abundance profiles by characterizing only those reads that map to their selected marker genes. these results show that accurate profiles can be obtained by taxonomic characterization of only a fraction of the query sequences. however, the choice of marker genes, and the technique used to bin the reads to the markers, has an impact on the resultant abundance profile. thus, future research should investigate whether improved performance can be obtained using a different set of marker genes and different techniques to map reads to the marker genes. also, our abundance profile estimates were based on combining all reads for all markers into one set, and using the distribution estimated for that set; more sophisticated techniques could be used to combine distributions estimated for each marker.  
