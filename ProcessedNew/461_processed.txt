genetics and population analysis a quality control algorithm for filtering snps in genome-wide association studies motivation: the quality control (qc) filtering of single nucleotide polymorphisms (snps) is an important step in genome-wide association studies to minimize potential false findings. snp qc commonly uses expert-guided filters based on qc variables [e.g. hardyweinberg equilibrium, missing proportion (msp) and minor allele frequency (maf)] to remove snps with insufficient genotyping quality. the rationale of the expert filters is sensible and concrete, but its implementation requires arbitrary thresholds and does not jointly consider all qc features. results: we propose an algorithm that is based on principal component analysis and clustering analysis to identify low-quality snps. the method minimizes the use of arbitrary cutoff values, allows a collective consideration of the qc features and provides conditional thresholds contingent on other qc variables (e.g. different msp thresholds for different mafs). we apply our method to the seven studies from the wellcome trust case control consortium and the major depressive disorder study from the genetic association information network. we measured the performance of our method compared to the expert filters based on the following criteria: (i) percentage of snps excluded due to low quality; (ii) inflation factor of the test statistics ; (iii) number of false associations found in the filtered dataset; and (iv) number of true associations missed in the filtered dataset. the results suggest that with the same or fewer snps excluded, the proposed algorithm tends to give a similar or lower value of , a reduced number of false associations, and retains all true associations.genome-wide association studies (gwas) have been shown to be a powerful and successful strategy in identifying genetic variants to whom correspondence should be addressed. that influence common and complex diseases. prior to the advent of gwas in 2005, there were only a few robust, replicated associations identified, such as nod2 for crohns disease (cd;), and pparg, kcnj11 and capn10 for type 2 diabetes (t2d) mellitus . with gwas, there are now more than 30 loci identified for cd and almost 20 loci for t2d . to date , there are over 545 published studies reporting genetic variants responsible for more than 340 common diseases (; http://www.genome.gov/gwastudies). gwas interrogate millions of single nucleotide polymorphisms (snps), and the large-scale genotype calling (which translates probe hybridization intensities into actual genotypes) must fully resort to automated clustering procedures . ideally, snp genotyping yields three clusters of signals, and a subjects genotype can be assigned according to cluster membership . in reality, the clustering methods are unavoidably prone to error, as imperfect clusters of signal clouds can arise due to experimental variation, dna quality and nonspecific hybridization issues . common error patterns include missing calls for snps with overlapping genotype clusters , homozygote heterozygote miscalls , false homozygote calls in heterozygous individuals due to allelic dropout , and erroneous assessment of monomorphic snps as polymorphic . snp quality control (qc) is commonly safeguarded by supervised (i.e. expert-guided) filters to exclude low-quality snps. the supervised expert filters aim to remove snps that fall into the extremes of qc variables including hardyweinberg equilibrium (hwe), missing proportion (msp) and minor allele frequency (maf). the rationale is clear: extreme deviation from hwe is typically used to identify gross genotyping error ; a high msp indicates poor genotype probe performance and low genotyping accuracy ; snps with low maf are more prone to error, as fewer samples would be within a genotype cluster and most clustering-based calling algorithms do not perform well with rare alleles . however, the implementation of expert filters tends to require arbitrary determination of cutoff values for the qc variables, and does not jointly consider all qc features. for example, in gain studies, the minimum snp genotyping quality standards are hwe p-value 0.00033, average msp 3,page: 1732 17311737ensuring the quality of genotype data is essential for drawing accurate and replicable conclusions . in this work, we have introduced a qc algorithm to identify snps with low qc features using criteria determined through pca and dbscan. the proposed filter is in essence an unsupervised (i.e. algorithmdetermined) version of the supervised expert filter to classify snps, and it aims to account for multiple qc variables, provides adaptive cutoff values and automates thresholding decisions. specifically, we use pca to jointly model the potentially highly correlated qc page: 1736 17311737variables, and use dbscan to identify the borders of good-snp clusters that have arbitrary shapes. the boundary of the good-snp cluster can be translated directly to meaningful thresholds for the original qc variables. the proposed algorithm retains the rationale of the expert filter to identify qc outliers, avoids arbitrary decisions on cutoff values and gives contingent msp thresholds for different maf values. the data applications show that with the same or fewer snps discarded due to bad quality, the proposed algorithm has comparable or better performance than the expert filter for all diseases. the underlying rationale of our algorithm is that the majority of genotyped markers have sufficient genotyping quality, and hence low-quality snps can be treated as outliers and be identified by looking for snps with distinct qc features. to facilitate the implementation of the idea, we use pca on the original qc variables. pca consolidates the information from the many correlated qc variables, and projects snps onto a two-dimensional pc plane where good snps clump together into a corner of desirable qc values, whereas bad snps fan out in all directions. it is expected that the pc biplot may differ from one study to another: in our exploration, we have seen different patterns in the biplots for wtccc datasets and for the mdd dataset. yet all biplots have good snps lumped into a corner that corresponds to good qc features. we wish to point out that when using the proposed algorithm, it is important to monitor the features of the retained good snps and tune the neighborhood radius r to safeguard the basic qc criteria. this is because the thresholds for outliers are determined relative to the majority of the data. the tuning becomes particularly crucial if a big proportion of data points are of low quality. for example, in the mdd dataset, there were about 11.4 of snps with msp 10, and our algorithm with the initial change-point r kept snps with msp up to almost 38. tuning of r was thus continued until the maximum msp dropped to 10. in practice, the smaller r is, the more stringent the qc criteria for good snps will be, as a smaller r makes it harder to form a cluster in dbscan. we suggest starting with a value of r determined by fitting a change-point model to the sorted fourth nearest distances, and then further to adjust r until the specific goal is reached, so as to assure the value, the maximum msp, or the percentage of snps removed within reasonable ranges. in our explorations, we found that the change-point r often suggests a reasonable value (e.g. in cad, cd, ht, t1d and t2d) or is at least a good upper bound (e.g. in bd, ra and mdd, judging by the resulting values or the retained maximum msp). given the change-point r, one can reduce its value if a more stringent filter is needed, and increase its value if one wishes to remove only extreme outlier snps. when selecting which qc variables to include in the algorithm, we intend to avoid using mafcs and mafcn because they may obfuscate the true associations. for the rest of the qc variables, it is possible to make other choices for inclusion/exclusion, e.g. to exclude mspall from the proposed qc variable set (i.e. to use five variables), or to include mspall/mafall to the proposed qc variable set (i.e. to use seven variables). while we expected that the performance would not change much, we carried out sensitivity analyses to evaluate the impact of using different qc variables in the proposed algorithm. the results are given in supplementary tables 1, 2 and 3. for comparability, we tuned the r values so that each analysis removed a similar proportion of snps to the original 6-variable analysis. as expected, the 7-and 5-variable analyses performed very similarly to the proposed 6-variable analyses, indicating the robustness of the proposed filter to the different choices of qc variables.  
