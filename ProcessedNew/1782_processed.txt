fast parametric time warping of peak lists alignment of peaks across samples is a difficult but unavoidable step in the data analysis for all analytical techniques containing a separation step like chromatography. important application examples are the fields of metabolomics and proteomics. parametric time warping (ptw) has already shown to be very useful in these fields because of the highly restricted form of the warping functions, avoiding overfitting. here, we describe a new formulation of ptw, working on peak-picked features rather than on complete profiles. not only does this allow for a much more smooth integration in existing pipelines, it also speeds up the (already among the fastest) algorithm by orders of magnitude. using two publicly available datasets we show the potential of the new approach. the first set is a lcdad dataset of grape samples, and the second an lcms data-set of apple extracts. availability and implementation: parametric time warping of peak lists is implemented in the ptw package, version 1.9.1 and onwards, available from github (https://github.com/rwehrens/ptw) and cran (http://cran.r-project.org). the package also contains a vignette, providing more theoretical details and scripts to reproduce the results below.hyphenated techniques, coupling a chromatographic separation step to a detector, are the norm in the analysis of complex biological samples, e.g. in proteomics and metabolomics. a common problem in all applications is that the separation, i.e. the exact time point at which a compound is measured by the detector, is not quite reproducible, hampering comparative analyses. when all measurements have been done in a single batch and peak shifts are expected to be small this is usually not a big problem, but when experimental difficulties arise during the batch, or comparisons with data from different batches or even different machines or labs need to be made, explicit retention time corrections are necessary. several procedures have been proposed in the literature, often indicated with the label time warping . these transform (warp) the time axis of a sample in such a way that the overlap with a reference signal is maximized. parametric time), for example, uses a polynomial transformation. this choice has several advantages: first, the allowed transformations are quite restricted, thus avoiding the common problem of overfitting (at least to some extent). second, the use of such a polynomial warping function often describes processes like column aging quite well. third, the explicit modeling allows for clever use of resources, like defining the warping using regularly injected quality control samples only, and interpolating to find the warping for the real experimental samples . here, we describe a further development in the ptw algorithm: warping is no longer based on complete profiles, such as extracted ion chromatograms in liquid chromatography mass-spectrometry (lcms) applications, but rather on the peak-picked features. this has several important benefits. first of all, in the new approach the optimal warping is obtained by only considering the relevant, information-containing part of the signal. this increases sensitivity, and decreases the need for extensive preprocessing of the data (e.g. baseline correction). second, the process is made faster, sometimes by orders of magnitude. also the increase in calculation time with wider search windows for the weighted crosscorrelation(wcc) optimization criterion is virtually eliminated.in all cases in this paper, quadratic warping functions are chosen. the grape dad data are sufficiently small to be able to zoom in and assess the individual warping functions, yet big enough to present a challenge for the algorithm and to show the type of speed improvements that are possible. indeed, warping the peaks rather than the profiles led to a decrease in computation time of almost an order of magnitude, whereas the results were identical for all practical purposes. not only do the warping functions in both scenarios look very similar, also warping the peaks with the warping functions obtained from the continuous profiles leads to virtually the same values for the wcc optimization criterion: 0.164 against 0.170 (on a scale of 01). aligning the qc samples of the apple data using the new, peakbased ptw algorithm, leads to 26 warping functions, one for every non-reference qc. interpolating the warping functions for the true apple samples on the basis of injection sequence leads to corrected peak positions for all peaks. using the same warpings for the tics, one can visualize the result more easily; this is shown in. the top panel shows the tics of the uncorrected apple samples, arranged per variety in order of injection (bottom to top). the effect of the leaking column is clearly visible: retention times tend to get much larger later in the injection sequence. in contrast, the corrected tics shown in the bottom panel only show minor retention time variations, that are largely random in nature. these can typically be handled by the alignment methods available in the data processing softwarethe bigger shifts caused by, in this case, faulty equipment, usually cannot. in cases where a quadratic warping as used here is not sufficient to align the features, one can try higher-order warping functions. the strategy of obtaining warping coefficients using pooled qc samples also provides a structural solution to a common problem in metabolomics: when comparing two very different groups of samples, the number of common features may be too small, or too much concentrated in one part of the chromatograms, to obtain useable alignments . with technical replicates like the pooled qc samples used here, this problem is eliminated.time warping using peak lists, as described here, brings the alignment of large numbers of complex samples into the realm of the practically feasible. instrument breakdown, for example, no longer necessarily forces samples to be remeasured, which is especially important when only small quantities of samples are available.databases of standards, used for annotation and typically containing only information on peaks and not on raw data, can be used for alignment as well, thereby considerably increasing their usefulness. conflict of interest: none declared.  
