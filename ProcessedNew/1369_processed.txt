determining the evolutionary history of gene families motivation: recent large-scale studies of individuals within a population have demonstrated that there is widespread variation in copy number in many gene families. in addition, there is increasing evidence that the variation in gene copy number can give rise to substantial phenotypic effects. in some cases, these variations have been shown to be adaptive. these observations show that a full understanding of the evolution of biological function requires an understanding of gene gain and gene loss. accurate, robust evolutionary models of gain and loss events are, therefore, required. results: we have developed weighted parsimony and maximum likelihood methods for inferring gain and loss events. to test these methods, we have used markov models of gain and loss to simulate data with known properties. we examine three models: a simple birthdeath model, a single rate model and a birthdeath innovation model with parameters estimated from drosophila genome data. we find that for all simulations maximum likelihood-based methods are very accurate for reconstructing the number of duplication events on the phylogenetic tree, and that maximum likelihood and weighted parsimony have similar accuracy for reconstructing the ancestral state. our implementations are robust to different model parameters and provide accurate inferences of ancestral states and the number of gain and loss events. for ancestral reconstruction, we recommend weighted parsimony because it has similar accuracy to maximum likelihood, but is much faster. for inferring the number of individual gene loss or gain events, maximum likelihood is noticeably more accurate, albeit at greater computational cost. availability: www.bioinf.manchester.ac.uk/dupliphy contact:recent large sequencing projects and development of whole-genome tiling arrays have allowed comparative surveys of copy number variation (cnv) of genes. cnvs arise from gene duplication and loss, and play an important role in genome evolution . differences in copy number are often reflected by differences in gene family size between species, as the result of gene gain via duplication and gene loss. indeed it has been argued that cnvs represent nascent gene families . variation of copy-umber can have enormous functional consequences. cnvs have been shown to be related to a range of diseases , including developmental defects and autism . in other cases, cnvs have shown to offer an adaptive advantage. in humans, an increase in the number of copies of the amylase gene is correlated with high-starch diet , whereas in plasmodium falciparum cnvs can lead to drug resistance . cnvs have also been shown to be under selection in drosophila . large differences in copy number have been found within a number of species, including human , fly , mouse and yeast . cnvs can also be found between sets of closely related species and within populations of the same species . given the importance of the phenotypic effects of cnv, an understanding of the processes of gain and loss is key to understanding functional evolution. specifically, both duplication and gene loss events must be mapped to the underlying phylogenetic tree if we are to correlate genotypic change with phenotypic change or understand the effects of selection. moreover, mapping of duplications and losses to specific branches of a phylogeny allows us to identify lineage specific gain and loss, giving insight into the ongoing adaptation to particular environments . advances in technology have only recently made large-scale resequencing projects and whole-genome tiling array studies cost effective, and hence it is only recently that the importance of cnvs has been recognized. the computational problem of mapping duplications and losses to a phylogeny has, therefore, not been tackled extensively. many of the analysis tools available to determine duplication histories on phylogenetic trees use tree reconciliation techniques . these methods infer gene trees for each gene family, and then reconcile these trees with a known species tree to infer gain and loss events. this approach requires the generation of gene family trees, which may be time consuming and may be affected by bias in certain circumstances . more recently, maximum likelihood has been used to infer the ancestral copy number of gene families given a species tree and gene family sizes for each species , and for chromosome number in relation to polyploidy . these methods differ in their models of genepage: 49 4855in order to be able to further our understanding of functional evolution, we must understand the processes of gene gain and loss. here, we have developed methods for inferring these events and the ancestral gene family sizes on a tree. we have compared the inferences of these methods with cafe , on gene families identified from drosophila data and on simulated data. we see that on drosophila data all methods perform similarly for internal nodes near the tips of the tree, but vary more on longer branches toward to the root. over all gene families we see that the methods produce inferences of gene family size that are more similar to each other than to cafe. even where the average variation in the inferences made by these methods is small it may be important in specific cases, particularly for those families with lots of variation between species. we use simulated data to compare the accuracy of our methods on data with a known evolutionary history and to compare the robustness of these methods on data produced under known conditions. the accuracy of three methods for inferring the number of birth and death events across the whole tree (weighted parsimony, as implemented in dupliphy, and maximum likelihood, as implemented in dupliphy-ml and dupliphy-ml+) was compared across all three models . the maximum likelihood methods provide an accurate estimate of the number of gainloss events, provided rate variation between genes is incorporated in the model. the accurate inference for all three simulation schemes suggest that the model may be reasonably robust to minor misspecification when describing the process of gene gain and loss, although failure to incorporate events that change gene family number by greater than one or affect multiple genes may still cause inaccurate inference. the failure of parsimony to infer correctly the number of events along a branch is a wellknown shortcoming, with the problem being analogous to long branch attraction . we conclude that maximum likelihood, with an appropriate probabilistic model, is well suited for inferring the number of gene gain and loss events along a branch,in order to understand the evolution of gene families through gene duplication and loss, we must be able to map gain and loss events on a phylogenetic tree. the two methods we have developed allow us to map these events to a tree. using gene family data from nine drosophila species, we found that the methods tended to vary more in their inferences of ancestral gene family size on longer branches near the root of the tree. on data simulated under a variety of models, maximum likelihood provides the most accurate and robust method of determining ancestral gene family sizes and identifying the individual events along a branch. however, we also see that weighted parsimony performs equally well as maximum likelihood at ancestral reconstruction on trees with shorter branch lengths. overall, we find that the accuracy of maximum likelihood is dependent on the underlying probabilistic model used to infer gain and loss and that more work is required to accurately describe the processes of gene family evolution.  
