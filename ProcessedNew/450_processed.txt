data and text mining a principal skeleton algorithm for standardizing confocal images of fruit fly nervous systems motivation: the fruit fly (drosophila melanogaster) is a commonly used model organism in biology. we are currently building a 3d digital atlas of the fruit fly larval nervous system (lns) based on a large collection of fly larva gal4 lines, each of which targets a subset of neurons. to achieve such a goal, we need to automatically align a number of high-resolution confocal image stacks of these gal4 lines. one commonly employed strategy in image pattern registration is to first globally align images using an affine transform, followed by local non-linear warping. unfortunately, the spatially articulated and often twisted lns makes it difficult to globally align the images directly using the affine method. in a parallel project to build a 3d digital map of the adult fly ventral nerve cord (vnc), we are confronted with a similar problem. results: we proposed to standardize a larval image by best aligning its principal skeleton (ps), and thus used this method as an alternative of the usually considered affine alignment. the ps of a shape was defined as a series of connected polylines that spans the entire shape as broadly as possible, but with the shortest overall length. we developed an automatic ps detection algorithm to robustly detect the ps from an image. then for a pair of larval images, we designed an automatic image registration method to align their pss and the entire images simultaneously. our experimental results on both simulated images and real datasets showed that our method does not only produce satisfactory results for real confocal larval images, but also perform robustly and consistently when there is a lot of noise in the data. we also applied this method successfully to confocal images of some other patterns such as the adult fruit fly vnc and center brain, which have more complicated ps. this demonstrates the flexibility and extensibility of our method. availability: the supplementary movies, full size figures, test data, software, and tutorial on the software can be downloaded freely from our website http://penglab.janelia.org/proj/principal_skeletonthe fruit fly (drosophila melanogaster) is one of most studied model organisms in biology. it is currently widely used to understand how a real nervous system works. a systems biology approach that we are taking to study the fruit fly brain is to produce 3d digital atlases of this animals nervous system at various developmental time points, including adult, larval and embryonic stages. we have been taking advantage of an on-going effort to generate a collection of 8000 enhancer-trap gal4 lines that would have their neuronal patterns cover the entire set of neurons in the fruit fly nervous system . high-resolution 3d confocal images of these gal4 lines were produced. the scale of the problem is large, in terms of both the large size of each 3d confocal image (hundreds of megabytes to multi-gigabytes each) and the large number of the images in the database (two to five times the number of gal4 lines, as multiple flies of the same gal4 line need to be imaged). therefore, an informatics challenge is how to map the neuronal patterns onto a standard brain in an accurate, reliable and automatic way. a brain mapping study needs several enabling techniques, including 3d image registration (alignment), neurite tracing, neuronal pattern classification, visualization and mining methods . it is often critical to align image patterns that have various orientations, sizes, shape deformations and intensity changes. a classic routine for 3d image pattern registration is to first align patterns globally, followed by a local alignment to transform one pattern to the other . for a pair of image patterns, the purpose of the global alignment is to standardize the patterns as a whole so that they possess similar scales, positions and directions. the affine transformation is commonly used for global alignment. once two patterns have been roughly aligned globally, it is much easier to use the more sophisticated local alignment (e.g.), which is often non-linear and deformable, to register the patterns precisely. the affine alignment was already successfully used in recent efforts to build digitized atlases for model animals, such as the allen mouse brain atlas , the adult fruit fly brain atlas (unpublished work of peng lab) and the singlenucleus resolution atlas of the nematode caenorhabditis elegans . however, for the alignment problem of the fruit fly larval nervous system (lns) in this article, we found that the global affine alignment can hardly be used. as shown in, in the lns the two brain hemispheres and the ventral nerve cord (vnc) form an articulated structure, which is flexible and often skews toward one side. this deformation cannot be described using globalrotation, translation, scaling and shear as used in the affine transform., which is an example of the adult vnc, displays a similar deformation of the shape. therefore, we need a more sophisticated global alignment method to standardize the shape of these patterns, before we can proceed further to the local alignment. intuitively, we considered aligning the backbone, or mid-line, of a curved fruit fly lns or an adult vnc (red skeletons in). a related study was to straighten the strongly curved body of c.elegans by first detecting the curved anterior posterior axis of a worm, and then restacking the resampled image data on the entire series of 1-pixel spacing cutting-planes orthogonal to such a detected backbone. this earlier method is very efficient for c.elegans confocal images and other similar cases where the backbone is a simple smooth curve, and the body of the pattern is not fat (wide) enough so that the slightly non-parallel cutting planes next to each other will not intersect within the pattern. unfortunately, this method cannot be directly used in standardizing a fruit fly larval pattern because the articulated pattern cannot be described as a simple curve, and the fruit fly patterns are often fat/wide enough so that restacking the cutting planes may introduce artifacts especially in the articulated image regions. there are several other skeleton extraction methods . however, they cannot easily produce skeletons of the same topological structure for different input images, and thus will not be very useful for the registration. therefore, in this work we proposed a new approach to standardize the confocal images of fruit fly lns and adult vnc. we detected the principal skeleton (ps) of a shape using an automatic skeleton deformation algorithm (section 2). then we designed a smooth warping method to best align the ps of a pair of image patterns (section 3). our method introduces a minimum amount of degradation of the image quality during the standardization. it is also robust under a variety of conditions. in addition, our method is general. it is not limited to fly larval patterns; indeed it can be applied to any image patterns that have a reasonable ps 1 (section 4).  
