modeling dna methylation dynamics with approaches from phylogenetics motivation: methylation of cpg dinucleotides is a prevalent epigen-etic modification that is required for proper development in vertebrates. genome-wide dna methylation assays have become increasingly common, and this has enabled characterization of dna methylation in distinct stages across differentiating cellular lineages. changes in cpg methylation are essential to cellular differentiation; however, current methods for modeling methylation dynamics do not account for the dependency structure between precursor and dependent cell types. results: we developed a continuous-time markov chain approach, based on the observation that changes in methylation state over tissue differentiation can be modeled similarly to dna nucleotide changes over evolutionary time. this model explicitly takes precursor to descendant relationships into account and enables inference of cpg methylation dynamics. to illustrate our method, we analyzed a high-resolution methylation map of the differentiation of mouse stem cells into several blood cell types. our model can successfully infer unob-served cpg methylation states from observations at the same sites in related cell types (90 correct), and this approach more accurately reconstructs missing data than imputation based on neighboring cpgs (84 correct). additionally, the single cpg resolution of our methylation dynamics estimates enabled us to show that dna sequence context of cpg sites is informative about methylation dynamics across tissue differentiation. finally, we identified genomic regions with clusters of highly dynamic cpgs and present a likely functional example. our work establishes a framework for inference and modeling that is well suited to dna methylation data, and our success suggests that other methods for analyzing dna nucleotide substitutions will also translate to the modeling of epigenetic phenomena. availability and implementation: source code is available at www. kostkalab.net/software. contact:dna methylation is a common epigenetic modification essential to organism development . in vertebrates, dna is most commonly methylated at the fifth carbon position on cytosine nucleotides (5mc) that are followed by a guanine, so-called cpg sites. a family of three dna methyltransferase enzymes (dnmt1, dnmt3a, dnmt3b) is responsible for the establishment and maintenance of methylation state at the millions of cpg sites in most mammalian genomes . recently, the ability to perform genomewide assays of the methylation state of individual cpgs has become a reality because of advances in microarray and dna sequencing technology. several approaches that vary in their accuracy, biases, coverage and cost are commonly used; see laird (2010) for a detailed review of current methods. systematic screening of dna methylation across tissue differentiation and development has improved our knowledge of its role in these processes . the methylation profile of the mammalian genome is largely stable, but the methylation of specific genomic regions changes dynamically across development, and different cellular lineages have unique methylation profiles . additionally, the dna methylation state nearby a genes transcription start site (tss) correlates with gene expression , and the correct orchestration of methylation changes is essential for proper cellular differentiation. aberrant methylation changes may lead to tumorigenesis and other diseases . studies assaying dna methylation often focus on the comparison of two types of conditions, like tumor versus normal tissue , or stem cells versus lineage-committed cells . however, the natural process of cellular differentiation and development has an essentially tree-like topology, in which precursor cell types are connected to their descendants by edges, thereby forming a so-called lineage tree . for example,depicts a lineage tree for blood cell differentiation, where dna methylation has been assayed in cell types represented by nodes . independent pairwise comparisons cannot accommodate this structure. to address this issue, we introduce an approach to model methylation state changes between cell types that explicitly takes dependencies induced by the lineage tree into account. in this setup, modeling methylation changes over developmental time is in many ways reminiscent of describing dna nucleotide changes over evolutionary time . as a result, we adapt established continuous-time markov models of sequence evolution to fit this task. in addition to accommodating cell lineage relations during development, our approach has the benefit that it works at single cpg dinucleotide resolution and does not require the spatial aggregation of methylation measurements across the genome. finally, the analogy with models for dna sequence evolution provides intuitive means to handle missing data, which are common in many dna methylation datasets. during parameter to whom correspondence should be addressed. the author 2014. published by oxford university press. this is an open access article distributed under the terms of the creative commons attribution non-commercial license (http://creativecommons.org/licenses/by-nc/3.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. for commercial re-use, please contact journals.permissions@oup.com estimation, missing data can be marginalized over, and the equivalent of joint ancestry reconstruction allows efficient inference of the most likely methylation states for unobserved data in context of the lineage tree. as an illustration of our approach, we analyzed methylation data collected across the cell lineage tree infrom. on this dataset, our method enabled the accurate reconstruction of missing methylation states. the single cpg resolution of our analysis allowed us to discover that the identity of neighboring dinucleotides is strongly correlated with cpg methylation dynamics at many sites in the mouse genome. finally, using our predictions of cpg methylation variability, we identified a cluster of highly dynamic cpg sites that show evidence of enhancer activity in blood cells.we applied our methylation dynamics model to an rrbs dataset tracing the differentiation of adult hscs . this study queried a set of over 2 million cpg sites at different stages during blood lineage differentiation, and the assayed cell types with their relationships are summarized in the lineage tree in. we fit a model with four rate categories (three variable and one invariant) to the discretized methylation status of cpg sites along each chromosome (section 2). the maximum likelihood estimates of the model parameters qualitatively agree across chromosomes, and the resulting model is consistent with several previous findings. invariant cpg sites are more prevalent than variable sites ; 61 of cpgs are invariant in our analysis, and 13, 12 and 14 fall into the slow, medium and fast rate categories, respectively. as expected, the equilibrium distribution for variable states favors methylated cpgs, i.e. u 5 p 5 m for all chromosomes. contrasting the dynamics at variable and invariant cpg sites, we find that invariant sites are most likely to remain unmethylated during differentiation (61), whereas variable sites are most likely to be in methylated states (57). the branch lengths obtained in our fitted models reflect the number of expected methylation state transitions between cell types, and we see the longest branch lengths between mep and ery cells and between hsc and mpp1 cells (t = 4.65 and t = 0.97 averaged over chromosomes, respectively). these numbers correspond to an expected fraction of cpg sites with observed methylation changes of 24 for mep !ery and of 17 and for hsc !mpp1, taking into account the prevalence of invariant sites and the different rate categories for variable sites. this is in qualitative agreement with previous i410in this article, we adapt phylogenetic markov models, which are prevalent in comparative genomics and statistical genetics, to accurately and efficiently analyze dna methylation dynamics across lineage specification. as a proof of concept, we model rrbs methylation data collected from 13 related stages of blood cell development . using our model, we illustrate that (i) cpg site methylation status can be accurately reconstructed using data from related cell types at the same site, (ii) the single cpg site resolution of our methylation dynamics estimates enable the discovery of attributes, such as dna sequence context, that correlate with cpg methylation dynamics and (iii) our models facilitate the identification of genomic regions with highly variable cpg methylation states that are likely functional. there are many additional methodologies that could be mapped from the rich reservoir of statistical genomics to the application of modeling methylation dynamics. it will be exciting to see which will prove most useful as genome-wide methylation data continue to be collected to elucidate tissue differentiation and development. for instance, our analyses confirm that methylation dynamics are different between cpg sites located in cpg islands and those elsewhere in the genome. thus, one way to extend our current approach would be to use different parameterizations based on such external annotations, as is commonly done when modeling coding versus non-coding sequence in comparative genomics. further on, such models could also be integrated in a hidden markov model (hmm) framework (as in phylo-hmms ), which could lead to genome segmentations that account for methylation dynamics. an hmm framework has already proven useful in modeling the density of cpg sites across a genome and defining cpg islands . in section 3.1, we demonstrated that progenitordescendant relationships in the lineage tree can be used to accurately reconstruct the methylation status of cpg sites in different cellular contexts (average of 90 accuracy). these vertical relationships enabled more accurate reconstruction on the rrbs dataset analyzed here than using nearest genomic neighbors to predict missing values. however, we note that there are many methods for reconstructing missing cpg methylation status using genomic information. these methods have largely focused on cpgs in cpg islands, but a recent approach used a random forest classifier to accurately (9194) predict cpgmethylation from a methylation array based on a suite of features including neighboring cpg methylation status and overlapping genomic elements. however, the cpg coverage provided by methylation arrays and rrbs assays is different , so it is difficult to directly compare the results of these methods on different datasets. nonetheless, our approach is complementary to existing methods for reconstructing dna methylation that use neighboring cpg sites along the genome. context-dependent models that integrate such vertical (i.e. progenitor to descendant) and horizontal (i.e. distance on chromosome) relationships have the potential to further improve methods for reconstructing unobserved states and highlighting functionally relevant shifts in methylation. most existing methods for analyzing dna methylation dynamics are based on pairwise comparisons of cellular contexts . for example, ziller et al. (2013) identify cpgs with large differences in their estimated methylation between pairs of tissues or cell lines, and then they cluster these to highlight differentially methylated regions. this type of pairwise comparison is appropriate for much of the methylation data currently available, but existing methods are challenging to generalize to analysis of more densely sampled sets of dependent cell types. to address this, our approach explicitly models the existence of statistical dependencies between methylation states from multiple related cell types. thus, it enables multivariate analyses of methylation patterns in differentiating cell lineages (like those from), but it may not provide much improvement when analyzing essentially independent samples (like distantly related terminally differentiated cell types). in addition, our strategy is subject to the discretization of methylation status in a population of cells into discrete methylation states. the three states and the thresholds we use are supported by the distribution of methylation values in our data, but including direct modeling of counts of methylated versus unmethylated instances of a cpg site into our approach is a promising future direction. dna methylation is just one of several dynamic epigenetic biochemical modifications regulating precise spatiotemporal gene expression patterns that are essential for proper development. the approach we have demonstrated here provides an integrative, multivariate framework for modeling any epigenetic changes across multiple cell types and lineages. as phylogenetic models proved essential in the identification and interpretation of functional dna sequence regions, we believe that lineage treeaware markov models of epigenetic dynamics can play a similar role in developing a deeper understanding of epigenetic phenomena and their roles in tissue differentiation and vertebrate development.  
