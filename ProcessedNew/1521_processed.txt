gene expression ebseq: an empirical bayes hierarchical model for inference in rna-seq experiments motivation: messenger rna expression is important in normal development and differentiation, as well as in manifestation of disease. rna-seq experiments allow for the identification of differentially expressed (de) genes and their corresponding isoforms on a genome-wide scale. however, statistical methods are required to ensure that accurate identifications are made. a number of methods exist for identifying de genes, but far fewer are available for identifying de isoforms. when isoform de is of interest, investigators often apply gene-level (count-based) methods directly to estimates of isoform counts. doing so is not recommended. in short, estimating isoform expression is relatively straightforward for some groups of isoforms, but more challenging for others. this results in estimation uncertainty that varies across isoform groups. count-based methods were not designed to accommodate this varying uncertainty, and consequently, application of them for isoform inference results in reduced power for some classes of isoforms and increased false discoveries for others. results: taking advantage of the merits of empirical bayesian methods , we have developed ebseq for identifying de isoforms in an rna-seq experiment comparing two or more biological conditions. results demonstrate substantially improved power and performance of ebseq for identifying de isoforms. ebseq also proves to be a robust approach for identifying de genes. availability and implementation: an r package containing examples and sample datasets is available atappropriate expression of a genes isoforms via alternative splicing is fundamental to normal development and maintenance in eukaryotes, and aberrations in alternative splicing are common in disease . consequently, there is much interest in identifying isoforms with expression that varies on average across biological conditions. high-throughput cdna sequencing (rna-seq) experiments provide the potential to identify such differentially expressed (de) isoforms on a genome-wide scale, but statistical methods are required to ensure that accurate identifications are made. the statistical methods available for identifying differences in isoforms in an rna-seq experiment [e.g. miso , fdm , chi-square test in] have focused on changes in the proportion of gene-specific reads assigned to an isoform, so-called differential transcription (dt) or differential splicing (ds). these methods do not consider changes in overall expression levels and are therefore not appropriate for identifying de isoforms. for example, consider a gene with two isoforms: the first with average counts 500 and 1500 in conditions 1 and 2, respectively, the second with average counts 1000 and 3000 in the two conditions, respectively. these isoforms would not be dt or ds, given that the proportion of total reads assigned to each isoform is unchanged across conditions (1/3 for isoform 1 and 2/3 for isoform 2), but the isoforms would likely be called de, given there is a 3-fold increase in expression in the second condition. when isoform-level de calls are required, count-based methods developed for identifying de genes are often applied directly to estimates of isoform expression . doing so is not optimal. the main problem is that count-based methods expect counts, or more specifically, an integer summary of reads mapping to a genes constituent exons, and they were not designed to accommodate the differential uncertainty induced by isoform expression estimation. in short, prior to isoform de inference, each isoforms expression must be estimated from aligned reads. for genes with a single isoform, this problem is rather straightforward in that all reads mapping to that gene are used to estimate that isoforms expression. for genes with multiple isoforms, isoform expression estimation is more difficult, as reads mapping to exons common to multiple isoforms must be allocated in a way consistent with each isoforms expression level, which is the very quantity being estimated. there are a number of methods available for estimating isoform expression [rsem , rseq , isoem (to whom correspondence should be addressed. the author 2013. published by oxford university press. this is an open access article distributed under the terms of the creative commons attribution non-commercial license (http://creativecommons.org/licenses/ by-nc/3.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. for commercial re-use, please contact journals.permissions@oup.com 2010), cufflinks and iqseq (. whatever method used, due to the increased difficulty inherent in estimating isoform expression for isoforms with common constitutive exons, there are varying levels of uncertainty in isoform expression estimates (see). most approaches for identifying de in an rna-seq experiment focus on genes [deseq , edger , bayseq , bbseq (, and do not accommodate this differential uncertainty. consequently, they are not appropriate for identifying de isoforms. another recently developed approach)] may be used for identifying de exons, but does not provide information on which associated isoforms are de. when isoform de is of interest, some count-based methods (e.g. edger) suggest choosing a single isoform [such as the isoform with the most counts within a gene or the longest isoform (and estimating expression using reads mapping to the isoforms constituent exons. in either case, information on other isoforms is lost, and reads mapping to multiple genes are ignored. a more serious consideration is that erroneous conclusions may be made due to differences in other isoforms (seefor an example). other methods such as easyrnaseq suggest that one assign all reads mapping to overlapping exons to each isoform separately (i.e. count reads mapping to exon 2 intwice, once for each isoform), and then proceed with a count-based approach. as with the prior suggestion, this can lead to erroneous conclusions. specifically, an isoform may appear to be equally expressed (ee, say isoform 1 in), even if it is not. a potentially more robust way to proceed is to estimate each isoforms mrna counts using a method designed specifically to do so and then apply a count-based approach directly to expected counts after rounding the expected counts to the nearest integer. this, too, is not advised. count-based methods require gene-level counts and consequently do not account for uncertainty inherent in estimated counts. furthermore, given that uncertainty varies systematically for different groups of isoforms, applications of count-based approaches for isoform level inference result in reduced power for some classes of isoforms and increased false discoveries for others. in short, the test statistics used by most methods for de gene identification calibrate a difference in expression levels between conditions by a variance, which is commonly estimated using the meanvariance relationship observed in data.shows that this relationship varies dramatically for different groups of isoforms, where groups are defined by the number of constituent isoforms of the parent gene (other definitions are possible as discussed below). specifically, an isoform of gene g is assigned to the i g k group, for example, where k 1, 2 or 3, if the total number of isoforms from gene g is k (the i g 3 group contains all isoforms from genes having 3 or more isoforms).shows two hypothetical genes g and g 0. gene g has one isoform, denoted by i g 1; gene g 0 has two (i g 0 2). the problem of estimating expression for isoforms of g 0 is complicated by the fact that reads mapping to exon 2 must be unambiguously assigned to each isoform. this results in increased uncertainty, on average, in expression estimates for isoforms sharing a parent.shows hypothetical expression of the isoforms from gene g 0 in each of two conditions (assuming differences in library size have been accommodated). if one focuses on the longest isoform (isoform 1) and uses all reads mapping to its constituent isoforms to estimate its expression, the isoform is called equivalently expressed, as there are 30 (6 22 2) reads mapped in condition 1 and 30 (10 16 4) mapped in condition 2. however, if the expression of other isoforms is considered, it becomes clear that isoform 1 contains almost twice as many reads in condition 2 as in condition 1 (23 versus 13, respectively). panel (c) demonstrates how estimation uncertainty changes as isoform complexity increases. we quantified isoform complexity here by i g where the i g k group represents isoforms from genes with k isoforms (here isoforms from genes with more than three isoforms are included in the i g 3 group; alternative definitions of complexity are discussed in the text). shown top right are splines fit to the empirical variance as a function of the mean for all isoforms as well as isoforms within groups defined by i g for the two-group human embryonic stem cell rna-seq experiment described in section 2; bottom right considers isoforms with average expression (expected count) in. the range was chosen as it approximates the 50th and 80th percentiles of expression across all isoforms. shown are box plots of the variances of these isoforms collectively, and within i g group. median variance within each group is shown rightas shown in, there is decreased variability in the i g 1 group, but increased variability in the others, due to the relative increase in uncertainty inherent in estimating isoform expression when multiple isoforms of a given gene are present. this observation is not specific to the dataset and/or the method used for isoform expression estimation; it is also not specific to the particular method used for quantifying isoform complexity (see supplementary figs s1s4 for additional examples). if isoforms are analysed collectively, there is reduced power for identifying isoforms in the i g 1 group (since the true variances in that group are lower, on average, than those derived from the full collection of isoforms) and increased false discoveries in the i g 2 and i g 3 groups (since the true variances are higher, on average, than those derived from the full collection). these effects are demonstrated in a simulation study in section 4 of the supplementary material. cuffdiff2 and bitseq account for differential uncertainty in isoform expression estimates and thus appropriately accommodate de inference at the isoform level. however, cuffdiff2 often finds fewer genes than comparable approaches, and the simulations here suggest this is a result of lack of power, as opposed to an increased false discovery rate (fdr) of other methods. bitseq is a good alternative when ranking isoforms is of interest, but it does not provide a way to control a list of identifications at a desired level of fdr. finally, both approaches couple expression estimation with de inference, and are not applicable to expression estimates obtained separately (e.g. via rsem or one of the other methods mentioned above). as other expression-estimation methods have demonstrated higher precision and continue to be improved, methods for de inference that accept expression estimates directly are desirable. taking advantage of the merits of empirical bayesian (eb) methods, we developed an approach called ebseq for inference in an rna-seq experiment. although its main advantage over other approaches is in its ability to identify de isoforms, results from simulations and case studies demonstrate good performance for identification of de genes as well.simulation studies were conducted to investigate the operating characteristics of ebseq and to assess how ebseq compares with competing approaches. as detailed in section 2, each simulated dataset derives counts from a negative binomial model. the negative binomial assumption is common to each method considered here , and should therefore not provide advantage, or lack thereof, to any one method in particular. furthermore, the form of the variance is not one we assumed in ebseq; rather, it was prescribed in the simulation set-up of robinson and smyth (2007). three sets of simulations are considered here. additional simulations are evaluated in section 4 of the supplementary material. for evaluation of isoform-level inference, ebseq is compared with cuffdiff2 and bitseq. it is important to note that cuffdiff2 and bitseq are not stand-alone packages that accept counts directly. rather, cuffdiff2 requires as input aligned reads that are subsequently processed through cufflinks to estimate counts; bitseq is similar, requiring that reads are processed through bitseq stage 1. this is important, as in the isoform simulation studies (sims i and ii), simulated counts were transformed back to reads as was done in rsem ; the reads were then processed via cufflinks (or bitseq stage 1) prior to analysis. the transformation is not possible with simulated gene counts, as multiple read count configurations can give rise to the same overall gene count, and as a result, cuffdiff2 is not evaluated in the gene simulations; it is evaluated at the gene-level on both maqc project and case study data. bitseq is not evaluated in any gene-level analysis, as the pplr provided for each isoform is derived from isoform-specific markov chain monte carlo (mcmc) samples, and no information is provided on combining the chains to derive a gene-level pplr.shows the power and fdr for ebseq and cuffdiff2 averaged across 100 sim i simulations for a target fdr of 5. cuffdiff2 deems some isoforms unacceptable prior to analysis. acceptable isoforms are called ok in cuffdiff2, and so results are reported for all genes as well as those deemed ok by cuffdiff2. because bitseq provides pplr for rank ordering isoforms, but does not specify how to use pplr to construct a list of de isoforms with a target fdr, it is not shown in. bitseq is evaluated in the roc curves shown in. as shown in, cuffdiff2 has well controlled fdr, but reduced power compared with ebseq ($44 versus $72); the fdr of ebseq is slightly elevated ($8). panel (a) ofshows qualitatively similar results for lists of varying size, not determined by targeting a specific fdr. in particular, the roc curves [empirical true positive rate (tpr) versus empirical false positive rate (fpr) for lists of increasing size] show that the tpr is higher than cuffdiff2 for lists provided by ebseq for all fprs considered. bitseq also provided higher tpr than cuffdiff2 across all fprs, and showed comparable performance with ebseq. a closer look into the de calls from the sim i simulations reveals that operating characteristics are sensitive to , which determines within-isoform variability. to demonstrate the effects, panel (b) ofshows power and fdr for six other sets of simulations where is fixed at a specific value (detailed in sim ii). the solid lines show that the power of both methods decreases as variability increases, with a greater loss in power for cuffdiff2; the dashed lines show that fdr increases slightly but remains well-controlled for both methods.shows the cumulative distribution functions (cdfs) of in four empirical datasets as well as the average cdf from 100 sim i simulations to demonstrate that the values of considered in panel (b) are typical of those observed in data. panel (c) also demonstrates systematic differences between the three datasets with biological replicates and the maqc data. given that the maqc data is made up of technical replicates, it is not surprising to observe relatively smaller values of compared with  
