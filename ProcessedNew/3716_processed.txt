probfold: a probabilistic method for integration of probing data in rna secondary structure prediction motivation: recently, new rna secondary structure probing techniques have been developed, including next generation sequencing based methods capable of probing transcriptome-wide. these techniques hold great promise for improving structure prediction accuracy. however, each new data type comes with its own signal properties and biases, which may even be experiment specific. there is therefore a growing need for rna structure prediction methods that can be automatically trained on new data types and readily extended to integrate and fully exploit multiple types of data. results: here, we develop and explore a modular probabilistic approach for integrating probing data in rna structure prediction. it can be automatically trained given a set of known structures with probing data. the approach is demonstrated on shape datasets, where we evaluate and selectively model specific correlations. the approach often makes superior use of the probing data signal compared to other methods. we illustrate the use of probfold on multiple data types using both simulations and a small set of structures with both shape, dms and cmct data. technically, the approach combines stochastic context-free grammars (scfgs) with probabilistic graphical models. this approach allows rapid adaptation and integration of new probing data types. availability and implementation: probfold is implemented in c . models are specified using simple textual formats. data reformatting is done using separate c programs. source code, statically compiled binaries for x86 linux machines, c programs, example datasets and a tutor-ial is available fromobtaining accurate secondary structure predictions is a crucial step toward understanding the physical properties of rna molecules and the biological roles of structural rna elements. however, computational predictions based only on the primary sequence are often inaccurate and therefore insufficient for in-depth interpretation. similarly, structure probing data typically only provides partial structural information . directly modeling both types of data in the folding process generally improves structure prediction accuracy . while most studies have used methods based on energyminimization, the inclusion of probing data in probabilistic folding models has not been fully explored . here, we develop and explore a modular probabilistic approach for integrating probing data in rna secondary structure prediction, which we call probfold. the focus is on how to best exploit the structure signal of the probing data, while keeping the models general and easy to adapt to new probing data types or additional layers of probing data. we have not aimed to develop a competitive single-sequence structure prediction method. the main focus is therefore on the use of the probing data signal rather than the overall performance. probabilistic modeling offers a coherent framework for combining different types of evidence as they are all naturally measured on the same scale. structure models based on energy minimization do not extend naturally to additional types of data in the same way. for instance, probing data measurements must be translated to pseudoenergy perturbations before they can be included in the models, though they do not have inherent thermodynamic interpretations. probabilistic approaches have previously been used to incorporate comparative evidence in structure folding . this is another example of supplementing the primary sequence with partial structure evidence and as such closely related to the probing data modeling problem studied here. several of these methods exploit that generative probabilistic methods can be combined and their parameters optimized in a unified approach. for instance, pfold combines previously established models of molecular evolution (phylogenetic models) with probabilistic models of rna secondary structure (stochastic context-free grammars scfgs). we aimed to develop a method, called probfold, that could be readily extended to disparate data types and could encompass different probabilistic models for these. in particular they should be able to capture correlations both within and between data types. this is achieved by combining scfgs with probabilistic graphical models (pgms). the scfg defines a prior over secondary structures, as it does in most other probabilistic methods . the pgms model the sequence and any layers of probing data given the structure. pgms are flexible and modular models useful for capturing select dependencies in high dimensional data . in our case, they model dependencies between the sequence and the probing data as well as dependencies along the sequence. standard algorithms allow efficient training of both scfg and pgms as well as prediction of the optimal secondary structure. importantly, this allows probfold to be automatically trained without hand-setting any parameters given a sufficiently sized training set of known structures with probing data. the size of the needed training set depends on the number of free parameters in the model. rna structure probing has a long history and many different methods exist , including use of chemical agents , rnases (,b) and spontaneous cleavage . generally these modify bases or the backbone preferentially at either single or paired positions, allowing positional information on base-pair status through gel electrophoresis or sequencing. in the case of the shape reagent (selective 2 0-hydroxyl acylation analyzed by primer extension), it is the flexibility of the backbone that determines reactivity, which is generally higher for unpaired than paired regions . the interpretation of structure probing data is challenged by incomplete specificity of the methods, noisy or missing data, nucleotide biases, etc., which results in incomplete labeling of the primary sequence into paired and unpaired positions. for instance, in the case of shape, the distributions of reactivities for paired and unpaired bases are largely overlapping (see section 3). there is therefore a great need for computational methods that can integrate and make optimal use of probing data, beyond interpreting the data as a definite labeling of the primary sequence. recently, progress have has been made on this problem with both physics-based methods , sampling based methods and a probabilistic method . these are briefly presented below. see eddy (2014) for a detailed review and discussion of their statistical foundations. in rnastructure , shape reactivities are converted to base-stacking pseudo-energy change terms using a linear model optimized by prediction performance on a known structure (23s rrna from escherichia coli (e.coli)).extends this approach in the rnasc method, by also including pseudo-energy change terms for unpaired positions. gtfold provides a fast parallelized multi-core implementation of the energy minimization algorithm and similarly includes shape data . in an extension of rnafold, pseudo-energy change terms are optimized for each structure given a loss function to maximize the agreement between the energy-based prediction and the experimental observations. in particular, no change is made when the sequence prediction is in complete agreement with the shape data . recently, the viennarna package has been extended to include several forms of soft constraints and specifically include implementations of theapproaches . a thorough performance comparison of the three approaches is also provided . another class of approaches samples structures from the boltzmann-weighted ensemble and selects a representative structure with minimal manhattan distance to a probing data profile . this has been extended to several layers of probing data by a method that reduces them to a single binary pairing status profile . the recently proposed probabilistic method, ppfold 3.0 , extends pfold by modeling both comparative sequence alignment data and experimental probing data. it uses stochastic context-free grammars (scfgs) to model secondary structures, phylogenetic models to model alignment columns and fine-grained discrete probability distributions to model shape probing data. the study provides a proof of concept for including probing data in probabilistic methods. compared to ppfold 3.0, probfold offers a more general, extendible and parameter-sparse modeling approach that is evaluated using cross-validation. we develop probfold using existing shape data combined with an extensive set of known rna structures and evaluate a hierarchy of increasingly parameter-rich models. we find that including both base-pair stacking interactions and neighbor correlations for the shape data improve performance. we also show how multiple types of probing data can be included in the models and may improve prediction performance. we find that the probfold approach exploits the probing data well, generally yielding higher performance gains than other methods, and present automatic procedures for optimizing the models on new data types.we have presented a probabilistic method for rna secondary structure prediction that integrates experimental structure probing data. one of the virtues of our approach is its flexibility. the underlying model was initially developed on a capillary electrophoresis shape dataset, but it can readily be retrained and applied on other data types given sufficient training data as well as extended to handle multiple data types. we demonstrated these extensions with proofof-concept examples on existing datasets and on generated (bootstrapped) data. we developed and trained versions of probfold for shape, shape-seq, dms and cmct probing data both individually and in combination. we also evaluated different variants of these models, for instance including nucleotide dependencies. the flexibility is achieved by the use of a highly modular probabilistic model with accompanying efficient algorithms for training and prediction . as with most other probabilistic rna secondary structure prediction methods , we use stochastic context-free grammars to model the secondary structure. we find limited benefit of modeling stacking interactions, as have others . this may be because individual base-pair parameters already account for most of the stacking interaction effects . we factorize the grammar rules into transitions and emissions. in contrast to other methods, we explicitly specify the emission distributions using probabilistic graphical models (pgms), which may be defined over multi-variate input data. the implementation closely reflects this modularity, with separate textual specifications of the overall grammar, the transitions, the pgms defining the emission distributions; and the mapping of observed data to pgm variables. as part of the model development, we evaluated correlations in the probing data. we found modeling shape probing data correlations along the sequence improved performance, given enough training data was present. in general, detecting and modeling the prominent dependencies in the observed data is expected to improve the fit and the discriminatory power of the emission distributions and hence overall model performance. however, including correlations makes the models more complex with many additional free parameters to learn. given the limited size of probing datasets for training, overfitting and lack of robustness easily becomes a problem, as shown for parameter-rich versions of probfold (e.g. supplementaryand supplementary). probfold bins the continuous probing data values to allow for the use of discrete pgms. this simplifies the pgm implementation, for instance by avoiding computationally expensive numerical integration, and avoids use of analytical continuous distributions with a potentially poor fit. as the structural signal of the probing data depends on the differences in its distribution in different structural regions, both the number of bins and their boundaries are important parameters of the model. we show that the number of bins should be kept small given the amount of available training data to avoid overfitting. we suggest to select bin boundaries by optimizing the difference between the single and pair probing data distribution using kl divergence. as an alternative to discretizing the data, parameter free continuous distributions, such as kernel distributions, could be used. these however easily become computationally heavy, as they in principle are specified by the full training dataset. given knowledge of the uncertainty of the probing data observations, a more satisfying approach would be to explicitly model the uncertainty of the individual probing data values. such knowledge would be available, e.g. with counts from ngs-based probing data, as some of transcriptome-wide approaches produce . the rnastructure method converts shape reactivities to pseudo energy change terms, which are incorporated when predicting the minimal free energy structure . the conversion is done using a simple linear parametric form, which only requires two free parameters. using a simple parametric form limits the number of free parameters, but may also introduce bias if the fit is poor in part of the probing data value range. in particular, rnastructure has been shown to perform extremely well on 16s rrna when introducing several preprocessing steps and filters, such as (i) selecting parameters performing well on 23s; (ii) limiting the allowed distance between base pairs; (iii) focusing on sites with useful shape data and (iv) disregarding sites with clear incompatibilities with the comparative reference structure . though individually helpful, manually selecting parameters and introducing many preprocessing steps risk making the approach more liable to overfitting on a concrete dataset. direct calculation of pseudo-energy change terms based on log-likelihood ratios of being paired versus unpaired has also been suggested , which is closer to the approach taken by probfold. probfold has been designed with the aim of extendibility to multi-variate probing data measurements. this could for instance be the combination of shape with other chemical or enzymatic probing agents, as in the proof-of-concept example using cmct, dms, shape data. if the noise in the individual measurements at a site are correlated it becomes important to capture these correlations in the model to retain specificity. such correlations could for instance be caused by tertiary structure interactions involving single stranded regions, which may affect several types of probing agents, including shape. specifically, non-canonical base pairs will often give similar signal to canonically paired bases using shape but not dms. learning such correlations would therefore be expected to improve prediction performance. as more and more rna tertiary structures are found, one solution could be to explicitly include tertiaryboth the f-value and the change in f-value (df) relative to the sequence-only (seq-only) predictions are shown. the maximal performance score for each combination of probing data types is denoted in bold. see supplementaryfor the full set of performance statistics. structure aspects into the model . in the case of shape, we did not observe any correlation between paired bases. however, such correlations may well exist for other types of probing agents, such as double stranded rnases. even partial evidence for the presence of specific base pairs could significantly improve performance by constraining and simplifying the folding problem. such evidence would resemble the signal exploited from compensatory base pair substitutions exploited in comparative rna structure analysis. as suggested by s k sd et al. (2012), additional power could be gained by combining experimental probing data with comparative data, though this would be limited to functional and conserved rna structures. however, exploring these extensions is beyond the scope of the current study. through proof-of-principle experiments, we have illustrated the applicability of probfold to different types of probing data and to multiple complementary datasets . the performance evaluations show that probfold can make efficient and competitive use of the probing data, both for shape data and when combining multiple datasets (tables 1 and 2). retraining aids its adaptation to varying noise levels. however, model performance is limited by the small size of the available training datasets, which restricts model complexity and hence predictive power. we hope the advent of ngs-based high-throughput structure probing techniques, as pioneered by  
