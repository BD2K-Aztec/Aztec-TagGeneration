genome analysis dmap: differential methylation analysis package for rrbs and wgbs data motivation: the rapid development of high-throughput sequencing technologies has enabled epigeneticists to quantify dna methylation on a massive scale. progressive increase in sequencing capacity present challenges in terms of processing analysis and the interpretation of the large amount of data; investigating differential methylation between genome-scale data from multiple samples highlights this challenge. results: we have developed a differential methylation analysis package (dmap) to generate coverage-filtered reference methylomes and to identify differentially methylated regions across multiple samples from reduced representation bisulphite sequencing and whole genome bisulphite sequencing experiments. we introduce a novel fragment-based approach for investigating dna methylation patterns for reduced representation bisulphite sequencing data. further, dmap provides the identity of gene and cpg features and distances to the differentially methylated regions in a format that is easily analyzed with limited bioinformatics knowledge. availability and implementation: the software has been implemented in c and has been written to ensure portability between different platforms. the source code and documentation is freely available (dmap: as compressed tar archive folder) from http://biochem.otago. ac.nz/research/databases-software/. two test datasets are also available for download from the web site. test dataset 1 contains reads from chromosome 1 of a patient and a control, which is used for comparative analysis in the current article. test dataset 2 contains reads from a part of chromosome 21 of three disease and three control samples for testing the operation of dmap, especially for the analysis of variance. example commands for the analyses are included.dna methylation is arguably the most stable epigenetic mark that plays a key role in regulating development and disease . one of the most fundamental challenges for epigeneticists is to identify dna methylation differences between genomes. for instance, differential methylation between diseased and normal samples, interindividual variation within a population, differences between tissues or species and so on are of biological and clinical relevance. the rapid improvement in next-generation sequencing technologies now provides opportunities to interrogate dna methylation at single base resolution with high coverage across multiple samples. bisulphite treatment converts unmethylated cytosines to uracils (and ultimately to thymine after amplification), although leaving methylated cytosines unchanged. therefore, bisulphite treatment combined with next-generation sequencing (bs-seq) has become a preferred method to generate base-resolution dna methylation maps. because whole-genome bisulphite sequencing (wgbs) is still expensive and generates challenging amounts of raw data, reduced representation bisulphite sequencing (rrbs) provides a cost-effective alternative for whole-genome methylation sequencing. rrbs has been widely used by several groups worldwide to interrogate functionally important genomic regions at high-sequencing coverage and sensitivity . during the past few years, several alignment tools have been developed to cope with asymmetric mapping issues of bisulphite converted sequenced reads and to map millions of reads with reasonable speed to the reference genome. some of these aligners are rmap , bs seeker , bismark , rrbsmap , batmeth and pass-bis . recent comparative analyses have improved our understanding of the efficiency, accuracy and algorithm of these aligners . additionally, tools have been developed for generating methylation calls and visualization. integrated genome viewer and methvisual allow visualization of sequenced reads and regional analysis. biq analyzer ht allows site-specific dna methylation analysis , and saap-rrbs can perform alignment, methylation calls, annotation of cpg sites and visualization . methylkit , an r package, enables detection of differentially methylated cpg sites (dmcs). methylkit to whom correspondence should be addressed. y the authors wish it to be known that, in their opinion, the first two authors should be regarded as joint first authors. applies a fishers exact test or logistic regression to calculate p-values that are adjusted to q-values for multiple test correction using a slim approach . for wgbs data, bsmooth performs local averaging and sample-wise smoothing of methylation values after alignment and methylation estimates by read position . bsmooth applies numerous cpg-wise t-tests, and based on a t-test threshold, differentially methylated regions (dmrs) are defined. biseq, an r package, performs smoothing of methylation data within cpg clusters considering spatial dependence . differential methylation is then detected in cpg clusters, the false discovery rate is controlled and finally dmr boundaries are defined. in contrast to alignment and visualization tools, the number of software packages available to detect dmrs is small. some tools offer detection of dmcs and some dmrs and most of them are hardwired, i.e. they provide little flexibility in the choice of analysis parameters such as coverage criteria, dmr length and the type of statistical test. further, most available tools do not provide options for further analysis of dmrs with respect to its genomic position such as the transcription start sites, genes, cpg features and so on. here, we describe differential methylation analysis package (dmap), a pipeline that can directly import the output from any bisulphite aligner in sequence alignment/map (sam) format and identify differential methylation. we have primarily designed the package to handle data from rrbs experiments (which uses 40220 bp mspi digested genomic fragments), but it can be used effectively to investigate wgbs data for any eukaryotic genome as well. a suite of statistical tests is included in dmap [chi-square test, fishers exact test and analysis of variance (anova)] to identify methylation differences between different groups and conditions. for rrbs, we introduce a novel approach of identifying differential methylation based on mspi fragments [differentially methylated fragment (dmf)]. further, dmap provides genomic relationship information (nearest gene, exon, introns and cpg features) for each dmr or dmf.a higher number of dmcs is expected compared to the number of dmfs/dmrs, because each dmf/dmr will contain several differentially methylated cpgs. dmf/dmr will also contain cpg sites that individually will not qualify as differentially methylated. further, there will be several independent dmcs that will not form part of a dmf or dmr. this explains the finding of higher dmcs identified by methylkit and lower dmr/dmfs identified by biseq and dmap. a frame-toframe comparison of differential methylation patterns between these tools is not possible because each of them uses a different unit of analysis to determine differential methylation. thenote: the identgenloc here provides data of chromosome, length of the region, number of cpg sites contained within the region, p-value, statistical test applied, distance in relation to the gene (calculated from the start of the gene), relationship with the gene (e.g. upstream, exon, intron), cpg feature relation, strand and the name of the associated gene. the in the gene distance column indicates the region is inside the gene body. the output is a tab-delimited text file, suitable for importing into microsoft excel. gene distance is calculated from the start of thewe wanted to include all the possible regions for a fair comparison with methylkit. during the review process, we found that biseq version 1.2.0 and 1.2.3 contained an erroneous readbismark function, which produced a very high number of dmrs for our analysis (as a result of false methylation calls), the function was corrected in version 1.2.4. therefore,it is advisable to use several tools in combination to ensure detection of sensible detection of differentially methylated regions for biological interpretation. in terms of coverage, methylkit called the cpg sites with 10 or more reads from the aligned sam files. in dmap, fragments having two cpg sites with 10 or more reads were included for analysis. in contrast, biseq uses a quantile approach for smoothing methylation data where a higher weighting is given to cpg sites with high coverage and sites with an unusually high coverage are excluded (for example, to the 90 quantile in this analysis). these differences could account for some of the variation observed in the comparative differential methylation analysis performed here. we present dmap, an analysis package that filters and processes aligned bisulphite sequenced data to generate comprehensive reference methylomes (tile based and fragment based) with flexibility for users. from sam files, dmap provides statistically significant dmrs and relates them to genes and cpgs. statistical approaches for the analysis of genome-wide methylation data are not yet well characterized. a caveat to the use of statistical tests for fragment or window-based approaches is that methylation values for cpgs within a sequenced read are likely to be correlated, and thus statistical significance can be overestimated. therefore, further work is needed to devise better statistical methods for accurate detection of differential methylation. aside from some awk scripts, dmap is written in c and executes efficiently. in our test runs, the diffmeth program was able to produce a list of candidate regions (while processing 11 human rrbs samples) in 4 h. the output from this step was processed in 20 min by identgeneloc to produce gene features of the candidate regions. although the package was initially developed for the human genome, the code was modified to work with any eukaryotic genome. optionally, dmap has no expectation of an x and y chromosome and can work with any number of autosomal chromosomes. we tested the package with zebrafish genome (zv9 assembly), which has 25 chromosomes (and no x and y chromosome), and all the features described in this article worked successfully . to our knowledge, dmap is the first tool that accepts unsorted raw sam alignment files as an input, detects dmr or dmf, provides information and distances of nearest genes and cpg features in relation to each dmf or dmr. the outputs (exported to text files) are relatively easy for bench scientists without bioinformatics expertise to analyze and use with other tools.  
