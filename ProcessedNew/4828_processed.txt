sequence analysis using tertiary structure for the computation of highly accurate multiple rna alignments with the sara-coffee package motivation: aligning rnas is useful to search for homologous genes, study evolutionary relationships, detect conserved regions and identify any patterns that may be of biological relevance. poor levels of conservation among homologs, however, make it difficult to compare rna sequences, even when considering closely evolutionary related sequences. results: we describe sara-coffee, a tertiary structure-based multiple rna aligner, which has been validated using bralidarts, a new benchmark framework designed for evaluating tertiary structure based multiple rna aligners. we provide two methods to measure the capacity of alignments to match corresponding secondary and tertiary structure features. on this benchmark, sara-coffee outper-forms both regular aligners and those using secondary structure information. furthermore, we show that on sequences in which 560 of the nucleotides form base pairs, primary sequence methods usually perform better than secondary-structure aware aligners. availability and implementation: the package and the datasets are available from http://www.tcoffee.org/projects/saracoffee and http://recent reports of a large number of previously unknown rna genes have prompted a renewed interest in the field of non-coding rna analysis. this shows well in the growing number of scientific reports uncovering a rapidly expanding range of new functions, and it now appears that non-coding rnas are involved in most parts of the cell machinery, including x inactivation, genome integrity maintenance [piwi-interacting rna (, transcript knockdown and cell differentiation [mirna ] as well as nuclear trafficking [nron (, among others. from a functional standpoint, the main consequence of high-throughput sequencing has certainly been the discovery of a large number of long non-coding rnas (lncrnas), simultaneously identified as un-reported non-coding encode transcripts and as conserved genomic regions with active promoter chromatin signatures . the exact function of this new class remains a matter of debate, although mounting bodies of evidence suggest their involvement in gene regulation, either through trans- or cis-acting mechanisms. other reports are also suggesting the potential usage of lncrnas as biomarkers . in humans only, the latest encode catalog lists 417 000 lncrna genes, and probably more have to come as a wider range of tissues get deep-sequenced. it remains a matter of debate whether these lncrnas have evolutionary conserved secondary structure. a difficulty when looking for such structures is the fast evolutionary pace of these molecules, a property that makes it hard to produce structurally informative sequence alignments. this limitation is rather serious, as our capacity to make sense of so much new information will significantly depend on our ability to build accurate homology-based models . in the present work, we borrow some concepts developed for protein sequence comparison and show that rna structural information can be used to derive more informative multiple sequence alignment (msa) models. this approach amounts to defining a perfect rna alignment as the one maximizing the matching of structurally equivalent elements. such accurate alignments are critical for various modeling applications, including evolutionary reconstruction, database search using improved context-free stochastic grammar model and fine-grain structural modeling of novel family members. we show that even a small amount of three-dimensional (3d) or two-dimensional (2d) experimental structure can help improve these models. alignment methods rely on the notion that key features are usually preserved by evolution through purifying selection. multiple comparison models can therefore reveal functional to whom correspondence should be addressed. y the authors wish it to be known that, in their opinion, the first two authors should be regarded as joint first authors. elements that would otherwise be difficult to identify on a single sequence. this is especially true for structured rna molecules where compensated mutations are frequent signatures for evolutionarily maintained stem loops. this strategy has been extensively used for the successful elucidation of ribosomal rna secondary structures . unfortunately, producing alignments accurate enough to be used for secondary-structure prediction is a challenging task, especially when dealing with distantly related sequences. two main obstacles exist that prevent the computation of informative homology-based models. first of all, rna sequences are composed of a four-letter alphabet, with no higher-order meta-alphabet (like proteins amino acid code) that would help powering statistical analysis. as a consequence, structure similarity becomes hard to infer when sequences have 560 identity . second, for many rnas, sequence evolution is mostly constrained by the maintenance of secondary structure elements stabilized through a combination of canonical and non-canonical base-pairings. under such constraints, it has been shown that sequences can evolve rapidly while exploring so-called neutral networks . the combination of a small alphabet with rapid evolution makes it difficult to use standard alignment tools like basic local alignment search tool-based approaches . to address these limitations, one can tap into the evolutionary signal contained in di-nucleotides that results from the co-evolution of adjacent bases. this approach has been recently shown to be effective enough for the improvement of database search accuracy . unfortunately, the signal thus uncovered is modest and unlikely to result in significantly improved alignments. a more suitable solution involves the simultaneous estimation of sequence and structural conservation using sankoff algorithm . as effective as it may be in theory, this approach is hampered by prohibitive memory and cpu requirements, a limitation that has prompted the development of a large number of faster approximate heuristics for the inclusion of secondary structure information when aligning rna. some of the most popular tools include r-coffee , locarna and consan . consan combines expectation maximization with a sophisticated banded dynamic programming strategy, which results in a heuristic approximation of sankoff algorithm. the consan algorithm that only aligns two sequences at a time can easily be combined with a consistencybased multiple sequence aligner like t-coffee or r-coffee to assemble highly accurate rna msas. consistency-based aligners rely on the compilation of an exhaustive library of all-against-all pairwise alignments. this library is extended to derive a position-specific scoring scheme, used to compute a standard progressive alignment. the main strength of multiple aligners like t-coffee is to allow any third-party pairwise aligner to be used for the library generation. this property was previously used to generate structure-based protein alignments (o) by combining structural pairwise aligners like sap . we show here how this approach, originally developed for proteins, can easily be extended to rna sequence alignments, provided suitable pairwise tools are used to build the pairwise library. structure-based rna alignment algorithms include sara , dial , arts , lajolla , r3d align and sarsa . these tools belong to a recently described class of aligners that make use of experimentally derived 3d structures. in this study, we chose the sara structural aligner that estimates series of unit vectors between consecutive c3 0 atoms (shown by the authors to be the most suitable for this task) and aligns them using dynamic programming, to minimize the root mean square deviation between superimposed atoms. as a stand-alone pairwise structural aligner, sara is directly usable within the t-coffee framework, and we describe in this article, a framework suitable for validating the effectiveness of combining these two tools for the generation of 3d structure-based rna msas. the benchmarking of an rna 3d structure-based method like sara-coffee is not an easy task. first of all, one needs reference datasets of sequences with known 3d structures. when it comes to benchmarking rna alignments, bralibase is usually referred to as the reference collection of choice. however, it cannot be used in the context of this work, as 57.2 of the sequences that make up the datasets match a known 3d structure (!95 identity), thus making it an impractical reference dataset for the benchmark of tertiarystructure aligners. this limitation prompted us to assemble bralidarts, a new reference dataset that only contains darts clusters of structurally homologous sequences, further filtered for their suitability (see section 2). the second issue relates to the nature of the reference. our goal being the evaluation of a structural aligner, any reliance on a structure-based reference alignment would have turned our approach into the de-facto comparison of two alternative structural alignment strategies (ours and the one used for the reference). we therefore decided to do an alignment-free assessment of our method by evaluating sara-coffees ability to match structurally equivalent features such as pairs of paired residues, or internal structural distances. this comparison of internal structures was carried out by adapting the nirmsd , a method designed to estimate the structural accuracy of protein msas (see section 2), to use distances between the c3 0 atoms of the aligned rna sequences. sara-coffee is heavily dependent on available rna 3d structure, an information source only available in small quantities. for instance, the latest pdb release contains54100 chains longer than eight nucleotides (a minimum for the sara algorithm), with a mere 2325 mapping onto the 6 million or so sequences in rfam. this shortage severely restricts the scope of a method like sara-coffee, and we therefore decided to broaden the scope of this work by going beyond a mere pure structure-based validation. we also tried to estimate the usefulness of 3d structural information when computing msas so as to provide the community with guidelines on how these data may be used as efficiently as possible, and also to determine when these data are critically needed. we were especially interested in determining the usefulness of 3d data when doing 2d modeling. this question is relevant in a context where it may soon be relatively easy to use next-generation sequencing to do massive secondary structure estimation at minimal cost , even though the reliability of such techniques remains to be established.our main goal was to estimate the effectiveness of structural information incorporation when assembling rna msas. we were especially interested in quantifying the usefulness of 3d information and its relative merits in comparison with inferred secondary structures. to address this problem, we focused a large part of this work on the design of bralidarts, a structure-based benchmark framework. aside from its full reliance on 3d information, bralidarts main strength is its total independence from any reference msa. this independence makes it possible to avoid any bias toward specific alignment methods. having assembled bralidarts, we tested five generic aligners, five secondary-structure aware aligners and the three new methods described here on the 41 datasets of bralidarts. we then calculated 3sp and nirmsd, the two metrics developed for bralidarts. the 3sp estimates the fraction of base pairs aligned with a potentially homologous pair. this metric merely requires knowing the secondary structure of the considered sequences. the nirmsd is used to estimate the variation of intra-molecular distances across homologous pairs of residue pairs (as defined by the msa one evaluates). it relies on the notion that in a correct alignment, the distance between two residues in a structure should be as similar as possible to the distance between homologous residues in another structure. this measure is made local by only considering, for any given residue, the difference of distances between a residue and its neighborhood across a structure. for proteins, a sphere of radius 20 a was reported to be an optimal size. in the context of this work, we tested three values: 20, 50 and 99 (supplementary data). we found the 50 a limit to yield the most informative correlations, even though no strong differences were observed between 20 and 50 a cutoffs. as our aim was to quantify the importance of structural information when assembling an rna msa, we first calculated the bp-index (base pair index) for each sequence, representing the fraction of paired residues as determined by x3dna. such score varies significantly across datasets and ranges from 6 to 90, with a median close to 70. we split the bralidarts accordingly in two subsets, one containing datasets made of low-density secondary structures (21 datasets, bp-index 70) and a second one containing high-density structures (20 datasets, bp-index 470) (supplementary). we then averaged readouts for each alignment method in both the high-and the low-density bin . on the low-density dataset, we found the 3sp readouts to behave roughly according to expectations, with primary methods delivering results $10 points lower than their secondary counterparts (0.51 versus 0.60). tertiary methods like sara-coffee were among the best. these observations are in stark disagreements with nirmsds readouts that showprimary structure-based methods outperforming those based on secondary structure (6.73 versus 7.27 a , the lowest values being the best ones). sara-coffee is one of the only method consistently delivering the best (nirmsd) or close to the best (3sp) readouts. the different behavior of the two metrics is reflected well in, where no correlation appears to exist between the two measures. the lack of secondary structure in this dataset explains why the 3sp score fails to properly estimate the 3d alignment accuracy. by contrast to this first series of results, our measures on the other subset of bralidarts, the one with highly connected structures, gave different results. on this dataset, the 3sp and the nirmsd measures are strongly correlated (0.79,). the differences between primary and secondary or tertiary methods are also much more pronounced. we found sara-coffee to be 20 points more accurate (3sp) and 1 a (nirmsd) better than sequence-based methods. on these two metrics, five of six secondary structure-based methods outperform all the sequence-based ones. this result confirms that on densely structured sequences, one can improve msa accuracy by using secondary or tertiary structure information, with the best results being achieved with 3d information. a possible confounding factor when observing this correlation might be the effect of low-resolution structures, in which the bp-index could have been underestimated. in that case, the correlation might have to do more with structural data quality than with base-pairing density. to rule out this possibility, we used bralidarts-hq, a third reference dataset made of a small number of carefully selected high-quality and high-density structures, and found the correlation to be even stronger (0.92,). we also tried to rule out the possibility that the sara-coffee improvement might have resulted from the use of experimental (as opposed to predicted) secondary structures rather than tertiary structure information. for that purpose, we designed r-coffeereal, an adaptation of r-coffee that explicitly uses experimental secondary structures. results show that on the high structural density dataset, r-coffeereal manages to improve significantly over r-coffee on most datasets, regardless of the considered metrics (3sp or nirmsd). the burden of requiring an experimental tertiary structure for each rna sequence one wants to align dramatically limits the scope of sara-coffee. unfortunately, such data are scarce. for instance, of the 4100 rna pdb chains longer than eight nucleotides available from the pdb, only 2325 have a close homolog (495 identity) to some of the 6 million sequences reported in rfam 11.0. to evaluate the effectiveness of sara-coffee in a more realistic context, we asked whether using only a handful of structures might be enough to significantly improve msa modeling (bestpair method). the results are not strongly conclusive,with bestpair being only slightly more accurate than other structure-based methods (nirmsd), albeit significantly less than sara-coffee and not significantly more accurate with respect to the 3sp measure than any structure-informed methods. this result, which is rather consistent with similar protein analysis, suggests a strong dependence between the final model accuracy and the overall amount of available structural information. all together, the results measured on the low-and the high-density bralidarts subsets suggest some heterogeneity and a strong sensitivity to datasets structural composition. when dealing with highly structured sequences, secondary and tertiary structure-based methods perform better, and result in highly correlated secondary (3sp) and tertiary (nirmsd) readouts. this correlation seems to disappear when analyzing low-density structures. we tested this hypothesis a bit further by taking advantage of the availability of 13 alternative msas for each single dataset. this variety allowed us to estimate a pearson correlation coefficient between the 3sp and the nirmsd of each single dataset and plot the resulting values against the bp-index . despite a rather weak correlation, the trend shows an increasing correlation above a bp-index of 60, with most datasets with 480 bp-index having strong correlations. this result suggests secondary structure-based methods to be best suited for datasets having a bp-index 480. we tested this hypothesis by measuring on each dataset, the difference in nirmsd readouts between primary and secondary structure-based methods . as expected, we found that below a bp-index of 60, primary methods tend to give better results, whereas above this value, secondary-structure aware methods often result in an improvement. a similar analysis carried out by comparing primary-and tertiary-based approaches shows that sara-coffee yields its most significant improvements on datasets with a bp-index460, but rarely degrades the msas below this value. we completed our analysis by doing a pairwise comparison of all the methods considered here and by counting, for each metric, the number of times any method outperforms any other method (supplementary figs s2 and s3). such a comparison is important, as it makes it possible to estimate the statistical support for the observed differences. we found most differences to be statistically significant on the 3sp method, whereas on the nirmsd, sara-coffee is the only aligner whose behavior appears to be statistically different from most alternatives on most datasets. these comparisons, which reflect individual dataset readouts, also support the notion of secondary structure information being more useful when dealing with highly structured sequences. the cpu requirements of sara-coffee are significantly higher than those of sequence-based methods, and we found our method to be $100 times slower than locarna, but also $100 times faster than consan-coffee, with the number of sequences being the main source of cpu cost (supplementary). considering the number of available pdb structures, this makes sara-coffee a realistic option for the computation of all currently available datasets on a standard desktop machine. regardless of the fraction of structured nucleotides. the easiest explanation for the lack of accuracy of aligners using predicted secondary structures is probably the tendency of over-predicting secondary structures on these sequences. indeed, a closer inspection on the low-fraction structure shows that these datasets are enriched in heterodimer interactions (rna/rna or rna/proteins), a finding that confirms the well-known issue of accurately predicting ab-initio structures without taking into account the folding context. in the real-world, rna tertiary structure information is rather scarce, and we therefore had to ask whether alternative sources of information could be reasonable substitutes for tertiary structure data. for instance, it is now possible to do large-scale secondary structure predictions using high-throughput sequencing, and the two leading technologies for single-molecule sequencing techniques, pacbio and nanopore, have been announcing kits dedicated to large-scale secondary structure determination. it is therefore realistic to consider that a wide amount of secondary structure information will soon be available, although its accuracy still needs to be verified. we tested the effect of using this information using a variation of the r-coffee method named r-coffeereal. our results are encouraging. they show that when dealing with highly structured rnas (470), the use of experimental secondary structure results in msas significantly better than those obtained with alternative secondary methods, even though accuracy does not reach the level of pure tertiary structure-based alignments. this result was also supported by the high correlation (0.92) observed when measured on bralidarts-hq. the main limitation of our work is probably its reliance on a rather small collection of datasets. furthermore, sequences making up this dataset are also rather short (44 nucleotides on average, 213 at most). it is not entirely clear how the behavior of methods relying on secondary structure prediction can be extrapolated to longer sequences, as it is well-known that length tends to impact structure prediction accuracy . by contrast, it is likely that the good performances measured on r-coffeereal and all methods using experimental data will hold reasonably well. our approach is generic and could easily be extended to any pairwise rna structure aligner. in practical terms, t-coffee is an open-source package that can be adapted by anyone. it has been designed so as to allow the introduction of any third-party package with minimal effort, thus making the incorporation of new third-party rna alignment package mostly a benchmarking exercise. no ideal substitute seems to exist for experimental data when modeling rna homology. a method like sara-coffee could therefore be useful for anyone requiring high-quality msa modeling for sequences having known 3d structure, and it is probably a realistic expectation that its relevance will grow as rna structural databases become more populated. start-up funds from the department of pathology at the university of alabama, birmingham (to e.c.); spanish 60 mineco (bfu2010-19310 to m.a.m.-r.). it reflects only the authors views and the european community is not liable for any use that may be made of the information contained therein. conflict of interest: none declared.  
