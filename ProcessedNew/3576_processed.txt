pipasic: similarity and expression correction for strain-level identification and quantification in metaproteomics motivation: metaproteomic analysis allows studying the interplay of organisms or functional groups and has become increasingly popular also for diagnostic purposes. however, difficulties arise owing to the high sequence similarity between related organisms. further, the state of conservation of proteins between species can be correlated with their expression level, which can lead to significant bias in results and interpretation. these challenges are similar but not identical to the challenges arising in the analysis of metagenomic samples and require specific solutions. results: we introduce pipasic (peptide intensity-weighted proteome abundance similarity correction) as a tool that corrects identification and spectral counting-based quantification results using peptide similarity estimation and expression level weighting within a non-negative lasso framework. pipasic has distinct advantages over approaches only regarding unique peptides or aggregating results to the lowest common ancestor, as demonstrated on examples of viral diagnostics and an acid mine drainage dataset. availability and implementation: pipasic source code is freely available from https://sourceforge.net/projects/pipasic/.in contrast to classical proteomic approaches, metaproteomics and environmental proteomics studies aim at deciphering the interplay of different organisms contained within an environmental sample . throughout the past years, this idea has seen increasing application primarily in three fields: aqueous ecosystems, terrestrial systems and eukaryotic host microbiomes . in addition, metaproteomic approaches have become of interest also for clinical diagnostics, e.g. for characterizing the state of an infection or for identifying and strain-level typing of bacteria . similar to metagenomic approaches , the analysis of environmental samples and the interplay of organisms offer an enormous potential to further the characterization and understanding of these systems. at the same time, challenges in metaproteomics are manifold and relate to all steps of the analysis. particularly, this includes the handling of the resulting large and complex datasets of spectra derived from mass spectrometry (ms) experiments and their meaningful comparison with reference proteomes of organisms. it can by no means be generally assumed that this set of referencesin particular for bacteria or virusesis complete or representative for the given sample . depending on the sample of interest, the number of organisms of interest may vary significantly from tens to thousands and more. in all cases, it is non-trivial to identify the correct origin of a spectrum and thereby to allow either the identification of organisms or the quantification of either organisms or key biological processes. while many goals and strategies correlate for metagenomic and metaproteomic approaches, several distinct differences are noteworthy. in metaproteomic approaches, expression levels are analyzed and thus quantitative measures differ even for proteins from a single organism. this can be highly insightful for functional analyses , but poses an additional challenge for data analysis. further, while the method is designed to be unbiased, it cannot be assumed that all proteins are extracted and captured by ms in a metaproteomics experiment. however, as it is an orthogonal technique to metagenomics, metaproteomic and metagenomic approaches have differing error profiles and can jointly provide a much deeper insight than each method on its own , even in cases such as the quantification of strains when metagenomics is usually preferable owing to lower demands on material and longer sequences. it should be noted that metaproteomic approaches require the availability of reference proteomes or genomes and cannot assemble them from a given sample as in metagenome protocols [e.g.. while numerous tools have been introduced for metagenomic data analysis (seefor an overview), only comparatively few tools exist with focus on the specific difficulties arising in the analysis of metaproteomic data. these cover a broad field ranging from specialized approaches for visualization to the scalability of database search algorithms and to metaproteogenomics and the difficulty of identifying a suitable reference database . one key difficulty that is hindering metaproteomic data analysis is the ambiguity of peptide identifications . even more to whom correspondence should be addressed.the experiments indicate that pipasic allows the reliable separation of highly similar strains in metaproteomics experiments. it can be used for reliably identifying and quantifying the contributions of organisms and functional units even in cases when as in the cowpox virus data experiment92 of all expressed tryptic peptides are identical. in particular, pipasic allows having a phylogenetic resolution down to the strain level, which is inherently not feasible for lowest common ancestor approaches for highly related species. this is also clearly visible in the comparison with megan on the cowpox virus strain data . given its reliability, pipasic is preferable to approaches relying solely on the analysis of unique peptides.indicates the risk of analyzing unique peptides for highly related strains. even though the overall number of identified peptides per species is above 1000, which is high for a metaproteomic setting, the number of unique peptides remains low owing to the sequence similarity. thus, only few peptide identifications out of a thousand decide on the identification of a species when relying on unique peptides. the example inhighlights the risk: even in cases when the ground truth contains 0 spectra of the kre strain, megan finds 17 unique peptides; this effect was also observed when using the more conservative omssa search engine instead of inspect. these may incorrectly be interpreted as proof of the presence of the kre strain. however, given that the original peptide identification search was conducted at a 5 fdr and given the large number of spectra searched, these identifications are incorrect. because pipasic leverages the computed similarity and the shared. pipasic similarity matrix with data weighting for the amd experiment. the matrix entries encode the probability that a peptide in a source proteome can be found in a target proteome, modulated by the metaproteomic data (see section 2). here we see that the intra-group matrix coefficients for the fer and lepto group are greater than the intergroup coefficients. this means in practice that pipasic corrects abundances within but not between the two groups. it is noteworthy that the matrix coefficients can be asymmetric, which has the effect that abundance can be shifted from one proteome to another rather than correcting both proteomes equallypeptides into the analysis, it is less at risk to overvalue these incorrect identifications and correctly reduces the presence of the kre strain in this example down to a level where it cannot be distinguished from a 0 presence. this example also indicates that the statistical model behind pipasic contains and quantifies uncertainty. a bootstrapping strategy in the abundance estimation step allows us to obtain confidence statements for all estimates, and thereby the definition of cutoffs for diagnostic decisions can be supported by statistical statements. the reliability of an estimate obviously primarily depends on data abundancethe number of supporting spectraas well as on the computed and weighted similarity of the species of interest. pipasic computes its similarity correction adjusted to the expression level of proteins. the cowpox virus data experiment clearly indicates the significance of this step for the results. this step highlights a major difference between metaproteomics and metagenomics: although the main idea of the metagenomic method could be applied in metaproteomics, the method itself must be tuned to the underlying difference in the biological data. the expression level correction should also be applicable and helpful in metatranscriptomics settings where also expression level information can be confounded with the state of conservation. here, we applied the correction only for complete proteomes of species because the number of spectra per species was limited. in large-scale experiments, it should also be feasible to adjust for protein groups separately. with regard to quantification, pipasic currently relies exclusively on spectral counts. while we observe positive results for both the expression level correction and the quantification in the cowpox virus experiment, spectral counts have been shown to have limitations with regard to the quantitative range and precision that they cover. methods combining the intensity of mass spectra with spectral counts, e.g., could in principle be integrated into the pipasic framework and further improve the quantification exactness. one general difficulty for metaproteomics is that all analyses depend on the completeness of the provided reference proteomes because purely de novo peptide identification approaches are not yet sufficiently reliable . thus, any quantification or identification by pipasic is also at risk of only reflecting the available reference proteomes. using an error-tolerant peptide search strategy such as biceps , peptides containing up to two amino acid substitutions can be included and thereby this risk can be reduced. pipasic is currently not optimized for large-scale datasets and can become computationally expensive because peptide identifications need to be performed separately against all reference proteomes and all pairwise string comparisons need to be computed and accounted for. to overcome this, a two-step procedure may be helpful to first identify all species having unique identifications with existing methodology and then to run pipasic on those subsets that are expected to have a high sequence similarity to ensure specificity of results.with this contribution, we introduced pipasic as a tool for identification and quantification in metaproteomics. pipasic focuses on correcting observed proteome abundances without having to exclusively assign ambiguous peptide spectrum matches to their correct origin among a potentially large number of reference proteomes. its particular strength is that it computes the peptide level similarity between reference proteomes and thereby can reliably distinguish on the strain level. further, pipasic includes the expression level in the analysis and thereby avoids bias resulting from the correlation of conservation and expression in metaproteomics. pipasic is implemented in python and freely available as an open-source project.  
