gene expression proper: comprehensive power evaluation for differential expression using rna-seq motivation: rna-seq has become a routine technique in differential expression (de) identification. scientists face a number of experimental design decisions, including the sample size. the power for detecting differential expression is affected by several factors, including the fraction of de genes, distribution of the magnitude of de, distribution of gene expression level, sequencing coverage and the choice of type i error control. the complexity and flexibility of rna-seq experiments, the high-throughput nature of transcriptome-wide expression measurements and the unique characteristics of rna-seq data make the power assessment particularly challenging. results: we propose prospective power assessment instead of a direct sample size calculation by making assumptions on all of these factors. our power assessment tool includes two components: (i) a semi-parametric simulation that generates data based on actual rna-seq experiments with flexible choices on baseline expressions, biological variations and patterns of de; and (ii) a power assessment component that provides a comprehensive view of power. we introduce the concepts of stratified power and false discovery cost, and demonstrate the usefulness of our method in experimental design (such as sample size and sequencing depth), as well as analysis plan (gene filtering).rna-sequencing has become a routine technique to study the whole transcriptome . in addition to the initial excitements of the extraordinary power of the technology such as being able to detect novel transcripts and alternative splicing patterns , more and more researchers use rna-seq as a replacement of gene expression microarrays to quantify and compare expression levels under distinct biological contexts, for example, to identify differentially expressed (de) genes. it has been well recognized now that technology improvements do not eliminate biological variability , thus replication is still necessary in establishing statistical significance in the identification of de. however, the number of replicates needed in rna-seq, a key issue in experimental design, remains a challenge owing to the complexities of the experiment and the nature of rna-seq data. in classical sample size determination involving a single-hypothesis test, one typically starts with a few quantities that one can make reasonable assumptions on: the minimum effect size, which is scientifically meaningful, the variance (which can be estimated from historical data), an acceptable type i error rate, usually in the form of p-value, etc. the statistical power also has a clear definition: the probability of rejecting the null hypothesis under the alternative model. based on these assumptions, one can then study the relationship between the statistical power and the sample size. in high-throughput experiments (such as identifying de genes from microarray or rna-seq) where many statistical tests are performed simultaneously, several factors complicate the sample size calculation. the first one is the need to deal with multiple testing. false discovery rate (fdr) is often a preferred control of type i error over family-wise error rate. for microarray studies, several sample size calculation methods have been proposed based on controlling fdr. for example, liu and hwang (2007) built a connection between fdr and power, and derived algorithms for power calculation based on t-or f-test. second, we note that the power analysis for rna-seq is even more complicated than that in microarray data. the baseline expression level is not of interest in microarray data, and can often be assumed to be zero without loss of generality, as it does not affect type i or ii error in the de detection. this is because the preprocessed expression values can be modeled as gaussian distribution, where the mean and variance are unrelated. thus, the baseline expression level does not affect the test statistics in microarray data. however, in rna-seq, gene expressions are measured as counts and often modeled as poisson or negative binomial distributions . the variation in gene expression measurements comes from both the biological variation and the sequencing counting error. the relative importance of the counting error depends on the expression level: for genes with low counts, the variation owing to the counting process dominates the variance, whereas for genes with high counts, it is negligible. as a result, the power in de detection is affected by expression level. for example, there is power bias toward longer genes to whom correspondence should be addressed. the author 2014. published by oxford university press. all rights reserved. for permissions, please e-mail: journals.permissions@oup.com because more reads are generated from longer transcripts . further, as coverage depends on sequencing efficiency as well as expression level, genes with modest counts are not necessarily expressed at low levels. thus, these may still be of interest even if we want to focus on genes that are above a certain level of expression. another issue often overlooked in existing methods of sample size determination for de experiments is the wide application of empirical bayes approach in de detection . because of the limited sample size in many experiments, the gene-specific biological variance is often estimated with some shrinkage by borrowing strength across genes. this helps stabilizing the variance estimates and leads to better ranking of true de genes, but in the meantime also creates dependency among genes, which affects the validity of some error-control procedures in multiple testing. though all methods report type i error (either as p-value, fdr/q-value or both), the type i error may be computed from a parametric test of which assumptions are not all met, and the reported fdr is often obtained via simple conversion from nominal p-values using benjaminihochberg methods . the resulting nominal error rate can be rather different from actual error rate . finally, the flexibility of sequencing experiments gives scientists more freedom in experimental design: for the same amount of sequencing, one may choose to seek deeper coverage of a small collection of samples, or to obtain more samples with modest coverage. this is an additional factor not encountered in microarrays. there are several methods for calculating the sample size for rna-seq data in recent literature. these include methods for single-gene differential expression analysis based on likelihood ratio or wald test , or on score test from negative binomial model . these methods, however, are not directly applicable to simultaneously testing thousands of genes profiled from one rna-seq experiment because they do not come with a procedure that deals with multiple comparisons.proposed an analytical method based on poisson model to determine sample size for both single gene and multiple gene comparisons with adjustment for fdr. this method has been further extended to negative binomial model in. however, to make calculations attainable, the authors suggested setting a common value for parameters including fold change, dispersion, and average read count for all the genes. in reality, these parameters vary a lot between genes, and this method is not flexible enough to fully capture the complex characteristics of rna-seq data. although one can choose common conservative values for these parameters, it will overestimate the sample size and increase the cost of the experiments. we argue, because of the complexities of rna-seq experiments, it is no longer feasible to rely on one simple power versus sample size curve while treating all other factors as fixed input and holding strong assumptions such as exchangeability between genes and equating nominal error rate as actual error rate. we advocate prospective power evaluation in the context of rna-seq, i.e. evaluating power in a comprehensive manner under various scenarios of sample size and sequencing depth. we use the word prospective to emphasize our choice to assess and visualize power in multiple forms and maintain its high-dimensional nature, instead of specifying a fixed level of one particular form of power to determine the sample size. we demonstrate that, in addition to the sample size and the other usual suspects in power analysis (namely, effect size and withingroup variance), there are other factors (such as the distribution of mean expression level) and other choices (such as sequencing depth and gene filtering) that influence the power of de detection. we propose a simulation-based power evaluation, as the accumulation of rna-seq data allows us to construct in silico datasets that well resemble real rna-seq data, and the increasing computing efficiency allows us to evaluate actual error rate. moreover, we demonstrate that conditional power, i.e. power stratified by coverage or biological variation, is more informative than overall (marginal) power in both experimental design and analysis plan.statistical power and sample size determination are the most common questions we face in experimental design. in high-throughput experiments that involve a large number of in-exchangeable tests, statistical power is not as tractable as in classical hypothesis testing. we demonstrate that in a rna-seq study, more factors affect the sample size determination in addition to the effect size and variance, including the distribution of the baseline expression level (what proportion of genes have high coverage in the sequencing), the distribution of the biological variation and the proportion of genes having de. asking a biologist to provide specific numbers for all the above factors, and/or to confirm that a particular parametric distribution is reasonable for some parameter, seems unrealistic. on the other hand, assuming the overall behavior of a factor to resemble that in some existing dataset eases the communication. thus, we prefer semi-parametric simulation settings as described in section 2. the definition of power itself can vary in rna-seq experiments: we may be interested in average marginal power as the proportion of all de genes identified, or targeted power as the proportion of de genes identified from a subset of genes, or we may be interested in the number instead of proportion of de genes identified. for these reasons, we advocate sample size decision based on a comprehensive evaluation of statistical power as well as actual type i error, over a range of sample sizes, based on simulation studies. we refer to this as prospective power evaluation, as compared with fixing one set of assumptions on effect sizes/type i error control/expression level/sequencing depth and then compute a minimum sample size to achieve a certain level of power, for a particular type of power. the user visualizes the relationship between various types of power and sample size, expression level and biological variation, and understands the cost of false discovery in different strata of genes. the power evaluation thus assist the decision on sequencing depth, analysis plan (filtering or not, choice of nominal error rate), and then based on these decisions, the user can select a sample size that provides acceptable power. filtering certainly comes with sacrifice: we discard the power completely on the genes we filter out. but the power evaluation allows us an informative decision: we would know how much power we give up, and make this decision before real data are analyzed, so we reduce the number of tests, hence not having to adjust for the tests never performed. the fact that statistical power depends on the baseline expression level and the dispersion level has several consequences. the first consequence is that power for = 0 (i.e., j g j40) is often biased toward highly expressed genes. sometimes it may be beneficial to filter out genes with counts too low, as discussed above. the second consequence is that simulation results based on one rna-seq dataset may not be generalizable to experiments involving another tissue/cell type with a different expression distribution across genes. for this reason we provide options using several public rna-seq datasets as simulation sources. we also let the user substitute with their choice of baseline expression. one way of increasing power is to increase sequencing depth. this is apparent from the stratified power plot: when we sequence deeper, genes with average counts in lower strata will move to higher strata and be associated with higher sensitivity at the same type i error control. however, based on, there is a sharp increase of power when the genes average count goes410, but remains relatively flat thereafter. if there are many genes whose expression level is lower than but near 10, increasing the sequencing depth may help, but there is little gain on de detection sensitivity for those genes that already have high power. thus, the impact of sequencing depth also depends on the expression pattern of the transcriptome under study. if the transcriptome consists of a smaller fraction of the genes with similar level of expression, then with modest depth, most of the genes may already reside in middle expression strata with acceptable power.  
