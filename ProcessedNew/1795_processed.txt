genetics and population analysis fast spatial ancestry via flexible allele frequency surfaces motivation: unique modeling and computational challenges arise in locating the geographic origin of individuals based on their genetic backgrounds. single-nucleotide polymorphisms (snps) vary widely in informativeness, allele frequencies change non-linearly with geography and reliable localization requires evidence to be integrated across a multitude of snps. these problems become even more acute for individuals of mixed ancestry. it is hardly surprising that matching genetic models to computational constraints has limited the development of methods for estimating geographic origins. we attack these related problems by borrowing ideas from image processing and optimization theory. our proposed model divides the region of interest into pixels and operates snp by snp. we estimate allele frequencies across the landscape by maximizing a product of binomial likelihoods penalized by nearest neighbor interactions. penalization smooths allele frequency estimates and promotes estimation at pixels with no data. maximization is accomplished by a minorizemaximize (mm) algorithm. once allele frequency surfaces are available, one can apply bayes rule to compute the posterior probability that each pixel is the pixel of origin of a given person. placement of admixed individuals on the landscape is more complicated and requires estimation of the fractional contribution of each pixel to a persons genome. this estimation problem also succumbs to a penalized mm algorithm. results: we applied the model to the population reference sample (popres) data. the model gives better localization for both unmixed and admixed individuals than existing methods despite using just a small fraction of the available snps. computing times are comparable with the best competing software.the pertinence of the first law of geographyeverything is related to everything else, but near things are more related than distant things has long been obvious to population geneticists. for example, in the 1930s,) and kolmogorov derived and solved a partial differential equation describing the spatial spread of an advantageous allele. subsequent generations of ecologists and evolutionary biologists have studied the correlations between geography and population structure from many different perspectives . during the past decade in particular, geneticists have discovered how to localize the origin of individuals, human and otherwise, based on their genetic backgrounds . such localization is called spatial assignment. in an application of principal component analysis (pca),were able to match the first two principal components of the genotype matrix of the population reference sample (popres) dataset to the map of europe. pca-based estimation of geographic origins was accurate to within a few hundred kilometers. though this level of resolution is impressive, it is natural to wonder if a modelbased method for spatial assignment could perform better and whether inferences could be reliably made for admixed individuals. this promptedto introduce spatial structure analysis (spa), which, in fact, produces more accurate spatial assignments than pca. in estimating allelic frequency surfaces for each surveyed single-nucleotide polymorphism (snp), spa depends on a simple gradient function describing how allele frequencies vary with location. in practice, allele frequency surfaces can be bumpy without a dominant cline. the current article relaxes this restriction and gives more accurate reconstructions.motivated by advances in image reconstruction, we have presented a probability model for the estimation of complex allele frequency surfaces. our model captures not only linear clines, but also multiple local peaks on a landscape. allele frequency estimates represent a compromise between locally sampled genotypes and smoothness. the degree of smoothness is determined empirically by cross validation. spatial assignment exploits the allele frequency surfaces of the most informative snps. to no ones surprise, the ancestry informative snps drive projection. in ranking snps our homogeneity lrt statistic outperforms the information criterion of, which assumes equal sample sizes at the sampled sites. in practice, the combination of a good model with just 1 of the available snps give better geographic localization on the popres data than competing models (pca, scat and spa) with all of the snps. our computing times are vastly superior to scat and competitive with pca and spa. we have also proposed a model for spatial assignment of admixed individuals. our model assigns an admixture coefficient to each pixel. to avoid over-parameterization, we impose a penalty that enforces parsimony and focuses attention on those pixels with the greatest explanatory power. estimation of both allele frequency surfaces and admixture coefficients benefits from the mm principle. the mm algorithms generated are simple to code and automatically enjoy the ascent property. convergence can be slow, but standard extrapolation techniques accelerate convergence dramatically. on the negative side of the balance sheet, our software origen requires more storage per snp than spa, which characterizes an allele frequency surface by just three parameters. the accuracy of origen is also limited by the number of pixels. for the popres dataset, we enclosed europe in a square with 70 pixels on a side. smaller pixels make little discernible difference in resolution at the expense of considerably more computation. the heatmaps of posterior probabilities and admixture coefficients afforded by the pixels are a decided plus. the ability to exclude infeasible pixels over oceans is another advantage.note: spas localizations can fall outside the mapped region. the localization of origen and scat must fall within the mapped region. be taken as geographically localized. finally, our snp selection criterion is probably better suited to identifying ancestry informative snps than abstract information criterion. readers will doubtless think of many other ways of improving the current model. for example, a reviewer suggested that it might be useful to incorporate standard errors of allele frequency estimates into localization heatmaps. our preliminary testing of this plausible idea finds no improvement, probably because localization averages across so many snps. science, like product design, is usually an iterative process of successive refinement.admixed surfaces longitude latitude. admixture coefficients for four simulated europeans with grandparents from locations highlighted in lighter colors. the numbers listed are the estimated admixture coefficients at their respective pixels based on 40 k snps; values51 are omitted. in the top left is a simulated individual with four grandparents coming from the uk. on his right is an individual with two grandparents from germany and two from poland. on the bottom left is an admixed individual with two grandparents from portugal and one each from france and poland. finally, on the bottom right is an individual whose four grandparents come from spain, france, uk and poland  
