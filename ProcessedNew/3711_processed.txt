genome analysis probabilistic partitioning methods to find significant patterns in chip-seq data motivation: we have witnessed an enormous increase in chip-seq data for histone modifications in the past few years. discovering significant patterns in these data is an important problem for understanding biological mechanisms. results: we propose probabilistic partitioning methods to discover significant patterns in chip-seq data. our methods take into account signal magnitude, shape, strand orientation and shifts. we compare our methods with some current methods and demonstrate significant improvements, especially with sparse data. besides pattern discovery and classification, probabilistic partitioning can serve other purposes in chip-seq data analysis. specifically, we exemplify its merits in the context of peak finding and partitioning of nucleosome positioning patterns in human promoters. availability and implementation: the software and code are available in the supplementary material.chip-seq (immunoprecipitation combined with high-throughput dna sequencing) experiments allow to characterize in vivo transcription-factor binding events and local chromatin organization on a genome-wide scale . within the past few years, chip-seq has become a widely used and indispensable technology in the study of transcriptional regulation. other epigenetic profiling assays are also starting to have a similar impact on the research field . a chip-seq experiment produces a large number of sequence tags that are mapped to the genome, resulting in a genome-wide profile of tag counts. a high tag count at a location on the chromosome indicates the presence of a particular protein at that location. this protein may be a sequence-specific transcription factor, a post-translationally modified histone or some other chromatin-associated protein. the regions enriched in chip-seq tags are diverse in terms of magnitude, shape and orientation . sequence-specific transcription factors typically produce uniform narrow gaussian peaks, while regions enriched in histone modifications tend to show complex multimodal signal distributions. the term chromatin signature has been coined to designate recurrent patterns found in chip-seq-based histone modification maps and other types of chromatin profiling data . a chromatin signature is usually represented by a vector of average tag counts in bins of certain sizes (typically 50500 bp) in a collection of larger genomic regions of sizes 110 kb. chromatin signatures can be detected by so-called aggregation plots (aps) , if precisely mapped experimentally defined anchor points [e.g. transcription start sites (tsss)] are available for selection and delineation of the genomic regions of interest. a basic assumption in chip-seq data analysis is that specific chromatin signatures are associated with specific functions. for instance, human promoters are characterized by a nucleosome-free region of $150 bp and a rigidly positioned h3k4me3-marked +1 nucleosome centered 120 bp downstream from the tss . discovering a chromatin signature is difficult, especially when anchor points are not available. an effective algorithm must be capable to cope with the following obstacles. biological inhomogeneity of the samples: the set of analyzed genomic regions often consists of multiple unknown subclasses, in which case, a plot derived from all samples shows the superposition of several different chromatin signatures.alignment uncertainty: precise anchor points are rarely available for delineating genomic regions. selected chromatin regions first need to be optimally shifted (registered) with respect to each other before an ap can reveal a highresolution chromatin signature. asymmetry: chromatin signatures associated with directional molecular mechanisms (such as transcription) are usually asymmetrical. however, the orientation of the genomic regions is often unknown. the input count vectors should then be compared with each other in both orientations.sparse count data: certain bins may have very low tag counts, leading to high sampling errors. the problem of inhomogeneity can be tackled by off-the-shelf clustering and partitioning algorithms. in fact, hierarchical clustering and k-means have been incorporated in several to whom correspondence should be addressed. multipurpose computational platforms for chip-seq data analysis. seqminer offers an in-built k-means function, while chipseeker is interfaced with a third-party hierarchical clustering software. however, shifting and flipping are only implemented in specialized programs like chromasig , archalign , catchprofiles and cagt . archalign performs only shifting and flipping and can find only one single signature. cagt supports flipping but not shifting. (the problem of optimal shifting is typically solved by exhaustive comparison of all overlapping subregions of a given size from two genomic regions, possibly in both orientations.) chromasig, archalign and catchprofiles use progressive multiple alignment strategies to assemble similar tag profiles. because these algorithms have to carry out a large number of pairwise comparisons, they tend to be slow. to overcome this drawback, cagt applies a two-step divide-and-conquer approach. it first uses the k-median algorithm (a variant of k-means) to define top-level classes and then runs a hierarchical clustering algorithm on each of these classes in turn. the shifting and clustering functions require some type of distance measure. all of these programs, except chromasig, use non-probabilistic measures such as the euclidean distance or the pearson correlation coefficient, neither of which does well with low counts per bin. chromasig assesses similarity between samples and class membership assuming position-specific gaussian distributions of the normalized chip-seq signal within a chromatin signature. the use of gaussian distributions, which seems unnatural for count data, is explained by the fact that chromasig was originally designed for chip-chip data. in this article, we propose an alternative approach for finding recurrent patterns in chip-seq data by probabilistic partitioning. the underlying principle of this general method is to optimize a mixture model by an expectation-maximization (em) algorithm, a strategy that has already proved effective in finding recurrent dna motifs in selected genomic regions . a key difference in this method compared with the other clustering methods mentioned is that samples are not deterministically assigned to a single class: rather, their classification status is defined by a vector of class membership probabilities. while em has long been a standard tool in machine learning, it is a general-purpose method, whose convergence rates and running times depend on the exact formulation of the objective function and the updating formulae. the purpose of this article is to demonstrate the merits of em when applied to chip-seq data and to explain by examples how it can be applied to classification and motif-discovery problems in research on chromatin structures. the probabilistic partitioning approach offers the following advantages.(1) the use of probabilistic distance functions naturally takes into account random sampling variation in low-count data.(2) probabilistic class assignment allows accurate characterization of classes even in situations where the classification of individual samples is uncertain.(3) probabilistic class assignment is flexible and can combine goals, for instance, the ranking and prioritizing of chipseq signal-enriched regions based on peak shape.(4) shifting and flipping can be implemented in the em framework via hidden variables.(5) the implementation of probabilistic partitioning is straightforward with existing programming platforms. all algorithms used in this work can be implemented by 530 lines of r code.(6) flexibility: methods are readily customized to meet the needs of a particular application. for instance, the switching from a poisson probabilistic model to a negative binomial model requires only one change in the corresponding r code.(7) efficiency: in contrast to most existing methods, the em algorithm does not require exhaustive pairwise comparisons, so that each iteration runs in time linear in the number of samples.(8) transparency and reproducibility: methods can be accurately described in a research paper by reproducing a few lines of r code (for example, see the r code given in the supplementary material). section 2 presents in detail several variants of the probabilistic partitioning algorithms. section 3 analyses the performance of these algorithms on carefully chosen examples based on simulated and real chip-seq data and compares its performance with k-means clustering and cagt.we presented a probabilistic partitioning method to find significant patterns in chip-seq data. the corresponding algorithm runs in o(n) time given a fixed number of classes and em iterations. it is capable of processing large datasets (tens of thousands of samples) in minutes. the method is conceptually simple yet flexible, and has been implemented in a few lines of r code. the basic partitioning algorithm is readily adjusted to handling flips and shifts following standard principles of em. with low data coverage, the probabilistic partitioning method gives excellent model accuracy, superior to k-means or cagt when tested on the same data examples. we have further shown that probabilistic partitioning can serve other purposes than pattern discovery and classification, like partitioning of nucleosome positioning patterns in human promoters, and shape-based evaluation and re-focusing of chip-seq peaks from published peak lists.. shape-based peak evaluation with shifting. the figure illustrates the effects of probabilistic partitioning on a ctcf peak list provided by encode in terms of motif enrichment. (a) probabilistic partitioning with shifting. (b) partitioning based on original p-values. method details: ctcf binding motifs where identified by scanning the dna sequence around peak centers with the jaspar matrix ma0139.1 at a p-value threshold of 10 5. the percentage of sequences containing a ctcf motif is plotted in a sliding window of 50 bp. the numbers in parentheses indicate the sizes of the peak lists. for fair comparison, the threshold for partitioning with the original p-values was chosen such as to match the numbers of good and bad peak obtained with probabilistic partitioning. the motif enrichment profile for the complete peak list (dotted line) is included in both graphs  
