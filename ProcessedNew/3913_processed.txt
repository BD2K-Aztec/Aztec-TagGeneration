read-based phasing of related individuals motivation: read-based phasing deduces the haplotypes of an individual from sequencing reads that cover multiple variants, while genetic phasing takes only genotypes as input and applies the rules of mendelian inheritance to infer haplotypes within a pedigree of individuals. combining both into an approach that uses these two independent sources of informationreads and pedi-greehas the potential to deliver results better than each individually. results: we provide a theoretical framework combining read-based phasing with genetic haplotyp-ing, and describe a fixed-parameter algorithm and its implementation for finding an optimal solution. we show that leveraging reads of related individuals jointly in this way yields more phased variants and at a higher accuracy than when phased separately, both in simulated and real data. coverages as low as 2 for each member of a trio yield haplotypes that are as accurate as when analyzed separately at 15 coverage per individual. availability and implementation: https://bitbucket.org/whatshap/whatshaphumans are diploid and determining the sequences of both homologous copies of each chromosome is desirable for many reasons. these two sequences per chromosome are known as haplotypes. the process of obtaining them is known as haplotyping or phasing, two terms that we will use interchangeably. haplotype-resolved genetic data can be used, for instance, for population genetic analyses of admixture, migration and selection, but also to study allele-specific gene regulation, compound heterozygosity and their roles in human disease. we refer the reader tofor detailed reviews on the relevance of haplotyping. general approaches for haplotyping. there are three major approaches to phasing. first, haplotypes can be inferred from genotype information of large cohorts based on the idea that common ancestry gives rise to shared haplotype tracts, as reviewed by. this approach is known as statistical or population-based phasing. it can be applied to unrelated individuals and only requires genotype data, which can be measured at low cost. while very powerful for common variants, this technique is less accurate for phasing rare variants and cannot be applied at all to private or de novo variants. second, haplotypes can be determined based on genotype data of related individuals, known as genetic haplotyping . to solve the phasing problem, one seeks to explain the observed genotypes under the constraints imposed by the mendelian laws of inheritance, while being parsimonious in terms of recombination events. for larger pedigrees, such as parents with many children, this approach yields highly accurate phasings . on the other hand, it is less accurate for single mother-father-child trios and has the intrinsic limitation of not being able to phase variants that are heterozygous in all individuals. third, the sequences of the two haplotypes can be determined experimentally, called molecular haplotyping. many techniques do not resolve the full-length haplotypes but yield blocks of varying sizes. approaches furthermore largely differ in the amount of work, dna and money they require. on one end of the scale, next-generation sequencing (ngs) instruments generate local phase information of the length of a sequenced fragment at everdecreasing costs. another approach consists in breaking both homologous chromosomes into (larger) fragments and separating them into a number of pools such that each pool is unlikely to contain fragments from the same locus of both haplotypes. this can, for instance, be achieved by dilution followed by bar-coded short-read sequencing. to achieve molecular haplotyping over the range of a full chromosome, protocols have been invented to physically separate the two homologous chromosomes, for example by microscopybased chromosome isolation, fluorescence-activated sorting, or microfluidics-based sorting. these and other experimental techniques for molecular haplotyping have been surveyed by snyderwe report the results of wmec-5, wmec-15 and pedmec-g-5 for both datasets, real and simulated. all combinations of the three methods, two datasets and six different average coverages (2, 3, 4, 5, 10 and 15) were run. the predicted phasings are compared to the ground truth phasing for the respective dataset. that is, for the real dataset, we compare to the population-based phasing produced by shapeit; for the simulated dataset, we compare to the true haplotypes that gave rise to the simulated reads.shows the fraction of unphased snps in comparison to the phasing error rate (see section 4.4) for all conducted experiments. a perfect phasing would be located in the bottom left corner. the influence of coverage. increasing the average coverage is beneficial for phasing. for all three methods (wmec-5, wmec-15 and pedmec-g-5) and both datasets, the phasing error rate and the fraction of unphased snps decrease monotonically when the average coverage is increased, as is clearly visible in. the effect is much more drastic for wmec than for pedmec, however. apparently, wmec needs more coverage to compensate for pacbios high error rate while pedmec can resort to exploiting family information to resolve uncertainty. the value of family information. when operating on the same input coverage, pedmec-g-5 clearly outperformed wmec-5 and even wmec-15 in all cases tested. this was true for phasing error rates as well as for the fraction of phased positions. on the real dataset with average coverage 10 for instance, wmec-5 andwmec-15 reached an error rate of 2.9 and 1.9, while it was 0.5 for pedmec-g-5. most remarkingly, pedmec-g-5 delivers excellent results already for very low coverages. when working with an average coverage as low as 2 for each family member, it achieves an error rate of 1.4 and a fraction of unphased snps of 1.8 (on real data). in contrast, wmec-15 needs 15 average coverage on each individual to reach similar values (1.4 error rate and 1.3 unphased snps). when running on 5 data, pedmec-g-5s error rate and fraction of unphased positions decrease to 0.75 and 0.85, respectively. therefore, it reaches better results while requiring only a third of the sequencing data, which translates into significantly reduced sequencing costs. comparison of real and simulated data. when comparing results for simulated and real data, i.e. top and bottom plots in, the curves appear similar, with some important difference. in terms of the fraction of phased snps (y-axis), results are virtually identical. this indicates that our simulation pipeline establishes realistic conditions regarding this aspect. differences in terms of error rates (x-axis) are larger. in general, error rates in the real data are larger than in the simulated data, which might be partly caused by a too optimistic error model during read simulation. on the other hand, the population-based phasing used as ground truth for the real dataset will most likely also contain errors. especially lowfrequency variants present difficulties for population-based phasers. next, we therefore compare our ground truth statistical phasing to the independent phasing provided by 10xgenomics. three-way comparison with 10xgenomics.shows the results of a three-way comparison of ground truth statistical phasing, 10xgenomics, and pedmec-g-5 on 15 coverage data. we observe that the total fraction of cases where there is disagreement between the three methods is below 1. out of these, 10xgenomics and the statistical phasing agree in a sizeable fraction of cases, shown in blue. in these cases, the pacbio-based pedmec-g-5 is likely wrong. given pacbios high read error rate, the existence of such cases is not surprising. on the other hand, there also is a significant fraction of cases where pedmec-g-5 and 10xgenomics agree, shown in red, indicating likely errors in the statistical phasing. cases where pedmec-g-5 and the statistical phasing agree but disagree with 10xgenomics are very rare, which is likely due to the low error rates of short-read sequencing underlying the 10xgenomics phasing and the resulting highly accurate phasing. shapeit-trio and duohmm.(right) shows the same three-way comparison, but uses the results obtained from shapeit when run in trio mode. we see that this improved the phasing for the child but dramatically worsened the agreement for the parents, with more than 4 of all phased snp pairs for which 10xgenomics and pedmec-g-5 agreed but disagreed with shapeit-trio. running duohmm (o) to improve the shapeit-trio phasing did not lead to any changes, which might be related to that duohmm is designed to be run for large cohorts of related individuals. phase information beyond block boundaries. genetic phasing operates on genotypes of a pedigree, without using any sequencing reads.illustrates a case where we have two blocks that are not connected by reads in any individual. nonetheless phase information can be inferred from the genotypes: each block contains a snp that is homozygous in both parents and heterozygous in the child, which immediately establishes which haplotype is maternal and which is paternal in both blocks. note that this, in turn, also implies the phasing of the parents. by design, pedmec-g implicitly exploits such information. to demonstrate this, we used the real dataset and merged all blocks reported by pedmec-g into one chromosome-wide block and determined the fraction of cases where phases were correctly inferred between blocks and hence between two snps that are not connected by reads in any individual. this resulted in a fraction of 89.7 correctly inferred phased (averaged over all individuals and coverages; standard deviation 1.4). repeating the same for wmec yielded 50.4 correctly inferred phased, as expected equalling a coin flip. runtimes. all experiments have been run on a server with two intel xeon e5-2670 cpus (10 cores each) running at 2.5 ghz. the implementation in whatshap is sequential, i.e. only using one cpu core. in all cases, the time spent reading the input files dominated the time spent in the phasing routine itself. processing all three individuals of the 5 coverage real dataset took 31.1 min, 31.2 min and 26.2 min for wmec-5, wmec-15 and pedmec-g-5, respectively. this time included all i/o and further processing. of these times, 2.0, 4.1 and 101.0 s were spent in the phasing routine, respectively. for input coverage 15 total processing took 89.3, 93.9 and 65.4 min for wmec-5, wmec-15 and pedmec-g-5, respectively. of this, 2.5, 149.9, 321.5 s were spent in the phasing routines, respectively. we conclude that the phasing algorithm presented here is well suited for. three-way comparison of phasings provided by shapeit, 10xgenomics and pedmec-g-5 (on 15 coverage data). of all pairs of consecutive snps phased by all three methods, the percentages of cases where the phasing reported by one method disagrees with the other two are reported. missing to 100: cases where all three methods agree. left: shapeit run with default parameters, corresponding to our ground truth phasing; right: shapeit run with pedigree information. two disjoint unconnected haplotype blocks for which phase information can be inferred from the genotypes read-based phasing of related individuals i241 handling current datasets swiftly. in the future, we plan to further optimize the implementation of i/o subroutines and provide automatic chromosome-wise parallelization of data processing.we have presented a unifying framework for integrated read-based and genetic haplotyping. by generalizing the whatshap algorithm , we provide a fixed-parameter tractable method for solving the resulting np-hard optimization problem, which we call pedmec. when maximum coverage and number of individuals are bounded, the algorithms runtime is linear in the number of phased variants and independent of the read length, making it well suited for current and future long-read sequencing data. this is mirrored by the fact that the runtime is dwarfed by the time required for reading the input files in practice. pedmec can use any provided costs for correcting errors in reads as well as for recombination events. by using phred-scaled probabilities as costs, minimizing the cost can be interpreted as finding a maximum likelihood phasing in a statistical model incorporating mendelian inheritance, read error correction and recombination. testing the implementation on simulated and real trio data, we could show that the method is notably more accurate than phasing individuals separately, especially at low coverages. beyond enhanced accuracy, our method is also able to phase a greater fraction of heterozygous variants compared to single-individual phasing. being able to phase more variants is a key benefit of the integrative approach. whereas read-based phasing can in principle only phase variants connected by a path through the covering reads, adding pedigree information enables even phasing of variants that are not covered in all individuals since the algorithm can fall back to using genotype information.illustrates the increased connectivity while phasing a trio, resulting in more phased variants in practice. genetic haplotyping alone cannot phase variants that are heterozygous in all individuals, emphasizing the need for an integrative approach as introduced here. we demonstrate that such an approach indeed yields better result and recommend its use whenever both reads and pedigree information are available. most remarkingly, the presented approach is able to deliver outstanding performance even for coverages as low as 2 per individual, on par with performance delivered by single-individual haplotyping at 15 coverage per individual. future work. we plan to implement phasing of de novo variants observed in the child, which would be impossible with pure genetic haplotyping but is straightforward with our approach. since runtime is exponential in the maximum physical coverage, pruning of datasets is required in practice. the read selection approach currently implemented in whatshap aims to retain reads that both cover and connect many variants at the same time, in particular for heterogeneous combinations of datasets such as paired-end or mate-pair reads together with long reads. for pedigrees, each dataset is currently pruned individually, but results would likely improve if pedigree structure was taken into account in this step. finally, since we show that it is possible and beneficial to integrate both read-based and genetic phasing, the next obvious question is whether it is possible to modify our unified theoretical framework to one that also includes statistical phasing.  
