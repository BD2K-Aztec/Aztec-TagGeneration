identification and quantification of metabolites in 1 h nmr spectra by bayesian model selection motivation: nuclear magnetic resonance (nmr) spectroscopy is widely used for high-throughput characterization of metabolites in complex biological mixtures. however, accurate interpretation of the spectra in terms of identities and abundances of metabolites can be challenging, in particular in crowded regions with heavy peak overlap. although a number of computational approaches for this task have recently been proposed, they are not entirely satisfactory in either accuracy or extent of automation. results: we introduce a probabilistic approach bayesian quantification (bquant), for fully automated database-based identification and quantification of metabolites in local regions of 1 h nmr spectra. the approach represents the spectra as mixtures of reference profiles from a database, and infers the identities and the abundances of metabolites by bayesian model selection. we show using a simulated dataset, a spike-in experiment and a metabolomic investigation of plasma samples that bquant outperforms the available automated alternatives in accuracy for both identification and quantification.the field of metabolomics studies small molecules such as amino acids, nucleic acids, lipids and carbohydrates, called metabolites, which are present in cells and extracellular fluids of biological organisms . metabolites are the end products of a variety of cellular processes and their high-throughput characterization and quantification can provide important insights into the functioning of living organisms. as a result, metabolomics is increasingly applied to the areas of system biology, drug discovery, pharmaceutical research, early disease detection, toxicology and food science . to whom correspondence should be addressed. developments in high-throughput metabolomics are driven by advances in analytical methods , such as nuclear magnetic resonance (nmr) spectroscopy and in mass spectrometry. in particular, 1 h nmr spectroscopy is non-destructive and highly reproducible, and is widely used for the identification and quantification of metabolites in biofluids such as plasma and urine . the 1 h nmr signal is generated by the motion of magnetic moments of protons or other nuclei in a magnetic field after their excitement with a high-frequency pulse . fourier transformation of this time-dependent signal yields a chemical shift, a measure that expresses the dependence of nuclear magnetic energy on the electronic and chemical environment in the molecule. an 1 h nmr spectrum displays chemical shifts in parts per million (p.p.m., i.e. the difference in hertz between a resonance frequency and that of a reference substance, over frequency of magnet field in megahertz), versus intensities of the signals . typically, a metabolite detectable by 1 h nmr contains one or more protons, and each of the protons produces one or more peaks. the number of peaks generated by a metabolite, as well as their location and ratio of heights, are reproducible and uniquely determined by the chemical structure of the molecule.illustrates two 1 h nmr spectra with a dominant signal from metabolite taurine from the spike-in experiment in section 4. all three predominant peaks in the spectra correspond to one proton in the taurine chemical structure. the expected ratio of heights of the three peaks is known and fixed to 1:2:1. extensive information regarding nmr-specific characteristics of a variety of metabolites is currently available. several public databases, such as human metabolome database (hmdb) and biomagresbank (bmrb) , as well as commercial databases such as the one in the chenomx nmr suite , store reference nmr spectra of metabolites. the reference spectra can contain observed peak locations and ratios of heights of spectra from pure chemical compounds, or their simulated counterparts. therefore, in principle, researchers can identify metabolites by matching the observed spectra to the reference spectra in the database. the area of the peaks from a metabolite is directly related to its abundance. as the abundance changes, the heights of peaks belonging to the same metabolite vary, as shown in the case of taurine in. this enables relative quantification of metabolites across samples ofregion from two 1 h nmr spectra from the spike-in experiment in section 4. solid line: spectral region from a sample containing the spiked metabolite taurine in the concentration of 3200 mols/l. dashed line: spectral region from a sample containing taurine in the concentration of 1600 mols/l. the decrease in metabolite abundance results in a proportional decrease of all three peaks. various types, e.g. across samples from patients with various status of a disease in biomarker discovery investigations. however, inference of identity and abundance of metabolites from 1 h nmr spectra is fraught with difficulties. first, complex biological mixtures contain hundreds of metabolites, which vary in abundance substantially, and can produce highly overlapped peaks. second, the number of candidate metabolites in a database typically exceeds the number of major sources of signals in the spectra, and one has to explore a combinatorially large space of candidate metabolites. finally, due to numerous factors such as potential of ph and ionic interactions, peaks generated by a metabolite can deviate from their expected p.p.m. , introducing positional uncertainty. the combination of these factors makes the deconvolution and the interpretation of individual metabolite-specific signals very challenging in practice. automated inferential approaches are needed in order to account for the noise and ambiguity of spectral interpretations, and to derive objective, accurate and reproducible identifications and quantifications of metabolites. this article develops a fully automated inferential approach, that we call bquant, for identification and quantification of metabolites in regions of complex 1 h nmr spectra. it takes as input a set of nmr spectra, a range of p.p.m. of interest and a database of reference spectra for candidate compounds. it is based on a family of bayesian hierarchical models for the spectra, where the models with the highest posterior probabilities are selected using a stochastic sampling technique. bquant outputs a list of identified metabolites associated with their inclusion probability, and their measures of abundances in each spectrum on a continuous scale.we compared the performance of bquant to representative instances of three classes of fully automated methods in section 2. binning is represented by the adaptive intelligent binning (ai binning) . an instance of curve fitting without a database is the multiplicative update algorithm implemented in the r package non-negative matrix factorization (nmf) , which we abbreviate as mu-nmf. both ai binning and mu-nmf cannot automatically identify the metabolites, and cannot be compared to bquant in terms of identification. therefore, we attempted to identify the bins (or the components of the deconvoluted mixtures) manually whenever possible, to compare the performance of these methods in terms of quantification. curve fitting with a database is represented by least-squares deconvolution (ld) , and enables a simultaneous identification and quantification of metabolites. since the original implementation of ld does not account for a baseline, this can negatively affect the performance of the method. hence page: 1642 16371644we also implemented a modified version of ld which, similarly to bquant, incorporates a sample-specific baseline using penalized b-spline. this is accomplished by adding a term including the same design matrix s as specified in model (1), and a sample-specific coefficient i , to the original formulation of ld. we refer to this modified version as ld with baseline (ldbl). we applied both ld and ldbl to the individual spectra in full resolution. since the methods are only applicable to the individual spectra, we compared them to bquant according to the list of most frequently identified metabolites. to reduce the computational complexity of bquant, we used ldbl for reduction of the size of the database. we chose l max = 35, since local regions typically do not contain more than 35 significantly abundant metabolites.  
