sequence analysis soda2: a hidden markov model approach for identification of immunoglobulin rearrangements motivation: the inference of pre-mutation immunoglobulin (ig) rearrangements is essential in the study of the antibody repertoires produced in response to infection, in b-cell neoplasms and in autoimmune disease. often, there are several rearrangements that are nearly equivalent as candidates for a given ig gene, but have different consequences in an analysis. our aim in this article is to develop a probabilistic model of the rearrangement process and a bayesian method for estimating posterior probabilities for the comparison of multiple plausible rearrangements. results: we have developed soda2, which is based on a hidden markov model and used to compute the posterior probabilities of candidate rearrangements and to find those with the highest values among them. we validated the software on a set of simulated data, a set of clonally related sequences, and a group of randomly selected ig heavy chains from genbank. in most tests, soda2 performed better than other available software for the task. furthermore, the output format has been redesigned, in part, to facilitate comparison of multiple solutions. availability: soda2 is available online at https://hippocrates.duhs .duke.edu/soda. simulated sequences are available upon request.b cells express immunoglobulin (ig) molecules on their outer surface and secrete them into the extracellular space. secreted ig is known as antibody. the genes that encode for antibodies are generated by many diversifying mechanisms including combinatorial rearrangement of gene segments, addition of non-templated (n) nucleotides at the junctions, and somatic hypermutation. this circumstance presents the important challenge of inferring the components of the original rearrangement for any observed ig gene. because point mutations cause loss of information regarding the original rearrangement, there may be multiple plausible solutions. in this article, we present a bayesian statistical method based on a hidden markov model (hmm) that allows a complete statistical to whom correspondence should be addressed. treatment of the problem by providing the posterior probability of each possible rearrangement. antibodies serve as effector molecules that neutralize microbes by binding to exposed antigens and targeting them to other components of the immune system, such as phagocytic cells and complement, that effect clearance. ig genes generate diversity in two stages: an antigen-independent and an antigen-dependent stage. antigenindependent diversity is generated in the bone marrow, where b cells originate, by combinatorial rearrangement of gene segments and junctional diversity. combinatorial diversity is created in a number of ways. first, each antibody molecule comprises one heavy-and one light-chain protein. both the light-and heavy-chain genes are encoded by gene segments that are genetically rearranged during a process known as v(d)j recombination . heavy chains are made up of three gene segmentsvariable (vh), diversity (dh) and joining (jh) where as light chains only have a v and j segment. in humans, there are 50 known functional vh segments, 27 known functional dh segments, and six known functional jh segments . this arrangement allows for 8100 combinations in the heavy chain alone. humans also have two light-chain loci, and . only one of these loci is expressed per cell so that each antibody either has a light chain or a light chain. humans have 44 functional v, 5 j, 33 v genes and 5 j resulting in 220 possible chains and 165 possible chains. thus this combinatorial rearrangement alone allows for greater than 3 million antibodies. junctional diversity is the result of multiple recombination site choices for each recombination event and the addition of n nucleotides. n nucleotides are sometimes added at the junction by terminal deoxynucleotidyl transferase (tdt) between adjoining gene segments . although tdt is believed to be expressed only in pro-b cells, the stage in which the heavy-chain rearrangement takes place , the presence of n nucleotides in light chains has also been seen in a few studies . antigen-dependent diversity is generated by somatic hypermutation in the periphery in a manner dependent on activationinduced cytidine deaminase (aid); during this process, mutations in the ig genes are accumulated at rate of up to 10 6 times the normal background rate . b cells are subsequently selected for enhanced affinity for the eliciting antigen. it is estimated that these processes of diversification can generate 10 12 different antibodies making it challenging to correctly identify the underlyingthe problem of inferring the correct rearrangement for antigen receptors is difficult due to the stochastic nature of the process, but the task is important for an increased understanding of the population somatic genetics of the immune response. in this paper we present a method based on an hmm that provides a statistical basis for identifying rearrangements of ig genes. in addition to providing the posterior probability of the top rearrangement candidate, soda2 also provides the user with an option to see all rearrangements with sufficiently high posterior probabilities, thus giving the user a statistically complete picture of the observed sequences origins. we tested soda2 against simulated datasets that were created using empirically observed recombination site choices for each of the gene segments and numbers of n nucleotides in the junctions. we also tested it on two clonally-related datasets as well as a set of ig heavy chains chosen randomly from genbank. our software performed as well as or better than available software on two out of three validation tests. the one test where soda did not outperform all of the others involved a single rearrangement. on the identical test with a different rearrangement, soda did as well as its nearest competitor. it is important to realize that the key feature of this article is to provide a tool based entirely on a probability model, and that therefore returns results interpretable as posterior probabilities rather than arbitrary scores. as with other inferential procedures, it is important to not only identify the optimal solution, but to identify near-optimal solutions and have a  
