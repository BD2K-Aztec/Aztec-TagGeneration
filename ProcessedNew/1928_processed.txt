gapped sequence alignment using artificial neural networks: application to the mhc class i system motivation: many biological processes are guided by receptor interactions with linear ligands of variable length. one such receptor is the mhc class i molecule. the length preferences vary depending on the mhc allele, but are generally limited to peptides of length 811 amino acids. on this relatively simple system, we developed a sequence alignment method based on artificial neu-ral networks that allows insertions and deletions in the alignment. results: we show that prediction methods based on alignments that include insertions and deletions have significantly higher performance than methods trained on peptides of single lengths. also, we illustrate how the location of deletions can aid the interpretation of the modes of binding of the peptide-mhc, as in the case of long peptides bulging out of the mhc groove or protruding at either terminus. finally, we demonstrate that the method can learn the length profile of different mhc molecules, and quantified the reduction of the experimental effort required to identify potential epitopes using our prediction algorithm. availability and implementation: the netmhc-4.0 method for the prediction of peptide-mhc class i binding affinity using gapped sequence alignment is publicly available at:a large number of biological processes are guided by receptor interactions with linear ligands . proteins involved in interactions with a linear component include membrane receptors (e.g. the mhc molecules), enzymes (e.g. kinases and phosphatases) and carriers of peptide-recognition domains (e.g. sh3, pdz, ww). characterizing the specificity of such interactions is essential for our understanding of the underlying biological process and for the design of interventions aimed at altering or controlling the behavior of these processes. we have previously proposed an artificial neural networkbased algorithm, nnalign, for the identification of binding motifs in large-scale quantitative peptide datasets (however, this approach can only generate un-gapped sequence alignments and is therefore limited to the detection of motifs of a fixed length. in many cases, experimental data are derived using libraries of peptides that are longer than the basic receptor binding core. while still a linear problem, the number of residues directly involved in the interaction with the same receptor may generally vary for different ligands. a prominent example of receptor that interacts with linear ligands of variable length is the mhc system. major histocompatibility complex (mhc) class i molecules bind peptides derived from intracellular proteins and present them on the cell surface to cd8 t cells.mhc molecules exist in numerous allelic variants with different physicochemical properties of their binding cleft. consequently, the peptide repertoire recognized by different mhc molecules is very diverse, with marked allele-specific amino acid preferences. the major determinants of such amino acid preferences are found at the so-called anchor residues, generally corresponding to positions p2 and p9 of the minimum nine amino acid binding core . in some cases other positions play a crucial role: for instance hlab08:01 has a strong preference for positively charged amino acids at p5, and hla-a01:01 for aspartic acid at p3 . constraints within peptides and intrapeptide contacts may also, to some extent, play a role in presentation and t-cell recognition . mhc class i molecules exhibit preferences also with regard to the length of the peptides they can bind. outside of a few exceptions where super-bulging peptides of up to 14 amino acids have been observed to bind to the mhc , the closed conformation of the mhc class i binding cleft limits the length of bound peptides to 811 amino acids. recent elution studies have attempted to quantify the length distribution of naturally processed and presented peptides and found that generally 9mer peptides were optimal. however, allele-specific preferences exist, for instance in the relatively high fraction of 8mer peptides found in complex with hla-b18:01 . similarly, the murine allele h-2-kb is known to have a comparable preference for 8 and 9mers and hla-b44:03 a relative tendency toward longer peptides such as 10 and 11mers . considerable efforts have been dedicated to the development of accurate methods for the prediction of peptide binding to mhc molecules, applying many different approaches including similarity matrices , linear regression and artificial neural networks , among others. of these methods, netmhc has been shown in several benchmark studies to be a state-of-the-art predictor for peptidemhc binding affinity . netmhc was trained on mhc peptide binding data contained in the immune epitope database (iedb) . the iedb has a large bias toward peptides of length nine (72 of the data are for 9mers, whereas 3 of the data are for peptides of length 11). as the amount of available training data is crucial for the generation of accurate prediction models, the performance of data-driven predictors such as netmhc will in general be limited for lengths different from nine. we have previously suggested a simple approximation approach that uses neural networks trained on 9mer data to extrapolate predictions for peptides of lengths other than nine . this approximation was used in netmhc to generate predictions for peptides of lengths 8, 10 and 11 for alleles with scarce binding affinity data. a more extreme approach has been taken for the development of the netmhcpan method, which was trained only on 9mer peptides . while these strategies have proven highly successful, they have the great limitation that they simply ignore all available data not conforming to the canonical 9mer peptide motif length. in this article, we extend the nnalign method to overcome this limitation and generate pan-length artificial neural networks trained on peptides of variable length. we demonstrate the performance of the method on a large set of mhc class i binding data, and show that it outperforms methods trained on single lengths and extrapolations from networks trained on 9mers only. also, we addressed how the predicted location of deletions can aid the interpretation of the modes of binding of peptide-mhcs, as in the case of long peptides bulging out of the mhc groove or extending at either terminus. finally, we analyzed to what degree the peptide length distribution of binders of the pan-length networks reflect the length preferences of different mhc class i alleles, and how such length preferences can potentially reduce the cost burden involved in rational epitope discovery.the machine-learning algorithm presented here stems from our previous work on sequence alignment based on artificial neural networks, namely the nnalign method . by bringing together the training examples onto a common window of fixed length, the nnalign training procedure effectively generates a multiple sequence alignment representing the minimal binding core of each peptide. the main innovation of the algorithm is the introduction of insertions and deletions into the nnalign learning framework, essentially enabling the creation of gapped sequence alignments. in the context of the mhc class i system, where the length of ligands is usually variable, insertions and deletions allow reconciling peptides of different lengths to a binding core of a common size. we demonstrated that models trained on all peptide lengths are superior to models made on individual lengths, especially for molecules with few measured experimental data of a given peptide length. these models also have higher performance than extrapolations from models constructed on 9mer peptides only. moreover, prediction of the core location can provide insight on the binding mode of linear peptides to their receptor, such as in the case of binders bulging out from the middle of the mhc groove or non-canonical binders protruding at the termini. a further advantage of using a single model trained on peptide of all lengths is that the length preferences of the receptor can be learned by the method. we observed that for several mhc class i molecules the length distribution of the top predicted binders follows the known preferences for the different mhc alleles. if netmhc-4.0 is used for a proteome scan in search for potential t cell epitopes, peptides of optimal length for the alleles of interest are therefore inherently prioritized. we quantified the experimental effort that can be saved by a bioinformatics-based selection of potential epitopes on a set of known ligands contained in the syfpeithi database, and found that on average the experimental effort and cost in identifying actual ligands could be reduced by at least 25 when using the prediction models trained with the pan-length algorithm. the applications of the proposed machine-learning algorithm are not limited to the mhc class i system. the method is equally well suited to the identification of binding motifs in other peptide datasets characterized by a linear component, and we expect future applications will include mhc class ii binding, pan-specific mhc class i and class ii binding, and peptide interactions with pdz, sh2 and sh3 domains.the netmhc-4.0 method for the prediction of peptidemhc class i binding affinity is publicly available as a webserver at http:// www.cbs.dtu.dk/services/netmhc-4.0.  
