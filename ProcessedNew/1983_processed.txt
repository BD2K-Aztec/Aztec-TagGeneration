gene expression gene selection for the reconstruction of stem cell differentiation trees: a linear programming approach motivation: stem cell differentiation is largely guided by master transcriptional regulators, but it also depends on the expression of other types of genes, such as cell cycle genes, signaling genes, metabolic genes, trafficking genes, etc. traditional approaches to understanding gene expression patterns across multiple conditions, such as principal components analysis or k-means clustering, can group cell types based on gene expression, but they do so without knowledge of the differentiation hierarchy. hierarchical clustering can organize cell types into a tree, but in general this tree is different from the differentiation hierarchy itself. methods: given the differentiation hierarchy and gene expression data at each node, we construct a weighted euclidean distance metric such that the minimum spanning tree with respect to that metric is precisely the given differentiation hierarchy. we provide a set of linear constraints that are provably sufficient for the desired construction and a linear programming approach to identify sparse sets of weights, effectively identifying genes that are most relevant for discriminating different parts of the tree. results: we apply our method to microarray gene expression data describing 38 cell types in the hematopoiesis hierarchy, constructing a weighted euclidean metric that uses just 175 genes. however, we find that there are many alternative sets of weights that satisfy the linear constraints. thus, in the style of random-forest training, we also construct metrics based on random subsets of the genes and compare them to the metric of 175 genes. we then report on the selected genes and their biological functions. our approach offers a new way to identify genes that may have important roles in stem cell differentiation.the differentiation of stem cells from a pluripotent state towards increasingly specialized cell types has long been conceptualized as a branching process, with multi-potent cells towards the top and fully differentiated cells at the bottom layer . the discrete cell types in the differentiation hierarchy have been identified by scientists using a number of means, including morphology, the study of development, lineage tracing, etc. in practice, the cell types v c the author 2015. published by oxford university press. all rights reserved. for permissions, please e-mail: journals.permissions@oup.com are often identified based on the expression of certain marker genes. many of these are cell-surface proteins, which are fairly easy to assay biochemically . however, such marker genes are not necessarily causative of the cell type, in the sense of being master transcriptional regulators. this raises important questions about how gene expression across the whole genome controls or reflects cell state, and in particular, differentiation hierarchies. since the advent of gene expression microarrays, and more recently rna-seq technology, expression in various stem cell types has been studied. this has prompted some authors to try to reconstruct differentiation hierarchies de novo, based only on expression data.used single linkage hierarchical clustering on microarray gene expression data of mature, differentiated human blood cells to classify them into nine distinct lineages. the resulting tree agreed with the known differentiation tree for blood cells, proving that de novo reconstruction of the tree is possible.showed that, similar to phylogenetic tree reconstruction, cellular differentiation hierarchies of mammalian tissue, specifically the hierarchical structures for hematopoietic differentiation, neural differentiation and early endoderm organogenesis, can be inferred from gene expression profiles by parsimonious maximization, again confirming the feasibility of de novo reconstruction. principal component analysis (pca) has also been used to map expression profiles of cells onto the principal component space of lower dimension . the positions of cells on the trajectories formed in the space of the highest three components seem to reflect the developmental potency of the cells and their differentiation status. we became interested in testing reconstruction on the more extensive dataset of. this data comprises microarray gene expression data for 22 215 genes in 38 distinct cell types in the hematopoiesis hierarchy , each assayed with between 4 and 10 replicate arrays, for a total of 211 arrays (supplementary). the majority of the cell types were purified with 95 purity from umbilical cord blood, which is enriched in undifferentiated populations. however, the terminally differentiated populations were purified from adult peripheral blood because exposure to antigens after birth is necessary for these populations. the remaining cells were identified by flow cytometry for labeled antibodies against the marker genes listed beside each cell type inand/or flow scatter properties. all marker genes that were used for cell type identification are also shown in supplementary table s1. [more details on cell populations and their sorting can be found in the experimental procedures of. the hierarchical clustering approach espoused byand the maximum parsimony approach of joshi and berthold (2011) assume data only at the most-differentiated level. thus, they are not well-suited to the novershtern data, which includes expression data at both leaves and internal nodes of the differentiation hierarchy. nevertheless, by taking the unpalatable step. the 38 cell types are: hematopoietic stem cells (hsc1-2), common myeloid progenitor (cmp), megakaryocyte/erythroid progenitor (mep), erythroid cells (ery1-5), cfu-mk (mega1), megakaryocyte (mega2), granulocyte/monocyte progenitor (gmp), cgu-g (gran1), neutrophilic metamyelocyte (gran2), neutrophil (gran3), cfu-m (mono1), monocyte (mono2), eosinophil (eos), basophil (bas), myeloid dendritic cell (mld), plasmacytoid dendritic cell (pld), early b cell (pre-b2), pre-b cell (pre-b3), navenave b cell (b1), mature b cell class able to switch (b2), mature b cell (b3), mature b cell class switched (b4), mature nk cells (n1-4), navenave cd8 t cell (t2), cd8 effector memory ra (t1), cd8 effector memory (t3), cd8 central memory (t4), navenave cd4 t cell (t6), cd4 effector memory (t7) and cd4 central memory (t8). near each cell type is a list of the marker genes whose expression was used by the authors ofto identify that cell type. a plus/minus sign following a marker gene name indicates a relatively higher/lower expression level of that gene in a cell type. a list of all marker genes used for cell type identification is shown in supplementary table s1 (color version of this figure is available at bioinformatics online.) of discarding the 18 non-fully differentiated cell types, leaving only the 20 fully differentiated types, we were able to apply both approaches. the resulting trees bore substantial resemblance to the correct differentiation hierarchy, although there were some errors (supplementary figs s1 and s2). it occurred to us that we might be able to reconstruct the differentiation hierarchy as a minimum spanning tree, because this would allow cell types to be either internal or leaf nodes in the resulting tree. we thus tried constructing minimum spanning trees on the expression data using various distance metrics (euclidean, l1, cosine, correlation, chebyshev, etc.). accuracy of these reconstructions varied, but none of the trees matched the true differentiation tree (supplementary figs s3s6). by performing pca on the expression data of the 38 hematopoietic cell types, we were able to map the expression profiles of the cell types onto the space of the 37 principal components. the positions of the cells showed partial agreement with the correct hierarchy (supplementary); however, again, when we constructed a minimum spanning tree of the 38 cells using euclidean distance on the cell profiles in the new space of the n-highest components for n 1,. .. , 37, the resulting trees did not agree with the correct differentiation tree. minimum spanning trees constructed using single principal components also did not agree with the differentiation hierarchy (supplementary). we concluded that to reconstruct a differentiation hierarchy as a minimum spanning tree, we need to identify the correct distance metric. distance metric learning has been studied extensively in the machine learning literature, particularly in the context of classification. for instance,introduced a convex optimization method for learning a distance metric that minimizes the distance between objects of the same class subject to linear constraints that ensure objects from different classes are well separated. similar work was done by kwok and tsang (2003) and globerson and roweis (2005)., weinberger and saul (2008) and ying and li (2012) aim to improve k-nearest neighbor classification by learning a mahalanobis distance metric from labeled training examples. a comprehensive survey of distance metric learning algorithms can also be found in. however, all of these methods focus on improving performance in classification tasks, usually binary classification. none of these methods is suitable to find a metric consistent with a differentiation hierarchy. the main contribution of the present article is to propose a solution to the following problem: given a set of objects (cell types) with associated feature vectors (gene expression), and given a tree t on those objects, identify a weighted euclidean distance metric such that the minimum spanning tree m constructed with that distance metric is precisely the tree t. we propose a set of linear constraints on the weights, depending on the tree t and feature vectors, and prove that they are sufficient (though not necessary) to establish the desired distance metric. we then propose an efficiently solvable linear program designed to satisfy those constraints while minimizing the l1-norm of the weights. this produces a sparse set of weights for hierarchy reconstruction, in essence choosing a subset of genes to participate in the distance metric. we apply this approach to the novershtern data, demonstrating successful tree reconstruction, and report on genes selected by the optimization.our differentiation tree has n 38 nodes and each replicate array in the dataset consists of 22 215 gene expression values. therefore, the matrix a in our linear program has 37 36 1332 constraints/ rows and 22 215 columns. for the purpose of computational accuracy and to be fair with all genes, we averaged the expression of each gene across all replicates of a cell so that each cell is represented by one array. we then normalized the data so that the mean expression of each gene over all cells is 0 with a standard deviation of 1. for the inequalities in our linear program, we chose b 1 t. any other negative constant produces the same results, although attaching different constants to different constraints could produce different results.  
