genetics and population analysis motivation: rapid advances in genotyping and genome-wide association studies have enabled the discovery of many new genotypephenotype associations at the resolution of individual markers. however, these associations explain only a small proportion of theoretically estimated heritability of most diseases. in this work, we propose an integrative mixture model called jbase: joint bayesian analysis of subphenotypes and epistasis. jbase explores two major reasons of missing heritability: interactions between genetic variants, a phenomenon known as epistasis and pheno-typic heterogeneity, addressed via subphenotyping. results: our extensive simulations in a wide range of scenarios repeatedly demonstrate that jbase can identify true underlying subphenotypes, including their associated variants and their interactions, with high precision. in the presence of phenotypic heterogeneity, jbase has higher power and lower type 1 error than five state-of-the-art approaches. we applied our method to a sample of individuals from mexico with type 2 diabetes and discovered two novel epistatic modules , including two loci each, that define two subphenotypes characterized by differences in body mass index and waist-to-hip ratio. we successfully replicated these subphenotypes and epistatic modules in an independent dataset from mexico genotyped with a different platform. availability and implementation: jbase is implemented in c, supported on linux and is available atgenome-wide association studies (gwas) have been successful in identifying thousands of novel disease markers. however, the discovered associations explain only a small proportion of theoretically estimated heritability of most diseases . this is referred to as the missing heritability problem. among the main hypotheses attempting to explain the missing heritability , four of them can be addressed with more detailed genetic data and more advanced methods: (i) rare variants and structural variants (svs), which are not covered by the common single-nucleotide polymorphism (snp) arrays used in gwas; (ii) spurious associations caused by population stratification; (iii) interactions between variants, i.e. epistasis and (iv) phenotypic heterogeneity. solutions to each problem have been sought with varying degrees of success. for example, full assessment of the impact of rare variants and svs on phenotypic variation requires larger cohorts, which is becoming feasible with affordable sequencing technologies and meta-studies. it is now possible to detect and remove spurious associations using efficient linear mixed models . in this article, we focus on epistasis and phenotype heterogeneitytwo major computational problems potentially contributing to missing heritability. recent large-scale genomic studies on model organisms , as well as theoretical findings revealed that epistasis may hinder identification of genetic associations. it is possible to categorize epistasis detection algorithms into three types: (i) pre-gwas algorithms that were mostly developed for small-scale datasets, e.g. multi-factor dimensionality reduction ; (ii) exhaustive search algorithms, such as team , sixpac and gwis , which scale to gwas datasets but only detect pairwise and often limited types of interactions and (iii) stochastic search methods such as beam , a generative latent variable framework that models marginal (independently acting) and epistatic effects allowing for any number of interactions. its successors include beam2 and beam3 . most of these methods rely on markov chain monte carlo for inference. many complex human diseases, such as autism, diabetes and cancer, are very heterogeneous. for example, it has been observed that risk variants associated with type 2 diabetes (t2d) differ in patients with high and low body mass indices (bmis) . similarly, in medulloblastoma, analysis of 1000 genomes revealed extensive subgroup specific variants that give rise to subgroup specific phenotypes, i.e. subphenotypes . there is now increasing evidence from breast cancer, hearing loss, cholesterol-related disorders, mental illnesses and t2d studies that many complex diseases may be better characterized as a collection of distinct and less common subdiseases . disease heterogeneity, if not taken into account, can have profound consequences on the success of association studies. it reduces statistical power to detect causal variants and confounds replication studies such that true associations fail to replicate and become classified as false positives (and also a detailed discussion in supplementary material section s1). subphenotyping attempts to solve these problems by (automatically) stratifying the global population to identify homogeneous patient subgroups. several approaches have recently been developed to address disease heterogeneity in the context of the missing heritability problem. these approaches can be grouped into two categories: (i) those with prior knowledge of subphenotypes and (ii) those that simultaneously infer both subphenotypes and associated markers . in the first case, the grouping information might come from prior medical knowledge, e.g. in t2d, the cases were stratified according to patients bmi using canonical bmi categories of obese versus non-obese. however, relying only on prior knowledge limits the space of accessible discoveries. moreover, it is also undesirable as subphenotypes often give rise to overlapping multivariate phenotype distributions, which cannot be studied with hard thresholdbased approaches. simultaneous identification of subgroups and group-specific markers removes the bias of potentially arbitrary thresholds while enabling the study of overlapping subphenotypes. the snpmix approach addresses this problem by modeling the population as a mixture of subphenotypes, with individual-to-subgroup assignment being unknown and trying to simultaneously identify marginally affecting markers and subgroup assignments. this is a promising first step but it focuses solely on marginal associations. joint models for partitioning genotype and phenotype simultaneously have been proposed in the expression quantitative trait loci (eqtl) framework. methods described in kim and xing (2009) andidentify modules of genes and corresponding variants. the partitioning in these models is in the gene space rather than in the patient space, thus these models are not directly applicable to our problem. a notable exception is, which proposes a bayesian partitioning method in the eqtl context that not only models marginal and epistatic effects of variants (explaining gene expression modules) but also encodes potential partitioning of the cohort. unfortunately, there are several key properties of this model that make it inapplicable to subphenotyping. for example, the variable corresponding to the partitioning of individuals is integrated out, i.e. it is not actually inferred. additionally, the groupings of individuals are independent between eqtl modules. thus, as is shown in the real case scenario in, each module has its own subgroup of individuals without any way to reconcile them. to summarize, zhang et al. (2010a) does not infer subphenotypes with respect to the disease but uses the idea of subgroups of individuals to identify more meaningful eqtl modules. the only way to coercemodel to ourin the case population is hidden or is not accounted for; can recover only shared causal markers (snp3) (b) subphenotyping approach to the same data recovers both shared (snp3) and subphenotype causal-specific markers (snp2, snp4 and snp5) setting would be to set the number of modules to 1. however, this would mean that there would have to be only one genotypic module that has to explain the full heterogeneity of the data, an assumption that is not supported by the current line of evidence on the genetics of subphenotypes . motivated by the fact that epistasis and phenotype heterogeneity represent two of the main challenges for the missing heritability problem and the fact that none of the existing methods address both issues simultaneously, we introduce the jbase model, which accounts for epistasis and subphenotyping while providing an easily interpretable probabilistic framework.where n mar kmj is the number of individuals in subpopulation k that has jth genotype for marker m. markers in the epistatic component are assumed to be generated by a single multinomial distribution. as each marker can have three states, this multinomial distribution can have e k 3 jg k 2 j states, i.e. interactions, whose frequencies are governed by the parameter / k / k1 ;. .. ; / e k . thus, we get:where n epi kj denotes the number of individuals in subpopulation k with the genotype combination j over the epistatic markers. note that, e k , and hence the dimensionality of / k vary depending on the state of s k (see supplementary material section s2.2 for details). the last genotype component to model is the null component. the parameters of the null component are shared across all components, i.e. a marker that is not related to the phenotype should have the same allelic distribution as other subpopulations in which it is assigned to the null component. let w m w m1 ; w m2 ; w m3 be the genotype frequencies of a marker m in the general population. then, we have:where n null mj is the number of the occurrence of state j for marker m across all individuals where it is classified as a null marker. the final component of the likelihood is the phenotype. in this work, we have focused on categorical phenotypes only. we model the phenotype likelihood as a multinomial distribution:parameterized with x k x k1 ;. .. ; x kt , where t is the number of all possible combinations of values of the different phenotypic variables, which is fixed based on cardinality of the multinomial distribution, and n phe kt is the number of individuals in subpopulation k with a phenotype value t. putting these together, we get the following form for likelihood pdjw; h; /; x; c; s:where we used g 0 to denote the collection of null components across all subphenotypes using conjugate dirichlet priors for w, h, / and x, as well as for the mixing coefficient parameter vectors p and a, allows us to integrate out all of the model parameters q fw; h; /; x; p; ag except latent variables c and s (see supplementary material section s2.1 for details). the final form of the posterior is presented in equation (6). as such, the posterior distribution depends only on the hyperparameters h fq; b; k; c; s; dg, which are given as input, and the latent variables c and s, which are inferred. we perform inference via sampling from the posterior using the metropolis hastings algorithm (see supplementary material sections s2.2 and s2.3 for details). it is also worth mentioning that jbase can control for linkage disequilibrium (ld), which can introduce false-positive epistatis, and for population stratification. for ld, jbase accepts an optional input file that lists the markers known to be in ld with associated lists of linked markers. jbase, via its proposal distribution on s km , ensures that linked marker pairs are never assigned to marginal and/or epistatic components simultaneously. in addition, one can also specify an optional genomic distance threshold such that markers closer than the given distance are not allowed to be simultaneously assigned to the marginal and/or epistatic component of a subpopulation. as for population stratification, jbase leverages the information obtained from the principal component analysis (pca) of individuals by ensuring that the subpopulation means of the most important pca dimension(s) do not significantly differ between subpopulations (see supplementary material section s2.2). this is achieved by rejecting proposals on variable c i if it causes the means between subphenotypes to diverge beyond a threshold. other biological constraints can easily be integrated into the proposal distribution of the metropolis hastings algorithm by eliminating the undesirable assignments from the state space of the posterior distribution.  
