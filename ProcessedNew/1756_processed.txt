gene expression fast and efficient qtl mapper for thousands of molecular phenotypes motivation: in order to discover quantitative trait loci, multi-dimensional genomic datasets combining dna-seq and chip-/rna-seq require methods that rapidly correlate tens of thousands of molecular phenotypes with millions of genetic variants while appropriately controlling for multiple testing. results: we have developed fastqtl, a method that implements a popular cis-qtl mapping strategy in a user-and cluster-friendly tool. fastqtl also proposes an efficient permutation procedure to control for multiple testing. the outcome of permutations is modeled using beta distributions trained from a few permutations and from which adjusted p-values can be estimated at any level of significance with little computational cost. the geuvadis & gtex pilot datasets can be now easily analyzed an order of magnitude faster than previous approaches. availability and implementation: source code, binaries and comprehensive documentation of fastqtl are freely available to download at http://fastqtl.sourceforge.net/genome-wide association studies have shown that most common trait-associated variants fall into non-coding genomic regions and likely alter gene regulation . this has motivated large-scale studies to catalog candidate regulatory variants (quantitative trait loci; qtls) associated with various molecular phenotypes (i.e. quantitative molecular traits with a genomic location) across various populations , cell and tissue types . mapping qtls in this context usually consists of finding statistically significant associations between phenotype quantifications and nearby genetic variants; task commonly undertaken using linear regressions . alternative approaches have also been developed to increase discovery power by accounting for confounding factors , integrating functional annotations , leveraging allelic imbalance (van de) or aggregating measurements across multiple tissues . in practice, this requires millions of association tests in order to scan all possible phenotype-variant pairs in cis (i.e. variants located within a specific window around a phenotype), resulting in millions of nominal p-values. matrix eqtl has recently emerged as a gold standard for this task by taking advantage of efficient matrix v c the author 2015. published by oxford university press.to perform a comprehensive evaluation of fastqtl, we used rnaseq and genotype data produced by both the geuvadis (; supplementary material 1) and the gtex consortia (; supplementary material 2), two of the largest eqtl studies performed to date. this comprises a total of 10 distinct datasets with between 14 and 35k quantified genes and 6.810.8m variant sites for 83373 samples (supplementary). in the context of this study, the two parameters of the beta distribution, k and n, can be interpreted as the rank of the associated variant and the effective number of independent tests performed in cis, respectively. we looked at the ml estimate distributions of these parameters across all genes in the geuv_eur dataset and find first that parameter k values tend to center around 1.0, in line with what is expected for the top variant . second, we find that the parameter n values show high dispersion and are consistently smaller than the actual number of variants being tested in cis ; both suggesting that the beta distribution captures well the redundancies between variants, a consequence of ld. this also highlights the importance of performing permutations instead of using a bonferroni correction based on the number of variants, which would result in a substantial proportion of false negative results. then, we checked whether the null p-values coming from permutations are beta distributed again in the geuv_eur dataset. to do so, we (1) stored for each phenotype the best p-values obtained from 1000 permutations as observations, (2) estimated k and n by ml from the 1000 resulting p-values, (3) simulated 1000 p-values from the newly parameterized beta distribution as expectations and (4) compared both observations and expectations to assess theirbonferroni significance threshold when testing 13 703 genes goodness-of-fit visually (qq-plots) and statistically (one sample kolmogorovsmirnov test). overall, we find very high degrees of concordance between results; both when pooling all genes together and also when looking at each gene individually . we only find that the beta distribution is not a good fit for two genes out of the 13 703 tested , these discrepancies are likely due to the stochastic nature of the simulations made in step (3). all this shows that the beta distribution is a good fit for the smallest null p-values generated via permutations and therefore a good candidate to model the permutation process outcome. we next checked that the adjusted p-values produced via beta approximation are well calibrated by comparing them to those directly derived from a large number of permutations. we find a very good concordance on the full p-value range with some deviations within the expected sampling variation range (, supplementary). of note, the beta approximation provides small adjusted p-values that are better calibrated than those provided by the direct method (, supplementaryand d) and sometimes not even accessible (i.e. below the lower bound implied by the number of permutations); the smallest adjusted p-value estimated using the geuv_eur dataset is in the order of $10 128 (supplementary). therefore, we subsequently estimated the number of permutations that the direct method needs to reach the same level of calibration as the beta approximation at various significance levels. to do so, we binned the adjusted p-values obtained from beta approximations and estimated for each bin, by exhaustive search, the number of permutations required by the direct method to match the same sampling variation (supplementary material 3). we find that this number drastically increases as small-adjusted p-values are targeted . for instance, beta approximations made from 1000 permutations give adjusted p-values of 10 4 as accurately as the direct approach with $50k permutations. then, we looked at the downstream impact of the beta approximation on qtl discovery. to do so, we first generated an optimal 5 fdr eqtl set for geuv_eur by running 100 000 permutations and then measured the sensitivity/specificity ratios of reasonable fastqtl configurations to recover this optimal set. specifically, we run from 50 to 5000 permutations using either the beta approximation or the direct method to compute adjusted p-values. we find that using 5005000 permutations allows us to approximate well the optimal set . we also find that the beta approximation does consistently better than the direct method for the same number of permutations, especially when few permutations are used (50 or 100). as a consequence, using 500 permutations with the beta approximation, for example, has the same accuracy to recover the optimal set as thefast and efficient qtl mapperdirect method using 1000 permutations. interestingly, the beta approximation using only 50/100 permutations already does very well at recovering the optimal eqtl set. finally, we investigated the speed and accuracy with which matrix eqtl (direct method) and fastqtl (beta approximation) using 100, 500 and 1000 permutations could reproduce the outcome of the pilot phase of gtex; a large-scale eqtl mapping study. of note, we run matrix eqtl in the most highly effective setting we could achieve in order to fully utilize its matrix based design (supplementary material 4). overall, we find that both fastqtl and matrix eqtl recapitulate the official eqtl set well, especially as the number of permutations increases . for the same number of permutations, we find that the closest eqtl set to the official one is consistently provided by fastqtl. again, it also performs well even when only 100 permutations are used to fit the beta distributions. to process all nine datasets with 1000 permutations, fastqtl requires $191 cpu hours which is $16 times faster than running the same number of permutations with matrix eqtl . when using only 100 permutations, this is reduced to only $33 cpu hours.we present fastqtl, a qtl mapper in cis for molecular phenotypes that implements a new permutation scheme to accurately and rapidly correct for multiple-testing at both the genotype and phenotype levels. fastqtl has several advantages compared with existing methods, making it the ideal candidate to map qtls for the coming wave of large-scale datasets regrouping many different layers of molecular phenotypes and near complete collection of variant sites. first, permutations are modeled with a beta distribution, parameterized from a relatively small number of permutations. this results in accurate adjusted p-values which could not be feasibly obtained by standard or adaptive permutation analysis; for example down to 10 128 in the geuvadis dataset. in practice, having well-calibrated adjusted p-values on the full range (0, 1) is of crucial importance to (1) estimate the number of tests made under the null (quantity underlying efficient fdr correction methods) and to (2) metaanalyze multiple qtl studies together. second, the beta approximation behaves well enough with only 100 permutations to rapidly assess the impact on the analysis of important parameters such as cis-window size and covariates like the number of peer factors . and finally, fastqtl is fast ($16 faster than matrix eqtl for the same number of permutations) due to an efficient implementation of linear regressions, optimized c code, efficient permutation schemes and rapid data retrieval from indexed files, while remaining user and cluster friendly. to summarize, fastqtl provides better adjusted p-values than the best method so far, matrix eqtl with a direct permutation scheme, while being significantly faster. in addition, fastqtl also provides a modular base onto which new functionalities are being implemented, such as fine mapping of causal variants, conditional analysis to discover multiple independent qtls per phenotype and interaction analysis to discover sex or disease specific qtls.  
