genetics and population analysis cpgfilter: model-based cpg probe filtering with replicates for epigenome-wide association studies the development of the infinium humanmethylation450 beadchip enables epigenome-wide association studies at a reduced cost. one observation of the 450k data is that many cpg sites the beadchip interrogates have very large measurement errors. including these noisy cpgs will decrease the statistical power of detecting relevant associations due to multiple testing correction. we propose to use intra-class correlation coefficient (icc), which characterizes the relative contribution of the biological variability to the total variability, to filter cpgs when technical repli-cates are available. we estimate the icc based on a linear mixed effects model by pooling all the samples instead of using the technical replicates only. an ultra-fast algorithm has been developed to address the computational complexity and cpg filtering can be completed in minutes on a desktop computer for a 450k data set of over 1000 samples. our method is very flexible and can accommodate any replicate design. simulations and a real data application demonstrate that our whole-sample icc method performs better than replicate-sample icc or variance-based method. availability and implementation: cpgfilter is implemented in r and publicly available under cran via the r package cpgfilter.recent advances in genomic technologies have enabled researchers to conduct large-scale studies of human disease-associated epigenetic variation, specifically variation in dna methylation. such epigenome-wide association studies (ewas) have helped elucidate the non-genetic determinants of human disease . the illumina infinium humanmethylation450 beadchip, which interrogates the methylation level of more than 450k cpg sites throughout the human genome, has been increasingly popular in large-scale ewas due to its good genome coverage, high reproducibility and lower cost (sandoval). one observation of the 450k data is that many cpgs have relatively larger technical variability compared with their biological variability, which are results of either large absolute technical variability (the methylation level cannot be measured accurately) or lower biological variability (many cpgs are constitutively methylated or unmethylated). these cpgs are less informative and including these cpgs will reduce the statistical power to discover relevant cpg sites by unnecessarily increasing the number of statistical tests. hence, cpg filtering could potentially boost statistical power for underpowered studies. traditional variance-based cpg filter is based on the total variability, which is the sum of the biological variability (signal) and technical variability (noise). however, we are more interested in retaining cpgs with relatively large biological variability instead of total variability. as with any hybridization-based array technology, cpg probes differ in their technical variability, possibly due to inexact probe sequence match, crosshybridization and local secondary structures . therefore, large total variability does not necessarily reflect large biological variability. without technical replicates, the assessment of technical variability is difficult and we can only rely on the total variability to filter cpgs. fortunately, most ewas have included some technical replicates to assess various sources of batch effects. we can therefore use these replicates to assess technical variability. we propose to use intra-class correlation coefficient (icc), which is defined as the ratio of biological variability to total variability, to filter cpg probes the method using technical replicates only, our method can result in more efficient icc estimate since the unreplicated samples provide significant amount of information about the biological variability. our method can accommodate any type of replicate design including unbalanced design. we have implemented an ultra-fast algorithm to fit lmm in linear computational time and the algorithm is highly scalable.we compare our whole-sample icc method to the replicate-sample icc method byas well as the total variance-based method using simulations. we simulate 1000 cpgs and 1000 independent samples, among which 10 samples are replicated twice. let r n $ uniform0:5; 8:0 and r $ uniform0:25; 2:0. we then simulate the methylation m-values based on the model (1) and rank these cpgs based on icc or variance after applying the three alternatives. we calculate the spearman correlation between the resulted ranking and the ranking based on the simulated true qs, which is assumed to be the best. simulations are repeated 100 times.shows our whole-sample icc method produces invariably better ranking than the other two methods (median correlation 0.80 vs. 0.70 and 0.58). we next study the effects of icc-based cpg filtering on the type i error and power of association tests using realistic simulations (supplementary note s2). cpgs with small iccs will have no or little chance of showing significance, and removing these cpgs will enrich signals against a background of noise. as expected, using bonferroni correction and false discovery rate control for multiple comparison correction, the proposed method has achieved better power than the replicate-sample icc method, while controlling the type i error at the desired level. simulation also suggests at least six technical replicate pairs to achieve good results. we apply our method to a cleaned 450k dataset of 482 985 methylation sites from buffy coat leukocytes of 559 males and 10 technical replicate pairs from the normative aging study . we conduct an epigenome-wide cross-sectional analysis of age (median 72, range 55100 years) based on a linear model, adjusting for subject characteristics, estimated cell type proportions and technical covariates. strict bonferroni correction isused to select significant cpg sites. clearly, these sites are dramatically enriched in large icc values . we see that 96.7 of the sites associated with age come from those with an icc greater than the median (0.55). we also see 138 562 sites with an estimated icc of zero, indicating much larger technical variability (measurement error) compared with their biological variability. in comparison with the icc method, if we had only used the sites with total variance above the median, we would have captured only 93 of the sites associated with age in the full analysis (supplementary). in general, an icc cutoff of around 0.5 provides a good tradeoff between loss of potential significant cpg sites due to filtering and gain of power due to reduction of multiple testing burden (supplementary).  
