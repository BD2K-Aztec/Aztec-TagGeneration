protein threading using context-specific alignment potential motivation: template-based modeling, including homology modeling and protein threading, is the most reliable method for protein 3d structure prediction. however, alignment errors and template selection are still the main bottleneck for current template-base modeling methods, especially when proteins under consideration are distantly related. results: we present a novel context-specific alignment potential for protein threading, including alignment and template selection. our alignment potential measures the log-odds ratio of one alignment being generated from two related proteins to being generated from two unrelated proteins, by integrating both local and global context-specific information. the local alignment potential quantifies how well one sequence residue can be aligned to one template residue based on context-specific information of the residues. the global alignment potential quantifies how well two sequence residues can be placed into two template positions at a given distance, again based on context specific information. by accounting for correlation among a variety of protein features and making use of context-specific information, our alignment potential is much more sensitive than the widely used context-independent or profile-based scoring function. experimental results confirm that our method generates significantly better alignments and threading results than the best profile-based methods on several large benchmarks. our method works particularly well for distantly related proteins or proteins with sparse sequence profiles because of the effective integration of context-specific, structure and global information.protein structure is essential for the understanding of protein functions. predicting the 3d structure of a protein from its sequence remains one of the grand challenges confronting computational biologists. template-based modeling (tbm), such as homology modeling and protein threading, is the most reliable method and can produce reasonable 3d models for about twothird of the proteins without solved structures. tbm is based on the observation that protein structures are much more conserved than sequences. that is, given a target protein sequence, we can predict its 3d structure by aligning it to structurally similar protein structures in pdb. the model quality of tbm depends on sequence-template alignment and template selection, both of which are challenging when only distantly related templates are available for a protein sequence under prediction. the threading accuracy critically depends on the choice of a threading scoring function . most of current methods make heavy use of position-specific information, such as sequence profile, which is usually represented as a positionspecific scoring matrix or a profile hmm . although sequence profile is effective on homolog detection, it is only position specific, but not context specific. further, it is also lack of structure information (e.g. secondary structure and solvent accessibility). context-specific information refers to the information in the sequential neighborhood of one residue. the neighboring residues of a given residue play an important role in shaping the mutation pattern of the residue. few alignment methods, such as cs-blast (biegert and sodingsoding, 2009) are developed to make use of context-specific information. even cs-blast makes use of only sequence, but not context-specific structure information. to the best of our knowledge, no protein threading method has integrated well both context-specific sequence and structure information. although many protein alignment methods use only local information, a few protein threading methods were developed to use global information, such as pairwise contact potential, which quantifies how well two sequence residues can be placed into two template positions in a contact. however, the gain from pairwise contact potential is not significant as compared with the impact of sequence profile on protein alignments. the underlying reason may be that the contact-based pairwise potentials used in these threading methods do not carry too much extra signal. to significantly improve the effectiveness of global information especially pairwise potential in protein threading, this article studies a context-specific distance-based pairwise potential. our pairwise potential is built on context-specific information and much more sensitive than the context-independent contact-based pairwise potentials and, thus, greatly helps improve protein threading. this article presents a novel context-specific alignment potential for protein threading, including both alignment and template selection. our alignment potential measures the log-odds ratio of one alignment being generated from two related proteins to being generated from two unrelated proteins, by integrating context-specific local and global information. an alignment is assumed to be optimal if it maximizes the alignment potential. the local alignment potential quantifies how well one sequence residue can be aligned to one template residue based on contextspecific information of these two residues. the global alignment potential quantifies how well two sequence residues can be placed into two template positions at a given distance, again based on residue context-specific information. in this article, the context of one residue includes a variety of correlated protein features, such as sequence (profile) information, (predicted) secondary structure and solvent accessibility, amino acid physic-chemical properties in a local window centered at the residue. we integrate these correlated protein features into an accurate alignment potential using advanced statistical learning methods, including conditional neural fields to whom correspondence should be addressed. the author 2013. published by oxford university press. this is an open access article distributed under the terms of the creative commons attribution non-commercial license (http://creativecommons.org/licenses/ by-nc/3.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. for commercial re-use, please contact journals.permissions@oup.com . experimental results show that our contextspecific alignment potential is much more sensitive than the widely used context-independent or profile-based (which is position specific) scoring function, generating significantly better alignments and threading results than the best profile-based methods on several large benchmarks. our method works particularly well for distantly related proteins or proteins with sparse sequence profiles because of the effective integration of contextspecific, structure and global information.training and validation data: we constructed the training and validation data from bc40, a subset of pdb, in which any two proteins share 540 sequence identity. in total, we use a set of 1800 protein pairs as the training data, which covers most of the folds in the scop database, and a set of 500 protein pairs as the validation data. there is no redundancy between the training and validation data (i.e. 540 sequence identity). the training and validation data have the following properties: (i) all the proteins have lengths 5400 and contain 510 of residues with missing coordinates; (ii) the tm-score of a protein pair is uniformly distributed from 0.55 to 1; and (iii) we use our in-house structure alignment tool deepalign to generate the reference alignment for a protein pair. each alignment has fewer than 50 middle gaps, and the number of terminal gaps is 520 of the alignment length. test data for alignment: we use the following three datasets to test the alignment accuracy of our method.(1) set6k: a set of $6000 protein pairs. any two target proteins in this set share 540 sequence identity. the tmscore of a protein pair is uniformly distributed between 0.55 and 0.8. two proteins in a pair have small length difference. the protein pairs in set6k have 5 of overlap with our training and validation data. by overlap we mean that the proteins in one pair have sequence identity 3050 with those in another pair.(2) set4k: a set of 4547 protein pairs. any two target proteins in the set share525 sequence identity. the protein pairs in set4k have 3 of overlap with our training and validation data. two proteins in a pair have length difference 430; therefore, this set can be used to test whether the domain boundary is correctly aligned.(3) set180k: a very large set of 179 390 protein pairs. any two proteins in most pairs share 540 sequence identity. the tm-score of a protein pair is uniformly distributed between 0 and 1. note that the size of our training set is only 1 of this large set; therefore, the test result on this set is unlikely biased by the training set.test data for threading: we use the following two datasets to test the threading accuracy of our method.(1) set 1000 6000: a large set constructed from pdb25, which consists of $6000 proteins. all the proteins in pdb25 are used as templates, and 1000 of them are randomly chosen as the target proteins. we predict the 3d structure for all the 1000 targets using the $6000 templates, but excluding self-threading.(2) casp10: a set of 123 test proteins. we use the casp official domain boundary definition for each test protein.evaluation criteria and programs to compare: we evaluate our threading method using both reference-dependent and referenceindependent alignment accuracy. the reference-dependent accuracy is defined as the percentage of correctly aligned positions judged by the reference alignments, which are built using our in-house tool deepalign . we also built the reference alignments using other structure alignment tools, such as dali, matt and tmalign and observed similar performance trend. to evaluate the reference-independent alignment accuracy, we build a 3d model for the target protein using modeller (s ali et al., 2004) from its alignment to the template and then evaluate the quality of the resultant 3d model using tm-score. tm-score ranges from 0 to 1, indicating the worst and best model quality, respectively. as our ultimate goal is to predict 3d structure for a target protein, referenceindependent alignment accuracy is more important than reference-dependent accuracy. we compare our method with the top-notch profile-based method hhalign, which is run with the option -mact 0.1. as shown in, our method outperforms hhalign in terms of both reference-dependent and reference-independent alignment accuracy on the two benchmarks set6k and set4k. on these two sets, our method outperforms hhalign by 13.6 and 9, respectively, in terms of the model quality (i.e. referenceindependent accuracy). in terms of reference-dependent accuracy, our method is better than hhalign by only 8.8 and 5.2, which is not as big as reference-independent accuracy. we also calculate the reference-dependent accuracy on set6k and set4k by allowing four-position off the exact match, as shown in, which indicates that our method is still much better than hhalign when four-position off the exact match is allowed. as shown in, on the very large set180k set, our method yields slightly better performance than hhalign when two proteins under consideration are similar. this is not surprising, as most methods can generate pretty good alignments for two closely related proteins. when the tm-score of two proteins under consideration falls into, our method outperforms hhalign by $3.3 in terms of the reference-dependent accuracy and by $7.6 in terms of the reference-independent accuracy. when the tm-score of two proteins under consideration falls into, our method outperforms hhalign by $9.4 in terms of the reference-dependent accuracy and by $11.3 in terms of the reference-independent accuracy. when the tm-score of two proteins falls into, our method outperforms hhalign by a very large margin in terms of reference-dependent alignment accuracy. however, in terms of the reference-independent alignment accuracy, the advantage of our method is not as big, although it is still substantial. this may be because that modeller cannot build a reasonable model from an alignment with too many errors. by the way, when the tm-score of two proteins is 50.4, it may not be so important to generate an accurate alignment for them, as the resultant 3d model has low quality and, thus, will not be useful. threading performance on a large test set: we test the threading performance of our method and hhpred on set 1000 6000. we run both our method and hhpred to predict the 3d structure for each of the 1000 targets using the $6000 templates. hhpred is run with its realign option. that is, hhpred first searches through the template database using local alignment and then re-aligns a target to the top templates using global alignment. by doing so, hhpred can improve its modeling accuracy a little bit over the default mode. to speed-up, our method first aligns a target to all the templates using only the local alignment potential and then ranks all the templates using both the local and global alignment potentials described insection 2. after ranking, only the first-ranked templates are used to build a 3d model by modeller for each target. as shown in, our method is significantly better than hhpred when the targets are not so easy (i.e. the hhpred model has tm-score 50.7). on the 1000 targets, our method and hhpred obtain average tm-score 0.566 and 0.517, respectively. our method outperforms hhpred no matter whether the target is easy or hard. if we exclude the 170 easy targets (i.e. either our model or hhpred model has tm-score 40.8) from consideration, the accumulative tm-score obtained by our method and hhpred is 0.524 and 0.451, respectively. that is, our method is $16.1 better than hhpred. further, as indicated by the yellow lines in, our method can generate models with tm-score 40.5 for many targets for which hhpred fails to generate a model with tm-score 40.5. we use tm-score 0.5 as a cutoff because when a model has tm-score 40.5, its overall fold is basically correct. as shown in, our method generates models better than hhpred by at least 0.05 for 342 targets, whereas hhpred is better than our method by this margin for only 93 targets. further, the number of targets for which our method generates models better than hhpred by at least 0.10 is 197, whereas hhpred is better than our method by this margin for only 49 targets. in summary, our method has a large advantage over hhpred on hard targets. threading performance on casp10 data set: we further evaluate the threading performance of our method on the most recent casp10 targets. we use the casp official domain boundary definition for each target, and in total there are 123 test proteins. to make the test as fair as possible, both our method and hhpred used the same set of templates and the same protein sequence database (i.e. nr), which were constructed before casp10 started. as shown in, similar to what we have observed on the large threading test set, our method significantly outperforms hhpred when the targets are not so easy. our method generates a model with tm-score40.5 for a few targets for which hhpred fails to generate a model with tm-score 40.5. on the whole testnote: reference-independent alignment accuracy is measured by tm-score. the protein pairs are divided into four groups depending on their structure similarity measured by tm-score.we exclude the server targets from consideration and only look at the more challenging human/server targets. the average tm-score obtained by our method and hhpred is 0.63 and 0.57, respectively. that is, our method is $10.5 better than hhpred. it is challenging to fairly compare our single-template threading method with the casp10-participarting servers because that most of the casp10 servers used a hybrid method instead of an individual threading method. for example, the first-ranked zhang-server integrated both consensus analysis of $10 individual threading programs and fragment-based 3d model building technique. the top-ranked hhpred server integrated new profile generation method, multi-template alignment and a better 3d model building technique. the top-ranked robetta server used consensus results from three programs, including hhpred, raptorx and sparks and also a new 3d model building method. our raptorx server, which is ranked no. 2 overall, used multiple-template threading, which can generate better 3d models than single-template threading for many targets especially the easy ones. in summary, the accumulative tm-score obtained by our single-template threading method described in this article is only 0.85 less than what was obtained by raptorx in casp10. it can be ranked no. 6 among all the casp10participating servers. p-value: it is desirable that any structure prediction program can assign a confidence score to predicted models. here, we use p-value to quantify the relative quality of the top-ranked templates and alignments. to calculate the p-value, we use a set of reference templates, which consist of $1800 single-domain templates with different scop folds. given a target, we first thread it to this reference template database and then estimate an extreme value distribution from the $1800 alignment scores (i.e. alignment potentials). based on this distribution, we calculate the p-value of each alignment when threading the target to the real template database. the p-value actually measures the quality of the template (and the alignment) by comparing it with the reference templates. to measure the real model quality, we use both gdt (global distance test) and ugdt (i.e. un-normalized gdt). gdt has been used as an official measure by casp for many years. it measures the quality of a model by comparing it with the native and outputs a value from 0 to 100, indicating the worst and the best quality, respectively. ugdt is equal to gdt times the target length divided by 100. ugdt is more suitable when a large or multi-domain target protein can only be partially covered by good templates. in this case, gdt is likely to be small and not a good indicator even if the templates are closely related to the target, as gdt is normalized by the whole target length. however, ugdt is not good for a target with length smaller than 100. for example, when a target of 60 residues is covered by a template perfectly on 48 of the 60 residues, the ugdt of this alignment is 48, whereas the gdt is 80. in this case, gdt is more suitable than ugdt. in summary, we use max(ugdt,gdt) to measure the model quality. we say one alignment is reasonable when its resultant model has ugdt or gdt 450. we use 50 as a cut-off because that many proteins similar at only the fold level have gdt or ugdt $50. as shown in, the p-value is a reliable indicator of model quality. when p-value is small (i.e. 510 5 ), the models have ugdt or gdt ! 50. even if p-value is 510 4 , there are few models that have both ugdt and gdt550. that is, the prediction from our threading method is reliable when the p-value is 510 4. contribution of the distance-based pairwise potential: to evaluate the contribution of our pairwise potential to alignment accuracy, we calculate the accuracy improvement resulting from adding our pairwise potential to the alignment potential using two benchmarks set6k and set4k. as shown in, our pairwise potential can improve reference-dependent accuracy by 3 and reference-independent accuracy by 0.01, respectively. we have not fully exploited the power of our pairwise alignment potential because it is computationally expensive. we just used our pairwise potential to refine the alignment generated by local alignment potential as follows. for each aligned position generated by our local potential, we allow it to move at most four positions to improve the total potential (i.e. local potential pairwise potential). we expect that a more efficient pairwise potential optimization algorithm that can search a larger alignment space will further improve the alignment accuracy. we also evaluate the contribution of our pairwise potential to template selection. to speed-up, we generate alignments using our local alignment potential, and then rank all the templates using a linear combination of our local and pairwise alignment potentials (with equal weight). experimental results on the 1000 6000 threading set and the casp10 set indicate that the pairwise potential indeed improves template selection, as shown in figures 6 and 7. on the 1000 6000 set, the average tm-score increases from 0.547 to 0.566 when the pairwise potential is used to rank the templates. on the casp10 set, the accumulative tmscore increases from 75.58 to 77.52 when the pairwise potential is used. as shown inand 7, the context-specific pairwise potential is particularly helpful to hard targets. case study: here, we use two specific examples to further demonstrate the strength of our method. both of these two cases are from our set6k benchmark. the first example is to align two proteins 3qnra and 2gffa, which have tmscore between 0.62 and 0.65 according to the structural alignments generated by tm-align , matt , dali and our in-house tooldeepalign . that is, these two proteins are similar in structures but not much in sequences. meanwhile, 2gffa contains two and two segments that are similar to one domain in 3qnra. as shown in, our method can correctly align 490 of the positions judged by the reference alignment (regardless of which structural alignment tools are used to generate it). in contrast, hhalign fails to align the second and segments. this is partially because hhalign favors generating short alignment. if we choose 3qnra as the template to build a 3d model for 2gffa, the resultant models from our method and hhalign have tm-score 0.63 and 0.25, respectively. we use another two proteins 3k53a and 1cb7a to showcase that our method and hhalign generate two alignments of nearly the same length, but our alignment has much better quality. as shown in, our method aligns nearly 80 of positions correctly, whereas hhalign fails to align any position correctly. if we use 3k53a as the template to build models for 1cb7a, the resultant 3d models from our method and hhalign have tmscore 0.64 and 0.22, respectively. we can also examine the alignments visually. as shown inand b, our method aligns the local structure well, whereas hhalign seemingly produces a totally wrong alignment. in this case, both 3k53a and 1cb7a have pretty good sequence profile information, and the predicted secondary structure for 1cb7a is also accurate (480).this article has presented a novel protein threading method using a context-specific alignment potential, which measures the. two alignments between 3qnra and 2gffa generated by our method and hhalign. the blue and red colors demonstrate correctly aligned regions judged by the reference alignment. to save space, only one of the domains of 3qnra is shownof the distance-based pairwise alignment potential to set 1000 6000. each point represents the quality, measured by tmscore, of two models: one is generated using the local alignment potential only (x-axis), and the other using both the local and global alignment potentials (y-axis). contribution of the distance-based pairwise alignment potential to the casp10 set. each point represents the quality, measured by tmscore, of two models: one is generated using the local alignment potential only (x-axis), and the other using both the local and global alignment potentials (y-axis). the relationship between p-value and the model quality on the 123 casp10 targets. the x-axis is the model quality measured by max(gdt, ugdt) and the y-axis is log (p-value)note: reference-independent alignment accuracy is measured by tm-score.  
