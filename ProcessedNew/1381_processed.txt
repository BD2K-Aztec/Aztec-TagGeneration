differential methylation analysis for bs-seq data under general experimental design motivation: dna methylation is an epigenetic modification with important roles in many biological processes and diseases. bisulfite sequencing (bs-seq) has emerged recently as the technology of choice to profile dna methylation because of its accuracy, genome coverage and higher resolution. current statistical methods to identify differential methylation mainly focus on comparing two treatment groups. with an increasing number of experiments performed under a general and multiple-factor design, particularly in reduced representation bisulfite sequencing, there is a need to develop more flexible, powerful and computationally efficient methods. results: we present a novel statistical model to detect differentially methylated loci from bs-seq data under general experimental design, based on a beta-binomial regression model with arcsine link function. parameter estimation is based on transformed data with generalized least square approach without relying on iterative algorithm. simulation and real data analyses demonstrate that our method is accurate, powerful, robust and computationally efficient.dna methylation is a covalent epigenetic modification of cytosine that plays a critical role in gene regulatory mechanism. it has been well characterized to involve in many biological processes such as cell differentiation, development and aging. it often shows abnormality in many diseases such as cancer . methylated cytosines within promoter regions have been shown to repress gene expression by interfering with dna-binding proteins that promote transcriptions , subsequently leading to phenotypic changes. studying the dynamics of dna methylation and their influence has broadened and enhanced our knowledge on many biological mechanisms and disease etiologies, in additional to the genetic components discovered from studying dna sequences alone. technologies for quantifying dna methylation have evolved rapidly in recent years. sodium bisulfite treatment of dna following next-generation sequencing (bs-seq) is a new technology that measures the methylation levels at single-nucleotide resolution. compared to earlier high-throughput technologies such as methylation microarray or capture-based sequencing like medip-seq , bs-seq has improved accuracy, reduced background bias and higher spatial resolution. thus it has quickly become the technology of choice to study dna methylation. one of the most important questions in dna methylation analysis is to identify genomic loci or regions with different methylation levels among distinct biological conditions. differentially methylated loci (dml) or regions (dmrs) can be functionally associated with biological processes such as protein bindings and gene expressions to contribute to phenotypic changes. the dml/dmrs could potentially be used as biomarkers for early stage disease diagnosis, v c the author 2016. published by oxford university press. all rights reserved. for permissions, please e-mail: journals.permissions@oup.com and identifying progression and subtypes of certain disease. dml/ dmrs can also provide information for targeted therapies in precision medicine. developing methods for dml/dmr detection has been and still remains an active epigenomics research topic. over the last several years, a number of statistical methods and software tools have been developed for identifying dml/dmrs from bs-seq data . a comprehensive review of the existing methods is provided by. most of available methods are specifically designed for comparing dna methylation levels from two treatment groups, partially because most of the existing bs-seq data are generated for two-group comparison due to high cost of the experiment. with rapid advances of sequencing technology and continuous reduction of sequencing cost, an increasing number of experiments are now performed under general, multi-factor design, especially from the reduced representation bisulfite sequencing (rrbs) technology and enhanced rrbs . we expect this trend will continue and data with multiple factors/ groups and covariates will be common in foreseeable future, even from large-scale population level studies. flexible and efficient methods are in great demand to comprehensively decipher biological processes in current epigenomics research. the data from bs-seq can be summarized as numbers of methylated and total reads at each cpg site. the methylated read counts are often modeled by a beta-binomial distribution, which accounts for both the biological and sampling variations . a straightforward method to call dml under general design is using a beta-binomial generalized linear model (glm) at each cpg site. there are currently two methods available for bs-seq under general design: radmeth and biseq . radmeth directly applies beta-binomial glm with logit link function. biseq first performs a local smoothing within each sample, and then uses a beta regression with probit link on the smoothed methylation levels. the hierarchical testing procedure used in biseq primarily focuses on identifying dmrs. another software methylkit does not explicitly provide any function for multi-factor dml calling. but it internally uses a binomial glm function for replicated data, which can also be used for general experimental design. all these methods are based on glm with or without over-dispersion adjustment. some drawbacks exist using such approach. first it is computationally intensive because model fitting is based on iterative procedure to maximize the likelihood. given the size of a typical bs-seq dataset (millions of cpg sites), such a procedure is very computationally demanding. this is evidenced by the poor computational performance from both radmeth and biseq. second, the glm procedure is numerically unstable when separation or quasi-separation happens in one or more covariates, which frequently occurs in many cpg sites, particularly when methylation levels are close to the boundaries (0 or 1). such limitations sometimes lead to undesirable results from existing methods. in this paper, we propose a novel statistical method to detect dml for bs-seq data under general experimental design. at each cpg site, the count data are modeled by a beta-binomial regression with arcsine link function. model fitting is based on the transformed methylation levels by applying generalized least square (gls) procedure, which provides estimates for regression coefficients and their covariance. hypothesis testing is achieved using a wald test at each cpg site, and the significance levels can be used for dml calling. we perform extensive simulation studies and real data analyses to show the advantages of our proposed method over existing ones. the method, termed dss-general, is now implemented as a part of the bioconductor r package dss.considering the large number of tests required, developing statistical method to analyze bs-seq data with multiple factors or covariates is challenging due to complicated model settings and computationally demanding parameter estimation procedure. beta-binomial model is commonly used for count data from bs-seq experiment due to the possibility of considering both biological and sampling variations. even though beta-binomial glm is a straightforward solution, computationally inefficient and numerically unstable estimation procedures are major obstacles for bs-seq data analysis in practice. we developed a novel statistical method, termed dss-general, to detect dml from bs-seq data under general experimental design. the method is based on transformation and approximation, which significantly improves computational efficiency. dss-general characterizes the count data using a beta-binomial regression with an arcsine link function. the regression coefficients are estimated from transformed methylation levels using gls, where the covariance matrices are determined by sequencing depth and biological variances. the estimator of covariance matrix for the parameter estimations is carefully derived. a wald test procedure is then applied for hypothesis testing to identify dml. similar approaches that operate on transformed data have been developed for other sequencing data such as rna-seq and chip-seq , and provide good performances. an important distinction of dss-general is the use of arcsine link function instead of the more frequently used logit or probit. this is mainly due to the statistical convenience because the stabilization of the variances after transformation makes the least square procedure possible. as shown from comparisons of computational performance with existing methods, dss-general is 40 and 166 times more efficient than radmeth and biseq respectively. along with compatible or better accuracy and statistical property, dssgeneral is a more desirable tool for the analyses of bs-seq data under general experimental design. although radmeth also provides similarly good results and computationally more efficient than biseq, unlike dss-general and biseq, users cannot apply continuous covariates or factors with more than two values. compared with logit link, a disadvantage of the arcsine link is that the coefficient is more difficult to interpret. however, since the main goal of dml detection is to detect and rank cpg sites and the detection/rankings are often based on quantities such as test statistics, p-values or fdr, the magnitudes of the coefficients are often not of interest. thus the interpretability of regression coefficients will not be a major limitation of the method. the algorithm of dss-general contains a step for dispersion estimation. we evaluated the performance of dispersion estimation on dml detection accuracy. we compared the results from dssgeneral when using the estimated dispersions versus using the true dispersions. supplementaryshows the tdr curves from the comparison. as expected, using true dispersions gives slightly better tdrs, particularly when sample sizes are small. however, the difference becomes very small when sample sizes increase to 10 replicates per group, indicating good performance of the proposed dispersion estimation procedure. it is also important to note that some dispersion estimation methods from other sequencing data are based on empirical bayes (eb) procedure, which borrows information across all genes or cpg sites and achieves a shrinkage effect . under our setting, the eb-type of shrinkage method cannot be easily adopted because of the complicated relationship between the dispersion and data distribution, i.e. it is difficult to express the data likelihood as a function of the dispersion. furthermore, the shrinkage is often based on maximizing an objective function such as penalized likelihood. the computational efficiency becomes a major issue without closed form of shrinkage estimator. in dss-general, the bounded estimation of dispersions can be considered as a type of shrinkage that imposes some biological variance and stabilizes the results. although the results shown in this paper are based on cpg methylation, our method can also be applied to cph methylation from whole-genome bs-seq. in addition, other types of base resolution methylation sequencing data such as 5-hydroxymethylcytosine (5hmc), 5-formylcytosine (5fc) and 5-carboxylcytosine (5cac) can also be compared using dss-general. though there is no such dataset under general experimental design so far, they could become popular with the continuous advances of technologies. dss-general is specifically developed to test differential methylation at single cpg site level. it has been reported that the methylation levels are spatially correlated across the genome , and smoothing-based methods were developed to account for the correlation . although we considered spatial correlation when generating data in simulation study, we did not develop method to take into account this information to improve dml calling. this is partly because that all currently available data with general design are from rrbs, where the cpg coverage is sparse and spatial correlation is more difficult to be modeled. nonetheless, incorporating the spatial information into our method will be a research topic in the near future. furthermore, dss-general is designed for data under linear model with fixed effects. the method cannot be directly applied to analyzing data from more complexed designs such as paired or clustered, which has to be modeled by a mixed effects model. developing method for analyzing such data is also in our short term plan.  
