gene expression matrix eqtl: ultra fast eqtl analysis via large matrix operations motivation: expression quantitative trait loci (eqtl) analysis links variations in gene expression levels to genotypes. for modern datasets, eqtl analysis is a computationally intensive task as it involves testing for association of billions of transcript-snp (single-nucleotide polymorphism) pair. the heavy computational burden makes eqtl analysis less popular and sometimes forces analysts to restrict their attention to just a small subset of transcript-snp pairs. as more transcripts and snps get interrogated over a growing number of samples, the demand for faster tools for eqtl analysis grows stronger. results: we have developed a new software for computationally efficient eqtl analysis called matrix eqtl. in tests on large datasets, it was 23 orders of magnitude faster than existing popular tools for qtl/eqtl analysis, while finding the same eqtls. the fast performance is achieved by special preprocessing and expressing the most computationally intensive part of the algorithm in terms of large matrix operations. matrix eqtl supports additive linear and anova models with covariates, including models with correlated and heteroskedastic errors. the issue of multiple testing is addressed by calculating false discovery rate; this can be done separately for cis-and trans-eqtls.the goal of expression quantitative trait loci (eqtl) analysis is to identify single-nucleotide polymorphisms (snps) which are significantly associated with expression of known genes. these associations can help reveal biochemical processes underlying living systems, discover the genetic factors causing certain diseases and determine pathways that are affected by them. expression qtl analysis is used to determine hotspots [dna regions affecting multiple transcripts,, construct causal networks, discover subclasses of clinical phenotypes, and select genes for clinical trials (see reviews of). there are various approaches to eqtl analysis. most eqtl studies perform separate testing for each transcript-snp pair. the association between expression and genotype can be tested for using linear regression and anova models, as well as nonlinear techniques including generalized linear and mixed models, bayessian regression , and models accounting for pedigree and latent variables . several methods has been developed to find groups of snps associated with expression of a single gene . expression qtl analysis is known to be computationally intensive. the issue is most pronounced for modern eqtl datasets, which have genotype measured over millions of snps and gene expression over tens of thousands of transcripts. for such data, the eqtl analysis involves over ten billion tests. the following three studies, analyzing relatively small datasets, indicate that non-linear methods can be prohibitively slow for large data.applied family-based association tests to a dataset with 142 samples. they tested only 40 227 transcript-snp pairs and report the total computation time to be under 24 h on 20 processors in parallel on a linux cluster.were running efficient mixed-model association (emma), which is said to be computationally efficient. they analyzed a dataset with 110 samples, 1813 snps, and 10 013 transcripts. they tested all transcript-snp pairs and report the computation time of a few hours using a cluster of 50 processors.tested their method on a dataset measuring 40 639 transcripts and 48 186 snps in 188 samples. they report that estimation took 10 h when parallelized across 1100 processors (this is more than a processor-year). note that the dimensions of a modern eqtl dataset can greatly exceed those in the examples above. in this article, we present a new tool, matrix eqtl, for fast eqtl analysis of large datasets. our tests show that matrix eqtl is 23 orders of magnitude faster than existing popular qtl/eqtl software. moreover, the computation time of matrix eqtl stays practically unchanged when covariates are added to the model. such performance is achieved, in particular, by expressing the most computationally intensive part of the algorithm in terms of large matrix operations. this allowed to implement the algorithm using high-level programming languages, r and matlab, relying on their efficient implementation of matrix operations. matrix eqtl tests for association between each snp and each transcript by modeling the effect of genotype as either additive linear (least squares model) or categorical (anova model). optionally, matrix eqtl can test for the significance of genotype-covariate interaction. matrix eqtl does not require genotypes to be discrete unless anova model is chosen. the models can include covariates to account for such factors as gender, clinical variables, population structure and surrogate variables. matrix eqtl also supports heteroscedastic and correlated errors to account for relatedness of the samples. matrix eqtl performs a separate test for each genesnp pair and corrects for multiple comparisons by calculating false discovery rate (fdr,). it is known that the snps located near a gene are more likely to affect its expression. to account for this fact, matrix eqtl supports separatewe measured the performance of matrix eqtl and six programs for qtl and eqtl analysis: plink , merlin , r/qtl , snpmatrix , emap and fastmap . plink is a command line toolset for whole genome association analysis. it is a general purpose tool written in c/c++ not particularly optimized for eqtl analysis. merlin is a command line tool for fast pedigree analysis written in c/c++. it is designed for analysis in pedigree, but has an option for analysis of unrelated samples. r/qtl, snpmatrix and emap are r packages for qtl/eqtl analysis. part of emap is coded in c and requires gsl library (gnu scientific library). fastmap is a fast association mapping tool written in java. it uses the discrete nature of genotype data to speed up calculations. fastmap is optimized for permutation-based testing. among selected tools, only fastmap and emap do not handle covariates. note that fastmap is the only tool out of seven that has a graphical user interface. all methods except r/qtl were set to use the simple linear model to test for association between levels of gene expression and frequencies of the minor allele of the genotype. r/qtl does not support the simple linear model and was set to estimate the anova model (haleyknott method). we estimated the time that matrix eqtl and other eqtl tools require to analyze a typical modern eqtl dataset. as the model dataset we chose cystic fibrosis (cf) dataset from. the dataset contains genotype information for 573 337 snps and the gene expression measurements for 22 011 transcripts for 840 patients. we applied eqtl methods to a randomly generated dataset containing 2201 genes and 57 333 genes across 840 samples, which is 10 of the number of genes and snps in the cf dataset. the performance of all eqtl tools depends dominantly on the dimensions of the dataset, and the computation time is approximately linear with respect to the number of genes and the number of snps. we used this observation to estimate the time required for the analysis of the full dataset. the performance of each method is reported in. matrix eqtl requires only 912 s to analyze the test dataset. this did not allow us to make precise estimates of its performance, so we applied matrix eqtl to the whole dataset and reported the performance in. to reduce the output we set the p-value threshold at 10 5 level for each method with such option. the specifications of the machine used to run the tests (except emap, which does not run on windows) are provided at the end of section 3. all methods that support covariates were additionally tested with 10 covariates set to the first 10 eigenvectors of the genotype sample covariance matrix.  
