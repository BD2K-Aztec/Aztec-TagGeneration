gene expression diffusion maps for high-dimensional single-cell analysis of differentiation data motivation: single-cell technologies have recently gained popularity in cellular differentiation studies regarding their ability to resolve potential heterogeneities in cell populations. analyzing such high-dimensional single-cell data has its own statistical and computational challenges. popular multi-variate approaches are based on data normalization, followed by dimension reduction and clustering to identify subgroups. however, in the case of cellular differentiation, we would not expect clear clusters to be present but instead expect the cells to follow continuous branching lineages. results: here, we propose the use of diffusion maps to deal with the problem of defining differentiation trajectories. we adapt this method to single-cell data by adequate choice of kernel width and inclusion of uncertainties or missing measurement values, which enables the establishment of a pseudotemporal ordering of single cells in a high-dimensional gene expression space. we expect this output to reflect cell differentiation trajectories, where the data originates from intrinsic diffusion-like dynamics. starting from a pluripotent stage, cells move smoothly within the tran-scriptional landscape towards more differentiated states with some stochasticity along their path. we demonstrate the robustness of our method with respect to extrinsic noise (e.g. measurement noise) and sampling density heterogeneities on simulated toy data as well as two single-cell quantitative polymerase chain reaction datasets (i.e. mouse haematopoietic stem cells and mouse embryonic stem cells) and an rna-seq data of human pre-implantation embryos. we show that diffusion maps perform considerably better than principal component analysis and are advantageous over other techniques for non-linear dimension reduction such as t-distributed stochastic neighbour embedding for preserving the global structures and pseudotemporal ordering of cells. availability and implementation: the matlab implementation of diffusion maps for single-cell data is available at https://www.helmholtz-muenchen.de/the advantages of single-cell measurements to various biological research fields have become obvious in recent years. one example is the stem cell studies for which population measurements fail to reveal the properties of the heterogeneous population of cells at various stages of development. purifying for a certain cell type or synchronizing cells is experimentally challenging. moreover, stem cell populations that have been functionally characterized often showheterogeneity in their cellular and molecular properties . to overcome these barriers, on the one hand researchers conduct continuous single-cell observation using time-lapse microscopy , accompanied by single-cell tracking and analysis tools. however, this approach is still limited as the expression of very few genes (typically one to three) could be observed. on the other hand, with the advent of new technologies, such as single-cell qpcr or rna-seq and flow or mass cytometry , it is now possible to measure hundreds to thousands of genes from thousands of single cells at different specific experimental time points (time-course experiments). however, several single cells measured at the same experimental time point may be at different developmental stages. therefore, there is a need for computational methods which resolve the hidden temporal order that reflects the ordering of developmental stages of differentiating cells. while differentiation has to be regarded as a non-linear continuous process , standard methods used for the analysis of high-dimensional gene expression data are either based on linear methods such as principal component analysis (pca) and independent components analysis (ica) [e.g. used as part of the monocle algorithm (or they use clustering techniques that groups cells according to specific properties. hierarchical clustering methods as used in spade and t-sne (van der) as used in visne are examples of clustering methods. however, as these methods are designed to detect discrete subpopulations, they usually do not preserve the continuous trajectories of differentiation data. a more recently proposed algorithm wanderlust incorporates the nonlinearity and continuity concepts but provides a pseudotemporal ordering of cells only if the data comprise a single branch. furthermore, in gene expression measurement techniques, there is usually a detection limit at which lower expression levels and nonexpressed genes are all reported at the same value.suggested the use of a censoring noise model for pca, whereas for the other methods it is unclear how these uncertain or missing values are to be treated. a variety of other manifold learning methods including (hessian) locally linear embedding (hlle) and isomap exist in the machine-learning community and are discussed in detail in the discussion and conclusion section. here, we propose diffusion maps as a tool for analyzing single-cell differentiation data. diffusion maps use a distance metric (usually referred to as diffusion distance) conceptually relevant to how differentiation data is generated biologically, as cells follow noisy diffusion-like dynamics in the course of taking several differentiation lineage paths. diffusion maps preserve the nonlinear structure of data as a continuum and are robust to noise. furthermore, with density normalization, diffusion maps are resistant to sampling density heterogeneities and can capture rare as well as abundant populations. as a non-linear dimension-reduction tool, diffusion maps can be applied on single-cell omics data to perform dimension-reduction and ordering of cells along the differentiation path in a single step, thus providing insight to the dynamics of differentiation (or any other concept with continuous dynamics). in this article, we @bullet propose an adaptation of diffusion maps for the analysis of single-cell data which is less affected by sampling density heterogeneities and addresses the issues relating to missing values and uncertainties of measurement, @bullet propose a criterion for selecting the scale parameter in a diffusion map, @bullet evaluate the performance of the diffusion map and its robustness to noise and density heterogeneities using a toy model that mimics the dynamics of differentiation, @bullet apply the adapted diffusion map algorithm to two typical qpcr and one rna-seq datasets and show that it captures the differentiation dynamics more accurately than other algorithms.in this section, we evaluate the performance of the diffusion map on each of the datasets described in the methods section and compare it to the performance of two other dimension-reduction methods pca and t-sne. data embeddings with several other methods including ica, spade, kernel-pca , isomap and hessian locally linear embedding (hlle) are provided in the supplementary figures s16s20.shows the average dimensionality hdi for balanced toy data (red) and imbalanced toy data (black) as a function of log r. the balanced set exhibits two maxima. the first one arises at the length scale of the thickness of the differentiation branches which include only a few cells. at this r several subpopulations form at the more densely populated stages of the steady state. the second maximum appears at a larger length scale when several subpopulations become visible to each other and the continuous branches form. we picked the r at the second maximum for visualization (data visualization at the first maximum is provided in the supplementary). for the imbalanced set, however, due to the high noise level, the first maximum vanished and we only detected one maximum which we then used for the visualization.  
