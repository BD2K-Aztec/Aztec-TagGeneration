structural bioinformatics biologically inspired em image alignment and neural reconstruction motivation: three-dimensional reconstruction of consecutive serial-section transmission electron microscopy (sstem) images of neural tissue currently requires many hours of manual tracing and annotation. several computational techniques have already been applied to sstem images to facilitate 3d reconstruction and ease this burden. results: here, we present an alternative computational approach for sstem image analysis. we have used biologically inspired receptive fields as a basis for a ridge detection algorithm to identify cell membranes, synaptic contacts and mitochondria. detected line segments are used to improve alignment between consecutive images and we have joined small segments of membrane into cell surfaces using a dynamic programming algorithm similar to the needlemanwunsch and smithwaterman dna sequence alignment procedures. a shortest path-based approach has been used to close edges and achieve image segmentation. partial reconstructions were automatically generated and used as a basis for semi-automatic reconstruction of neural tissue. the accuracy of partial reconstructions was evaluated and 96 of membrane could be identified at the cost of 13 false positive detections.serial-section transmission electron microscopy (sstem) can produce reconstructions of neuronal morphology at very high resolution, including synaptic organelles and the contacts between neurons that constitute circuits. alignment and reconstruction of sstem images is currently performed manually or semiautomatically, with the aid of computer software, to generate a 3d model of the imaged neuron and, with other such neurons, of the synaptic circuits to which that neuron contributes . in some to whom correspondence should be addressed. cases, approximate alignment can be achieved automatically but, even so, high-quality circuit reconstructions still require many hours of manual tracing and annotation, and are highly dependent upon the interpretative skill of the human observer and the complexity of neuronal arborizations being reconstructed . for example, neurites are simple and have been completely reconstructed by manual means in the nematode caenorhabditis elegans but are complex, highly branched and reconstructed only with great difficulty or incompletely in the fruit fly drosophila melanogaster . existing methods of image alignment usually rely on a control point selection method. semi-automatic alignment can be carried out by identifying control points manually and aligning these by means of a particular algorithm . automatic alignment can be carried out with control point detection algorithms , and works best when image quality is consistent throughout the dataset, but performance can be degraded when artefacts such as gaps, noise, differing levels of brightness and/or contrast are present in the images being aligned. such artefacts are unfortunately fairly common in sstem because of the complicated preparative procedures and increase as the series of images becomes longer. most currently used systems for automatically annotating electron microscopy (em) data rely on some variant of the watershed algorithm to detect boundaries between cells . this method usually results in oversegmentation, and several methods have been identified to reunite incorrectly over-segmented areas after the watershed algorithm is run . a commonly used method to detect membrane present in an image is to pre-process the image by a gaussian blur combined with image derivative or hessian matrix analysis. also called gaussian smoothed hessian (gsh), this method is effective at filtering out noise while retaining membrane edges in the image . random forest classifiers have also been used to successfully combine outputs from a range of generic feature detectors . gsh, and other generic feature detectors, are efficient to implement and make reasonable assumptions when membrane profiles are gaussian, but when line profiles are predictable the construction of a specific filter may improve performance . for this reason, we have customized a set of receptive fields to specific features visible in em images.page: 2217 22162223). four categories have been annotated: sharp membranes that pass vertically through the section thickness (a), blurred images of obliquely sectioned membrane (b), synaptic profiles (c) and mitochondria (d). each image patch is 227227 nm.manual reconstructions of em data are difficult to compare directly with segmentation derived from algorithms. reconstructions areusually performed with the intention of tracing the neuron correctly over many sections rather than identifying the exact location of the cell membrane in every image. with these goals in mind, manual reconstructions generate the general shape of the neuron and overall neuron morphology along with the contacts made with other neurons correctly, but with the exact location of membrane not necessarily accurate in all places. in areas where a membrane runs obliquely in the section and appears blurred in its corresponding projection image, or where a large presynaptic density is present (and c), membrane signal can occupy a width of 20 pixels or more at a resolution of 3.7 nm per pixel. for the same dataset, tracing variation between experts can be up to 20 pixels, or 74 nm, depending on both the acceptable level of accuracy of tracing with a manually controlled mouse and true uncertainty in the location of oblique membranes (data not shown). this looseness in manual tracing makes direct comparison between manual and automatic tracing methods difficult to achieve. choosing a performance metric that recognizes topological correctness rather than small differences in boundary locations and using high-quality datasets against which to assess automatic tracing are both important considerations. to overcome the problem of the disparity between manual and automatic tracing methods, an interactive web interface was developed to view and correct membrane automatically traced from em images that had previously been annotated manually. errors made by the algorithm were classified as either false positives (locations where membrane was detected by the algorithm but was not actually present) or false negatives (where membrane was present but not detected) as shown in. using the web interface, we identified false positive lines by clicking on them,and drawing in manually the missing, or false negative, lines. using this method, all errors were identified and a fully traced membrane dataset was constructed within a small volume (dataset s1). selected trace results and alignment improvements were imported into manual reconstruction software, reconstruct , for direct visual comparison with manual tracing. 3d renderings of results are shown in. alignment improvement and semiautomatic tracing produced a more accurate representation of the reconstructed bouton of a projection neuron, the main input neuron to the mushroom body calyx. the semi-automatic annotation is smoother and small misalignments in the z direction are corrected. the correlation coefficient between pairs of consecutive images was also calculated for the volume shown in. the average correlation coefficient was 0.29 after manual alignment, and 0.32 after alignment improvement using a linear transformation. note that this level of accuracy can also be achieved by careful manual annotation but would take much longer time to complete. exact membrane accuracy is usually traded for faster, less accurate tracing that preserves topological correctness. the fully traced membrane dataset was used to optimize and test algorithm performance. convolutions necessary for the line detection algorithm were implemented on a graphics processing unit (gpu) to improve algorithm speed. edge detection parameters were first estimated empirically, and then optimized by simplex or gradient descent optimization to maximize metric scores. the rand index, a commonly used measure of segmentation performance , was used to assess performance, as shown in. performance was also measured by the number of separating pixels between segments that were correct or incorrect as a proportion of total true positive separating pixels, as shown inand displayed inrand index is expressed as a measure of similarity, with 1 being identical to the manually corrected segmentation. separating pixel true positive (tp) false positive (fp) and false negative (fn) rates are shown as a proportion of the total true positive separating pixels. algorithm parameters were optimized by simplex or gradient descent to find 10 times more false positives than false negatives or to maximize the rand index score. the 5-fold cross-validation was used to validate rand index scores.results were assessed before and after edge closure (open edges and closed edges, respectively). performance is compared against the watershed algorithm applied to an optimized gsh, and to a manually trained random forest classifier (ilastik). false positives are expressed as a percentage of true separating pixels, as determined by manual annotation. a receiver operator characteristic (roc) in. membrane detected within 10 pixels of manually annotated membrane was considered correct, because for the dataset used here this width would correspond to a flat section of membrane at an oblique angle of 36 @bullet. performance was benchmarked against gsh and a freely available random forest classifier, ilastik , manually trained on a range of generic features to identify cell membrane. scores from both these benchmarks were segmented by the watershed algorithm. parameters were optimized to maximize metric scores in both cases. responses of the gabor-like receptive fields were robust to several types of noise sometimes encountered in sstem images such as lowcontrast images, blurred or out-of-focus areas and sudden or gradual changes in brightness. after optimization, the ridge detection and edge closure methods were able to join gaps where noise such as oblique membrane or stitching artefacts obscured the receptive field responses. line segments identified by edge detection and edge closure operations were further classified as enclosing the profile of either a synapse or a mitochondrion by the receptive fields shown inwe have presented a set of computational methods for em image alignment and reconstruction, based on a set of receptive fields learnt from em image data. the identification of many control points for aligning consecutive images can improve upon manual alignment methods and is robust to many types of noise encountered in em images. closing edges based on a shortest path algorithm can also achieve a full segmentation of images and additional receptive fields can be used to identify the profiles of synapses and other organelles present in sstem images. the ridge detection approach is complementary to existing regional or watershed-based methods, and achieves similar or superior results. aligning points of membrane by the dynamic programming algorithm is also complementary to existing control point-based alignment methods and can improve upon these in some cases, especially at places where areas of noise or imaging artefacts affect control point properties. an open-source reference implementation of the ridge detection and alignment algorithms is available for download in dataset s2. the manual alignment and segmentation of detailed sstem images is very time consuming, but information on synaptic connections obtained by these means is essential for research in systems neuroscience . this reawakened need has recently received renewed recognition, identified in the recently designated field of connectomics . inspired by the example of tools used in biology for molecular alignment, the set of methods we report for improved alignment and detection of membrane is able to assist in the time-consuming process of manual annotation. further information about likely membrane locations is also available from consecutive images in the stack. areas where membrane alignment is poor between two images in the z-axis may indicate a false positive or false negative identification in either image. utilization of this additional information and further improvements in both image processing techniques and image quality will help lead to the complete automation of neuronal reconstruction in 3d, and the complete identification and definition of circuits constituted by such reconstructed neurons. approaches to image analysis based on receptive fields are inspired by research into the visual systems especially of mammals and insects (o), in which visual interneurons have been shown to respond to bars, lines or edges. that area of vision research is under constant evaluation, and advances in it can lead to improved accuracy for segmentation and feature detection. future avenues of research include identifying additional useful receptive field types and combining outputs from different receptive fields into a layered system for more accurate detection of cell membranes and other organelles. applying these techniques to sstem data offers for the future an improved understanding not only of visual systems but in turn also a further improvement of such computational techniques.  
