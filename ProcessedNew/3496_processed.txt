genome analysis pepr: a peak-calling prioritization pipeline to identify consistent or differential peaks from replicated chip-seq data motivation: chip-seq is the standard method to identify genome-wide dna-binding sites for transcription factors (tfs) and histone modifications. there is a growing need to analyze experiments with biological replicates, especially for epigenomic experiments where variation among biological samples can be substantial. however, tools that can perform group comparisons are currently lacking. results: we present a peak-calling prioritization pipeline (pepr) for identifying consistent or differential binding sites in chip-seq experiments with biological replicates. pepr models read counts across the genome among biological samples with a negative binomial distribution and uses a local variance estimation method, ranking consistent or differential binding sites more favorably than sites with greater variability. we compared pepr with commonly used and recently proposed approaches on eight tf datasets and show that pepr uniquely identifies consistent regions with enriched read counts, high motif occurrence rate and known characteristics of tf binding based on visual inspection. for histone modification data with broadly enriched regions, pepr identified differential regions that are consistent within groups and outperformed other methods in scaling false discovery rate (fdr) analysis. availability and implementation:chromatin immunoprecipitation followed by massively parallel sequencing (chip-seq) is the standard technique to identify the genome-wide occurrences of transcription factor (tf) binding sites and histone modifications in vivo. over the past few years, there has been tremendous development of analysis methods for chip-seq data, with tens of peak finders published . over this course, several characteristics of chip-seq datasets, such as enrichment profile features (peak width, signal-to-noise ratio and location relative to genomic features) of different types of tfs and histone modifications, sources of artifacts and the commonly observed statistical distributions of read counts, have been gradually revealed . as sequencing cost decreases, use of biological replicates is emerging and may eventually become the standard practice for chip-seq studies. most of the encyclopedia of dna elements (encode) consortium data were performed in duplicate . furthermore, as researchers shift from performing chip-seq experiments that address mechanistic questions to those that hypothesize differential and/or contextspecific binding in a disease, treatment or epidemiologic setting, the use of replicates to account for individual variability becomes crucial. we expect that this will lead to more analyses comparing a group of chip samples with a group of controls, or two groups of chip samples, with or without controls, run under different experimental conditions. chip-seq peak finders that perform direct group comparisons within the peak-calling pipeline are currently lacking. when biological replicates are available, researchers may choose to combine the replicates (cr) in each group and run one-chip-versusone-control analysis to identify all possible peaks. alternatively, they can pair chip and control samples, conduct a separate analysis (sa) for each pair and then stipulate rules to combine the peak-finding results, such as requiring the peaks to be found in all pairwise comparisons. the cr approach is often used in tf chip-seq studies to identify all possible binding sites. however, if the goal is to find consistent binding among replicates, many false positives may occur where binding is present in only one or a subset of the samples. the sa approach is more sophisticated in the sense that it does not lose all information regarding sample-tosample variability and is more applicable to experiments that have a natural pairing of samples. however, because it evaluates peaks for each replicate separately, the effects of false negatives across replicates may become compounded. thus, the sa approach is more likely to miss moderate, yet consistent, differences in binding. when there is no inherent pairing between test and control samples, as often occurs with differential binding analyses, the sa approach may call a peak because in each one-versus-one analysis, one sample has greater enrichment than its paired sample. yet, if to whom correspondence should be addressed. y the authors wish it to be known that, in their opinion, the first two authors should be regarded as joint first authors. the pairs were constructed differently, some peaks may no longer exist. an alternative approach is the irreproducible discovery rate (idr) approach recommended by encode. idr can be considered a sophisticated cr approach, which assesses the consistency of peak rankings in replicates to find an optimum significance cutoff for determining the final peak list. correctly modeling the variation among samples in gene expression studies when testing for differential expression has been shown to be of great importance . for rna-seq analysis, several methods [for example, edger and deseq ] use a negative binomial distribution instead of a poisson distribution to capture the extra variance among replicates. these approaches can be used with chip-seq data; however, they do not perform the first several steps of the chip-seq analysis pipeline nor do they take advantage of local chromosomal information. an exact negative binomial test (diffreps) was recently introduced for chip-seq data and compared with edger and deseq using two histone modification datasets . other approaches to identify differential binding with replicates include the r packages diffbind and dbchip ; although these programs take into account sample variation, they rely on other peak callers to generate peak sets for each individual sample first and conduct analysis on the candidate regions that fall within the peak sets. here, we introduce a chip-seq peak-finding and prioritization (pepr) pipeline that can analyze either a group of chip-seq samples together with controls or compare two groups of chip-seq samples, with or without controls. pepr uses a sliding window approach and models read counts across replicates and between groups with a local negative binomial model. genomic regions with less variable read counts across replicates are ranked more favorably than regions with greater variability, thus prioritizing consistently enriched regions. we tested pepr on chip-seq data for activating transcription factor 4 (atf4) , seven encode tf datasets and one histone modification dataset (h3k27 tri-methylation), and compared the performance of pepr to several chip-seq methods representing different statistical models and using different sources of information: macs , macs2 and spp with idr , zinba , sicer , diffreps , diffbind and edger . we show that pepr performs favorably compared with the other tested approaches, prioritizing peaks that reflect stronger enrichment fold and higher consistency among samples.currently, there is a lack of chip-seq analysis programs that account for biological variability within the peak-finding process. we have developed a method and tool, pepr, which uses a local negative binomial model to identify consistent or differential binding sites among chip-seq data, and that additionally estimates the optimal moving window size and offers postprocessing steps to reduce false positives and refine peak resolution. variation among samples in chip-seq data can sometimes be large, such that some binding sites, even for tfs, are not reproducible . inconsistent tf peaks among biological samples can exist for many reasons, including differences in accessibility of chromatin regions (e.g. because of the histone tail modifications or dna methylation), common sequence variants, competitive or cooperative binding differences with another tf or technical artifacts that only occurred in one of the replicates. however, all but the last of these reasons are not significant concerns for most peak-finder programs, the goal of which is to identify all potential binding sites rather than consistent or differential binding sites. in addition, as public datasets from large consortiums such as encode more comprehensively cover known tf binding in commonly used cell and tissue types, there will be less incentive for individual laboratories to identify all of the potential binding sites for a protein, as many will be available. a more refined hypothesis may be where does this tf (or histone modification) bind consistently in this specific context (a specific disease, developmental stage, exposure or treatment)? accurately modeling the variation is highly important in population epigenomics studies where substantial variation exists among samples, not only among individuals but also between tissue types , developmental time points and during disease progression . we compared pepr with five commonly used single-sample peak finders that use different underlying statistical models (macs, macs2, spp, zinba and sicer), as well as three programs that were designed for replicates (diffreps, diffbind and edger), and found that pepr performed favorably in terms of consistently enriched read counts, motif occurrence rate and known characteristics of tf binding based on visual inspection. for comparison with macs, zinba or sicer, we either performed separate paired analyses and then called peaks in the overlapping regions (sa) or combined the reads for the replicates and called peaks from the concatenated lists (cr). idr was incorporated with macs2 and spp to determine the peak list cutoff, as recommended by the encode consortium. visual inspection of the peak shape and summarizing the read counts in peaks were extremely valuable in characterizing the unique tendencies of each approach. in particular, macs was sensitive to detecting regions that had low background and tended to miss peaks that had a relatively high background [(iii)]; visual inspection of the zinba and diffreps unique peaks revealed that many had similar peak shape in both chip and control samples; spp had severe false negatives for the nrsf data, which is possibly because of the removal of true binding sites that spp mistakenly assumed to be artifacts because of having unexpectedly small shift size [i.e. in the phantom peak as defined in (. when we compared pepr with spp-idr and macs2-idr, we observed pepr-unique peaks (that are missed by the other two) had high read counts and motif rate. although motif occurrence rate is a useful marker for dna binding, its value as a marker for consistent or differential dna binding is not as clear. for identification of all dna binding sites, motif analysis is expected to be specific (if the motif is found within a peak, it is assumed that binding occurs) but not necessarily highly sensitive (indirect binding cooperatively with other protein(s) may not result in a motif occurrence). because the percent of binding sites without a motif is only expected to vary by dna binding protein, and not by peak caller, this is often ignored when comparing peak callers. however, for consistent or differential binding experiments we can no longer assume specificity; a peak finder that identifies fewer overall peaks with a motif than an alternative may be correct in not calling the additional peaks as consistently bound or differentially bound. given these caveats, we nonetheless found motif occurrence rate informative for interpreting our results when used in conjunction with visual inspection of peaks. the large improvement in motif occurrence rates for pepr-unique peaks compared with peaks identified by the sa approaches and edger-basic suggests that peaks with higher read intensities and the expected smooth peak shape are more likely to contain a motif . the cr approaches, on the other hand, were comparable in motif occurrence rate with pepr, but many of these were only bound in one replicate on visual inspection, and thus are likely false positives for identification of consistent binding sites in the biological system under study. although pepr and edger use a similar underlying negative binomial model, edger lacks initial steps required for chip-seq peak finding (shifting opposite strand reads, defining and summarizing reads per window, etc), does not incorporate information from neighboring windows, which especially benefits histone modification analyses, and does not offer post-processing steps to improve peak resolution or reduce false positives. in five of the eight tf datasets, pepr performed better in motif rate than edger if the same pepr-processing steps are performed for edger; with the histone data, pepr was more sensitive than edger owing to estimation of the dispersion parameters locally. peprs post-processing steps improved edgers performance when there is a high proportion of pcr-duplicate peaks (6 in nrsf, 1.6 in atf4 and50.5 in other datasets). diffbind was previously shown to work well with differential binding in tf data ; however, in h3k27me3 data with broad and highly variable peaks, diffbinds edger module had low detection power, whereas its deseq module identified 918 peaks, many of which were inconsistent among samples. diffreps resulted in unpredictable numbers of peaks across the datasets we tested, for example, it identified substantially fewer peaks than all other programs for atf4 and smc3 (supplementary) but many more for h3k27me3. owing to the lack of benchmarks in histone modification datasets, in this manuscript we mainly relied on tf datasets to compare methods. however, pepr is adaptable to datasets with either sharp or broad peaks because of its empirical estimation of the optimal sliding window size, and thus is equally relevant for analysis of histone modification chip-seq datasets as illustrated with our h3k27me3 data. h3k27me3 tends to occur in broad regions several kilobases in length, making consistent peak calling more difficult. based on our visual inspection of peaks and scaling fdr analysis for the approaches compared, we showed that pepr identified binding regions consistent between groups without being sensitive to changes in read coverage. one limitation of pepr is that it currently does not perform paired analysis, similar to the limitation of multiple rna-seq differential analysis programs ; thus, for example, the paired nature of tumor and patient-matched normal samples could not be taken into account. for experiments requiring covariates, we currently recommend edger. pepr also makes the assumption that the quality of data for each chip-seq experiment is approximately equal, similar to most methods for other types of high-throughput analysis. when this assumption is violated, the result may be a high false-negative rate owing to missing peak regions in the lower quality sample(s); this may especially be true for experiments with small sample size. in this case, users may obtain better performance using a different peak finder on individual samples, and a secondary method to explore options to combine results. future versions of peak finders for replicated chip-seq data could take into account quality, for example, by assigning a weight to each sample.  
