gene expression preserving biological heterogeneity with a permuted surrogate variable analysis for genomics batch correction motivation: sample source, procurement process and other technical variations introduce batch effects into genomics data. algorithms to remove these artifacts enhance differences between known biological covariates, but also carry potential concern of removing intragroup biological heterogeneity and thus any personalized genomic signatures. as a result, accurate identification of novel subtypes from batch-corrected genomics data is challenging using standard algorithms designed to remove batch effects for class comparison analyses. nor can batch effects be corrected reliably in future applications of genomics-based clinical tests, in which the biological groups are by definition unknown a priori. results: therefore, we assess the extent to which various batch correction algorithms remove true biological heterogeneity. we also introduce an algorithm, permuted-sva (psva), using a new statistical model that is blind to biological covariates to correct for technical arti-facts while retaining biological heterogeneity in genomic data. this algorithm facilitated accurate subtype identification in head and neck cancer from gene expression data in both formalin-fixed and frozen samples. when applied to predict human papillomavirus (hpv) status, psva improved cross-study validation even if the sample batches were highly confounded with hpv status in the training set. availability and implementation: all analyses were performed using r version 2.15.0. the code and data used to generate the results of this manuscript is available from https://sourceforge.net/projects/psva.high-throughput genome-scale data can yield powerful predictors of sample phenotype. when applied to disease such as human cancers, the resulting classifiers may predict patient prognosis or therapeutic strategy to select appropriate personalized treatment. nonetheless, technical artifacts from sample collection and processing introduce biologically irrelevant signal into highthroughput data, referred to as batch effects. even modest changes to experimental design, such as the microarray scan date or technician, can adversely impact the accuracy of genomic analyses . several batch correction algorithms can remove these artifacts statistically, provided that pertinent biological groups are known and well represented in each batch (gagnon). current batch correction algorithms remove signal unrelated to the protected biological groups, thereby enhancing group differences unrelated to batch. for example, combat corrects genomic data using an empirical bayes framework to fit parameters in a linear model containing both batch and biological covariates . similarly, surrogate variable analysis (sva;) uses an iterative procedure to estimate the effect of batch covariates spanning a space not associated with biological covariates. although essential for class comparison, these corrections sometimes unintentionally eliminate true biological heterogeneity not encoded in the modeled biological covariates. as a result, novel patterns cannot be identified from such corrected data, limiting inference of either dynamics from time course genomics data or of novel disease subtypes. the heterogeneity of human tumors makes the removal of sample heterogeneity particularly challenging in cancer genomics. in this field, biological heterogeneity is essential to realize the central goal of identifying personalized genomic signatures to select optimal treatments for each cancer patient. worse still, the need to prioritize collection of formalin-fixed paraffin-embedded (ffpe) samples for pathology may introduce an imbalance and significant technical artifacts in samples available for such classification . this study provides a comprehensive assessment of the extent to which batch correction techniques, including notably sva and combat, remove such biological heterogeneity when correcting for technical artifacts. we also propose a new algorithm, permuted-sva (psva), to counteract such overcorrection of genomics data. this algorithm incorporates an innovative statistical model in the computational framework of sva (to whom correspondence should be addressed.) to iteratively refine sample clusters after modeling the effect of known batches. this algorithm removes technical artifacts in replicate samples, while retaining biological heterogeneity in samples. as a result, correcting genomics data with psva improves subtype identification and class discovery in batch-affected gene expression data from head and neck squamous cell carcinoma (hnscc) tumors.batch correction techniques have been well established for class comparison analysis of genomic data. nonetheless, we observed that these algorithms potentially removed true biological heterogeneity to facilitate such comparison. therefore, we developed anone combat sva sva+combat psvanew batch correction technique, psva, which reversed the typical sva process to infer dominant sources of signal that is independent of known sources of technical artifacts. this algorithm simultaneously reduced differences in replicate samples arising from technical artifacts while maintaining differences between unique samples not observed with other batch correction techniques. moreover, hierarchical clustering of psva-corrected data clearly delineated established hnscc subtypes from batch-affected gene expression data. the psva classification further divided the atypical group into two primary clusters, consistent with the recent observation of the association of the atypical group with hpv-positive samples and of subtypes within hpv-positive hnscc . moreover, encoding some of the known subgroups delineated by hpv status in our model did not substantially alter the batch-corrected data with psva. therefore, we anticipate that future application of psva to genomics data from other human cancers without a priori knowledge of diseases will similarly retain patient-specific heterogeneity to facilitate class discovery. for example, encoding cancer types as batch with psva, similar to the model employed for batch correction in the tcga pan-cancer project , could better identify the molecularly distinct subtypes across human cancers that are required for personalized therapeutic selection. beyond subtype identification, the psva algorithm may also facilitate more subtle patterns in genomic data using pattern-finding algorithms , particularly adept for time course data. for example, psva may enable the detection of the complex, interacting dynamic signals in time course data without the prior knowledge of specific time groups required for batch correction inand should be explored in future work. an additional goal for genomics data is the development of classifiers to infer clinical groups in future genomics datasets that better assess prognosis or improve therapeutic selection. implementation of such personalized genomics requires application of classification rules learned on training data to independent test data, for which phenotype is by definition unknown a priori. because psva does not require knowledge of these groups, the algorithm can naturally be applied to also batch correct test data in such class discovery problems, and should be compared with other emerging techniques including fsva . consistent with our previous findings  
