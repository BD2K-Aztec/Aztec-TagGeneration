a hidden markov random field-based bayesian method for the detection of long-range chromosomal interactions in hi-c data downloaded from motivation: advances in chromosome conformation capture and next-generation sequencing technologies are enabling genome-wide investigation of dynamic chromatin interactions. for example, hi-c experiments generate genome-wide contact frequencies between pairs of loci by sequencing dna segments ligated from loci in close spatial proximity. one essential task in such studies is peak calling, that is, detecting non-random interactions between loci from the two-dimensional contact frequency matrix. successful fulfillment of this task has many important implications including identifying long-range interactions that assist interpreting a sizable fraction of the results from genome-wide association studies. the task distinguishing biologically meaningful chromatin interactions from massive numbers of random interactions poses great challenges both statistically and computationally. model-based methods to address this challenge are still lacking. in particular, no statistical model exists that takes the underlying dependency structure into consideration. results: in this paper, we propose a hidden markov random field (hmrf) based bayesian method to rigorously model interaction probabilities in the two-dimensional space based on the contact frequency matrix. by borrowing information from neighboring loci pairs, our method demonstrates superior reproducibility and statistical power in both simulation studies and real data analysis. availability and implementation: the source codes can be downloaded at:chromosomal dna must be tightly packed to fit within the limited space of the nucleus. the intricate, highly compacted folding of the chromosomes, however, is by no means random. chromatin architectures are closely linked to genomic functions by influencing how genetic information is accessed, read, and interpreted in a given cell and under certain local micro-environmental conditions via dynamic interactions among genes and their regulatory elements. for example, a long-range loop structure can be formed to link a distant enhancer with its target gene to regulate gene transcription. hence, characterization of the three dimensional (3d) genome organizations is critical to understanding genomic function . recent advancements in chromosome conformation capture (3c) and derived methods (such as 3c, 4c, 5c and hi-c) allow the study of 3d chromosome organization with increasing resolution and throughput. these 3c-based methods quantify the interaction or contact frequency, how often any pair of loci in the genome is in close spatial proximity. for 3c, a locus is the unit of analysis and corresponds to one restriction enzyme fragment (hereafter termed fragment). approaches to analyze interaction frequencies fall largely into two complementary categories: 3d model reconstruction and peak calling. the first set of methods simultaneously model contact frequencies of all pairs of loci in the genome to reconstruct 3d structure . the second set of methods aim to identify interaction peaks, meaning pairs of loci where the observed contact frequency is higher than expected from non-random chromatin looping or co-location events . to answer many important biological questions (e.g. pinpointing individual cis-regulatory elements), higher resolution for the contributing loci is highly desirable, if not indispensable. this paper focuses on peak calling. identifying non-random contacts is of fundamental biological interest to researchers due to their relevance for functional regulation. for instance, it can shed light on the functional mechanisms of non-coding complex trait associations identified in genome-wide association studies (gwas). gwas have been resoundingly successful, identifying thousands of variants associated with complex traits. only a small proportion (712) fall in protein coding regions making interpretation of non-coding variants imperative. although a large number of regulatory elements have been annotated , their target genes are largely unknown . recent 3c-based studies are generating an increasingly comprehensive catalog of interactions between genes and their regulatory elements in different cell types at varying resolution across multiple organisms including drosophila, yeast, mouse and human . such information will be fundamental to understanding functional mechanisms. for example, a recent study used 4c data to identify longrange (at megabase distances) interactions between the obesityassociated intronic variants in fto and the homeobox gene irx3, with the expression of irx3 rather than fto being directly linked to body mass. this study showcased the value of interactions identified from the 3c-based studies for shedding light on the functional mechanisms of genetic variants implicated by gwas. several computational and statistical methods have been developed for this important peak calling task for data generated from 3c-based methods.developed a 5c peaking calling algorithm where they first estimated the null contact frequencies (average and standard deviation) using nonparametric lowess smoothing over genomic distance (using all pairs with the assumption that the vast majority of interactions are random collisions), then calculated standardized z-scores and raw p-values by fitting the z-scores to a weibull distribution, followed finally by converting the raw p-values into q-values for fdr analysis.binned pairs of loci according to genomic distance, estimated null contact probabilities within each bin, and called peaks by assuming the contact frequency of every pair in each bin followed an identical binomial distribution.developed a pipeline to estimate the expected contact frequency accounting for locus length, inter-locus distance, mappability and gc content, and then tested for significant interaction by assuming the observed contact frequency followed a negative binomial distribution. most recently,refined the binning method in duan et al. (2010) and to develop fit-hi-c. specifically, fit-hi-c provided more accurate estimates of the contact probabilities by fitting nonparametric spline curves across genomic distances (instead of discrete binning), re-fitting spline curves after filtering non-random collisions based on the initial spline, and modeling other hi-c biases by incorporating locus-specific correction factors inferred from a previously published iterative correction and eigenvector decomposition method . these existing methods have advanced the field by improving the accuracy in the estimation of the expected contact frequencies under the null (i.e. random collisions). all these methods take into account genomic distance between the pair of loci under inference during the estimation, with some incorporating other genomic biases. however, all existing methods, by testing each individual pair of loci independently, ignore the potential correlation among pairs of loci. this was less of an issue with lower resolution data when multiple fragments combined into metafragments served as the units of analysis. when analyzing a fragment resolution hi-c data, jin et al.(2013) recognized this potential issue and developed the anchorfragment caller (afc), an ad hoc approach to accommodate the correlation of peak status among neighboring fragment pairs. in afc, one anchor was fixed (either a fragment or mega-fragment from consecutive smaller fragments) and one-dimensional peak calling was performed. for each anchor, the algorithm started with the identification of candidate peak regions. a candidate peak region could encompass multiple consecutive fragments with moderate marginal evidence for non-random interaction with the anchor and, importantly, afc allows for small gaps. peaks were called by aggregating information across the entire candidate peak region via assigning thresholds on read counts and p-values from contributing fragment pairs as well as from the entire region cumulatively. as an initial attempt to model the spatial dependency of the underlying peak status, afc performed reasonably. we believe that the existing methods are not yet optimal, and that improvements in multiple aspects are needed. first, an improved analysis suite for data from 3c-derived methods should be based on an explicit model that yields clear and reproducible expectations for genome-wide interaction frequencies. second, existing approaches choose anchor fragment(s) arbitrarily and also ignore any correlations between neighboring fragments or anchors. for example, we found that neighboring anchors often interact with the same target fragments, suggesting that these anchors are parts of a bigger region involved in the same dna looping event. therefore an ideal peak caller should consider correlations between neighboring a hidden markov random field-based hi-c peak callerfragments in the context of a two-dimensional (2d) contact matrix generated from 3c-derived technologies. third, onedimensional calling approaches are not optimal, do not incorporate useful existing information, and considerable benefits can be gained using a 2d approach. for example, we observed afc asymmetric peak calls (supplementary figs s1 and s2) and lower power in the identification of non-random interactions (details in section 3). thus, these observations motivated us to develop rigorous statistical models that efficiently use information from neighbors in the 2d space. here we present a hidden markov random field (hmrf) based bayesian method for peak calling using hi-c data. our approach improves on prior methods by explicitly borrowing information from neighboring fragment pairs via modeling the dependency in the 2d space. our results in real data and from extensive simulations indicate superior performance of our method over existing methods, across a range of underlying dependency structure.comprehensive simulation studies have demonstrated the superior performance of our hmrf bayesian caller over other available methods. in particular, our simulations showed that our model is able to accurately estimate the inverse temperature parameter w across a wide range of spatially dependent patterns and as a result improved power for calling peaks (detailed in supplementary material section 2). next, we showcase the improved reproducibility and statistical power of our method in real data analysis. as aforementioned, our method was motivated by our observations in real data and was developed for re-analysis of the fragment resolution hi-c data generated by. in the original study, twelve replicates of primary imr90 human fibroblast cells (including six replicates untreated cells and six replicates after tnf-a treatment) were used to generate $3.4 billion paired-end reads. this unprecedented sequencing depth allowed direct identification of interacting fragments. one major finding of this study is that tnfa responsive enhancers are already in contact with their target promoters before signaling, manifested by similar peak patterns observed under each condition separately. motivated by this finding and the insufficient sequencing depth in each condition (i.e. before or after tnf-a treatment), we combined data from the two conditions to achieve higher statistical power in detecting fragment resolution chromatin interaction. we thus first test our hmrf bayesian caller in this hi-c data set. we analyzed three datasets (1) imr90 before tnf-a treatment, (2) imr90 after tnf-a treatment and (3) the combined dataset (dataset by pooling data from datasets 1 and 2). under the rationale that peak patterns of the two conditions are shared, a robust caller is expected to identify similar patterns for the three datasets.shows peak calling results from one domain chr17:29.52 29.72 mb. we observed that fewer peaks were called in datasets 1 and 2, particularly dataset 1 where the total number of reads was 75.1 of that in the dataset 2. comparatively, our method encourages more clustering of peaks and more consistent results across the three datasets. for example, within this particular domain, 40.6 and 69.9 of the peaks called in the combined dataset were detected using only dataset 1 and 2, respectively, by our method, compared with 35.3 and 65.2 (40.3 and 67.9) by afc (fit-hic). genome-wide quantitative comparisons are presented below (tables 1 and 2). we next proceeded to quantitatively and systematically evaluate the performance based on genome-wide calling for all domains. for a fair comparison, we selected thresholds based on posterior peak probabilities for our method and p-values for fit-hi-c to match the number of peaks called by afc for each dataset. we also performed other comparisons where we matched the number of peaks called by either our method or fit-hi-c, or where we let each method call peaks according to its own criterion and found similar patterns (detailed in supplementary material section 5). treating peaks called in the combined dataset as truth, we gauged performance in single-condition datasets using the following three statistics: false-positive rate (fpr), false discovery rate (fdr) and recovery rate (rr). denote the number of false positives, true positives, false negatives and true negatives as fp, tp, fn and tn, where the truth is defined according to afc results from the combined dataset and the four numbers sum up to the total number of intra-domain fragment pairs. we have fpr fp/(fp tn), fdr fp/(fp tp) and rr tp/(tp tn). as shown inupper panel, methods accounting for potential dependency of underlying peak statuses (afc and our hmrf bayesian caller) resulted in better performance than fit-hi-c which models fragment pairs independently. furthermore, our method outperformed the others for all three measures. for example, for imr90 before tnf-a treatment, we obtained fpr 0.52, fdr 15.6 and rr 42.3 for our hmrf bayesian caller, compared with fpr 0.60, fdr 18.4 and rr 41.1 for afc and fpr 0.64, fdr 19.2 and rr 41.2 for fit-hi-c. by borrowing information from neighboring fragment pairs in a probabilistic framework, our method lead to more robust inference with simultaneously lower false positive, false discovery rates and higher recovery rate. in addition, for each caller, we calculated the jaccard index between the peak sets from the two conditions, defined as the ratio of number of peaks identified under both conditions over the number of peaks identified by either. average jaccard index across all domains genome-wide is shown infor each method. again, methods accounting for the dependency of underlying peak status show higher concordance across conditions. average jaccard index improved by 33.6 and 61.3 respectively, from 13.7 (fit-hi-c) to 18.4 (afc) and 22.1 (hmrf). to avoid potential systematic differences between treated and untreated conditions in terms of peak status (although not supported by results in), we also analyzed two randomly split datasets as described by. results shown in(lower panel) and(rightmost column) similarly show better reproducibility and robustness of our methods over existing ones. given one important utility of called peaks is to illuminate biologically meaningful interactions, we directly evaluated the power to identify one important category of biological interactions: between enhancers and transcription start sites (tss). we used the enhancerpromoter connection map based on multi-tissue correlations between distal and promoter chromatin accessibility , augmented with results from multi-tissue correlations between chromatin accessibility and gene expression , retrieved from http://dnase.med.unc.edu/supplement/allgenecorrelations100000 .p2.txt.gz. we left fit-hi-c out in the comparison as it showed incomparable reproducibility with the other callers. supplementarydemonstrates the increased power of hmrf over afc with up to 11.3 more enhancer-tss interactions identified by hmrf, given the same number of peak regions called by two methods. in addition, supplementaryshows one particular example where the potential target gene ctsb of a gwas variant rs1600249 was missed by afc but captured by our method.peak calling from data generated by 3c-derived methods is a fundamental task for the identification of chromatin interactions in 3d space. however, model-based methods for this important task are still lacking. existing methods focus on the calibration of expected count frequency distribution under random collision, accounting for multiple biases behind 3c analysis including but not limited to density of restriction enzyme sites, mappability and gc content. we have found existing methods rather mature for the purpose of calibrating expected counts (with results robust to different methods used). establishing the expected count distribution is nevertheless a prerequisite, not peak calling itself. none of the existing methods consider the dependency underlying the peak status with statistical rigor. in this work, we propose a hmrf based bayesian method that explicitly models the dependency of the underlying peak pattern. the true peak pattern is unknown and can take different forms in the presence of dependency. we simplify the problem by assuming an ising distribution prior and learn the level of dependency from data in a bayesian framework. our extensive simulations indicate superior performance in terms of both the estimation of the extent of dependency and the statistical power to distinguish peaks from background, across a range of underlying dependency patterns. there are several aspects where the model can be further elaborated. first, our model has one h, one w and one /, thus assuming that peaks are of similar strength and clustering patterns, and that reads have similar levels of over-dispersion. while the first two are simplifying assumptions bypassing issues including model selection difficulty and parameter non-identifiability, the last has been shown to be reasonable . sensitivity analysis with the imr90 combined dataset suggests these assumptions are reasonable: splitting each domain into two equal sub-domains resulted in highly consistent peak calls (spearman correlation 0.9, detailed in supplementary material section 4). second, we use a one-parameter ising prior, with the parameter controlling both the peak proportion and level of dependency. a two-parameter ising prior would allow more flexibility, particularly when the underlying dependency is weak. third, our method could allow incorporation of prior knowledge, when available, into the model. for instance, a hyper prior could be imposed on the inverse temperature parameter based on estimated distribution from similar existing datasets. finally, the computational complexity of our bayesian modeling is quadratic in terms of the number of fragments under consideration. our java implementation takes $13 minutes for a typical domain with 200 fragments and with parallel computing, genome-wide analysis can be easily accomplished within a few hours. in contrast, fit-hi-c and our r implementation of afc take $4 seconds and $12 minutes, respectively. therefore, for future work, computationally more efficient algorithms warrant consideration. we attempted to apply the iterative conditional mode algorithm , but observed unsatisfactory performance with weak peak signals (data not shown). despite these possible further model improvements, our method has demonstrated favorable performance over existing methods by borrowing information from neighboring fragment pairs via statistically modeling the potential dependency among the underlying peaks using a bayesian framework. our extensive simulation studies (supplementary material section 2) show the advantage of our method across a range of dependency patterns and its ability to learn the level of dependency (as modeled by the inverse temperature parameter) from data. both are valuable since we have limited, if any, prior knowledge regarding the extent of dependency in real data. re-analysis of several published hi-c datasets including the imr90, h1-hesc and mesc data confirmed the value of dependency modeling as taking dependency into consideration resulted in better concordance (40 improvement as measured by jaccard index of peak sets across two imr90 datasets) and lower false positive, false discovery rates and higher recovery rate. our method is the first to model dependency in a statistically rigorous manner and to borrowinformation from neighboring fragment pairs through a probabilistic model, was able to call up to 11.3 more enhancer-tss interactions than the ad hoc method given the same number of peak regions called. we acknowledge that there is currently no genomewide gold standard for real data (for example, from large scale genome-wide imaging-based experiments). we therefore made special efforts to benchmark the methods across multiple datasets and for each dataset, against the most reasonable silver standard. for example, for the imr90 cell lines, we compared against results from the combined dataset with the highest sequencing depth, for h1 hesc and mesc, we used results from independent technologies (5c and chia-pet, respectively). with the continuing drop in sequencing costs and the intensive interest in chromatin structure as a way to understand gwas results, we anticipate in the near future more high-resolution (fragment-level) hi-c data where our method have demonstrated key advantage given the non-negligible dependency structure.  
