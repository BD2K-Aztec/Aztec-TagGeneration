structural bioinformatics fast alignment and comparison of rna structures motivation: to recognize remote relationships between rna molecules, one must be able to align structures without regard to sequence similarity. we have implemented a method, which is swift [o(n 2)], sensitive and tolerant of large gaps and insertions. molecules are broken into overlapping fragments, which are characterized by their memberships in a probabilistic classification based on local geometry and h-bonding descriptors. this leads to a probabilistic similarity measure that is used in a conventional dynamic programming method. results: examples are given of database searching, the detection of structural similarities, which would not be found using sequence based methods, and comparisons with a previously published approach. availability and implementation: source code (c and perl) and bin-aries for linux are freely available at www.zbh.uni-hamburg.de/rna has diverse roles ranging from ligand binding/recognition to catalysis. these functions depend not just on sequence, but more on how a molecule positions groups in space (;). this means that if one wants to detect functional similarity, one must be able to align molecules structurally. we present a method for rna-structure alignment, which seems to be sensitive, reliable and with a running time comparable with sequence alignment techniques. one could also claim that in evolutionary terms, structure is more conserved than sequence; therefore, structural searches and alignments will find relationships that would be missed at the sequence level . if one allows for gaps and insertions, the problem of structurally aligning two biopolymers is np-complete . there is, however, an abundance of methods developed for proteins using various approximations that usually provide reasonable results (;). typically, these methods rely on some structural property specific to proteins. for example, most proteins can be reasonably characterized by their classic secondary structure elements or their sequence of backbone , angles or a contact map based on c atoms. in the case of rna, there is far less prior art, presumably because it is harder to describe, and there is little consensus as to what constitutes a characteristic structural motif. in proteins, common structures are rather well described by neglecting the backbone ! dihedral angle and considering , , perhaps with additional hydrogen bond information. in rna, one could consider six backbone angles (,and perhaps the dihedral angle, which captures the orientation of the base. at the same time, not all these descriptors are necessary, as some of the angles are significantly correlated . duarte and pyle took advantage of this fact and pointed out that it may be more effective to define dihedral angles based on atoms such as c4 0 and p atoms from successive bases even though they are not covalently connected . using these angles as descriptors, they defined 10 structural motifs with which they were able to reconstruct known rna structures with surprisingly high accuracy. these descriptors also seemed to be sufficient for finding motifs in collections of known structures . although there are methods for aligning rna based on secondary structures , there is a distinct paucity of methods that use 3d properties. the approach implemented in arts uses the coordinates of phosphorus atoms and attempts to find and extend sets of atom pairs, which can be superimposed below some threshold . the alignment calculation relies on the recognition of secondary structure elements. this means the method implicitly has some thresholds, but it has the advantage that the procedure is apparently fast enough to be used for searches of a structure against a database of known structures. another approach is to label sites with some structural property or combined sequence/structure property. sites from different molecules can be compared with each other giving a score, which can be used in a conventional dynamic programming algorithm. dial uses this approach and bases its score on sequence, nine dihedral angles and a measure to whom correspondence should be addressed. of base pairing . sarsa, by, used four dihedral angles to define a small structural alphabet. this approach was revisited in iparts , with a similar structural alphabet limited to the pseudotorsion angles and as defined by duarte and pyle (1998). sara follows an approach inspired by the mammoth programme for protein structure alignment . the most recent approach, setter, divides rna structures into non-overlapping secondary structure elements . all of these methods are sensitive to the geometry of specific sites rather than larger pieces of structure. in this work, we have adapted a method from the protein literature, but one with little preconception as to what constitutes a structural motif . instead, one says that a structure is built from overlapping fragments of some length (k 5 in this work). each fragment is described by a set of structural descriptors (angles, distances and a measure of likelihood to be in a base pair). a large set of fragments from the protein data bank (pdb) was then subjected to a maximally parsimonious bayesian classification yielding $10 2 classes. to use this for alignments, one can take a fragment from a new molecule and calculate the probability that it is in class 1, 2,.. ., n class. this vector of probabilities can be seen as a structural label for the site, but more importantly, the dot product of two such vectors is a direct measure of their similarity. these dot products can be used directly in a score matrix for a dynamic programming algorithm. the similarity measure is a continuous property ranging from 0 to 1; therefore, no thresholds are necessary. calculating an optimal alignment has o(n 2 ) running time albeit with a larger pre-factor than in sequence alignments. as we show below, the method seems to produce rather high quality alignments.before considering structural alignments, one can look at a few properties of the underlying fragment classification. this had 79 classes, although the largest 10 classes covered just 425 of the data. the relative importance of the classes varied from 3 down to 50.1 of the original data. as one would expect, the most populated classes reflect common rna motifs. for example, the first two classes have similar helical structures (and b), and, within statistical uncertainty, they are geometrically indistinguishable. they do however differ in the property, which cannot be seen in the diagram. the second class is distinguished by a much higher probability of being involved in h-bonds. the next most populated class also shows a common motif: a hoogsteen pair in which a base pairs with two other bases . given the machinery for comparison, we began with an all against all comparison within the set of 2250 chains from the pdb. for each structure, the alignments were sorted according to rmsd. the runtime for a pairwise comparison varied from less than a second to $40 minutes. the runtime for a typical alignment [two transfer rnas (trna) of $70 bases]) was $5 seconds. the most time-consuming examples were naturally those between two ribosomal structures of several thousand nucleotides. the biggest part of the computation time went into computing the h-bond terms. the times reflect a typical pc (intel dual core 3.06 ghz processor). this number of comparisons produced a mass of data, but we can show some interesting examples. the most important application is finding homology, which would not be detected using sequence-based methods. in the case of proteins, there are empirical studies showing the significance of the degree of sequence identity. for proteins of 100 residues, one would require 2530 sequence identity before regarding a pair of sequences as related . for nucleotides, the value must be higher owing to the smaller alphabet. as an example of a structure pair,shows the structural alignment of 2det chain c and 1i9v . there is only 32 sequence identity, but the rmsd difference is only 4.9 a calculated over the aligned 70 bases.shows the best global sequence alignment of the corresponding sequences. a superposition based on this alignment has an rmsd of 15 a . essentially, the correct alignment, based on fries structural alignment, is completely missed with a sequence-based method. it was also impossible to find this alignment with blast, as the word size cannot be set less than four . one can also find examples to show that the method can find small structures, which are similar to parts of larger ones.shows the example of chain 1p5m and 1p5p with an rmsd of 4.7 a 455 aligned residues. in this). and , the angles used as descriptors, are also labelledcase, the sequence identity is 87, but a sequence-based method will only find the alignment if gap penalties are set low enough to allow a gap of 21 residues as shown in the corresponding sequence alignment . in this work, one set of gap penalties was used for all calculations. a more targeted application is a classic structure search. given some query rna structure, can one find related structures, regardless of sequence homology? perhaps the clearest example comes from using a trna because this has been the most frequently solved structural family. the results are summarized in. the trna used as the query structure was 1tra, and for each alignment, one has the alignment length, sequence identity (from the structural alignment) and rmsd. alignments fall into two separate sets (or clouds): in the lower part of the plot are unrelated rna structures, and the increasing deviation of the cloud reflects the way rmsd values grow with optimal alignments of randomly chosen molecules. in the upper part of the plot, there is a clear cluster of alignments with a minimum length of $68 bases and rmsd values ranging from 0 to 10 a (10 a was the cut-off value used for finding matches). this cluster comprises related trna molecules and even includes trna chains buried within larger ribosome structures. it also includes examples such as the alignment of 1tra to 1wz2 chain d, which is an alignment of a phenylalanine-trna and a leucyl-trna (see). this alignment would also not be found by classical sequence alignment methods and had a sequence identity of only 48. there is often no such thing as a correct structural alignment , but one can make some comparisons between different methods. amongst the published methods, only lajolla could be locally installed for comparison. an all against all comparison was attempted. for each alignment, the rmsd and alignment lengthgenerated by fries and the corresponding values generated by lajolla were compared and are shown inf. we tested lajolla on three different sets, the first one comprising all possible alignments of structures between 60 and 80 nucleotides (i.e. trnas, see). the second and third sets were not limited to a certain size, but to all possible alignments for a sequence identity of 50 and rmsd 55 a in fries (and d) and with an rmsd of 2 a with fries . several features are clear. first, lajolla caps rmsd values at 2 a (calculated using its selection of atoms); thus, many alignments found by fries would not be seen with lajolla. second, lajolla did not return any results for structures larger than 1000 nucleotides. the plots further show that, given the capping, lajolla generally produces alignments with a smaller rmsd (9 a, c). however, for all alignments, the number of aligned nucleotides was significantly higher for alignments from fries (9 b, d, f). we also ran a test taking into account only alignments with rmsd values of 2 a in fries. this showed that fries could produce alignments with better rmsd values than lajolla, but with a significantly larger number of aligned nucleotides. higher rmsd values are obviously acceptable when they reflect longer and more meaningful alignments. finally, some programs offer web interfaces; thus, it is possible to show some comparisons with arts , sara and sarsa . for the alignment of 2det chain c and 1i9v, arts provided an alignment that comprised only 52 residues (in comparison with 68 residues for fries) but had a smaller rmsd of 1.9 a . the distinctive features of arts can explain this difference; its alignment method is exclusively based on the comparison of coordinates of phosphate atoms, and no further backbone information is taken into account. combined with the use of a distance matching error, this can lead to entirely different(b), alignments with an rmsd below 5 a and a sequence identity of 550 in (c) and (d), and alignments with an rmsd below 2 a in both fries and lajolla in (e) and (f). alignment of pdb files 1tra, chain a and 1wz2, chain d corresponding to the outlier in. database search for pdb id 1tra. the upper group is a set of alignments, which includes all trnas in the pdb. the structural superposition corresponding to the circled alignment is shown instructural alignments. furthermore, owing to the lack of an option to choose between local and global alignments in arts, it was not possible to reproduce our alignment. arts will always find a local alignment with a much better rmsd value instead of our global one. the results for sarsa are similar with an alignment showing many gaps. the alignment obtained by sara also contains gaps; however, these are located mainly in the anticodon region of both trnas. given the fact that 1i9v describes a phenylalanine-trna and 2det contains a glutamine-trna, they are most likely to differ in this area. using 2det chain c as query for the database search of arts, 1i9v will not be found at all. this is caused by the nature of the dataset used for database searches in arts, which consists of only 250 representative rna structures. this obviously improves the computation time but misses many results. sarsa offers no database search. the alignment of 1tra and 1wz2 chain d gave similar results. here, the alignments with sarsa and arts are slightly shorter with a correspondingly smaller rmsd value. the alignment from sara is similar to the one obtained from fries with two more gaps, which also results in a better rmsd value. some literature results are based on very few structures, but one can also compare against them. both setter and r3d align were compared on the basis of the alignment of two 16s rrna structures against arts, sara and dial.shows little difference between the results from fries and the other approaches. in addition to comparing fries against programmes using tertiary structure, we also compared it with two methods that compute alignments using only secondary structure. rnaforester hierarchically ordered multiple sequence alignments to generate alignments of rna secondary structure strings , and locarna uses a sankoff (1985) style alignment and folding. we compared the resulting alignments in terms of two properties:(i) the number of indels (insertions and deletions) in the resulting sequence alignment and (ii) the structural alignment implied by the secondary structure alignment. property (i) shows, that for the example of 1p5m and 1p5p, there is a big difference in the number of indels for rnaforester and locarna/fries . the alignment obtained from rnaforester contains 30 indels in 10 gaps , whereas the alignments of locarna and fries both show only 22 indels in two gaps . considering the implied structural alignments, the large differences between the alignment obtained from rnaforester and the ones from locarna and fries are even more apparent. the alignments from fries and locarna are of similar quality, with a slightly lower rmsd for locarna (3.1 a as compared with 4.7 a for fries). the rmsd for the alignment obtained from rnaforester is 13.4 a .because the structural alignment of biopolymers is fundamentally np complete , all methods use heuristics and approximations. the method in this work might be closest to those which rely on some kind of structural alphabet to label fragments. however, the method here is different in the type of labelling used. firstly, each site in the chain is influenced by all overlapping fragments. this means that each pair of aligned residues reflects a region of nine bases. next, the labels come from an unsupervised learning approach ; thus, there are few preconceptions as to what constitutes a structural element. this is a major difference compared with rna secondary-structure aligners (locarna, rnaforrester), which cannot take advantage of other common structural motifs. most importantly, the labels are not discrete as in a typical) or the much smaller alphabet (paired/unpaired) used by rna secondary-structure aligners. in this work, the product of the probability vectors] leads to a smooth measure of similarity; therefore, the method works when confronted with a completely new structural element. one should also note that the classification of fragments is certainly not optimal and need not be. it must only serve to provide a fingerprint for recognizing similarity. this can be seen by a simple numerical argument. imagine a class in the classification was incorrectly split into two classes, and a calculation is then faced with a fragment, which fits perfectly into this class. the calculated probability vector would have two entries with values of 0.5. when compared with a similar vector, the dot product would still be near 1.0. these might be technical aspects only relevant to this method, but there is a general technical problem with this kind of approach. ultimately, most methods are based on some choice of atoms and structural properties. the classic statistical mixture model used in this work does impose one important restriction. it must be possible to approximate the distributions of the descriptors by the sums of simple distributions. for example, the quasi-electrostatic score of equation (3) would not be a good model for physics, but it yields relatively well-separated sets for h-bonded and not h-bonded sites. similarly, the distances and angles used here fit better to gaussian distributions than examples from the literature . it is also worth noting that the choice of descriptors can have a large influence on the kind of alignments generated. most of the methods working with rna structures are dominated or begin with local structural properties. in contrast, our method included a contribution from h-bonding, which is a distinctly non-local property in terms of sequence. this means that equation (3) will yield a good score for local similarity, but there is a preference to align h-bonded sites with h-bonded sites and vice versa. one could also say that in an alignment calculation, one never requires a perfect match, and an optimal alignment may involve many less than optimal local matches. the underlying classification is entirely automatic and, although not perfect, a model for the most important features of rna structure (given a set of descriptors). one could, for example, interpret the most populated classes in structural terms. looking at, one would say that the single most common motif is a helix with well-described angles, but one can statistically justify splitting it into two classes based on h-bonding probability. the third class is also similar but is characterized by one particular distance and a particular value at one site. the results in this work highlight the ability to find remote structural similarities, but the comparisons suffer from a typical problem. it is often difficult to claim one alignment is better than another. method 1 may truncate alignments and return results with a small rmsd value (structural similarity), whereas method 2 returns longer alignments, which will appear to have a larger rmsd value. it is completely arbitrary which method one prefers. the results do, however, suggest that our proposal often finds rather long alignments without a great cost in rmsd values. this is also related to a second problem. when searching a database for related structures, there are several reasonable ways to rank the hits. a navenave structural measure such as rmsd will certainly retrieve similar structures, but these will penalize longer and more interesting alignments. one can invent similarity measures based on multiple factors, although these will entail decisions as to the importance of different properties. when comparing methods, one can also see some differences in principle. if a method tries to optimize rmsd values, it will be sensitive to hinge movements within structures. in our approach, rmsd values are only calculated for comparisons. this means that the results are tolerant of hinge movements and, in particular, one has no problem with alignments in large structures such as ribosomes. to make comparison with literature methods easiest, the results here were based on smith and waterman (1981) style alignments, which emphasize core regions of similarity. should one want to force globally optimal alignments, it is only a switch to choose needleman and wunsch (1970) style alignments. if one is interested in extending the method, there are a number of possibilities. the classification used here was based on fragments of length k 5. it is possible that one would capture more structural information with longer fragments, but the classification time does become prohibitively expensive. one should, in principle update the classification, as more structures become available. this can do no harm but will only make a difference with exotic and uncommon pieces of structure. at the moment, the largest 25 classes account for most of the probability density. if one doubled the amount of data, this would lead to a slightly better statistical model for the less commonly seen fragments. one could also say that the dataset used for the classification is biased. it includes too many trna structures because there are. superposition of 1p5m and 1p5p based on alignment generated by rnaforester, rmsd of 13.4 a (a) and locarna, rmsd of 3.1 a (b). the structure alignment obtained from fries is shown inso many structures in the pdb. it includes too many bases from ribosomes because ribosome structures are so large. if one removed these biases, it would change the prior probabilities associated with each class and yield a classification that was in some chemical sense better. it would not make a great deal of difference in this application where the aim is simply to apply unique labels to structural fragments. a more interesting extension would be to combine sequence and structure information. statistically, this means one uses a multi-way bernoulli description for the probability of base types at each site. this is technically possible and has been tested on proteins , but it does raise a question that is difficult to answer. one is usually dealing with cases where sequence similarity is so small, that one has to use structural alignments. in this regime, it is not clear as to whether adding sequence information adds more noise or more information. finally, one must make the obvious concession. structurebased alignments can only complement sequence-based methods, as they can only be applied to the fraction of rnas for which a structure has been determined. the method presented here seems to be swift, sensitive to remote similarities and capable of producing accurate structural alignments of rna structures. the code is available for download and should prove useful as more rna structures enter the databases and one is interested in remote relationships. conflict of interest: none declared.  
