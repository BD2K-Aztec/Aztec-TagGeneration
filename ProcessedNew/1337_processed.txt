gene expression destiny: diffusion maps for large-scale single-cell data in r diffusion maps are a spectral method for non-linear dimension reduction and have recently been adapted for the visualization of single-cell expression data. here we present destiny, an efficient r implementation of the diffusion map algorithm. our package includes a single-cell specific noise model allowing for missing and censored values. in contrast to previous implementations , we further present an efficient nearest-neighbour approximation that allows for the processing of hundreds of thousands of cells and a functionality for projecting new data on existing diffusion maps. we exemplarily apply destiny to a recent time-resolved mass cytometry dataset of cellular reprogramming. availability and implementation: destiny is an open-source r/bioconductor package bioconductor.org/packages/destiny also available at www.helmholtz-muenchen.de/icb/destiny. a detailed vignette describing functions and workflows is provided with the package.recent technological advances allow for the profiling of individual cells, using methods such as single-cell rna-seq, single-cell rt qpcr or cytof . these techniques have been used successfully to study stem cell differentiation with timeresolved single-cell experiments, where individual cells are collected at different absolute times within the differentiation process and profiled. while differentiation is a smooth but nonlinear process involving continuous changes of the overall transcriptional state, standard methods for visualizing such data are either based on linear methods such as principal component analysis (see supplementary) and independent components analysis or they use clustering techniques not accounting for the smooth nature of the data. in contrast, diffusion mapsinitially designed byfor dimensionality reduction in image processingrecover a distance measure between each pair of data points (cells) in a low dimensional space that is based on the transition probability from one cell to the other through several paths of a random walk. diffusion maps are especially suited for analysing single-cell gene expression data from differentiation experiments (such as time-course experiments) for three reasons. first, they preserve the global relations between data points. this feature makes it possible to reconstruct developmental traces by re-ordering the asynchronously differentiating cells according to their internal differentiation state. second, the notion of diffusion distance is robust to noise, which is ubiquitous in single-cell data. third, by normalizing for sampling density, diffusion maps become insensitive to the distribution of the data points(i.e. sampling density), which aids the detection of rare cell populations. here, we present a user friendly r implementation of diffusion maps including previously proposed adaptations to single cell data as well as novel functionality. the latter includes approximations allowing for the visualization of large data sets and the projection of new data on existing maps.we applied destiny to four single-cell datasets of different size (hundreds to hundreds of thousands of cells) and characteristics (qrtpcr, rna-seq and mass cytometry, see supplementary). we first estimate the optimal r that matches the intrinsic dimensionality of the data (and supplementary figs s3a and s4a). using a scree plot (and supplementary figs s3b, s4b and s5a), the relevant diffusion components can be identified. however, for big datasets as the mass cytometry data fromwith 256 000 cells and 36 markers, corresponding eigenvalues decrease smoothly. although only a part of the intrinsic dimensionality can be represented in a 3d plot, the diffusion map reveals interesting properties of the reprogramming dynamics (and supplementary). we compared destinys performance to other implementations, including our own in matlab (based on maggioni code (http://www.math.duke.edu/mauro/code.html), published with) and the diffusionmap r package . destiny performs similarly well for small datasets, while outperforming other implementations for large datasets (supplementary).  
