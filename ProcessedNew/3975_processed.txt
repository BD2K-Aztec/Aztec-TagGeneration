repgenhmm: a dynamic programming tool to infer the rules of immune receptor generation from sequence data motivation: the diversity of the immune repertoire is initially generated by random rearrangements of the receptor gene during early t and b cell development. rearrangement scenarios are composed of random eventschoices of gene templates, base pair deletions and insertions described by probability distributions. not all scenarios are equally likely, and the same receptor sequence may be obtained in several different ways. quantifying the distribution of these rearrangements is an essential baseline for studying the immune system diversity. inferring the properties of the distributions from receptor sequences is a computationally hard problem, requiring enumerating every possible scenario for every sampled receptor sequence. results: we present a hidden markov model, which accounts for all plausible scenarios that can generate the receptor sequences. we developed and implemented a method based on the baumwelch algorithm that can efficiently infer the parameters for the different events of the rearrangement process. we tested our software tool on sequence data for both the alpha and beta chains of the t cell receptor. to test the validity of our algorithm, we also generated synthetic sequences produced by a known model, and confirmed that its parameters could be accurately inferred back from the sequences. the inferred model can be used to generate synthetic sequences, to calculate the probability of generation of any receptor sequence, as well as the theoretical diversity of the repertoire. we estimate this diversity to be 10 23 for human t cells. the model gives a baseline to investigate the selection and dynamics of immune repertoires. availability and implementation: source code and sample sequence files are available at https://bit bucket.org/yuvalel/repgenhmm/downloads.the ability of the adaptive immune system to identify a wide range of threats rests upon the diversity of its lymphocyte receptors, which together make up the immune repertoire. each such receptor can bind specifically to antigenic molecules, and initiate an immune response against the threat. t cell receptors (tcr) are composed of two protein chains, called alpha and beta. b cell receptors (bcr) share a very similar structure, with a light chain and heavy chain playing the same role. each chain is produced according to the same process of v(d)j rearrangement. in each new cell and for each of the two chains, two germline segments for alpha chains (va and ja genes), or three segments for beta chains (vb, db and jb genes), are assembled together to form the recombined gene coding for the chain. in addition, at the junctions where the segments are joined, the ends of the segments are trimmed, and random nucleotides are inserted (seefor a diagram describing the alpha chain rearrangement process). this process creates a large initial diversity of possible receptors, which are later selected according to their recognition functionality. an important property of this process is that it is redundant, as many different v(d)j rearrangements may lead to the exact same sequence. it is thus impossible to unambiguously reconstruct the scenario from the sequence alone, a problem that is aggravated by sequencing errors. the rearrangement process is random, as is each of the elements composing itchoice of germline segments, number of deleted nucleotides, number and identity of insertions. since the rearrangement process is the basis of repertoire diversity, it is important to study its distribution quantitatively. with recent advances in high throughput sequencing, there is a growing body of data on repertoires for both t and b cells, in a variety of situations . using large sequence datasets of rearranged, non-productive genes, the probability distribution of rearrangement events in human tcr beta chain and bcr heavy chains could be inferred using statistical methods, gaining important insights into the random processes underlying repertoire diversity . however, these studies are based on a brute force approach, which enumerates every possible rearrangement scenario for each observed sequence. this is a very computationally costly procedure, which is unrealistic for very large datasets. in this report we present a dynamic programming approach to learn the distribution of rearrangement scenarios from large numbers of non-productive sequences in an efficient way. this approach is based on a hidden markov models (hmm) formulation of the problem, and learns its parameters using a modified baumwelch (bw) algorithm to avoid the full enumerations of all scenarios. many studies have described algorithms designed to process or postprocess large numbers of rearranged tcr or bcr genes and extract the template v(d)j genes of the rearrangement . these tools process each sequence separately to obtain the best (but often incorrect) alignment to a v(d)j combination, sometimes using dynamic programming or hmm , and assume an implicit, ad hoc prior on rearrangements. by contrast, our algorithm explores all plausible alignments for each sequence from data to learn accurately the distribution of rearrangement events. once the model of rearrangement has been learned by our procedure, the entire distribution of possible sequences and their probabilities is accessible. our algorithm can calculate the probability of any sampled sequence, even if it is not part of the data used to learn the model, and it can generate arbitrary numbers of synthetic sequences with the exact same statistics as the data. such large samples can be used to investigate the origin of shared sequences, or public repertoires, between different individuals. the procedure can also calculate the entropy of the rearrangement processa classical measure of sequence diversity. this enables us to further our understanding of the generation process, quantify the baseline state of the immune system and evaluate subsequent processes such as somatic selection. finally, our work produces insights not just on the data sequences, but on the underlying biological processes.the strength of the adaptive immune system lies in its inherent diversity. this dynamic diversity is the result of several stochastic biological mechanisms, including complex enzymatic reactions that alter the dna structure and composition. the action of some of the enzymes such as rag and tdt have been studied extensively (seefor reviews). in our work we have studied the way in which the diversity is generated in a top down approach, focusing on statistical properties as inferred from sequenced receptor genes. in principle, this is a computationally difficult problem, due to the very large number of possible rearrangement scenarios.. tcr beta chain rearrangement distribution inferred from sequence data previously analyzed in . (a) distribution of the number of insertions at both vd and dj junctions, and comparison with the distribution of insertion in the alpha chain from. inset: the nucleotide usage is identical for vd and dj insertions when considered on opposite strands. (b) distribution of the number of deletions on both the v and j genes, averaged over different genes. performance of the algorithm on synthetic data. sequences generated using a known model were given as an input to the inference algorithm. the results of the inference are compared to the true model used for generation, for (a) the distribution of the number of insertions (inset: usage of inserted nucleotides) and (b) v, j gene usage. the error bars, which correspond to sample noise, are smaller than symbol size for (a). in (a) we also report the distribution of insertions obtained using mixcr repgenhmm  
