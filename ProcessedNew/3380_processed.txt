sequence analysis optitype: precision hla typing from next-generation sequencing data motivation: the human leukocyte antigen (hla) gene cluster plays a crucial role in adaptive immunity and is thus relevant in many bio-medical applications. while next-generation sequencing data are often available for a patient, deducing the hla genotype is difficult because of substantial sequence similarity within the cluster and exceptionally high variability of the loci. established approaches, therefore, rely on specific hla enrichment and sequencing techniques, coming at an additional cost and extra turnaround time. result: we present optitype, a novel hla genotyping algorithm based on integer linear programming, capable of producing accurate predictions from ngs data not specifically enriched for the hla cluster. we also present a comprehensive benchmark dataset consisting of rna, exome and whole-genome sequencing data. optitype significantly outperformed previously published in silico approaches with an overall accuracy of 97 enabling its use in a broad range of applications.the human leukocyte antigen (hla) cluster located on chromosome 6 is one of the most polymorphic regions of the human genome and encodes for several genes involved in functions of the immune system, including hla classes i and ii. both hla classes comprise three major loci (hla-i: a, b, c; hla-ii: dp, dq, dr), which are co-dominantly expressed. hla-i/ii molecules present intracellular and extracellular peptides, respectively, and interact with other immune cells to induce an adaptive immune response. thus, hla-i/ii molecules play an important role in many medical areas, such as vaccinology , regenerative and transplantation medicine and autoimmune diseases . over 7300 different hla-i and 2200 hla-ii alleles are known to date [imgt/hla release 3.14.0, july 2013 (. in addition to this vast allelic variation, hla alleles display a high degree of sequence similarity even across different loci, which drastically increases the complexity of uniquely identifying a genotype using short-read sequencing techniques. established hla typing approaches make use of labor-intensive and time-consuming probing techniques, such as sequence-specific oligonucleotide probe hybridization, pcr amplification with sequence specific primers or serotyping techniques, which often lead to ambiguous genotyping results . hla typing can be done with different degrees of resolution, with two-digit and four-digit types distinguishing hla allele families and distinct hla protein sequences, respectively.demonstrated the use of targeted next-generation sequencing (ngs) for hla typing to overcome the problems mentioned above. several new protocols have recently been established based on ngs technologies . these methods are still accompanied by labor-intensive preparations and remain time consuming. more recently,published an automated protocol based on gs 454 junior sequencing allowing a high-resolution typing with a turnaround time of 2 days. to reduce time and cost expense even further, in silico approaches have been developed. in 2011, erlich et al. published an approach based on posterior probability of allele pairs and integrated it into a 454 gs flx titanium sequencing pipeline . common to the above approaches is the dedicated generation of ngs data for the sole purpose of hla typing. routine sequencing of patient exomes or whole genomes has been established in many larger clinical centers, and it should be possible to determine the hla type from these data through purely computational means. using existing data can save both money and time; however, because of the high variability of the hla loci, the typical read mapping and variant calling-based analysis of ngs data is not suitable to determine the hla genotype.proposed an algorithm (hlaminer) based on allele-specific scoring for whole genome, exome and to whom correspondence should be addressed. y the authors wish it to be known that, in their opinion, the first three authors should be regarded as joint first authors. the author 2014. published by oxford university press. this is an open access article distributed under the terms of the creative commons attribution non-commercial license (http://creativecommons.org/licenses/ by-nc/4.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. for commercial re-use, please contact journals.permissions@oup.com transcriptome sequencing to solve this problem. it assembles reads de novo and aligns the resulting contigs against an hla reference database. a score for each hla allele is then calculated based on properties of the aligned contigs, and the highest scoring alleles for each locus are selected. in 2013, boegel et al. suggested a greedy algorithm (seq2hla) based on read count maximization for rna-seq data . after read mapping, in an initial round, the algorithm determines the allele with the highest number of mapped reads for each locus individually. after discarding the selected alleles and already assigned reads, second alleles are selected accordingly. athlates, published by, uses an hla reference database to filter for relevant reads, which are used for contig construction. the reference hla sequences are decomposed into exons, and the best mapping contig for each exon is determined. for one hla locus at a time, each allele is scored based on its overall hamming distance to all aligned exons. a candidate allele list is generated by applying different filtering criteria. using this candidate list, the most probable hla allele pairs per locus are determined based on the minimal hamming distance to the variable positions of each exon. one of the most recent approaches, published by kim et al., uses a tree-based top-down greedy algorithm (hlaforest) to predict the hla genotypes based on rna-seq data . the algorithm generates an hla alignment tree for each read based on the mapping results against an hla reference database whose leaf nodes indicate four-digit alleles and inner nodes represent allele families to which the read could be mapped. then, alignment probabilities and node weights are distributed in the trees. based on the sum of weights of all trees, the highest scoring allele family is selected. after reweighting the nodes based on the selected allele family, the four-digit hla allele is selected similarly. a different approach byapplies various filtering criteria and optimizes coverage depth and base coverage. the first filter criterion enforces certain sequence coverage of exons 2 and 3 of the hla alleles, as these exons are the most polymorphic regions that also encode for the binding core of the hla molecule. additionally, reads are filtered based on mismatches and alignment orientation of the paired reads. subsequently, alleles are sorted and filtered based on their coverage depth and sequence coverage of their alignment. finally, allele pairs are selected such that coverage depth and sequence coverage are optimized. yet, these methods do not yield sufficiently accurate predictions, especially in terms of clinical usability. boegel et al.s approach is capable of only two-digit genotyping; kim et al. and warren et al. could achieve only 8590 correctly predicted four-digit hla genotypes on rna-seq data, and for shortread rna-seq and whole-genome sequencing (wgs) data, the accuracy was even lower. major et al. could accomplish an accuracy of 94 on exome sequencing samples that fulfilled all their filtering criteria, but out of the 217 samples they have considered, only 161 could be fully typed. a possible cause for low typing accuracy in the aforementioned approaches might be the independent consideration of each locus. sequence homology between loci can lead to ambiguous read alignments where reads map to alleles of multiple loci equally well. another reason for suboptimal with its closest neighbor with respect to sequence similarity from among the complete allele sequences. the procedure, therefore, attempts to reconstruct partial allele sequences based on their closest phylogenetic relatives with known intron sequences, using the fact that intronic variability in hla is characterized by highly systematic mutations reflecting the ancestral lineage of the alleles . sequence similarity values were obtained from full distance matrices computed with clustal omega 1.2.0 . partial alleles were partitioned into sets according to their exons with known sequences to ensure sequence similarity calculation using maximal sequence information available. all complete alleles were added to every set, followed by computing distance matrices between set members concatenated exon sequences. partial alleles have shown to have 1.66 (ae 1.04) nearest neighbors with unique intron sequences on average. sequences of partial alleles with multiple nearest neighbors were reconstructed with each of the nearest neighbors, resulting in 10 779 reconstructed sequences for 6489 partial alleles. the quality of sequence reconstruction was validated in a leave-oneout fashion. introns 1, 2 and 3 for each of the fully sequenced alleles were discarded and reconstructed using the remaining alleles, considering only exon 2 and 3 sequences for nearest neighbor identification. the reconstructed intron sequences were compared with their original counterparts and showed a sequence similarity of 99.89 (ae 0.43), corresponding to an average 1.2 edit distance error on the three introns combined. for comparison, sequence similarity between introns of the same loci was found to be 97.36 (ae 2.15), corresponding to 29 nt differences on average. the used reference sequences can be found in the supplementary material (s12).hla typing with four-digit-level accuracy is essential for clinical applications like the development of individualized patientspecific vaccines and transplantation. therefore, optitype has been optimized to yield correct hla typing results on four-digit resolution (i.e. on the protein-coding level) for distinct read lengths and different types of sequencing technologies. performance of optitype has been evaluated on exome sequencing, wgs and rna-seq data.  
