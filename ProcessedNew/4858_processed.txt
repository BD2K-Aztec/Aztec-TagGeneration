genetics and population analysis viquas: an improved reconstruction pipeline for viral quasispecies spectra generated by next-generation sequencing motivation: the combined effect of a high replication rate and the low fidelity of the viral polymer-ase in most rna viruses and some dna viruses results in the formation of a viral quasispecies. uncovering information about quasispecies populations significantly benefits the study of disease progression, antiviral drug design, vaccine design and viral pathogenesis. we present a new analysis pipeline called viquas for viral quasispecies spectrum reconstruction using short next-generation sequencing reads. viquas is based on a novel reference-assisted de novo assembly algorithm for constructing local haplotypes. a significantly extended version of an existing global strain reconstruction algorithm is also used. results: benchmarking results showed that viquas outperformed three other previously published methods named shorah, qure and predicthaplo, with improvements of at least 3.153.9 in recall , 012.1 in precision and 038.2 in f-score in terms of strain sequence assembly and improvements of at least 0.0060.143 in kl-divergence and 0.0010.035 in root mean-squared error in terms of strain frequency estimation, over the next-best algorithm under various simulation settings. we also applied viquas on a real read set derived from an in vitro human immunodeficiency virus (hiv)-1 population, two independent datasets of foot-and-mouth-disease virus derived from the same biological sample and a real hiv-1 dataset and demonstrated better results than other methods available. availability and implementation: http://sourceforge.net/projects/viquas/inside an infected host, most rna viruses such as human immunodeficiency virus (hiv), hepatitis c, foot-and-mouth-disease virus (fmdv) and some dna viruses like hepatitis b exhibit very high replication rates . the low fidelity of the proof-reading function of the viral polymerase coupled with this high replication rate results in the formation of a viralquasispecies population. more specifically, a quasispecies is a set of genetically related but non-identical viral mutant types (which can also be referred to as strains) that are able to co-exist within the host . as anti-viral vaccines and drugs make use of the knowledge on various stages of the host-viral interaction process and viral replication process , the presence of different viral strains in the population affects the natural host-immune response as well as the antiviral drug therapy . therefore, information about these strains, or quasispecies spectra, is of critical importance to antiviral drug design and vaccine design. in particular, such information would enhance research into viral evolution, disease progression and provide insights into the biology and pathogenesis of viruses . during the analysis of quasispecies, identifying the co-occurrence of nucleotide level mutations is as important as identifying individual mutations. as such, there are two main challenges in this analysis: assembling nucleotide sequences of each individual strain to identify co-occurring mutations and to estimate the relative frequency of each strain within the quasispecies. collectively, these two challenges constitute quasispecies spectrum reconstruction (qsr). the most similar problem to qsr is the metagenomic binning problem as applied to bacterial metagenomes , butemphasizes the inability of binning methods based on sequence similarity and sequence composition to discriminate between strains of the same species due to high nucleotide compositional similarity. single-genome de novo assembly is another similar problem to qsr . these algorithms are optimized to overcome technical sequence errors assuming the existence of a single species in the sequenced sample . hence given a metagenomic dataset as input, most assemblers work towards generating a single assembly of reads misinterpreting genetic variability as potential technical sequencing errors. one of the earliest methods for viral population estimation using next-generation sequencing (ngs) was proposed in. it uses a multiple read alignment and clustering strategy for read error correction, a combinatorial algorithm for strain reconstruction and a statistical model-based expectation-maximization strategy for strain frequency estimation. the method formulated in, named shorah, extends the method ofand uses a bayesian inference algorithm for read error correction and a probabilistic clustering algorithm for strain reconstruction . three other interesting approaches to solve the qsr problem are the combinatorial method proposed in, which was later published as a software named qure , the method proposed innamed vispa and the method proposed in) named predicthaplo. current methods that address the qsr problem rely on the fact that the ngs reads of a quasispecies sample can be assigned with a unique alignment position to a known reference genome or a consensus sequence. this has become possible due to the rarity of repeats in viral genomes . following read alignment, a typical quasispecies analysis pipeline consists of three major steps: (i) first, the genetic diversity is determined on either overlapping or non-overlapping local windows of the reference genome by clustering reads within each window together with strategies to eliminate or correct technical sequencing errors. this is also referred to as constructing local haplotypes. (ii) second, the global diversity is inferred by connecting the local haplotypes to form the nucleotide sequences spanning the entire genomic region of interest (i.e. strain reconstruction). (iii) third is the step of estimating the relative frequencies of the reconstructed strains. comprehensive reviews on different techniques used within these main steps of an analysis pipeline are found inand beerenwinkel and zagordi (2011). the most critical component within this pipeline is global diversity estimation, where previous studies have relied on one of two key concepts . the most popular strategy of inferring global diversity is based on graph-based methods, as has been implemented in. alternatively, the problem has also been approached using probabilistic clustering methods . less common, but a very useful third approach for quasispecies identification based on de novo assembly has been published in. even thoughdoes not address the qsr problem from strain assembly to frequency estimation, it provides an interesting initiation point for the total strain assembly problem using short ngs reads. we have further developed the idea of using a de novo assembly algorithms for quasispecies assembly in this work. an analysis of the effects of average read length, depth of coverage and technical sequencing errors on total strain reconstruction is presented in, and it highlights the fact that inferring quasispecies population diversity of larger genomic regions using short ngs reads remains a challenging problem. in this article, we present a new analysis pipeline named viquas for viral qsr using short ngs reads. our main focus is on inferring quasispecies spectrum within a certain genomic region of a viral sample using sequence reads that are several folds shorter in length compared with the region, in the presence of a moderate level of technical sequencing errors. the novelty of our method is 2-fold. (i) we propose a novel reference-assisted de novo assembly algorithm for defining local haplotypes. (ii) we propose a significant extension to the global reconstruction algorithm presented in, based on relative coverage depths and overlap agreement of local haplotypes. moreover, we present the first benchmark study of viquas and three other existing methods named shorah , qure and predicthaplo , on a broad spectrum of simulated data allowing for a thorough comparison of performance between the four methods. the correctness of the nucleotide sequences reconstructed is primarily evaluated based on the measures recall and precision. under different simulation conditions, the four methods used in the benchmark study outperformed each other in recall and precision without a particular pattern. hence, the geometric mean of recall and precision termed as f-score is used to measure the performance using a single measure. on the other hand, the accuracy of the estimated relative frequency distribution of the reconstructed strains is measured using kl-divergence and root mean-squared error. viquas outperformed shorah, qure and predicthaplo, demonstrating improvements of at least 3.153.9 in recall, 012.1 in precision and 038.2 in f-score in terms of strain sequence assembly and improvements of at least 0.0060.143 in kl-divergence and 0.0010.035 in root viquasmean-squared error over the next-best algorithm under various simulation settings.performance evaluation of qsr is 2-fold. the performance in terms of total strain reconstruction is evaluated based on the metrics recall, precision and f-score as defined below.the performance in terms of frequency estimation is evaluated based on kl-divergence and root mean-squared error between the input and output relative frequency distributions. we compared viquas with three other previously published software, named shorah , qure and predicthaplo , based on entirely simulated, psudo-real and real data. a noteworthy factor in performance comparison is the distinction between the objectives of the global spectrum reconstruction algorithms used by these three methods. shorah aims to output the most parsimonious set of strains that is consistent with a given set of reads , which in general produces a larger number of strains than the actual number of strains present in the population. this leads to a better chance of producing true strains, while also producing many false in silico recombinants. in contrast, qure, predicthaplo and viquas aim to output a selective set of strains that is likely to be totally covered by the given set of reads, minimizing the production of false in silico recombinants. our choice to consider only the number of theoretically reconstructible strains (n p ) as the expected number of strains in calculating recall (eq. 1) and to disregard the number of reconstructed strains having a relative frequency less than f min in calculating precision (eq. 2) provide practical and fair grounds to compare the performance in terms of the metrics recall, precision and f-score. also, in calculating kldivergence and root mean-squared error, we only considered the input and output strains with relative frequency values greater than f min. in sections 3.13.3, we validate viquas and benchmark it against shorah, qure and predicthaplo using the simulated datasets ss1ss11 using the metrics recall, precision, f-score, kldivergence and root mean-squared error. in section 3.4, we validate and benchmark the methods using average pair-wise alignment cost between the known and reconstructed haplotypes. finally, in sections 3.5 and 3.6, we compare the results of the four methods on real datasets. as a result of the fact that the exact nucleotide content of the strains and their relative frequencies are unknown in these real datasets, we have used other criteria as described under the respective subsections to evaluate the results.we present in this article, a novel method for qsr named viquas. the main novelty is the proposed reference-assisted de novo assembly algorithm constituted by the three consecutive steps de novo assembly, mutation calling and chimeric error correction. the greedy graph-based de novo assembly algorithm and the subsequent mutation loci-guided chimeric error correction algorithm provide viquas with a significant advantage over shorah, qure and predicthaplo when it is used to analyse short ngs reads. our method clearly outperformed shorah, qure and predicthaplo on the 6810 simulated datasets used in the benchmark study, demonstrating the capability of reconstructing quasispecies spectra using short ngs read samples (100 bp, 200 bp and 300 bp) with comparatively less susceptibility to the presence of sequencing errors and indels. given a viral genomic region of interest, the average read length of the ngs read sample and the diversity of the quasispecies population were identified as the two most critical factors affecting the performance of viquas, provided that the technical sequencing error rate is kept at a minimum level. it is evident that strain sequence assembly gets easier when the diversity of a quasispecies population becomes higher, provided that read data are available covering the whole genomic region of(lr 100 bp; e 0, both snps and indels are present in strains t p ; i; d, n total 30 000 and f min 1:4). l r is the mean read length (read length $ n lr; 25), e is the substitutional error probability of the reads, n total is the total number of reads and f min is the theoretically reconstructible minimum relative frequency. each point indicates mean value of the measureinterest. this pattern of performance was common to all four methods considered in our study. under all eight different simulation conditions, viquas gave the highest average recall values demonstrating the best total strain reconstruction capability. viquas and shorah performed at comparable levels in terms of strain frequency estimation, while clearly outperforming qure and predicthaplo. due to the unavailability of real datasets with known quasispecies populations, the best alternative for validating these methods under real world conditions was to use simulated datasets such as ss9ss11 that can be assumed to resemble such conditions. agreement between the performance patterns of entirely simulated data (ss1ss8) and data resembling real conditions (ss9ss11) further confirmed the enhanced performance of viquas over shorah, qure and predicthaplo. even though the correctness of the reconstructed strains cannot be evaluated due to the unavailability of exact nucleotide content of the strains in the real fmdv samples (err180978 and err180979) and real hiv-1 dataset v11909 , the consistency of results produced by viquas on real fmdv samples and the higher degree of biological validity of the strains reconstructed from real hiv-1 data by viquas indicate the applicability of viquas on real sequence data and better performance over shorah, qure and predicthaplo. in addition, simulated samples with illumina sequencing parameters further confirmed the superior performance of viquas. in this study, we performed a comprehensive comparison of performance between viquas, shorah, qure and predicthaplo in a broad range of diversity and n s values. because of the requirement of vispa to have the diversity of a sample as an input parameter, which is impractical for real data, and its poor performance under read lengths in the range of 100 bp and 200 bp, we did not use it in this study. another method found in literature named quasirecomb was also omitted from further analysis due to its poor performance even on ss2 (on which the other three method used in the analysis showed their best performance). two of the most significant observations of the comparison study are the drastic drop of performance of shorah and predicthaplo under the presence of indels [refer(e) and(h)] and of qure under a shorter (100 bp) read length [. on the contrary, viquas was much less susceptible against both indels and reduced read lengths. all four methods handled the sequencing error rate of 0.1 without a significant drop of performance. in particular, we observed a better performance of shorah and predicthaplo on ss9 in the presence of indels compared with their poor performance on ss7. this observation is due to the fact that some strains in ss9 do not have insertions (but snps and deletions), which are correctly reconstructed, while every strain in ss7 has both insertions and deletions. it was not evident that shorah and predicthaplo eliminates all insertion considering them as technical sequencing errors because some reconstructed strains in ss7 contain a few (but not all) correct insertions. this also explains the improved performance of shorah on ss10 and ss11 compared with qure (supplementary), as the 10 real hiv strains used in ss10 and ss11 does not have any mutations in the form of insertions. on the other hand, qure performed better than shorah and predicthaplo on ss9 (supplementary) where some of the simulated hbv strains contain insertions. the second significant factor is that shorah, qure and predicthaplo define local analysis windows a priori. these window boundaries restrict the growth of the read clusters along the nucleotide space of the region of interest. in contrast, viquas allows the contigs to extend as far as the reads provide information supporting the co-occurrence of mutations. this unrestricted growth of contigs becomes advantageous in the total strain reconstruction stage. in shorah, each of the paths in the cover of the read graph contains a number of nodes equal to the number of windows . in qure, the complexity of the global reconstruction algorithm is proportional to the number of windows . the window length is typically set equal to the average read length in both shorah and qure. hence, the algorithmic complexity of the global reconstruction methods of both shorah and qure increases in proportionate to the ratio between the genomic region of interest and the read length. these factors significantly affect the performance of the respective methods as been discussed in, takes advantage of the unrestricted de novo assembly algorithm and dynamically defines the local haplotype boundaries for each strain, at which the decisions for connecting local haplotypes are made. this dynamic definition of local haplotype boundaries significantly reduces the number of heuristic decisions to be made when connecting local haplotypes providing a clear advantage over qure. this advantage becomes prominent especially under shorter read lengths. the third source of performance enhancement in viquas is the improvement of estimated strain frequency values (demonstrated in terms of kl-divergence and root mean-squared error) resulted from the second and third major extensions to the algorithm indescribed under the subsection 2.2.6. limitations of viquas include the requirement of higher computational resources when analysing longer read lengths owing to the use of smithwaterman algorithm in the pipeline. however, this computational complexity does not degrade the performance of the pipeline. a shorter read length compared with the genomic region of interest reduced coverage depth of the sequences and a higher rate of technical sequencing errors were identified as the factors influencing negatively on the performance of viquas. in fact, these factors were common to all four methods in our study and viquas was observed to be the least susceptible to them. also, all four methods failed to reconstruct strains with a relative frequency less than f min, and the correctly reconstructible minimum relative frequency increased with the presence of technical sequencing errors. we notice that the performance of the methods analyzed vary with different population characteristics and sequencing parameters. therefore, it is a difficult task to define parameters within which a certain method performs at an acceptable level. in fact, the acceptable level of performance varies according to the needs of the individual user. hence, the decision on choosing the best method of analysis and the appropriate sequencing parameters is left to the end user. furthermore, the longest region that can be successfully reconstructed depends on both the read length and diversity. for instance, when the region of interest and the diversity are given, we observe that the performance increases with increasing read length. this does not imply that we can expect the same levels of performance with the same diversity and read length over a larger genomic region. a thorough analysis of this fact is presented in. we anticipate the use of viquas to extend beyond quasispecies spectra profiling with applications in other omics fields including viquascancer genomics, metagenomics and immunogenomics. for instance, applications such as estimating genetic diversity of tumour cells and understanding gene heterogeneity and diversity of microbiomes in various environments such as human gut or waste treatment plants may benefit from the underlying methodology.  
