genetics and population analysis quasar: quantitative allele-specific analysis of reads motivation: expression quantitative trait loci (eqtl) studies have discovered thousands of genetic variants that regulate gene expression, enabling a better understanding of the functional role of non-coding sequences. however, eqtl studies are costly, requiring large sample sizes and genome-wide genotyping of each sample. in contrast, analysis of allele-specific expression (ase) is becoming a popular approach to detect the effect of genetic variation on gene expression, even within a single individual. this is typically achieved by counting the number of rna-seq reads matching each allele at heterozygous sites and testing the null hypothesis of a 1:1 allelic ratio. in principle, when genotype information is not readily available, it could be inferred from the rna-seq reads directly. however, there are currently no existing methods that jointly infer genotypes and conduct ase inference, while considering uncertainty in the genotype calls. results: we present quasar, quantitative allele-specific analysis of reads, a novel statistical learning method for jointly detecting heterozygous genotypes and inferring ase. the proposed ase inference step takes into consideration the uncertainty in the genotype calls, while including parameters that model base-call errors in sequencing and allelic over-dispersion. we validated our method with experimental data for which high-quality genotypes are available. results for an additional dataset with multiple replicates at different sequencing depths demonstrate that quasar is a powerful tool for ase analysis when genotypes are not available.quantitative trait loci (qtls) for molecular cellular phenotypes (as defined by), such as gene expression [expression qtl (eqtl)] (e.g.), transcription factor binding and dnase i sensitivity have begun to provide a better understanding of how genetic variants in regulatory sequences can affect gene expression levels (see also). eqtl studies in particular have been successful at identifying genomic regions associated with gene expression in various tissues and conditions (e.g.). although previous studies have shown an enrichment for gwas hits among regulatory variants in lymphoblastoid cell lines (lcls) , a fulleqtl data are available and will represent a useful resource to functionally annotate genetic variants. however, the number of cell types and environments explored are a small subset of the presumably larger number of regulatory variants that mediate specific gxe interactions. eqtl studies are expensive, requiring large sample sizes (n 70), which may be difficult to achieve for tissues that are obtained by surgical procedures or are difficult to culture in vitro. even if biospecimens are readily available at no cost, eqtl studies require large amounts of experimental work to measure genotypes and gene expression levels. as the measurement of gene expression using high-throughput sequencing (rna-seq) is becoming more popular than microarrays, rna-seq library preparation is also becoming less expensive ($46/sample), whereas costs of sequencing are also very rapidly decreasing (e.g. 16m reads per sample would cost $49 using a multiplexing strategy). additionally, the sequence information provided by rna-seq can be used to call genotypes , detect and quantify isoforms and to measure allele-specific expression (ase), if enough sequencing depth is available . ase approaches currently represent the most effective way to assay the effect of a cis-regulatory variant within a defined cellular environment, while controlling for any trans-acting modifiers of gene expression, such as the genotype at other loci (cowper). as such, ase studies have greater statistical power to detect genetic effects in cis than a traditional eqtl mapping approach when using a small sample size. additionally, ase may also be useful to detect epigenetic imprinting of gene expression if ase is present but no eqtl is detected . in the absence of ase, the two alleles for a heterozygous genotype at a single-nucleotide polymorphism (snp) in a gene transcript are represented in a 1:1 ratio of rna-seq reads. to reject the null hypothesis and infer ase, it is necessary to first identify heterozygous snps with high confidence and then conduct inference to detect a departure from a 50 allelic ratio. although genotyping and ase are usually considered two separate problems, miscalling a homozygous snp as heterozygous is likely to induce an error in rejecting the ase null hypothesis; thus, we argue that the two problems should addressed together. although it is possible to obtain genotype information from rna-seq , to the best of our knowledge, all existing methods for detecting ase consider the genotypes known and error probabilities associated with genotyping are not taken into account for the ase step. although overall genotyping quality can also be modeled within the ase model , there is currently no method that for each snp can jointly genotype and detect allelic imbalances in high-throughput sequencing data. an approach that takes into account base-calling errors was previously proposed for detecting ase in ests data , but for rna-seq data, it is essential to also include overdispersion. here, we propose a novel framework for quantitative allele-specific analysis of reads (quasar) that starts from a single or multiple rna-seq experiments from the same individual and can directly identify heterozygous snps and assess ase accurately by taking into account base-calling errors and overdispersion in the ase ratio. quasar is evaluated with two different datasets that demonstrate genotyping accuracy and the importance of incorporating the genotype uncertainty when performing ase inference.we implemented the quasar approach as detailed in section 2 in an r package available at http://github.com/piquelab/quasar. first, to evaluate quasar genotyping accuracy, we collected rna-seq data for two lcls that already have high-quality genotype calls from the 1kg project (gm18507 and gm18508). as illustrated in, we are able to accurately genotype thousands of loci with lower error rates than other methods commonly used for genotyping dna-seq data. by design, quasar is more conservative in making heterozygous calls than homozygous calls, yet still retains a large number of heterozygous loci compared with gatk and samtools . in quasar, if there is contention between (i) an heterozygous genotype call with extreme allelic imbalance or (ii) an homozygous genotype call with base call errors, our model will favor the latter (ii). this is a crucial feature for accurate inference of ase, which will be discussed later in more detail. as we increase the threshold on the quasar posterior probability of heterozygosity, we consistently reduce the genotype error rate, supplementary table s1.the error rates increase slightly if we include rare variants with maf 0.05 and are minimally affected when 1kg allele frequencies are not used as priors . an important feature of quasar is that the genotyping information is also used for the next inference step. we next sought to characterize quasar performance in genotyping and ase inference from rna-seq experiments sequenced at different depths. in total, we analyzed 18 samples (three replicates across six different time points) for an individual for which genotypes were not previously available. we combined the 18 fastq files in different ways as input for quasar to obtain an empirical power curve . as expected, we observed that our ability to detect heterozygotes (map 0.99) increases with the sequencing depth. at a more modest sequencing depth of 16 million, we can still detect more than 1,000 heterozygous sites. after obtaining the genotypes, we assessed whether there is evidence of ase at any of the snps determined to be heterozygous. to conduct ase inference, we used the lrt (9) statistic in quasar and obtained p values. we controlled the fdr using the q-value procedure . as shown in, our ability to detect ase greatly increased with the number of snps we were able to genotype, which in turn is a function of coverage . using 100 million reads, we detected roughly 9,000 heterozygous snps of which 50 have ase at 10fdr. to assess the calibration of the ase test in quasar and to compare it to other ase inference approaches, we used qq plots,. a qq plot compares the quantiles observed from a test statistic to those that are expected under a null distribution (e.g. p values are uniformly distributed between 0 and 1). the shape of the qq-plot curve is useful to judge how well the p values are calibrated when we expect that a large number of the tests conducted are sampled from the null distribution. in this latter scenario, we expect that the qq-plot curve would follow the 1:1 line for the range of p values with higher value. for small p values, we expect that the curve starts to depart from the 1:1 line representing the small proportion of tests that are not sampled from the null distribution. many existing approaches for ase use either a binomial test or a beta-binomial test that does not account for genotyping or base-calling error. to compare quasar ase inference to these alternative. empirical power in detecting heterozygous snps as a function of sequencing depth. each point represents a single input dataset to quasar: either as a single experiment replicate and time point (red dot), combining multiple time points (2 green, 3 blue, 6 purple) or combining replicates (1 dot, 2 triangle). the x-axis represents the total number of rna-seq reads in the fastq input files. the y-axis represents the log 10 of the total number of snps that are determined to be heterozygous quasarapproaches, we used the rna-seq data collected on the lcl samples and the genotype calls from quasar.clearly shows that the binomial test is too optimistic and will likely lead to many false discoveries. another binomial test (supplementary) independently implemented show a similar behavior to our own implementation. in contrast to the binomial test, the beta-binomial model seems better calibrated but uncertainty on the genotype being a true heterozygote can lead to very small p values and false positives. quasar combines the beta-binomial model with uncertainty on the genotype, resulting in the most conservative approach, likely avoiding a common cause of false positives in ase analysis. to further evaluate the differences between quasar and other methods, we focused on the high-coverage lcl samples. this cell type has been part of large sample eqtl studies such as geuvadis including rna-seq data for more than 600 individuals. from a recent reanalysis of the geuvadis dataset , we selected genes with eqtls (5 fdr) and a leading snp with a high posterior inclusion probability (pip 0.9), as those are the nucleotides more likely to be causal (i.e. the eqtn). we hypothesized that in our data, genes for which the eqtn was heterozygote would be more likely to show evidence for ase than those for which the eqtn was homozygote. however, transcripts with homozygous eqtns could still show ase, if they have additional personal/rare associations or due to an imprinting mechanism. in any of the methods we tested (supplementary), there was a significant difference between ase p values in the expected direction (mannwhitney u-test p 0.02). the distribution of p values (supplementary) for ase signals in transcripts with homozygous eqtns are much closer to the uniform distribution in quasar when compared with other methods, especially those that do not account for overdispersion. in general, the p values obtained across all methods tested are very much correlated to each other, as shown in supplementary, but there are key differences. the methods that use a binomial test tend to have lower p values than quasar, which uses a beta-binomial model. supplementaryand b show that we may observe more shrinkage for snps with deeper coverage. compared with a test using the beta-binomial distribution but ignoring genotype uncertainty, our quasar test leads to similar p values, but snps with more uncertainty on being heterozygous are corrected in a higher degree toward a less significant p value (supplementary figs. s3c and s4c). in terms of computational complexity, quasar is very fast. quasar runtime for genotyping with the em procedure takes less than 20 s on any of our datasets (using a computer with a 6-core 2.93-ghz intel processor and 8-gb ram). each em iteration in the genotyping step is o(ls) linear with the number of snps and samples, and convergence is achieved in less than 20 iterations. gatk with the default options takes a longer amount of time (about 2 h) compared with samtools and quasar, as the latter methods focus directly on 1kg snps only. comparatively, for both our pipeline and, more time is spent in data pre-processing (roughly 10 min per sample depending on the sequencing depth and assuming reads are already aligned) than in genotyping or ase inference.quasar is the first approach that detects genotypes and infers ase from the same sequencing data. in this work, we focused on rnaseq, but quasar can be applied to other data types (chip-seq, dnase-seq, atac-seq and others). indeed, the more experimental data available from the same individual across many experimental. qqplot comparing the p value distribution of three alternative methods for determining ase. the x-axis shows the log 10 quantiles of the p values expected from the null distribution. the y-axis shows the log 10 quantiles of the p values computed from the real data using three different methods: (i) binomial (black) assumes m 1 no overdispersion; (ii) beta-binomial (green) considers overdispersion but does not consider uncertainty in the genotype and (iii) quasar (blue) uses the beta-binomial distribution and uncertainty in the genotype calls. in all three cases, the same set of snps is considered. the shaded area in gray indicates a 95 confidence band for the null distribution samples (data types, conditions, cell types or technical replicates), the more certainty we can gather about the genotype. a key aspect of the quasar ase inference step is that it takes into account over-dispersion and genotype uncertainty resulting in a test that we have shown to be well calibrated. in many cases, the p values obtained from biased statistics can be recalibrated to the true null distribution using a permutation procedure. unfortunately, this is not possible for ase inference, as randomly permuting the reads assigned to each allele would inadvertently assume that the reads are distributed according to a binomial distribution. more complicated and computationally costly resampling procedures can be proposed, but it is not clear what additional assumptions may be introduced and if such methods can correctly take into account genotyping uncertainty. if prior genotype information is available, it can also be provided as input to the algorithm. the prior uncertainty of the genotypes should be reflected in the form of prior probabilities for each genotype. in this article, we have shown that we can obtain reliable genotype information from rna-seq reads, thus making additional genotyping unnecessary if the endpoint is to detect ase. instead, sequencing the rna-seq libraries at a higher depth is probably a better strategy as it greatly improves the power to detect ase. furthermore, as sequencing costs decrease rapidly, ase methods are becoming very attractive in applications where eqtl studies have been previously used. this is of increased importance in scenarios where collecting a large number of samples is expensive or infeasible. large-scale eqtl studies are still very much necessary for fine mapping, but analysis of ase can provide unique insights into mechanisms that are uncovered only under specific experimental conditions, e.g. as a result of gene x environment interactions.  
