an algorithm for designing minimal microbial communities with desired metabolic capacities motivation: recent efforts to manipulate various microbial communities, such as fecal microbiota transplant and bioreactor systems optimization, suggest a promising route for microbial community engineering with numerous medical, environmental and industrial applications. however, such applications are currently restricted in scale and often rely on mimicking or enhancing natural communities, calling for the development of tools for designing synthetic communities with specific , tailored, desired metabolic capacities. results: here, we present a first step toward this goal, introducing a novel algorithm for identifying minimal sets of microbial species that collectively provide the enzymatic capacity required to synthesize a set of desired target product metabolites from a predefined set of available substrates. our method integrates a graph theoretic representation of network flow with the set cover problem in an integer linear programming (ilp) framework to simultaneously identify possible metabolic paths from substrates to products while minimizing the number of species required to catalyze these metabolic reactions. we apply our algorithm to successfully identify minimal communities both in a set of simple toy problems and in more complex, realistic settings, and to investigate metabolic capacities in the gut microbiome. our framework adds to the growing toolset for supporting informed microbial community engineering and for ultimately realizing the full potential of such engineering efforts. availability and implementation: the algorithm source code, compilation, usage instructions and examples are available under a non-commercial research use only license at https://github. com/borenstein-lab/comida.complex microbial communities can be found everywhere on our planet, spanning marine communities inhabiting the deep ocean to symbiotic communities living on and within host organisms. these communities impact a broad set of processes ranging from environmental resource cycles to host organism health. for example, deep sea rock and vent communities play a fundamental role in oxidizing environmental methane , whereas the human gut microbiome crucially aids in drug metabolism, energy harvest and immune system response . microbial communities affect these processes through a variety of metabolic reactions catalyzed by enzymes encoded in the member species genomes, and ultimately through the diverse compounds each community can degrade or produce. these critical roles microbial communities play in shaping their environment, combined with the potential to manipulate these communities, suggest a promising route for numerous medical and environmental applications . specifically, severalsuch efforts to shift target communities toward preferred states have used samples from naturally occurring communities as an inoculation source. for instance, transplanting healthy donor microbiome samples into patient guts has recently been used to treat a variety of gut disorders . such fecal microbiota transplants (fmts) have been shown to perturb a patients dysbiotic gut community, shifting it to a healthier state and ameliorating their condition . these fmtbased therapies have had a 90 success rate at curing recurrent clostridium difficile infections and have promising results for addressing other gut disorders including inflammatory bowel disease and metabolic syndrome . similarly, wastewater treatment bioreactors are often seeded by microbial communities cultivated from naturally occurring wastewater microbes or from previously established bioreactors . these seed communities colonize the new bioreactor and thereby provide the metabolic processes necessary to degrade biological matter in wastewater. following the success of such transplants, recent efforts have further aimed to use engineered, rather than naturally occurring, communities in an attempt to increase control over transplant outcomes. for example, a synthetic stool substitute was recently developed using a mixture of cultured bacterial isolates to mimic a healthy gut community . such a synthetic community removes the need for sample donors, allows greater regulation over the bacteria present in the transplant community, and reduces the risk for inadvertent transfer of pathogens. this synthetic and markedly simpler community was shown to still be effective in treating c. difficile infections. another effort applied a simple selectionbased approach to optimize the species composition of a bioreactor seed community for increased biopolymer production from glycerol . the final communitys biopolymer production rate was demonstrated to be noticeably increased compared to the original community. such community engineering approaches are clearly an important first step towards customizing microbial community composition, yet they still largely rely on imitating natural community structures or enhancing existing community capabilities and cannot, for example, produce communities with potentially desired abilities absent from the initial community. indeed, even optimizing an existing community function involves developing a carefully controlled selection procedure tailored to the preferred function and may require a long time for the community to reach an optimal state. the applications of such engineering efforts are therefore inherently constrained and are often very system-specific and hard to generalize. one approach to address these challenges is to rationally design and construct synthetic communities with desired and predefined metabolic capabilities. such a design process would involve the careful selection of member species and their abundances, hopefully defining a community composition that would achieve the desired metabolic task in the target environment. the ability to design such communities would significantly broaden the applicability of community engineering, could alleviate the reliance on naturally occurring community functions, and would ultimately support the construction of communities tailored to perform specific tasks within the context of various environmental settings. designing microbial communities, however, is a daunting task. microbial species are endowed with tremendously diverse and complex capacities, which may not be trivial or easy to discern. moreover, the various species comprising each community do not function independently, and each community impacts its environment through the orchestrated activity of its members. interaction between species can lead to emergent behaviors that cannot be attributed to the function of just a single species or to additive species functions . one species can, for example, provide the necessary precursors that allow a second species to produce metabolites that it could not produce when growing in isolation . similarly, costly metabolic tasks could be distributed among community members such that each member performs a specific part of a complex metabolic pathway . a successful design framework should therefore account for such interactions and their impact on the metabolism of the community as a whole. as a first step to address this challenge, here we develop comida (community metabolism design algorithm), an algorithmic framework for designing simple communities with some predefined metabolic capacities. specifically, we aim to identify a set of species that, as a community, have the metabolic potential to convert a set of metabolic substrates to a set of desired target metabolites. we further aim to discern the smallest set of species required to provide this desired metabolic potential, reducing downstream complexities and providing more streamlined communities. in other words, our goal is to identify a minimal set of species whose genomes collectively encode a set of enzymatic genes that can catalyze a collection of metabolic reactions forming metabolic paths to each desired product metabolite from the available substrates. communities designed with our framework will therefore have the required metabolic potential to achieve the specified metabolism. obviously, there are additional factors and processes that should be ultimately considered in designing a stable and functional community that carries out a specific task. first and foremost, possessing the set of reactions leading from substrates to products does not necessarily imply that the community would actively and efficiently perform the desired metabolic function. toxin production, signaling between microbes, the capacity to transport metabolites between cells, and the ability of the selected species to survive in the target environment could further affect the community behavior, stability and dynamics. yet, having the metabolic potential to carry out the desired function is an important and essential prerequisite for any community that could achieve the specified task, and is therefore a natural first step in rational community design and a critical component of any design task (see also section 4).recent efforts to manipulate various naturally occurring communities and to impact their activities have shown tremendous promise. for example, efforts to modify the human gut microbiome have demonstrated that properly perturbing this community can treat or ameliorate certain conditions . expanding this approach to effectively treat a wider variety of diseases, as well as alter the functions of environmentally and industrially-relevant microbial communities, requires methods for rationally designing communities with specific metabolic capacities. above, we take a first step towards this goal, introducing and validating a novel algorithm which identifies minimal microbial communities that provide specified and desired metabolic capacities. clearly, various biological factors are currently not considered by our algorithm, including, for example, species-level interactions , the expected flux through each metabolic reaction, and whether member species, or even the community as a whole, can survive in the target environment . ignoring such factors may render communities designed by our algorithm markedly different than naturally occurring communities and synthetic communities constructed based on such designs may consequently fail to survive or to perform specific desired tasks. for example, the discrepancy between the small communities identified in our analysis above and the extreme diversity observed in many naturally occurring communities (human microbiome project consortium, 2012b;) may be likely accounted for, at least partly, by such factors. yet, our algorithmsolution sizes identified for 10 000 random substrate/product metabolite pairs, using species from the human microbiome project provides a starting point for such design efforts and for future method development in this area. specifically, selecting a community based initially on the presence of desired metabolic capacities provides a simple way to address an important prerequisite for community metabolism; any community designed to consume or produce given metabolites or to have some metabolic activity must obviously also have the metabolic capacity to carry out those functions. our attempt to identify minimal communities may again not necessarily be aligned with biological assembly rules, but offers simple candidate communities for further design refinement. moreover, by formulating our program as an ilp algorithm, we provide an easy way to introduce additional design considerations. as our understanding of the various constraints affecting community assembly improves, such considerations can be added to this framework by devising equations and inequalities that encode these constraints. of the various considerations that could be implemented to further refine any design approach, two stand out as logical next steps. first, the expected stability of designed communities could be improved by examining the likelihood that a combination of species will coexist in a community. specifically, information on species co-occurrence in natural communities can be used to estimate the tendency of various species pairs to co-exist or the exclude one another from a shared environment . such information would allow an algorithm to prioritize communities that minimize the risk of losing member species due to antagonistic species interactions, ultimately stabilizing community structure. second, considering the predicted activity of candidate communities, rather than just the presence of specific metabolic capacities, could increase the likelihood that designed communities would perform the desired task. several frameworks for predicting the metabolic activity of microbial communities have recently been introduced , potentially allowing future design algorithms to consider predicted rates of metabolite consumption and production and predicted changes in species abundances over time. our algorithm could be used, for example, as an initial filtering step, providing a set of candidate minimal communities that have the capacity for some desired metabolism, followed by a metabolic model-based prediction of the metabolic activity of each candidate community to further refine the design process. moreover, such metabolic modeling could allow the design process to account for important factors that our current algorithm may not be able consider. for instance, our algorithm does not explicitly prevent community members from degrading one or more of the specified target products. such inadvertent target metabolite degradation may depend on the set of microbes present, other available substrates, and various environmental conditions, and could therefore be predicted and potentially avoided using metabolic modeling-based design. the ability to computationally design microbial communities will be a useful tool for many purposes. for example, designed synthetic communities could be ultimately used in place of fmts, removing the need for screening donor samples while also optimizing treatments to target specific conditions. communities could also be created for industrial resource and pharmaceutical production, potentially obviating the need for extensive microbial genetic engineering and providing novel mechanisms for production control in the form of inter-species signaling . clearly, such applications are not yet feasible and the development of a comprehensive, general-purpose design framework may still be out of our reach for years to come. we hope, however, that our framework will encourage future developments of such design methodologies and will lay the foundation for future efforts in microbial community design.  
