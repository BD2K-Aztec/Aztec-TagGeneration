genome analysis sigma: strain-level inference of genomes from metagenomic analysis for biosurveillance motivation: metagenomic sequencing of clinical samples provides a promising technique for direct pathogen detection and characterization in biosurveillance. taxonomic analysis at the strain level can be used to resolve serotypes of a pathogen in biosurveillance. sigma was developed for strain-level identification and quantification of pathogens using their reference genomes based on metagenomic analysis. results: sigma provides not only accurate strain-level inferences, but also three unique capabilities: (i) sigma quantifies the statistical uncertainty of its inferences, which includes hypothesis testing of identified genomes and confidence interval estimation of their relative abundances ; (ii) sigma enables strain variant calling by assigning metage-nomic reads to their most likely reference genomes; and (iii) sigma supports parallel computing for fast analysis of large datasets. the algorithm performance was evaluated using simulated mock communities and fecal samples with spike-in pathogen strains. availability and implementation: sigma was implemented in c++ with source codes and binaries freely available atit is a public health and national security imperative to prepare for a broad range of biological threats, including infectious diseases and food-borne illnesses . biosurveillance will provide early detection of disease outbreaks and rapid characterization of pathogens. conventional methods for biosurveillance include laboratory culture, immunoassays, and genotyping . metagenomic sequencing, developed in environmental microbiology, is a promising new method for biosurveillance. for example, fecal samples of suspected patients in food-borne disease outbreaks can be sequenced directly to identify responsible pathogens, bypassing the steps of strain isolation and culturing for pathogen identification. in the 2011 german shiga toxin-producing e.coli (stec) o104:h4 outbreak, the pathogen was identified by the standard epidemiology procedure of isolation, culturing, and genotyping . multiple isolate cultures of this pathogen from different patients were subsequently sequenced, which generated whole genome sequences for pathophysiology analysis. in the future, metagenomics could be used to sequence fecal samples of patients in the early stage of such an outbreak, potentially allowing more rapid and unambiguous identification of the pathogen. it is a computational challenge to achieve sensitive and specific identification of pathogens in a complex metagenome background. many algorithms have been developed to infer the taxonomic composition of a microbial community using metagenomic sequencing data. the algorithms generally used the following three approaches. (i) the k-mer statistics approach compares k-mer frequency profiles of metagenomic reads with those of organisms representing a wide range of clades. this approach is used by na ve bayes classifier , phymmbl , and phylopythias (in the marker gene approach, metagenomic reads are aligned with a set of preselected clade-specific marker genes, and taxonomic classification is inferred from phylogenetic distances to these marker genes. this approach is used by metaphlan and amphora2 . both of the two approaches can produce high-quality classification results at the species level or above without using a significant amount of computation. however, these two approaches may not be adequate for taxonomic classification at the strain level. genome identification for metagenomic biosurveillance needs to resolve different strains (or serotypes) of the same species. for example, pathogenic e.coli strains need to be unambiguously differentiated from coexisting non-pathogenic e.coli strains in the metagenome. alternatively, (iii) the read mapping approach infers the taxonomic composition of a community by searching metagenomic reads against a database of reference genomes. this approach is used by megan , sort-items , metaphyler , grammy , gasic , and pathoscope . this approach can provide accurate highresolution taxonomic classification for clades well represented by reference genomes. it is suitable for metagenomic biosurveillance of known pathogens, which generally have reference genomes available for a variety of strains. however, it is difficult for this approach to detect novel pathogens. when a new strain is present in a sample, its closely related strains in a reference genome database need to be identified and their sequence variations be determined. here, we present the sigma algorithm (strain-level inference of genomes from metagenomic analysis) for metagenomic biosurveillance. a novel probabilistic model was developed to identify and quantify genomes using the read mapping approach. our benchmarks showed that sigma provided more accurate to whom correspondence should be addressed. the author 2014. published by oxford university press. this is an open access article distributed under the terms of the creative commons attribution license (http://creativecommons.org/licenses/by/4.0/), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited. strain-level and species-level classification than an established read mapping algorithmmegan, a representative marker gene algorithmmetaphlan, and a recent pathogen detection algorithmpathoscope. sigma was scaled from desktops to supercomputers to achieve a short turnaround time for large metagenomic datasets. this allows a prompt response of a metagenomic biosurveillance network to disease outbreaks using supercomputers. the existing taxonomic analysis algorithms generally do not provide statistical confidence assessment of their results. it is difficult to make a biosurveillance decision based on the inference of an algorithm on a pathogens presence without knowing the uncertainty on such inferences or to use the estimated relative abundance of a genome without knowing the confidence intervals of such estimates. after the identification and quantification of genomes, sigma can rigorously evaluate the statistical confidence of its findings. hypothesis testing based on the likelihood ratio test was used to calculate p-values for the detection of relevant genomes. bootstrapping was used to estimate the confidence intervals of the relative abundances of identified genomes. when an outbreak spreads or a pathogen re-emerges, it is important to determine the sequence variations between the genomes of this pathogen in the field-collected samples and its reference genomes in the database. this allows accurate reconstruction of the transmission sources of the outbreak and the evolutionary history of the pathogen. thus, biosurveillance further requires information on the single-nucleotide polymorphisms (snps) of a detected pathogen to distinguish different variant populations. identification of variants is straightforward for isolate genome sequencing by mapping all reads to a reference genome. however, in metagenome sequencing, one cannot simply map all metagenomic reads to a reference genome, because some of the aligned reads may originate from different microorganisms, which could introduce false variations. sigma solves this problem by assigning each read to its most likely originating genome based on the sigma probabilistic model, which allows subsequent variant calling by variants calling software such as samtools .shows an overview of the sigma algorithm. sigma starts with mapping all reads in a metagenomic dataset onto a userdefined database of reference genomes. a parallelization wrapper is provided as an option for users to speedup the read alignment using computer clusters. a read can be aligned to many genomes with up to a given number of mismatches. the foundation of all statistical inferences in sigma is a simple probabilistic model for sampling reads with mismatches from genomes at unknown abundances. the sigma probabilistic model permits maximum likelihood estimation (mle) of the relative abundances of all genomes measured by the percentages of reads sampled from these genomes. importantly, we proved the convexity of the objective function of the mle so that sigma can guarantee to attain a global optimum solution using interior point non-linear programming (nlp) provided in the ipopt library . the sigma probabilistic model further provides the statistical framework for hypothesis testing and confidence interval estimation. sigma calculates the p-value for identification of a genome using a likelihood ratio test of the null hypothesis that this genome is not present in the sample. to account for the quantification uncertainty from the stochastic sampling process of metagenomic sequencing, bootstrapping is used to estimate confidence intervals of relative abundances of identified genomes. as both bootstrapping and likelihood ratio tests entail solving the nontrivial nlp optimization problem for many times, the nlp solver of sigma is multithreaded and parallelized to computer clusters. finally, given the mle of genome relative abundances, sigma can calculate the probabilities of sampling a read from its mapped genomes, which allows assigning metagenomic reads to their most likely originating genomes for variant calling. for a selected genome, sigma provides the alignment of its assigned reads on the genome sequence as the input for variant calling with samtools. sigma filters the variant calling output to identify high-confidence sequence variations.a number of taxonomic classification algorithms have been developed for metagenomic data with different advantages. for example, the lca algorithm used by megan can provide classification at a higher taxonomic rank for a novel microorganism without a reference genome from a closely related strain or species in the database. the marker gene approach used by metaphlan only requires a small amount of computing resources for large metagenomic datasets. the general-purpose taxonomic classification algorithms typically providecomprehensive phylogenetic coverage and identifications at proper taxonomic ranks for complex microbial communities, which is important for many microbial ecology studies. conversely, pathoscope and sigma both are designed for detecting pathogens in metagenomic samples. however, pathoscope did not provide accurate resolution of different strains in a sample, which is required for biosurveillance to distinguish pathogenic strains from non-pathogenic strains and to pinpoint the serotype of a pathogen from a complex metagenome background. this is probably because the em algorithm used by pathoscope can only provide a local optimum solution for genome abundance estimation. the local optimum solution may deviate significantly from the global optimum solution for metagenomes that are complicated by multiple different strains. however, the nlp algorithm used by sigma mathematically guarantee a global optimum solution for genome abundance estimation, due to the convexity of the objective function for the mle. furthermore, sigma provides three unique capabilities needed for metagenomic biosurveillance. first, sigma can evaluate the statistical confidence of genome identification and quantification with hypothesis testing and confidence interval estimation. the uncertainty quantification will support more informed decision making in biosurveillance. second, sigma can determine the divergence of the actual genomes in the sample from the reference genomes in the database by variant calling. by assigning metagenomic reads to their most likely originating genomes, sigma makes the metagenomic snp analysis amenable to the existing variant calling algorithms designed for isolate genomes. strain variations can be used to track the divergence of a pathogen during its spread. finally, sigma users can optionally use high-performance computing to achieve fast analysis with short turnaround time. the computation is scalable to very large metagenomic datasets.  
