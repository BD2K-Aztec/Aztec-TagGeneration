astral: genome-scale coalescent-based species tree estimation motivation: species trees provide insight into basic biology, including the mechanisms of evolution and how it modifies biomolecular function and structure, biodiversity and co-evolution between genes and species. yet, gene trees often differ from species trees, creating challenges to species tree estimation. one of the most frequent causes for conflicting topologies between gene trees and species trees is incomplete lineage sorting (ils), which is modelled by the multi-species coalescent. while many methods have been developed to estimate species trees from multiple genes, some which have statistical guarantees under the multi-species coalescent model, existing methods are too computationally intensive for use with genome-scale analyses or have been shown to have poor accuracy under some realistic conditions. results: we present astral, a fast method for estimating species trees from multiple genes. astral is statistically consistent, can run on datasets with thousands of genes and has outstanding accuracy improving on mp-est and the population tree from bucky, two statistically consistent leading coalescent-based methods. astral is often more accurate than concatenation using maximum likelihood, except when ils levels are low or there are too few gene trees. availability and implementation: astral is available in open source form at httpsspecies tree estimation is difficult in the presence of gene tree conflict, which can result from incomplete lineage sorting [ils, modelled by the multi-species coalescent ] as well as other causes. ils is equivalent to deep coalescence, which occurs with high probability whenever the time between speciation events is short relative to the population size . when ils is present, gene trees can differ from each other and from the species tree, presenting substantial challenges to phylogeny estimation methods . for example, the standard approach, concatenation (which concatenates the multiple sequence alignments for different genes together into one superalignment, and then estimates a tree on the super-alignment) can return incorrect trees with high confidence . furthermore, under some conditions, even the most probable gene tree topology may not be identical to the species tree topology , a condition called the anomaly zone. however, there are no anomalous rooted three-taxon species trees and no anomalous unrooted four-taxon species trees , a key fact that underlies the design of some summary methods and their proofs of statistical consistency. while several methods are established to be statistically consistent under the multi-species coalescent model, mp-est and the population tree returned by bucky are among the leading methods. bucky-pop is more computationally intensive but can work with unrooted gene trees, while mp-est requires rooted gene trees but easily scales to hundreds of gene trees and so has been used in many phylogenomic studies . other statistically consistent species-tree estimation methods include best and beast , which co-estimate gene trees and species trees from input sequence alignments; however, these methods are extremely computationally intensive on datasets with !100 genes , so that only summary methods are feasible for use on genome-scale datasets. however, even the best coalescent-based summary methods have not been reliably more accurate than concatenation , and performance on biological datasets has in some cases resulted in species trees that were less well resolved and biologically feasible than concatenation . hence, the choice between coalescent-based estimation and concatenation is highly controversial . we present astral (accurate species tree algorithm), a new coalescent-based species tree method. astral provides a statistically consistent estimation of the true species tree from unrooted gene trees, under the multi-species coalescent model. furthermore, astral runs in polynomial time and can analyse genome-scale datasets in minutes. we evaluate astral in comparison with two statistically consistent methods (mp-est and bucky-pop), two simple summary methods) and the greedy consensus] and concatenation under maximum likelihood (ca-ml) using raxml , on a collection of biological and simulated datasets. we explore genome-scale analyses, analysing datasets with hundreds to thousands of genes, which are too large for bucky-pop and beast to analyse. to whom correspondence should be addressed. the author 2014. published by oxford university press. this is an open access article distributed under the terms of the creative commons attribution non-commercial license (http://creativecommons.org/licenses/by-nc/3.0/), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. for commercial re-use, please contact journals.permissions@oup.com astral is more accurate than the other summary methods under all the simulated model conditions we explore. as expected, the relative accuracy of astral and concatenation depends on the amount of ils, with astral having an advantage when ils levels are at least moderate, and concatenation having an advantage when ils levels are low. thus, astral enables highly accurate large-scale phylogenomic estimation, even in the presence of high levels of gene tree conflict because of ils.results on mammalian simulated datasets. the first experiment shows results on the mixed mammalian dataset, which most closely resembles the biological dataset studied in. we compare astral, mp-est, greedy, mrp, bucky-pop and ca-ml and three types of inputs to summary methods. for mrp, mp-est and astral, using bestml input trees produced more accurate species trees than using bootstrap replicates, either as one input (all bs) or using mlbs. the purpose of using bootstrap replicates is to take gene tree uncertainty (resulting from insufficient sequence length, for example) into account, but these results indicate that for this model condition, these two simple approaches do not improve species tree estimation. however, it is possible that other model conditions [perhaps smaller numbers of genes, as studied inor other ways of addressing gene tree uncertainty might show some advantage over the bestml approach. therefore, we use bestml input trees in the remaining experiments. for the mixed model condition and using bestml trees, astral is the most accurate of these methods, mp-est the next most accurate, followed by the other summary methods, and finally by ca-ml. astral with any of the three sets of inputs is also more accurate than bucky-pop; however, differences between astral on all bs and bucky-pop are relatively small. the next experiment explored variants of the basic mammalian simulation, exploring the impact of changes to the ils level (by scaling the species tree branch lengths), number of genes and gene sequence length, on the absolute and relative performance of various methods using bestml input. astral was generally more accurate than all the other summary methods . however, for a few cases, astral and one or more summary methods had similar accuracy; for example, on 800 true gene trees from default ils levels, all summary methods (except for greedy) produced the true species tree. furthermore, astral was more accurate than ca-ml, except when the amount of ils is low. the relative performance between astral and ca-ml depended on the amount of ils, so that ca-ml was more accurate than astral under low levels of ils, and otherwise astral was more accurate than ca-ml. some observed trends were expected: all summary methods gave improved accuracy as the sequence length in each gene increased from 500 to 1000 bp; using true gene trees gave the best results ; species tree error rates generally reduced as the number of genes increased ; and species tree error rates increased as ils levels increased . however, some other observed trends were surprising. for example, unlike the other methods, greedy did not continue to improve with increased numbers of gene trees, but could be more accurate than many other summary methods (including mp-est but not astral) when the number of gene trees and gene sequence lengths were both small . in addition, we observed that mrp, a simple supertree method that is not known to be statistically consistent, was in some cases more accurate than mp-est. for example, while mp-est was always at least as accurate as mrp on true gene trees or on estimated gene trees with high ils, there were cases (. species tree estimation error on the default mammalian datasets with 37 genes and 400 genes (half with 500 bp and half with 1000 bp and with 71 mean bs). we show the missing branch rates for estimated species trees computed using summary methods (mrp, mp-est, greedy, bucky-pop and astral) as well as concatenation using raxml. results are shown for running summary methods on maximum likelihood gene trees (bestml) and on the set of all bootstrap replicates from all genes (all bs), as well as the greedy consensus of running summary methods on individual bootstrap replicates from all genes (mlbs). caml is run on the true alignment. average and standard error shown based on 20 replicates i544on biological datasets.analysed a dataset with 447 genes across 37 mammalian species using mp-est. two of the questions of greatest interest were the placement of bats (chiroptera) and tree shrew (scandentia), where their mp-est analysis differed from the concatenated analyses they performed. in our analysis of this dataset, we noted the distance of estimated gene trees to other gene trees; this produced a distribution with two clear outliers (see supplementary materials). we also identified 21 genes with mislabelled sequences [easily confused taxon names, subsequently confirmed by the authors of. we removed all 23 outliers from the dataset, and reanalysed the reduced dataset. we used a multi-locus bootstrapping procedure with 100 replicates, with both site and gene resampling, to be consistent with song et al. (2012). we re-estimated the gene trees using raxml on the gene sequence alignments produced by. we recomputed the mp-est tree, obtaining a tree topologically identical to the mp-est tree reported in, but with lower bootstrap for the placement of scandentia (62 in our analysis). ca-ml analyses of the full and reduced datasets were topologically identical and had similar branch support. thus, the ca-ml and mp-est trees on the reduced dataset still differed in the placement of both scandentia and chiroptera. we compare astral to mp-est in. both astral and mp-est trees placed chiroptera as the sister to all other laurasiatheria except eulipotyphyla, whereas ca-ml placed chiroptera as the sister to cetartiodactyla. the astral tree placed scandentia as sister to glires with 74 support and thus agrees with the ca-ml tree but differs from the mp-est tree.the simulated mammalian datasets. we show the missing branch rates for estimated species trees computed using summary methods (mrp, mp-est, greedy and astral) as well as ca-ml. summary methods are run on raxml bestml gene trees. we also show performance of summary methods on the true gene trees. subfigure (a) shows results under default levels of ils, varying the number of genes and gene tree resolution; (b) shows results under increased ils levels, varying the number of genes, and on both true gene trees and estimated gene trees and (c)shows results on 200 genes, varying the amount of ils from very low (5 species tree branch lengths) to very high (0.2 species tree branch lengths)genes using astral, adding bipartitions to x (see supplementary materials). the question of greatest interest is the sister group to land plants. previous analyses have inferred many different possible sister clades, including the following four major hypotheses: zygnematales, coleochaetales, zygnematales + coleochaetales and charales.used mp-est to analyse their data and inferred zygnematales as the sister with 64 bs. a reanalysis of the same data using star was performed by springer and gatesy (2014), who obtained zygnematales + coleochaetales with 44 bs. we analysed this dataset using astral and obtained a tree that generally has high bs on the branches (i.e. with the exception of four branches, all branches have support at least 86, and most have 100 support). however, one edge had low support (only 18). after collapsing the single branch with low support, we obtained a tree (see supplementary materials) in which the charales + land plants hypothesis is rejected with moderately high support (86); however, it is not determined whether zygnematales, coleochaetales or zygnematales + coleochaetales are the sister group to land plants (the branch that distinguishes between these three hypotheses is the one with 18 support). thus, astrals analysis of this dataset can be seen as suggesting that this dataset is insufficient to completely resolve the sister relationship to land plants. however, the most interesting question is whether charales are sister to land plants, and the astral tree rejects that hypothesis with 86 support. amniota dataset.assembled a dataset of amniota to resolve the position of turtles relative to birds and crocodiles. most recent studies favour an archosaurus hypotheses that unites birds and crocodiles as sister groups . the mp-est analyses byresolved this relationship differently when aa and dna gene trees were used; thus, aa had 99 support for the archosaurus clade, but dna rejected archosaurus with 90 support. we analysed the same dataset using the exact version of astral and found that both aa and dna recover archosaurus; however, while astral on aa gene trees recovered archosaurus with 100 support, astral on dna gene trees had only 55 support for archosaurus. running time. comparisons between coalescent-based methods reveal substantial differences in running time. for example, on the mammalian dataset fromwith 37 taxa and 421 genes, mp-est (run with 10 random starting points) used 83 min per bootstrap replicate, while astral used 7 s. analyses of the simulated mammalian datasets allow us to explore the limits of bucky-pop, as well as obtain other comparisons. we examine running times under moderate ils, gene sequences of length 500 bp, and with 400 and 800 genes and with bestml input trees (except for bucky-pop). bucky-pop strictly runs in serial, using a bayesian markov chain monte carlo (mcmc) technique, which can take a long time and substantial memory to reach convergence. on the 37-taxon mammalian simulated datasets, bucky-pop ran to completion for datasets with up to 400 genes (where it took $5 h), but failed to complete (due to memory issues) on the 800-gene dataset. mp-est completed relatively quickly$100 minfor both the 400-gene and 800-gene datasets. we ran mp-est with 10 random starting points, so this time could be reduced by using just one starting point, but with a potential decrease in accuracy. astral completed in 3.3 s on the 400-gene dataset and in 5.3 s on the 800-gene dataset. thus, astral is dramatically faster than the other methods and able to run on these phylogenomic datasets in reasonable time frames. however, bucky is used with 200 bootstrapped gene trees for each gene and outputs support values. running astral and mp-est using mlbs to obtain support values would increase their running times if run in serial, but astral would still be much faster than bucky (e.g. 11 min on the 400-gene dataset rather than 5 h). in addition, parallelizing mlbs is trivial because each bootstrap replicate is independent. see supplementary materials for more information about running times under different model conditions.  
