GeneCodeq: quality score compression and improved genotyping using a Bayesian framework Motivation: The exponential reduction in cost of genome sequencing has resulted in a rapid growth of genomic data. Most of the entropy of short read data lies not in the sequence of read bases themselves but in their Quality Scoresthe confidence measurement that each base has been sequenced correctly. Lossless compression methods are now close to their theoretical limits and hence there is a need for lossy methods that further reduce the complexity of these data without impacting downstream analyses. Results: We here propose GeneCodeq, a Bayesian method inspired by coding theory for adjusting quality scores to improve the compressibility of quality scores without adversely impacting geno-typing accuracy. Our model leverages a corpus of k-mers to reduce the entropy of the quality scores and thereby the compressibility of these data (in FASTQ or SAM/BAM/CRAM files), resulting in compression ratios that significantly exceeds those of other methods. Our approach can also be combined with existing lossy compression schemes to further reduce entropy and allows the user to specify a reference panel of expected sequence variations to improve the model accuracy. In addition to extensive empirical evaluation, we also derive novel theoretical insights that explain the empirical performance and pitfalls of corpus-based quality score compression schemes in general. Finally, we show that as a positive side effect of compression, the model can lead to improved genotyping accuracy. Availability and implementation: GeneCodeq is available at:Over the past decade, unprecedented advances in next generation sequencing (NGS) technologies have led to a dramatic reduction in sequencing cost and much faster data production rates . These technological advances are fostering increasingly wide-ranging applications in biotechnology, public healthcare and personalized medicine . Furthermore, as genomic sequencing data has grown exponentially, they have outpaced advances in some information technologies that they indirectly rely on: computing power and storage . In particular, genome sequencing results in a large storage footprint for each genome. Thus, storing and transferring raw sequencing information is becoming prohibitively expensive and effective compression schemes of raw sequencing data are indispensable.The majority of NGS data output consists of read sequence information whereby each nucleotide base is associated with a sequence confidence level (also referred to as quality score), produced by the base caller . The Phred scale Q 10log 10 P encodes with integer Quality Score Q an estimate of the probability P that the base has been called incorrectly. This information is used both for the quality control of raw read data and for downstream processing, including genome assembly, read mapping and genotyping . In compressed genomic datasets, quality score values take up the dominating share. For example, when compared to the read sequence data, quality scores of Illumina reads take at least 2.3 more storage, although this can be an even higher ratio when using more aggressive sequence compression . Quality scores are more difficult to compress due to a larger alphabet (6394 in original form) and intrinsically have a higher entropy . With lossless compression algorithms and entropy encoders reaching their theoretical limits and delivering only moderate compression ratios , there is a growing interest to develop lossy compression schemes to improve compressibility further. Quantizing quality scores (i.e. reducing the alphabet size) is the most basic approach to improve compressibility in a lossy manner. One such approach of reducing all quality values to eight levels (bins) has become a widely used standard for the Illumina platform and is enabled by default on the most recent machines . Another approach called P) involves local quantization so that a representative quality score replaces a contiguous set of quality scores that are within a fixed distance of the representative score. Similarly the R) scheme replaces contiguous quality scores that are within a fixed relative distance of a representative score. Other lossy approaches improve compressibility and preserve higher fidelity by minimizing a distortion metric such as meansquared-error or L1-based errors (Qualcomp and QVZ) . However, adoption of lossy compression schemes for quality scores has been slow due to concerns about adverse effects on downstream analyses, in particular genotyping accuracy . However, there are also reports that compression schemes such as P-Block, R-Block, QVZ and Qualcomp can, under some circumstances, lead to a slight improvement in genotyping accuracy. A number of more recent approaches utilize the sequence data itself to guide the quality score compression. Quartz achieves this using a reference corpus built from frequent 32-mers across reads from individuals sequenced in the 1000 Genomes Project . Read base pairs that match any one 32-mer in the corpus (up to one allowed mismatch per 32-mer) have their quality score set to a fixed high value. This sparsification of quality scores reduces entropy, thus improving quality score compressibility. A different approach, Leon, utilizes the dataset itself for building its set of k-mers, and to generate a reference probabilistic de Brujin Graph. In this case, bases in a read that have enough highly frequent k-mers covering it within the dataset are set to a fixed high-value quality score. Both methods were reported to improve genotyping accuracy. In this article we present GeneCodeq, a lossy compression scheme that is inspired by coding theory and Bayesian inference. Uniquely, GeneCodeq uses a statistical approach to objectively reason about the compressibility of quality scores. Briefly, our model estimates the posterior probability of a sequencing error given the evidence of the full read, including quality scores, together with information from a reference corpus. As a result, the posterior estimates of most quality scores are boosted above a saturation point of the Phred scheme, corresponding to very high confidence. This approach results both in a significant reduction in entropy and better genotyping accuracy when compared to existing methods.Weve used sequences from NA12878 for evaluation purposes due to availability of high quality trio-validated SNP calls to validate genotyping accuracy. Unmapped raw reads were obtained for two datasets: @BULLET SRR622461, a 1000 Genomes Project (1000 Genomes) dataset with 18.3 gigabases at 5 coverage. @BULLET NA12878J, a public dataset from the Garvan Institute with 122.6 gigabases at 30 coverage (see Supplementary Materials for details). Resulting variant calls from genotyping were compared to the Illumina Platinum set (http://www.illumina.com/platinumgenomes), which served as a gold standard. In the Supplementary Material we also provide results for additional datasets. The raw FASTQ files were processed with GeneCodeq, Quartz , R), P-Block (C), QVZ , Qualcomp , Leon and Illumina 8-bin quantization . We used the GATK best practices workflow and the samtools recommended workflow, with and without BaseQuality-Score-Recalibration (BQSR). In addition to running GeneCodeq in its default mode, we also explored its behaviour with a reference-only corpus (see Section 3.2 for more details), as well as in combination with other approachesIllumina 8-bin, P-Block and R-Block (see Section 3.4 for more details). For comparison, Quartz was also run with a reference-only corpus, and in combination with Illumina 8-bin quantization. We found that the BQSR stage produces a greater variable change to genotyping accuracy than most of the lossy compression algorithms do alone (pre-BQSR). This makes it difficult to separate and properly assess the impact of lossy compression alone on postBQSR results. On the lossless dataset, applying BQSR resulted in a significant drop in genotyping accuracy. Combinations of BQSR with lossy compression also resulted in lower genotyping accuracy versus the original across almost all methods. However, since BQSR had a large variable impact, sometimes the lossy compressed postBQSR results appeared better than the lossless post-BQSR results, skewing relative comparisons. There are strong indications that this is due to flaws with BQSR itself rather than due to the lossy compression. A detailed discussion, included additional results, can be found in the Supplementary Material. The improvements with GeneCodeq are seen across each combination of workflows, for brevity the main results shown here are with the GATK best practices workflow excluding BQSR. Similar results are seen with the samtools recommended workflow, which can be found in the Supplementary Material, along with BQSR results. Variant calls that resulted from the datasets and produced using these workflows, were ranked by their confidence levels (quality of the variant call) to generate receiver operating characteristic (ROC) curves. This approach avoids choosing a specific quality threshold and hence is well suited to compare alternative methods (see alsowhere a similar approach is used). However, if two ROC curves have different domains (i.e. a different set of variants for the x-axis) then they are not directly comparable to one another. For the results here and in the supplementary material, the ROC curves and area under the curve (AUC) were calculated with a common domain. As additional quality metrics, we also report precision, recall and F-score metrics. See Supplementary Material for more details on the evaluation approach for all these metrics. To estimate the impact in compressibility, both the raw and modified quality scores were compressed with bzip2 (http://www. bzip.org), unless a custom entropy coder was already integrated into the lossy compression (i.e. QVZ, Qualcomp and Leon). We chose bzip2 because under its default options it consistently yielded superior compression numbers compared to 7zip (http://www.7-zip.org) and gzip (http://www.gzip.org). We note, however, that 7zip in its PPMd mode can perform even better, and these results are included in the Supplementary Material. This includes significantly better 7zip re-compressed results for Leon which ordinarily uses the poorer performing zlib for its internal compression.reports quality score compression rates and genotyping accuracy metrics for these approaches.shows a scatter plot summarizing the best results in, depicting the genotyping accuracy and compressibility. 
