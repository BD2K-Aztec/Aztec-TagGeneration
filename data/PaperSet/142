A fast and automated solution for accurately resolving protein domain architectures Motivation: Accurate prediction of the domain content and arrangement in multi-domain proteins (which make up 65 of the large-scale protein databases) provides a valuable tool for function prediction, comparative genomics and studies of molecular evolution. However, scanning a multi-domain protein against a database of domain sequence profiles can often produce conflicting and overlapping matches. We have developed a novel method that employs heaviest weighted clique-finding (HCF), which we show significantly outperforms standard published approaches based on successively assigning the best non-overlapping match (Best Match Cascade, BMC). Results: We created benchmark data set of structural domain assignments in the CATH database and a corresponding set of Hidden Markov Model-based domain predictions. Using these, we demonstrate that by considering all possible combinations of matches using the HCF approach, we achieve much higher prediction accuracy than the standard BMC method. We also show that it is essential to allow overlapping domain matches to a query in order to identify correct domain assignments. Furthermore, we introduce a straightforward and effective protocol for resolving any overlapping assignments, and producing a single set of non-overlapping predicted domains. Availability and implementation: The new approach will be used to determine MDAs for UniProt and Ensembl, and made available via the Gene3D websiteAn active field of bioinformatics pursues the identification and classification of protein domain families. This is critical to our understanding of how proteins evolve new functions and how domain family content can explain phenotypic variation between organisms. From an annotation perspective, newly To whom correspondence should be addressed. The authors wish it to be known that, in their opinion, the first two authors should be regarded as joint First Authors. sequence genomes can be scanned against libraries of domain families in order to predict the function of novel genes . However, due to both the huge number of sequences in the protein databases, and also the large number of domain families, it is essential to use fast robust sequence analysis and comparison techniques. Furthermore, unless manual validation is used when building profiles of families, a given query sequence can generate many conflicting and overlapping matches. These are the result of complex structural rearrangements and gene fusion events that have occurred throughout evolutionary history. Resources such as InterPro and Pfam apply extensive curation of their family models and the resulting predictions. In contrast, fully automated protocols remain useful in helping identify novel families that are then fed into the manual curation pipelines, rather than directly used for biological analyses (i.e. Pfam-B, ADDA and CHOP;). However, using manual verification is very expensive and time consuming, and will become increasingly so in the era of high throughput sequencing. Gene3D , a member of the InterPro consortium, provides domain annotations based on the CATH structural domain classification . CATH provides a manually validated set of domains derived from structures in the PDB , and these domains are grouped into superfamilies where there is evidence of common evolutionary ancestry from shared sequence, structural and functional features. Gene3D uses a similar approach to the SUPERFAMILY resource , which is based on the SCOP structural classification . A set of structural representatives are chosen from each superfamily in CATH and used to seed an automatic iterative search process (SAM Target-2K;). The resulting multiple sequence alignment is then converted into a Hidden Markov Model (HMM). Each superfamily may be represented by more than one model, with an average of four per superfamily. These models are then used to identify probable homologous domains in protein sequences, and the resulting predictions merged into a final set of assignments. Gene3D aims to provide high quality structural domain annotations for the major genome and protein sequence databases, including Ensembl , UniProt and RefSeq see Supplementary Data for example genome coverage. The annotation pipeline for determining a multi-domain architecture of a given query sequence can be considered to consist of three main steps:(1) Generate a HMM model library to represent structural domains in CATH.(2) Scan the query against the model library using HMMsequence search software (e.g. HMMER2).A CATH benchmark dataset was constructed from a representative set of sequences from the PDB, in order to evaluate the relative performance of the BMC and HCF approaches, as well as the effect of varying the allowed overlap threshold. If the domain assignment and boundary resolution process was working accurately, we would expect to be able to reconstruct the manual assignments by scanning the PDB benchmark set against the CATH HMM library. Using the same set of HMM results (the prediction set), we tested the two approaches against each other, along with varying the allowed overlap parameter.shows a comparison of the accuracy of the two methods with respect to correctly predicting the multi-domain architecture. When HMM matches are not allowed to overlap (i.e. threshold = 0), Page: 749 745751The residue accuracy is the percentage of residues determined correctly as according to the source CATH assignments (only multi-domain data shown). This measure reflects the accuracy of boundary assignments more reliably than attempting to determine equivalence between predicted segments and curated segments. Plotted on the y-axis is the percentage of chains for which DF2 or DF3 achieve at least the accuracy indicated on the x-axis. Shown are the accuracy distributions for the BMC (grey) and HCF (black) methods with allowed overlaps of 1 (triangles and crosses) and 30 residues (dashes and diamonds). Using HCF with a 30 residue overlap achieves 90 accuracy for 75 of chains, while only 50 of chains are at least that accurate when DF2 is used. the BMC method only achieves 52 accuracy versus 68 for HCF. Increasing the overlap threshold makes a substantial difference to the percentage of correct predictions for both BMC and HCF, but relies on the new overlap resolution mechanism in DF3. An optimal overlap limit of 30 residues increases MDA prediction accuracy from 68 to 91 for HCF, while BMC accuracy improves from 52 to 84. The superior performance of the HCF algorithm largely arises from a decrease in false negatives (i.e. missing domain assignments), although there is also some improvement in the false positive rates . This improvement is confirmed by examining the residue assignment accuracy : the original version of DF2 (where overlap = 1) only annotated 50 of sequences with 90 residue accuracy, while DF3 (where overlap = 30) achieved this level of accuracy on 75 of sequences. An alternative approach for determining the allowed overlap is to use a percentage of the match length. As can be seen in, similarly high levels of accuracy are achieved by using a threshold between 30 and 40 (using the HCF approach). However, as noted in the Supplementary Data the true false positive rate for the Gene3D models over this benchmark are very low; we suspect that a percentage threshold will be less tolerant with noisy predictions. If a match can be overlapped by up to 80 of its length (40 at each end) then erroneous matches that do not align with the boundaries of correct ones are more likely to be incorporated. We have also tested whether limiting the prediction of discontinuous domains to those superfamilies for which they have been observed would improve the accuracy of the algorithm. However, despite our concern that this might in fact over-fit to the benchmark data set, it slightly reduced overall performance (data not shown). The CATH benchmark, whilst useful for optimising parameters and the core algorithm, does not completely emulate a real-worldoverlap accuracy. Using a percentage overlap threshold also performs well on this benchmark set. However, 0.5 (see Supplementary Data) of the matches in this benchmark are to nonhomologous families, and so it is not clear that this method would be tolerant of noisy data (see). situation: scanning large, highly divergent, sequence databases for which the nearest structural representative may have a very dissimilar sequence. To better re-create this situation we generated two smaller benchmark sets to capture key aspects of this variation, as described in the section 2.5.2 (the Distant Benchmark) and 2.5.3 (the Gapped Benchmark). The results on the multi-domain proteins show a similar distribution and profile to the original benchmark (seeand b), suggesting that the results for the main benchmark can be considered to be generally representative of the relative accuracy of the two approaches. The benchmark results above give us confidence that using HCF and a 30 residue overlap limitwhich we now term DF3will produce more accurate architectures and allow us to detect many more domains. To test this we analysed their performance on largescale sequence databases. To examine whether the new approach will translate into a significant improvement to the Gene3D resource, we searched a sequence database comprising UniProt and Ensembl with Hmmer and the CATH v3.2.0 HMM library. The matches were then resolved using both the old protocol, DF2 (BMC with a one residue allowed overlap) and the newly defined DF3 (heaviest weighted clique with a 30 residue allowed overlap). In a very small number of cases (0.005 sequences) a graph was produced that contained more than 6000 edgesfor these, the HCF approach took at least a day and sometimes much longer to calculate. Hence, matches for these query sequences were instead resolved using BMC to keep the computation time feasible. Both DF2 and DF3 ran across the whole set within two days on two dual core 3.0 GHz Intel Xeon CPUs. The DF algorithms can be easily parallelized, and so can be distributed across multiple CPUs. In practice, the overall speed is limited by the time taken to solve the single most complex graph. The MDAs predicted by DF3 for UniProt contained 600 000 more domains than those predicted by DF2 (an increase of 15) and a similar increase for Ensembl (20) compared to DF2. The majority of new domains were restricted to just a couple of hundred superfamilies, though around half (1000) of all superfamilies showed a clear increase, and 1 showed any decrease (see). Furthermore, whilst all of the matches to one superfamily were lost Page: 750 745751Accurate prediction of multi-domain architectures can be extremely useful for many function and network prediction methods, including phylogenetic profiling, gene fusion detection, proteinprotein interaction inheritance, and annotation by homology transfer. However, current automated approaches are of unknown accuracy or are compared with Pfam or InterPro, where manual curation requires substantial investment. Both resources also contain many families that are not based on single domains, which in turn creates problems when benchmarking domain-related methods, such as ab initio domain prediction algorithms. Gene3D aims to be a gold-standard provider of domain family assignments, of equivalent accuracy to the manually-curated resources. So we set out in the first instance to define a useful measure of our accuracy in predicting multidomain architectures, and then to improve on those predictions. Since it is not possible to accurately estimate performance over UniProt, we have generated a PDB-based benchmark that provides a means of comparing different algorithms (i.e. BMC versus HCF). Furthermore, we show that the results are likely to hold true for scanning large protein sequence repositories, by simulating cases of uncharacterised domain superfamilies and the absence of close relatives. The benchmarks suggest that using DF3HCF and 30-residue allowed overlapleads to a 35 increase in accuracy compared to the old DF protocol for predicting multi-domain architecture from a list of matches to a HMM model library. Including single domain proteins, the overall accuracy is 95, with many of the errors due to erroneous structures and assignments in the PDB and CATH. Most of the increase in multi-domain prediction accuracy is due to the loss of false negatives, and so would be expected to translate into an increased number of domains found in the sequence databases. As expected, the number of domains found in UniProt and Ensembl increased by 1520. As of Gene3D version 8 all annotations have been generated using DF3. There remains some room for improvement on the specific failures, and many common MDA archetypes, especially transmembrane proteins, are simply not present in the PDB. 
