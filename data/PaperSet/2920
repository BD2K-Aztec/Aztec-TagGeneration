Systems biology MetAssign: probabilistic annotation of metabolites from LCâ€“MS data using a Bayesian clustering approach R on Motivation: The use of liquid chromatography coupled to mass spec-trometry has enabled the high-throughput profiling of the metabolite composition of biological samples. However, the large amount of data obtained can be difficult to analyse and often requires computational processing to understand which metabolites are present in a sample. This article looks at the dual problem of annotating peaks in a sample with a metabolite, together with putatively annotating whether a me-tabolite is present in the sample. The starting point of the approach is a Bayesian clustering of peaks into groups, each corresponding to putative adducts and isotopes of a single metabolite. Results: The Bayesian modelling introduced here combines information from the mass-to-charge ratio, retention time and intensity of each peak, together with a model of the inter-peak dependency structure, to increase the accuracy of peak annotation. The results inherently contain a quantitative estimate of confidence in the peak annotations and allow an accurate trade-off between precision and recall. Extensive validation experiments using authentic chemical standards show that this system is able to produce more accurate putative identifications than other state-of-the-art systems, while at the same time giving a probabilistic measure of confidence in the annotations. Availability and implementation: The software has been implemented as part of the mzMatch metabolomics analysis pipeline, which is available for download at http://mzmatch.sourceforge.net/.The metabolome, being the entire set of metabolites in a biological system, is a highly informative descriptor of the physiological state of an organism, and understanding the dynamics of the metabolome is essential for a wide range of biomedical applications. Major advances have been made recently in the development of high-throughput assays to measure the metabolome . One of the most popular methods for this purpose is mass spectrometry (MS), coupled to a chromatographic separation, such as liquid chromatography (LC). The output of the LCMS process is a set of peaks, characterized by their mass per unit charge and their chromatographic retention time. For almost all subsequent analysis to be undertaken, these measured peaks have to be annotated (i.e. matched to the particular metabolites that produced them). Accurate reliable peak annotation and metabolite identification is currently the greatest challenge in high-throughput metabolomics . In this article, the terms identification and annotation are used in the sense specified by the chemical analysis working group of the metabolomics standards initiative, where identification means a positive comparison with an authentic standard using two or more measured quantities (e.g. mass and retention time) and annotation means a positive comparison with compounds using physicochemical properties or spectral databases . Tandem MS (or, more generally, MS n ) and comparison with authentic standards are two common approaches to providing robust metabolite identifications . For global untargeted metabolomics, comparison of each detected metabolite with an authentic standard rapidly becomes infeasible (through cost and availability of standards). Fragmentation methods including MS/MS and MS n are powerful, but rely on libraries of fragmentation patterns of authentic standards . However, fragment patterns are often similar between isomers of the same compound. Fragmentation prediction algorithms exist but are limited in similarity to standards-derived fragment patterns. There are three key factors that make peak annotation and metabolite identification difficult. First, the finite mass accuracy of the MS equipment and the large number of potential formulas results in multiple possible mass-matches for each observed peak . Second, each metabolite in the sample being measured may produce many peaks, including isotopologues, adducts, molecular fragments and multiply charged ions . These peaks form a dependency structure and exacerbate the problem of overlapping database matches; accounting for them in some manner is needed to avoid an overwhelming number of false annotations. Finally, many observed peaks will be the result of impurities and contaminants . To whom correspondence should be addressed. The Author 2014. Published by Oxford University Press. This is an Open Access article distributed under the terms of the Creative Commons Attribution License (http://creativecommons.org/licenses/by/3.0/), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited. A considerable number of computational methods have been developed to address the metabolite annotation challenge . One of the main differences among existing algorithms is how they treat derivative peaks and their associated dependency structure. Some methods ignore these relations altogether and match individual peaks against a database . Others attempt to annotate metabolites by first grouping peaks in some manner and then assigning a putative annotation to the groups (e.g.). Additional types of data can also help, e.g. predicted retention times of molecules have recently been used to help in identification . There has also been much work on the use of multistage MS to produce a fragment tree that can be compared against hypothetical fragment trees to contribute to the annotation . As well as methods that attempt to improve accuracy by taking into account inter-peak dependencies, there have also been attempts to incorporate additional information not contained within the spectra to improve annotation. For example,, Silva et al.To assess the performance of peak annotations, three measures were used, precision, recall and their harmonic mean, the F 1 score. As in all classification algorithms, there is a trade-off between precision and recall, with good procedures trying to maximize both. With comprehensive results given in the Supplementary Material,shows an example of this trade-off. In these figures, Prior means the prior probability of peaks being assigned to metabolites, Posterior means the raw posterior probability and MetAssign means the posterior probability calculated as described in Section 2.3. As can be seen from these results, MetAssign performs best, with the best precision while recalling the majority of peaks, the target it was designed to achieve. In this circumstance, mzMatch struggles to recall half the peaks, with a precision of 0.5, while CAMERA is extremely selective and annotates only a tiny fraction of the input data, albeit with high precision. To see the systematic behaviour of the algorithms,shows how the F 1 score changes as the size of the decoy database is varied. For the smallest databases, the prior assignment based on the best match of the mass-to-charge ratio performs best, but as the database grows to more and more realistic sizes, the MetAssign algorithm becomes the best performing method. For the metabolite annotation task, the results are presented in terms of the TPR and FPR. An example analysis of this task is shown in the form of a ROC curve in. Although the MetAssign output dominates the other methods over most parts of the curve, the operating point will be at a level from 0 to 5 FPR, and it is here that the behaviour is of interest. At this level the number of false positives returned by an algorithm would beBold values indicate best performance.limited, while still achieving an acceptable amount of recall of the compounds that are present in the sample.shows the performance at an FPR of 5; as can be seen, MetAssign consistently performs much better than the other two algorithms at annotating metabolites, for all standard mixtures tested and at all sizes of the decoy database. 
