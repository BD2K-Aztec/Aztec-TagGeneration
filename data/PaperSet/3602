pong: fast analysis and visualization of latent clusters in population genetic data Motivation: A series of methods in population genetics use multilocus genotype data to assign individuals membership in latent clusters. These methods belong to a broad class of mixed-membership models, such as latent Dirichlet allocation used to analyze text corpora. Inference from mixed-membership models can produce different output matrices when repeatedly applied to the same inputs, and the number of latent clusters is a parameter that is often varied in the analysis pipeline. For these reasons, quantifying, visualizing, and annotating the output from mixed-membership models are bottlenecks for investigators across multiple disciplines from ecology to text data mining. Results: We introduce pong, a network-graphical approach for analyzing and visualizing membership in latent clusters with a native interactive D3.js visualization. pong leverages efficient algorithms for solving the Assignment Problem to dramatically reduce runtime while increasing accuracy compared with other methods that process output from mixed-membership models. We apply pong to 225 705 unlinked genome-wide single-nucleotide variants from 2426 unrelated individuals in the 1000 Genomes Project, and identify previously overlooked aspects of global human population structure. We show that pong outpaces current solutions by more than an order of magnitude in runtime while providing a customizable and interactive visualization of population structure that is more accurate than those produced by current tools. Availability and Implementation: pong is freely available and can be installed using the Python package management system pip. pongs source code is available at https://github.com/abehr/ pong.A series of generative models known as mixed-membership models have been developed that model grouped data, where each group is characterized by a mixture of latent components. One well-known example of a mixed-membership model is latent Dirichlet allocation , in which documents are modeled as a mixture of latent topics. Another widely used example is the model implemented in the population-genetic program STRUCTURE , where individuals are assigned to a mixture of latent clusters, or populations, based on multilocus genotype data. In this article, we focus on the population-genetic application of mixed-membership models, and refer to this application as clustering inference; see Novembre (2014) for a review of multiple population-genetic clustering inference methods, including STRUCTURE. In STRUCTUREs Bayesian Markov chain Monte Carlo algorithm, individuals are modeled as deriving ancestry from K clusters, where the value of K is user-specified. Each cluster is constrained to be in Hardy-Weinberg equilibrium, and clusters vary in their characteristic allele frequencies at each locus. Clustering inference using genetic data is a crucial step in many ecological and evolutionary studies. For example, identifying genetic subpopulations provides key insight into a samples ecology and evolution , reveals ethnic variation in disease phenotypes , and reduces spurious correlations in genome-wide association studies . For a given multilocus genotype dataset with N individuals and K clusters, the output of a single algorithmic run of clustering inference is an N K matrix, denoted as Q, of membership coefficients; these coefficients can be learned using a supervised or unsupervised approach. Membership coefficient q ij is the inferred proportion of individual is alleles inherited from cluster j. The row vector q i is interpreted as the genome-wide ancestry of individual i, and the K elements of q i sum to 1. Each column vector q j represents membership in the jth cluster across individuals. Although covariatessuch as population labels, geographic origin, language spoken or method of subsistenceare not used to infer membership coefficients, these covariates are essential for interpreting Q matrices. Given that over 16 000 studies have cited STRUCTURE to date, and 100 or more Q matrices are routinely produced in a single study, investigators need efficient algorithms that enable accurate processing and interpretation of output from clustering inference. Algorithms designed to process Q matrices face three challenges. First, a given run, which yields a single Q matrix, is equally likely to reach any of K! column-permutations of the same collection of estimated membership coefficients due to the stochastic nature of clustering inference. This is known as label switching: for a fixed value of K and identical genetic input, column q j in the Q matrix produced by one run may not correspond to column q j in the Q matrix produced by another run . In our analyses of the 1000 Genomes (phase 3;), label switching occurred in 62.64 of pairwise comparisons among runs; that is, many matrices of membership coefficients were identical once columns were permuted to match, and rapidly finding permutations that maximize similarity between Q matrices is computationally expensive as K increases. Second, even after adjusting for label switching, Q matrices with the same input genotype data and the same value of K may differ non-trivially. This is known as multimodality , and occurs when multiple sets of membership coefficients can be inferred from the data. We refer to runs that, despite identical inputs, differ non-trivially as belonging to different modes. For a fixed value of K, a set of runs grouped into the same mode based on some measure of similarity can be represented by a single Q matrix in that mode. Many studies using the maximumlikelihood approach for clustering inference implemented in ADMIXTURE ignore manifestations of multimodality , despite the fact that ADMIXTURE can identify different local maxima across different runs for a given value of K (e.g.). The complete characterization of modes present in clustering inference output gives unique insight into genetic differentiation within a sample. A third complication arises for interpreting clustering inference output when the input parameter K is varied (all other inputs being equal): there is no column-permutation of a Q NK matrix that exactly corresponds to any Q NK1 matrix. We refer to this as the alignment-across-K problem. A common pipeline when applying clustering inference methods to genotype data is to increment K from 2 to some user-defined maximum value K max , although some clustering inference methods also assist with choosing the value of K that best explains the data .. Accurate and automated analysis of clustering inference output across values of K is essential both for understanding a samples evolutionary history and for model selection. The label-switching, multimodality, and alignment-across-K challenges must all be resolved in order to fully and accurately characterize genetic differentiation and shared ancestry in a dataset of interest. Here, we present pong, a new algorithm for fast post-hoc analysis of clustering inference output from population genetic data combined with an interactive JavaScript visualization using DataDriven Documents (D3.js; https://github.com/mbostock/d3). Our package accounts for label switching, characterizes modes, and aligns Q matrices across values of K by constructing weighted bipartite graphs for each pair of Q matrices based on similarity in membership coefficients between clusters. Our construction of these graphs draws on efficient algorithms for solving the combinatorial optimization problem known as the Assignment Problem, thereby allowing pong to process hundreds of Q matrices in seconds. pong displays a representative Q matrix for each mode for each value of K, and identifies differences among modes that are easily missed during visual inspection. We compare pong against current solutions [CLUMPP by; augmented as CLUMPAK by], and find our approach reduces runtime by more than an order of magnitude. We also apply pong to clustering inference output from the 1000 Genomes (phase 3) and present the most comprehensive depiction of global human population structure in this dataset to date. pong has the potential to be applied broadly to identify modes, align output, and visualize output from inference based on mixed-membership models.) from clustering inference with ADMIXTURE . In order to generate visualizations highlighting similarities and differences among Q matrices, pong generates weighted bipartite graphs connecting clusters between runs within and across values of K (Sections 2.2, 2.3). Our goal of matching clusters across runs is analogous to the combinatorial optimization problem known as the Assignment Problem , for which numerous efficient algorithms exist . pongs novel approach of comparing clusters column vectors of Q matricesdramatically reduces runtime relative to existing methods that rely on permuting entire matrices. Consider two Q matrices, Q q ij and R r ij . Each weighted bipartite graph GQ; R f q j g [ f r k g; E encodes pairwise similarities between clusters in Q and clusters in R. Edges in G are weighted according to a similarity metric computed between clusters (detailed in Supplementary Information); pongs default similarity metric is derived from the Jaccard index used in set comparison, and emphasizes overlap in membership coefficients without incorporating individuals who have no membership in the clusters under comparison. We define an alignment of Q and R as a bipartite perfect matching of their column vectors. pongs first objective is to find the maximum-weight alignment for each pair of runs for a fixed value of K (Section 2.2). This information is used to identify modes within K, and we randomly choose a representative run (Q matrix) for each mode found in clustering inference. We call the mode containing the most runs within each value of K the major mode for that K value (; ties are decided uniformly at random). pongs second objective is to find the maximum-weight alignment between the representative run of each major mode across values of K (Section 2.3;, Supplementary). Identifying the maximum-weight alignment within and across K inherently solves the label switching problem without performing the computationally costly task of comparing whole-matrix permutations. Last, pong colors the visualization and highlights differences among modes based on these maximum-weight alignments.We ran ADMIXTURE on 225 705 unlinked genome-wide single-nucleotide variants from 2426 unrelated individuals in the 1000 Genomes Project (phase 3; Consortium, 2015; see Supplementary Materials) to characterize population structure among globally distributed human populations. ADMIXTURE was run with K ranging from 2 to 10, and 10 runs were generated per value of K. Thus, a total of 90 Q matrices were produced; Figures 1 and 2 depict pongs analysis of 20 of these runs. We also applied CLUMPAK , the state-of-the-art method for automated post-processing and visualization of clustering inference output, to these 90 runs (partial results shown in Figures 3B and C; see also Supplementary). CLUMPAK automatically runs CLUMPP for each value of K as part of its pipeline, and produces visualizations within and across values of K using DISTRUCT , displaying one barplot per mode.shows CLUMPAKs reported major mode in the 1000 Genomes dataset at K 10, which averages over six runs; all major modes reported by CLUMPAK can be viewed in Supplementary. Using CLUMPAKs web server (http://clumpak.tau.ac.il/) with its default settings (including using CLUMPs fastest algorithm, LargeKGreedy, for aligning Q matrices for a fixed value of K) took 58 min and 18 s for post-processing of these 90 runs. We could not apply other CLUMPP algorithms to the 1000 Genomes dataset using CLUMPAKs web server due to the servers restrictions against exhaustive running times . We also installed CLUMPAK locally on Linux machines running Debian GNU/Linux 8 with 8 GB of RAM. Processing these 90 Q matrices took 74.275 hours using CLUMPPs LargeKGreedy algorithm; using CLUMPPs Greedy algorithm, which has increased accuracy over LargeKGreedy, CLUMPAK did not complete processing these Q matrices after four days. We also applied CLUMPPs FullSearch algorithm, its most accurate algorithm, to the 10 Q matrices where K 10; after 6.78 days, the job had still not completed.Under its default settings, pong parsed input, characterized modes and aligned Q matrices within each value of K, and aligned Q matrices across K in 17.5 seconds on a Mid-2012 MacBook Pro with 8 GB RAM. After opening a web browser, pongs interactive visualization loaded in an additional 3.2 s (Supplementaryshows the main visualization). In, pong identifies four modes at K 10 in the 1000 Genomes dataset (phase 3). Light blue represents the cluster of membership coefficients first identified at K 10 (see also Supplementary Figures S1 and S2). In run k10r4 (representing 4 out of 10 runs), light blue represents British/Central European ancestry in the major mode (CEU and GBR). However, light blue represents South Asian ancestry (GIH) in 3 out of 10 runs (e.g. run k10r7), Puerto Rican ancestry (PUR) in 2 out of 10 runs (e.g., run k10r3), and Han Chinese ancestry in run k10r9. pongs display of representative runs for each mode allows the user to observe and interpret multiple sets of membership coefficients inferred from the data at a given value of K. In contrast, the minor mode CLUMPAK outputs is the same as pongs major mode , while CLUMPAKs major mode reported at K 10 averages over all minor modes identified by pong. The light blue in CLUMPAKs reported major mode could be easily misinterpreted as shared ancestry among South Asian, East Asian, and Puerto Rican individuals, when in actuality these are distinct modes. We note that the highest-likelihood value of K for the 1000 Genomes data we analyzed is K 8; at that value of K, we also see that CLUMPAKs major mode suggests shared ancestry among individuals that are actually identified as having non-overlapping membership coefficients when individual runs are examined (Supplementary Figures S1 and S2).shows pongs visualization with consistent colors of all Q matrices released by, K 5 through 25; pong was able to process these Q matrices and render its visualization in 67.06 s. The modes identified in, 3 and Supplementarydiffer substantially from the results reported by. For example, in, pong depicts substructure in Puerto Rico and in China that is not observed in Extended Databy. This could be due to different filters applied to the input SNP data (e.g. we removed relatives from data but did not filter based on minor allele frequency; see Supplementary Information), and we further note that these contrasting results indicate the need for efficient and accurate methods for processing and visualizing Q matrices.Here we introduce pong, a freely available user-friendly networkgraphical method for post-processing output from clustering inference using population genetic data. We demonstrate that pong accurately aligns Q matrices orders of magnitude more quickly than do existing methods; it also provides a detailed characterization of modes among runs and produces a customizable, interactive D3.js visualization securely displayed using any modern web browser without requiring an internet connection. pongs algorithm deviates from existing approaches by finding the maximum-weight perfect matching between column vectors of membership coefficients for pairs of Q matrices, and leverages the Hungarian algorithm to pong: analysis and visualization of latent clustersefficiently solve this series of optimization problems . Interpreting the results from multiple runs of clustering inference is a difficult process. Investigators often choose a single Q matrix at each value of K to display or discuss, overlooking complex signals present in their data because the process of producing the necessary visualizations is too time-consuming. pongs speed allows the investigator to focus instead on conducting more runs of clustering inference in order to fully interpret the clustering in her sample of interest. Currently, many population-genetic studies only carry out one run of A B C. Visualizations of modes in population structure identified by pong and CLUMPAK at K 10 for clustering inference with ADMIXTURE applied to 1000 Genomes data (phase 3;). The new cluster of membership coefficients first identified at K 10 is denoted by light blue in each barplot. (A) pongs dialog box of modes at K 10, with multimodality highlighted. (B) CLUMPAKs major mode at K 10 averages over six runs of clustering inference output; the reported mean similarity score among these six runs is 0.811. South Asian (GIH), Han Chinese (CHB and CHS), and Puerto Rican (PUR) individuals all have ancestry depicted by the light blue cluster in this plot. The six runs averaged here are instead partitioned into three minor modes by pong in panel A. (C) CLUMPAKs minor mode at K 10 averages over four identical runs (mean similarity score is 1.000). This barplot contains the same information as the barplot of k4r10, representing pongs major mode in panel A clustering inference per value of K , particularly when using ADMIXTUREs maximum-likelihood approach to the inferential framework implemented in STRUCTURE . The likelihood landscape of the input genotype data is complex, and can hold different local maxima for a given value of K (see). Combining pongs rapid algorithm and detailed, interactive visualization with posterior probabilities for K reported by clustering inference methods will allow investigators to accurately interpret results from clustering inference, thereby advancing our knowledge of the genetic structure of natural populations for a wide range of organisms. We further plan to extend pong to visualize results from other applications of mixedmembership models and to leverage the dynamic nature of bound data to increase the information provided by pongs visualization. 
