HHalign-Kbest: exploring sub-optimal alignments for remote homology comparative modeling Motivation: The HHsearch algorithm, implementing a hidden Markov model (HMM)-HMM alignment method, has shown excellent alignment performance in the so-called twilight zone (target-template sequence identity with 20). However, an optimal alignment by HHsearch may contain small to large errors, leading to poor structure prediction if these errors are located in important structural elements. Results: HHalign-Kbest server runs a full pipeline, from the generation of suboptimal HMM-HMM alignments to the evaluation of the best structural models. In the HHsearch framework, it implements a novel algorithm capable of generating k-best HMM-HMM suboptimal alignments rather than only the optimal one. For large proteins, a directed acyclic graph-based implementation reduces drastically the memory usage. Improved alignments were systematically generated among the top k suboptimal alignments. To recognize them, corresponding structural models were systematically generated and evaluated with Qmean score. The method was benchmarked over 420 targets from the SCOP30 database. In the range of HHsearch probability of 2099, average quality of the models (TM-score) raised by 4.116.3 and 8.021.0 considering the top 1 and top 10 best models, respectively. Availability and implementation: http://bioserv.rpbs.univ-paris-diderot.fr/services/HHalign-Kbest/ (source code and server).Automated protein structure prediction has been widely used for biological research in recent years. HHsearch is among the fastest and most accurate tool for remote homology detection and targettemplate alignment by using a hidden Markov model (HMM) pairwise alignment method . Despite its high performance, an optimal alignment often contains small to large errors, especially in the position and length of gaps. Usually, structural biologists correct these errors manually using back and forth examination of the alignments and of the resulting structural models. This task becomes particularly tedious when target-template sequence identities are low and hampers the development of fully automated pipelines able to generate accurate structural models.In this work, we present a tool integrating suboptimal technique within the Viterbi algorithm of HHsearch program to generate suboptimal alignments. This interest of suboptimal exploration has previously been shown for the prediction of membrane protein topology and in sequence-HMM pairwise alignments . We first studied 26 targets from the CASP10 TBM dataset (template-based modeling) to test the algorithms. The SCOP30 database (sequence identity in the range of 530,) was then used as a benchmark to define the conditions in which the strongest increase in model accuracy could be expected from the use of the HHalignKbest server.The Viterbi algorithm (for pair HMMs) of HHsearch is a hybrid between standard Viterbi and pairwise alignment algorithms and uses a dynamical programming matrix of three dimensions: target HMM length (noted as m), template HMM length (n) and the number of pair-state types (N 5) . To obtain k-best paths, a natural extension is to add another dimension of length k to this three-dimensional matrix. This fourth dimension stores an ordered top-k scores and can be calculated by an N-way merge sort efficiently. This matrix-based k-best Viterbi algorithm has both a theoretical space complexity and time complexity of O(Nkmn). Since the memory usage limits the application of the matrixbased method, we developed the directed acyclic graph-based algorithm. Based on the same principle, dynamical allocation of memory is used, which gives an opportunity to prune useless paths and nodes. This method requires dramatically less memory while taking only slightly longer time (Supplementary Results S1 and S2). CASP10 sets were used to evaluate whether suboptimal alignments could correct misaligned segment(s) in set A targets without degrading the accuracy of nearly perfect alignments of set B. We compared (sub)optimal alignments to a reference structural alignment calculated from the superimposition between the template and query PDB structures using TM-align . Qloc score was used to report the accuracy of an alignment [from 0 to 1 indicating from wrong to correct, see Supplementary Method S4 (.shows an example of suboptimal alignments for a target CASP10 set A (see Section 2), where the suboptimal N.398 (Qloc 0.860) corrected the second beta sheet (red), while N.485 (Qloc 0.835) corrected the first one (blue) perfectly in comparison with the Viterbi optimal alignment (Qloc 0.722) (see details in Supplementary). Using a procedure combining Modeller to generate models for each suboptimal alignment and Qmean Zscore to evaluate model quality , the suboptimal alignments incould be discriminated (Supplementary). N.398 and N.485 led to better models with TM-score (average TM-score of 20 models for each (sub)optimal alignment) 0.646 and 0.652, respectively, in comparison to Viterbi alignment TM-score 0.585 (Supplementary). No loss of accuracy was observed for set B (Supplementary). To benchmark HHalign-Kbest, 70 pairs of models/templates extracted from SCOP30 database were randomly selected in every six ranges of HHsearch probabilities (see Section 2). Pairs could be a posteriori divided into hard and easy cases depending on the TMscore of the Viterbi model, below or above 50, respectively . TM-scores were improved by 4.1 6.5 (top 1) and 8.012.7 (top 10) for HHsearch probabilities in the range 9099. The improvements increased up to 16.3 (top 1) and 21.0 (top 10) for the range 2090. Above 99, there were almost no hard cases, and HHalign-Kbest could still make minor improvements although it is not in the scope of use of the method (, Supplementary,). More details about scores, results analysis and server usage are provided in Supplementary Figures S5S11 and Supplementary Discussion. As a general algorithm, HHalign-Kbest may be integrated in alternative frameworks for model generation such as M4T to consider multiple templates and with alternative evaluation scores to better recognize the best models from the top_all k-best suboptimal alignments (k 500). 
