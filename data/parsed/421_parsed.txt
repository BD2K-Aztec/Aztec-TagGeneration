a phylogenetic kalman_filter for ancestral trait reconstruction using molecular data motivation correlation between life_history or ecological traits and genomic_features such as nucleotide or amino_acid can be used for reconstructing the evolutionary_history of the traits of interest along phylogenies thus far however such ancestral reconstructions have been done using simple_linear approaches that do not account for phylogenetic inertia these reconstructions could instead be seen as a genuine comparative regression_problem such as formalized by classical generalized least square comparative_methods in which the trait of interest and the molecular predictor are represented as correlated brownian characters coevolving along the phylogeny results here a bayesian sampler is introduced representing an alternative and more efficient algorithmic solution to this comparative regression_problem compared with currently existing generalized least square approaches technically ancestral trait reconstruction based on a molecular predictor is shown to be formally equivalent to a phylogenetic kalman_filter problem for which backward and forward recursions are developed and implemented in the context of a markov_chain sampler the comparative regression_method results in more accurate reconstructions and a more faithful representation of uncertainty compared with simple_linear application to the reconstruction of the evolution of optimal_growth in archaea using gc composition in ribosomal_rna stems and amino_acid of a sample of protein_coding confirms previous_findings in particular pointing to a hyperthermophilic ancestor for the kingdom availability_and the program is freely_available at www phylobayes org there is a growing interest in reconstructing the evolutionary_history of quantitative_traits along phylogenies using information coming from genetic_sequences in those cases where the evolution of genes or genomes is influenced by ecological or life_history the ancestral sequences which can be reconstructed over the tree using phylogenetic_methods will contain useful information about ancestral values of the trait one of the first applications of this idea was to the reconstruction of ancestral optimal growth_temperatures based on ribosomal_rna rrna nucleotide_composition or amino_acid of the proteome although in principle the same idea could be applied to other cellular ecological or morphological_traits that would correlate with genetic_sequences in its original formulation the sequence trait correlation approach proceeds in several steps first the correlation between the trait and the molecular predictor in the aforementioned example the trait being temperature and the predictor rrna or protein composition is characterized in extant_species typically a regression_analysis is conducted yielding an estimate of the slope and the intercept of the linear_regression of the trait against the predictor second ancestral sequences and thus ancestral values of the molecular predictor are inferred using molecular phylogenetic_methods finally the values of the predictor inferred in the ancestors along the phylogeny are translated into estimates of ancestral traits based on the regression this approach is simple and straightforward to implement one potential problem however is that it does not take into account phylogenetic inertia in the present context the phylogenetic structure underlying both the trait and the molecular predictor has at least two important consequences first the correlation measured in extant taxa between the trait and the molecular predictor should be corrected for the non independence between data_points second ancestral reconstructions could possibly benefit from the fact that inertia effectively induces an intertemporal smoothing of the reconstruction across neighboring nodes along the phylogeny an alternative to the stepwise regression_method would be to use a fully integrated comparative and phylogenetic_approach modeling the joint correlated_evolution of the trait and the sequences and conditioning the resulting hierarchical_model simultaneously on genetic_sequences and quantitative data this would account not only for phylogenetic inertia but also for all sources of uncertainty associated with the unknown_parameters of the model however in some cases proceeding in a stepwise manner dividing the problem into smaller and computationally more manageable tasks can be more practical also some interesting situations in particular involving trait dependent stabilizing selection on sequence_composition are not so easily modeled directly at the level of the substitution process as they induce interdependence among sites of the alignment a middle ground solution explored here still relies on a preliminary estimation of ancestral sequence compositions along the tree using a phylogenetic program thus ancestral composition is here treated as known and inferred separately from the model to be presented later in the text on the other hand the estimation of the correlation between composition and trait and the ancestral reconstruction of the trait are merged into one single step explicitly formalized as a comparative regression_problem similar models have been developed in the context of generalized least square methods and used for reconstructing among other things ancestral genome_sizes of extinct lineages once reconsidered in the context of the comparative method the question is typically formulated in terms of a multivariate process jointly encompassing the trait of interest and the molecular predictor mathematically a process z t is defined running along the branches of the phylogeny and combining the trait of interest x t and the molecular predictor y t in the case of rrna stems x t would be the temperature y t some function of the gc_content of rna stems so that z t would be a bivariate process in more general settings both x t and y t could themselves be multivariate under the brownian assumption the joint posterior_distribution over the values of the trait x and the predictor y over the phylogeny is multivariate_normal and can be compactly represented using the kronecker product formalism e g as in conditioning this distribution on observed values for the trait and or the predictor at the relevant nodes of the phylogeny can be done by maximum_likelihood using multivariate_normal theory and matrix calculus or in a bayesian_markov mcmc context using standard metropolishastings algorithms equivalently standard multivariate_normal theory allows for a reformulation of this model such that the joint variation of the trait x and the predictor y over the time interval t represented by a branch of the phylogenetic_tree is written as follows where t and t are normally distributed residual errors and b is a linear operator this reformulation suggests a hierarchical_structure in which a partially hidden state the trait x evolves along the phylogeny according to its own brownian generator effectively undergoing discrete time transitions from one node of the tree at time t to the next at time t t according to a multivariate_normal kernel the distribution of t before each such transition the process emits along the branch just visited an observable quantity the predictor yt yt t yt whose distribution linearly depends on the hidden_states at both ends of the branch through xt xt t xt based on the observed history of the predictor y along the phylogeny and the observed values of x at the tips the aim is to reconstruct the hidden evolutionary_history of x this reformulation suggests an analogy with hidden_markov or more specifically as all distributions are normal with what is known in particle_filtering and tracking as the kalman_filter there are several differences between the classical kalman_filter and its phylogenetic counterpart introduced here in particular in the classical kalman_filter the emitted state only depends on the current state whereas in the phylogenetic model the emitted state yt depends on both the current and the previous hidden_states also the classical kalman_filter unfolds along a linear time frame whereas the phylogenetic model is branched in time however these differences are minor and do not compromise the most important property of the kalman_filter namely its convenient analytical tractability leading to simple and computationally_efficient recursions for integrating and resampling hidden_states along the phylogeny using dynamic_programming methods and elementary matrix algebra importantly such reconstructions will automatically integrate both the across time smoothing effect between neighboring nodes for the trait x t and the additional information provided by the local behavior of the predictor yt about the local evolution of the trait x t the kalman approach introduced here and the generalized least square approaches mentioned earlier in the text are similar the main difference is algorithmic the kalman_filter having a globally lower algorithmic complexity than the algebraic and the metropolishastings approaches as will be detailed later in the text in this article the phylogenetic kalman_filter is introduced and formalized backward and forward recursions are established and are used in the context of a bayesian mcmc sampler as a gibbs_sampling method for updating the x component of the model this gibbs sampling_approach is then combined with another previously described conjugate gibbs_sampling algorithm for updating the correlation_matrix the combination of the two algorithms results in an efficient alternating gibbs strategy for sampling from the joint posterior_distribution over the unknown_parameters finally the phylogenetic kalman_filter is applied to the reconstruction of ancestral growth_temperatures in archaea 
