an efficient tof_sims image_analysis with spatial_correlation and alternating non negativity constrained least_squares motivation advances in analytical instrumentation towards acquiring high_resolution images of mass_spectrometry constantly demand efficient approaches for data analysis this is particularly true of time of_flight imaging where recent_advances enable acquisition of high_resolution data in multiple_dimensions in many applications the distribution of different species from a sampled surface is spatially continuous in nature and a model that incorporates the spatial_correlation across the surface would be preferable to estimations at discrete spatial_locations a key challenge here is the capability to analyse the high_resolution multidimen sional data to extract relevant_information reliably and efficiently results we propose a framework based on alternating nonnegativity constrained least_squares which accounts for the spatial_correlation across the sample_surface the proposed method also decouples the computational_complexity of the estimation procedure from the image_resolution which significantly_reduces the processing time we evaluate the performance of the algorithm with biochemical image datasets generated from mixture of metabolites imaging mass_spectrometry ims is an increasingly popular_approach in the characterization of biological_samples it is a powerful_tool to image surface_structure with a mass_spectrum measured at each pixel one ims technique is time of_flight tof_sims with applications in areas as varied as hair care medical implants and drug_delivery it is primarily applied in monitoring the distribution of targeted chemical_species but can also be employed for imaging surfaces in non targeted analyses when surface compositions are not well defined in particular in the analysis of biological_systems however this latter extension poses several challenges with respect to data deconvolution multivariate_analysis mva methods have been used extensively to map large complex spatio spectral tof_sims data into factors of single components providing insights into the type and distribution of chemical_species on a surface popular mva techniques to describe spatiospectral tof_sims data include principal_component pca maximum auto correlation factor maf and multivariate_curve mcr the pca is perhaps the most commonly used technique either as a main analysis step or an initialization step for ma approach maf is an alternative to pca which is independent of pre_treatment scaling the method is based on maximizing the autocorrelation between neighbouring pixels a comparison of the two methods for tof_sims data analysis is reported in recommending the use of maf when images with low spectral intensity are analysed the presence of negative peaks in the spectrum computed using pca or maf makes it more difficult_to the resulting factorization mcr optimized by alternating least_squares mcr als overcomes this problem by imposing a non negativity constraint in an iterative optimization_process however these methods can be computationally_expensive when applied to large three way datasets the fast combinatorial nonnegativity constrained least_squares fc nnls algorithm van is specifically_designed to handle such datasets allowing for significant_gains in the speed and computational_demands of the optimization_process in als applications despite a substantial performance increase in fc nnls the estimation of loadings and scores when decomposing large tof_sims data in an mcr als algorithm can still be problematic one limitation is that the complexity of the scores estimation is coupled with the number of image pixels therefore an increase in the image_resolution of the sample_surface leads to increases in the uncertainty and computational_demands of the score and loading estimates this is becoming increasingly important as sophisticated tof_sims images with higher_spatial are becoming more widespread even for a currently typical tof_sims dataset with pixels and a spectral mass_range up to da the implementation of als algorithm with three spectral basis_functions contains the estimation of values in the scores estimation step this emphasizes the benefit of decoupling the number of pixels in images and the number of parameters in addition the progress towards acquisition of image data in voxels as opposed to pixels confers further demand on the analysis time and efficiency of data_processing additionally in cases where the spatial distribution of compounds in an image is continuous such as chemical samples or samples from a biological cell or a cellular_environment the characteristics at proximate distant regions on the surface are expected to be highly weakly correlated this requires the inclusion of the spatial_correlation across the surface in the estimation of scores and loadings from tof_sims data we propose an approach to mcr als that incorporates a continuous over space formulation which accounts for spatial_correlation across the sample_surface additionally the algorithm does not couple the complexity of the estimation procedure to the resolution of tof_sims images resulting in a significant reduction in the processing time we exploit the method of a basis function decomposition of scores images which simplifies the estimation of individual pixel_values into a set of weights these weights scale the continuous basis_functions and lie in a significantly_lower dimensional_space we set out to examine the algorithm with biochemically relevant model image datasets that were generated from simple mixture of metabolites as an example the proposed algorithm was first implemented on pure species to extract discriminatory information from the estimated scores and loadings the extracted information was then used to perform peak assignment in the computed spectra of tc and tpc mixtures during this process the spectral_information was summarized into three major_peaks that can differentiate different species this information was also used to examine replicate measurements of each dataset to further evaluate the performance of the algorithm the total ion images for each dataset are depicted in supplementary tof_sims images were mapped onto in both x and y directions and therefore the spatial aspects of the model can be considered arbitrary cross_section of the spatial frequency_response along the x axis for tpc mixture is shown in from this figure it can be seen that to capture the full spatial bandwidth c should be set to a high value shown by blue dashed_line algorithm scores and loadings estimation decomposition determine m using pca define basis function centres l using equation define basis function widths r using equation construct y using equations and initialization initialize the weight_matrix a as a random dense matrix scores and loadings estimation define stopping condition threshold q set k while jja k a k jj f q update the loadings b k using fc nnls and equation update the weight_matrix a k using fc nnls and equation set k k end while update the loadings b k using fc nnls and equation estimation of high_resolution scores matrices calculate w from equation and the final estimate of b resulting into a high number of basis_functions a grid of with q alternatively the configuration can be chosen to represent the reconstructed_images up to a specified bandwidth to limit the number of basis_functions and hence computational demand of the estimation algorithm we set the cutoff frequency to c giving approximately db attenuation from the maximum power_spectrum this is shown by a red circle in in order to account for the slow roll off in the frequency_response of gaussianbasis functions the oversampling parameter of q was chosen using these values in equations and yielded the distance between adjacent basis_functions centres d and the width of basis_functions r given the spatial_domain of interest a grid of equally_spaced basis_functions can be used to satisfy shannons sampling criterion with this arrangement the number of unknown_parameters was reduced from m to m the pre_processing stage involved normalizing the data to the total ion counts this was followed by poisson scaling for the systems rank analysis an initial guess of the number of spectral basis vectors m for each poisson scaled dataset was obtained using pca and the scree test the scree plot for the first few principal_components is shown in the results suggested three spectral basis vectors for each of t p and c elements and two and three spectral basis vectors for tc and tpc mixtures respectively the proposed algorithm was then applied on tof_sims datasets to estimate loadings and the corresponding scores images in the estimation procedure we set m for all pure and mixed species despite the suggested rank of two for tc compound in the pca analysis the results for scores and loadings estimation for t p and c components are shown in the m z number for dominant peaks are illustrated in the loadings plots where the inset figures show the corresponding ion images in the tof_sims dataset shows large peaks sorted in order of decreasing magnitudes at m z and for the first factor of component t for component p the first factor comprises of large peaks at m z and for component c significant peaks for the first factor are located at m z and as can be seen the m h signals for each of the metabolite predominates but fragment_ion contributions also exist peaks at m z m z and m z are common between second and the third factors of all components therefore these m z values do not contain discriminatory information and can be considered noise in the system in fact the corresponding scores images of the second and third factors show noisy structures also the peak at m z presents in the first factors score and loading estimates using als with non negativity constraint for tpc mixture ac score estimates df loading estimates of t and p and cannot be used to distinguish these species from this analysis the characteristic peak for component p can be identified as m z which would be the deprotonated metabolite ion m h the result of the algorithm for tc mixture is illustrated in similar to the previous example we associate the peak at m z into the existence of the noise in the system the peak at m z of the first factor in component t can be also identified inwith its corresponding scores image illustrated in the same observation can be made for the component c where three peaks of the first factor that is m z and can be identified however the peaks at m z and can be putatively identified as fragment_ions chco c h o respectively there are also strong peaks at m z and m z for t and e respectively and at m z for c however these peaks are not present in tc and tpc mixtures it should be noted that the peaks at m z and are also present in tc and tpc spectra although these peaks can provide discriminatory information for the component c they are fragment_ions of the process the results using appropriate number of spectral basis vectors that is m for t p and c datasets and m for tc dataset are also provided in supplementary showing successful identification of different components in each case the extracted information was also used to perform similar analysis on replicate images of t p c tc and tpc to further examine the performance of the algorithm on discerning different species in this case we used the correct number of spectral basis vectors that is m and respectively for each pure replicate measurements tc replicate measurements and tpc replicate measurements the results are given in supplementary data confirming the ability of the proposed algorithm to identify different components in the case of pure species the characteristic peak for the component c at m z is dominated by fragment_ions that is m z and bottom panels of supplementaryf however this peak can be clearly identified from tc and tpc mixtures as is shown in supplementary figures s and s in each experiment the algorithm was allowed to run for a maximum number of iterations although typically the change in the weights matrix frobenius norm dropped below after less than iterations we compared ion image estimates from the full model and the reduced model with tof_sims data using the mean over spectra of the root_mean mrmse over space the average mrmse of the image estimates over three replicate measurements are shown in the slight_increase in the error is due to the low pass action of the basis_functions which attenuates the high_frequency details of the scores images during the iterative algorithm a comparison between the convergence of the algorithms when reduced and full models were used is also shown in note that for pixels images and m each iteration of the algorithm takes ms for the full model this is ms when the reduced model is used we also generated images using random numbers with different pixel densities to compare the computation time for the full model fc nnls and the reduced model algorithm with n using different number of spectral basis vectors the computation time is approximately times_faster when the reduced model is used as is shown in the full and reduced models are shown by dotted and dashed lines respectively 
