genetics_and exact coalescent_simulation of new haplotype_data from existing reference haplotypes motivation we introduce a coalescent_based method recoal for the simulation of new haplotype_data from a reference_population of haplotypes a coalescent genealogy for the reference haplotype_data is sampled from the appropriate posterior probability_distribution then a coalescent genealogy is simulated which extends the sampled genealogy to include new haplotype_data the new haplotype_data will therefore contain both some of the existing polymorphic_sites and new polymorphisms added based on the structure of the simulated coalescent genealogy this allows exact coalescent_simulation of new haplotype_data compared with other methods which are more approximate in nature we live in an era in which the genome_wide gwas is one of the standard_tools by which we interrogate the genome for polymorphisms that relate to phenotype there is also a growing use of next generation sequence ngs_data a large number of new methodological approaches are being developed and published in both areas there is much discussion about the degree to which the gwas approach has been successful for example see but in humans many new associations between genotype and disease status have been discovered an important part of the process of methods development in the gwas era is the testing of those methods on both real and simulated test data frequently investigators have a single smaller set of data from a given population the features of which they wish to mimic when producing multiple larger datasets for testing purposes a common example is the hapmap data or genome_project gp data in this article we present an to whom correspondence should be addressed exact coalescent method for simulating test_sets of new haplotype or genotype data based upon such an existing smaller initial sample the goal is to sample new datasets d consisting of n say haplotypes conditional upon some observed existing data d which contains n o n haplotypes under the assumption that the popular coalescent model is a reasonable approximation to the evolution of the data the goal here is to produce new data d conditional on the unobserved genealogy g of the existing data d since it is through g that the dependence of d on d is expressed note that in the presence of recombination g will be a graph the so_called ancestral recombination graph arg rather than a tree the problem of sampling g conditional on d is computationally_challenging and for that reason several approximate_methods have been proposed the most relevant here being hapgen and hap sample which are based upon the pac likelihood method of the algorithm of li and stephens is an appealing way to reduce the computational_burden involved in calculating probabilities under a full coalescent model instead it uses an approximation scheme based upon a model in which haplotypes are explained as mosaics of other existing haplotypes this scheme is shown to i reduce computational_burden significantly and ii provide a good approximation to probabilities that would be obtained under the full coalescent model however it remains the case that one would prefer to sample from the exact coalescent model when such a thing is tractable in this article we present software that makes this practical for regions of length up to kb using as many as about n o reference haplotypes we demonstrate performance of the proposed method using both data simulated under the coalescent model and data drawn from the genomes_project we begin with examples using simulated_data in this article we introduce an exact coalescent method for the simulation of new haplotype_data from an existing set of reference haplotypes our method recoal simulates data from the distribution p d d using the full coalescent model rather than using an approximation to that model in addition to the replication of snps present in the reference haplotypes recoal also simulates new snps using a coalescent prior it preserves ld_structure well and we demonstrate that new polymorphism is added at an appropriate level because of its exact nature recoal is less computationally_tractable than the approximation underpinning hapgen but it is produces data under the full coalescent model rather than the approximation to the coalescent model exploited by hapgen as such we argue that it is appropriate to use recoal when computational considerations permit nonetheless we believe hapgen remains an excellent alternative approach it should be noted that step of our approach is based on an mcmc method as such the user must allow the mcmc chain to converge to the stationary distribution of p g d the time taken to reach convergence increases with both overall recombination_rate and number of reference haplotypes thus the combination of recombination_rate and the number of reference haplotypes determine the limits of computational tractability of recoal as an example the simulation used in this article which includes reference haplotypes over a kb_region with human population parameters takes h to simulate new haplotypes on a typical desktop machine as such recoal is intractable for simulation of regions larger than kb however in the context of followup of a gwas for example in which the area being investigated may be quite short our software allows for the exact coalescent_simulation of new haplotypes conditional on the existing data under the coalescent model rather than using a more approximate method when larger regions are desired or much larger reference samples exist we recommend the approximate method hapgen still be used of course our method is model based and as such is exact in the sense that it samples from exactly the correct distributions conditional on that model this then is a good time to remind the reader of a quote attributed to george box all models are wrong some are useful the coalescent has proven itself to be widely useful but it is still of course wrong one example of its wrong ness in the present context is that we use a neutral model of molecular_evolution ignoring natural_selection there is a literature about the coalescent with selection included and some programs can simulate data with the presence of the selective mutation but those models are not tractable when one wishes to condition upon the existing data so like most other coalescent simulators recoal simulates data under neutrality another area in which our model is wrong is that it is based upon an unstructured coalescent in other words we assume random mating while this has proven to be a robust approximation to the behavior of single populations it has proven necessary to introduce extensions to the coalescent when population_structure is present as such we would recommend caution when applying our method to datasets in which multiple_populations are present or selection is expected to have occurred in the former context for example it might be more appropriate to produce new haplotypes for each subpopulation separately by dividing the data into its subpopulations and applying recoal to each subpopulation in turn the existing version of recoal allows for fine_scale variation of recombination_rates and for exponential_growth of population_size extensions to other more complex demographic scenarios such as bottlenecks and population admixture are also possible and are currently under development finally we also presented an extension of our method to ascertained data in which the probability of ascertainment is a function of allele_frequency admixture is an extremely challenging_problem in coalescent methods and we note in passing that our correction illustrates how sampling of an underlying coalescent genealogy condition upon observed polymorphism data can be adapted to respect such an ascertainment scheme funding national_institutes mh and national_science hg as well as improvements due to comments received from the reviewers 
