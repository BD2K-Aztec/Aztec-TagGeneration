ll achrb a scalable algorithm for sampling the feasible solution_space of metabolic_networks motivation random_sampling of the solution_space has emerged as a popular tool to explore and infer properties of large metabolic_networks however conventional sampling approaches commonly used do not eliminate thermodynamically unfeasible loops results in order to overcome_this we developed an efficient sampling algorithm called loopless artificially centered hit and run on a box ll achrb this algorithm is inspired by the hit and run on a box algorithm for uniform sampling from general regions but employs the directions of choice approach of artificially centered hit and run a novel strategy for generating feasible warmup points improved both sampling efficiency and mixing ll achrb shows overall better performance than current strategies to generate feasible flux samples across several models furthermore we demonstrate that a failure to eliminate unfeasible loops greatly affects sample statistics in particular the correlation_structure finally we discuss recommendations for the interpretation of sampling results and possible algorithmic improvements availability_and source_code for matlab and octave including examples are freely_available for download ata diversity of computational_methods referred to as constrainedbased methods has been developed to study the characteristics and capabilities of genome_scale models gems uniform random_sampling of the flux solution_space is a popular choice for interrogation of gems without introducing optimality criteria from evaluation of the impact of physiological constraints on the sampled flux_distributions to identification of transcriptional_regulation definition of a flux backbone and correlated reaction sets uniform sampling has been applied to explore achievable states and emergent properties of networks more importantly uniform sampling has emerged as an unbiased tool to assess the capabilities of metabolic reconstructions for this type of analysis to be valid a keyand often overlookedassumption is that the flux samples are thermodynamically_feasible gems are mathematically described by the stoichiometry matrix s m n which encodes the mass_balances for m metabolites reacting in n biochemical_reactions the capacities of these reactions are phenomenologically limited by thermodynamic and kinetic constraints in the form of lower lb and upper ub bounds assuming steady_state for metabolites accumulation the vector of reactionfluxes v consistent with mass conservation is defined by the following set of constraints eqs and the resulting flux space x defines a convex polytope describing the achievable states of the network sampling from this multi_dimensional body can be efficiently achieved using markov_chain mcmc methods such as the hit and run hr and the artificially centered hit and run achr algorithms the latter method has been particularly preferred for sampling the irregularly_shaped solution_space of metabolic_networks as it explores elongated directions of x enabling in principle faster mixing there are however additional constraints on v that ensure its thermodynamic feasibility let us denote n int the matrix storing the null space vectors of the internal reactions described by s int and dl int the vector of chemical potentials for these reactions according to the first and second law of thermodynamics v is thermodynamically_feasible if for v int v equations and guarantee respectively that the global potential energy of the network is balanced first law and that reactions proceed in the opposite_direction of chemical_potential change second law these two equations can be satisfied simultaneously only if the net_flux around all closed loops is equal to zero and hence it is commonly referred as the loopless condition imposition of this condition generally causes the solution_space x loopless to be non convex which is much harder to sample and so_far no algorithm has been developed to do so instead ad_hoc methods using conventional samplers have been used to sample from x and then either remove samples with loopy patterns or find the nearest feasible flux distribution both approaches have disadvantages the first approach may yield few feasible samples making it inefficient in high_dimensional models whereas the second approach is impractical in large models as it requires the solution of a non polynomial time milp problem for each flux distribution here we present a scalable direct sampling algorithm called loopless artificially centered hit and run on a box ll achrb this algorithm is motivated by a recent variation of the hit andrun algorithm for uniform sampling from general regions convex and non convex termed hit and run on a box hrb and employs directions of choice as in achr the algorithm shows overall better performance than current strategies to generate thermodynamically_feasible flux samples in several metabolic_models ranging from small_size models to gems finally we report significant_discrepancies in feasible and unfeasible sample statistics highlighting the consequences of employing thermodynamically unfeasible samples for statistical_inference exact calculation of the volume of a large polytope is an p hard problem which leads to polynomial time approximate algorithms for convex bodies these algorithms typically rely on monte_carlo sampling methods and have proven to be particularly useful in the analysis of metabolic_networks however rigorous enforcement of thermodynamic feasibility of flux samples has so_far been overlooked as it greatly complicates sampling due to the imposition of non convex constraints np_hard the significant differences in sample statistics when excluding unfeasible samples highlights that thermodynamic feasibility cannot be ignored without introducing significant errors here we developed a scalable algorithm inspired by mature monte_carlo samplers to incorporate this condition and generate only feasible samples ll achrb outperforms the conventional achr where unfeasible loop laws are present and even for models without potential unfeasible loop laws ll achrb was as fast as achr mixing is a concern when sampling in complicated spaces reimers reported a high_frequency of reactions with only zero flux samples despite a non zero flux range using achr to sample ijo using ll achrb we only found one blocked reaction in the ijo model involved in an unfeasible loop apart from collecting a bigger sample the main difference in our approach is the pre_processing of ijo which first a compacted linear pathways and b removed trace_elements from the biomass equation the former reduces the dimension of the problem while the latter should make the problem better conditioned the inaccessible reaction in the core e coli model fumarate_reductase highlights that caution still is required when analysing sampling results the loopless condition dictates that fumarate_reductase can only be active under anaerobic conditions and this is indeed consistent with experimental_data in this instance fumarate reductase_activity under anaerobic conditions can only be accurately captured if the model is deliberately constrained for anaerobic_growth i e zero oxygen_uptake supplementarypanel a another illustrative example of the caution needed when analysing sampling results from ll achrb are comparison of sample statistics for the irbc a and ijo r b models estimated respectively from flux samples generated ignoring achr and enforcing ll achrb the loopless condition left_hand side panels compare the normalized flux means for reaction i i e mean divided by flux range range l i r i whereas the right hand side panels compare non redundant pairwise correlation_coefficients between reactions i and j q ij the two blocked reactions from iit reversible o succinylhomoserine lyaseshsl rand l threonine deaminasethrd l supplementarypanel b samples from ll achrb show these two perfectly coupled reactions to be blocked by constraining these two reactions to zero the unfeasible loop is avoided notably have also studied this loop and have proposed to manually fix the directionalities of another two perfectly coupled reactions involved in it namely phosphotransacetylase ptar and acetate kinese ackr this measure unblocks thrd l and shsl r and allows all reactions to carry flux avoiding the loop however it massively constrains the flux range of ptar and ackr from to mmol gdcw h in this particular case more experimental_evidence is needed to decide between the alternatives more importantly these cases underscore the need for careful analysis of sampling results from ll achrb we finish by mentioning possible improvements to the algorithm dehave recently reported efficient procedures for improving the performance of hr by finding an ellipsoid that closely matches the sampling space by extracting directions from the surface of the matching ellipsoid the performance of the traditional hr can be greatly_improved this strategy is convenient as hr guarantees convergence to the uniform_distribution on the target space as opposed to the nonmarkovian achr directions choice a combination of this strategy with the present algorithm would confer this desired guarantee however it is unclear how well it would scale in the case of a nonconvex space this will be subject for future_research 
