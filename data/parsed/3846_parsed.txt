genetics_and quasar quantitative allele specific analysis of reads motivation expression_quantitative eqtl studies have discovered thousands of genetic_variants that regulate_gene enabling a better understanding of the functional role of non coding_sequences however eqtl studies are costly requiring large_sample and genome_wide genotyping of each sample in contrast analysis of allele_specific ase is becoming a popular_approach to detect the effect of genetic_variation on gene_expression even within a single individual this is typically achieved by counting the number of rna_seq matching each allele at heterozygous sites and testing_the of a allelic ratio in principle when genotype_information is not readily available it could be inferred from the rna_seq directly however there are currently no existing_methods that jointly infer genotypes and conduct ase inference while considering uncertainty in the genotype_calls results we present quasar quantitative allele specific analysis of reads a novel statistical_learning method for jointly detecting heterozygous genotypes and inferring ase the proposed ase inference step takes into consideration the uncertainty in the genotype_calls while including parameters that model base call errors in sequencing and allelic over dispersion we validated our method with experimental_data for which high_quality genotypes are available results for an additional dataset with multiple replicates at different sequencing_depths demonstrate that quasar is a powerful_tool for ase analysis when genotypes are not available quantitative_trait qtls for molecular cellular_phenotypes as defined by such as gene_expression expression qtl eqtl e g transcription_factor binding and dnase_i sensitivity have begun to provide a better understanding of how genetic_variants in regulatory_sequences can affect_gene levels see also eqtl studies in particular have been successful at identifying genomic_regions associated with gene_expression in various tissues and conditions e g although previous_studies an enrichment for gwas hits among regulatory variants in lymphoblastoid_cell lcls a fulleqtl data are available and will represent a useful resource to functionally annotate genetic_variants however the number of cell_types and environments explored are a small subset of the presumably larger number of regulatory variants that mediate specific gxe interactions eqtl studies are expensive requiring large_sample n which may be difficult to achieve for tissues that are obtained by surgical_procedures or are difficult to culture in vitro even if biospecimens are readily available at no cost eqtl studies require large_amounts of experimental work to measure genotypes and gene_expression levels as the measurement of gene_expression using high_throughput rna_seq is becoming more popular than microarrays rna_seq library_preparation is also becoming less expensive sample whereas costs of sequencing are also very rapidly decreasing e g m reads per sample would cost using a multiplexing strategy additionally the sequence_information provided by rna_seq can be used to call genotypes detect and quantify isoforms and to measure allele_specific ase if enough sequencing_depth is available ase approaches currently represent the most effective way to assay the effect of a cis_regulatory variant within a defined cellular_environment while controlling for any trans_acting modifiers of gene_expression such as the genotype at other loci cowper as such ase studies have greater statistical_power genetic effects in cis than a traditional eqtl mapping_approach when using a small_sample additionally ase may also be useful to detect epigenetic imprinting of gene_expression if ase is present but no eqtl is detected in the absence of ase the two alleles for a heterozygous_genotype at a single_nucleotide snp in a gene_transcript are represented in a ratio of rna_seq to reject the null_hypothesis and infer ase it is necessary to first identify heterozygous snps with high_confidence and then conduct inference to detect a departure from a allelic ratio although genotyping and ase are usually considered two separate problems miscalling a homozygous snp as heterozygous is likely to induce an error in rejecting the ase null_hypothesis thus we argue that the two problems should addressed together although it is possible to obtain genotype_information from rna_seq to the best of our knowledge all existing_methods for detecting ase consider the genotypes known and error probabilities associated with genotyping are not taken into account for the ase step although overall genotyping quality can also be modeled within the ase model there is currently no method that for each snp can jointly genotype and detect allelic imbalances in high_throughput sequencing_data an approach that takes_into base_calling errors was previously_proposed for detecting ase in ests data but for rna_seq it is essential to also include overdispersion here we propose a novel framework for quantitative allele specific analysis of reads quasar that starts from a single or multiple rna_seq experiments from the same individual and can directly identify heterozygous snps and assess ase accurately by taking_into base_calling errors and overdispersion in the ase ratio quasar is evaluated with two different datasets that demonstrate genotyping accuracy and the importance of incorporating the genotype uncertainty when performing ase inference we implemented the quasar approach as detailed in section in an r package available at http github com piquelab quasar first to evaluate quasar genotyping accuracy we collected rna_seq for two lcls that already have high_quality genotype_calls from the kg project gm and gm as illustrated in we are able to accurately genotype thousands of loci with lower error_rates than other methods commonly used for genotyping dna_seq data by design quasar is more conservative in making heterozygous calls than homozygous calls yet still retains a large number of heterozygous loci compared with gatk and samtools in quasar if there is contention between i an heterozygous_genotype call with extreme allelic_imbalance or ii an homozygous genotype call with base call errors our model will favor the latter ii this is a crucial feature for accurate inference of ase which will be discussed later in more detail as we increase the threshold on the quasar posterior_probability of heterozygosity we consistently reduce the genotype error_rate supplementary table s the error_rates increase slightly if we include rare_variants with maf and are minimally affected when kg allele_frequencies are not used as priors an important feature of quasar is that the genotyping information is also used for the next inference step we next sought to characterize quasar performance in genotyping and ase inference from rna_seq experiments sequenced at different depths in total we analyzed samples three replicates across six different time points for an individual for which genotypes were not previously available we combined the fastq_files in different ways as input for quasar to obtain an empirical power curve as expected we observed that our ability to detect heterozygotes map increases with the sequencing_depth at a more modest sequencing_depth of million we can still detect more than heterozygous sites after obtaining the genotypes we assessed whether there is evidence of ase at any of the snps determined to be heterozygous to conduct ase inference we used the lrt statistic in quasar and obtained p values we controlled the fdr using the q value procedure as shown in our ability to detect ase greatly_increased with the number of snps we were able to genotype which in turn is a function of coverage using million_reads we detected roughly heterozygous snps of which have ase at fdr to assess the calibration of the ase test in quasar and to compare it to other ase inference approaches we used qq plots a qq plot compares the quantiles observed from a test_statistic to those that are expected under a null_distribution e g p values are uniformly_distributed between and the shape of the qq plot curve is useful to judge how well the p values are calibrated when we expect that a large number of the tests conducted are sampled from the null_distribution in this latter scenario we expect that the qq plot curve would follow the line for the range of p values with higher value for small p values we expect that the curve starts to depart from the line representing the small proportion of tests that are not sampled from the null_distribution many existing_approaches for ase use either a binomial_test or a beta binomial_test that does not account for genotyping or base_calling error to compare quasar ase inference to these alternative empirical power in detecting heterozygous snps as a function of sequencing_depth each point represents a single input dataset to quasar either as a single experiment replicate and time point red dot combining multiple time points green blue purple or combining replicates dot triangle the x axis represents the total number of rna_seq in the fastq input_files the y axis represents the log of the total number of snps that are determined to be heterozygous quasarapproaches we used the rna_seq collected on the lcl samples and the genotype_calls from quasar clearly shows that the binomial_test is too optimistic and will likely lead to many false_discoveries another binomial_test supplementary independently implemented show a similar behavior to our own implementation in contrast to the binomial_test the beta_binomial model seems better calibrated but uncertainty on the genotype being a true heterozygote can lead to very small p values and false_positives quasar combines the beta_binomial model with uncertainty on the genotype resulting in the most conservative_approach likely avoiding a common cause of false_positives in ase analysis to further evaluate the differences between quasar and other methods we focused on the high coverage lcl samples this cell_type has been part of large sample eqtl studies such as geuvadis including rna_seq for more than individuals from a recent reanalysis of the geuvadis dataset we selected genes with eqtls fdr and a leading snp with a high posterior inclusion probability pip as those are the nucleotides more likely to be causal i e the eqtn we hypothesized that in our data genes for which the eqtn was heterozygote would be more likely to show evidence for ase than those for which the eqtn was homozygote however transcripts with homozygous eqtns could still show ase if they have additional personal rare associations or due to an imprinting mechanism in any of the methods we tested supplementary there was a significant_difference between ase p values in the expected direction mannwhitney u test p the distribution of p values supplementary for ase signals in transcripts with homozygous eqtns are much closer to the uniform_distribution in quasar when compared with other methods especially those that do not account for overdispersion in general the p values obtained across all methods tested are very much correlated to each other as shown in supplementary but there are key differences the methods that use a binomial_test tend to have lower p values than quasar which uses a beta_binomial model supplementaryand b show that we may observe more shrinkage for snps with deeper coverage compared with a test using the beta binomial_distribution but ignoring genotype uncertainty our quasar test leads to similar p values but snps with more uncertainty on being heterozygous are corrected in a higher degree toward a less significant p value supplementary figs s c and s c in terms of computational_complexity quasar is very fast quasar runtime for genotyping with the em procedure takes less than s on any of our datasets using a computer with a core ghz intel processor and gb ram each em iteration in the genotyping step is o ls linear with the number of snps and samples and convergence is achieved in less than iterations gatk with the default options takes a longer amount of time about h compared with samtools and quasar as the latter methods focus directly on kg snps only comparatively for both our pipeline and more time is spent in data pre_processing roughly min per sample depending on the sequencing_depth and assuming reads are already aligned than in genotyping or ase inference quasar is the first approach that detects genotypes and infers ase from the same sequencing_data in this work we focused on rnaseq but quasar can be applied to other data types chip_seq dnase_seq atac seq and others indeed the more experimental_data available from the same individual across many experimental qqplot comparing the p value distribution of three alternative_methods for determining ase the x axis shows the log quantiles of the p values expected from the null_distribution the y axis shows the log quantiles of the p values computed from the real_data using three different methods i binomial black assumes m no overdispersion ii beta_binomial green considers overdispersion but does not consider uncertainty in the genotype and iii quasar blue uses the beta binomial_distribution and uncertainty in the genotype_calls in all three cases the same set of snps is considered the shaded area in gray indicates a confidence band for the null_distribution samples data types conditions cell_types or technical_replicates the more certainty we can gather about the genotype a key aspect of the quasar ase inference step is that it takes_into over dispersion and genotype uncertainty resulting in a test that we have shown to be well calibrated in many cases the p values obtained from biased statistics can be recalibrated to the true null_distribution using a permutation procedure unfortunately this is not possible for ase inference as randomly permuting the reads assigned to each allele would inadvertently assume that the reads are distributed according to a binomial_distribution more complicated and computationally_costly resampling procedures can be proposed but it is not clear what additional assumptions may be introduced and if such methods can correctly take into account genotyping uncertainty if prior genotype_information is available it can also be provided as input to the algorithm the prior uncertainty of the genotypes should be reflected in the form of prior probabilities for each genotype in this article we have shown that we can obtain reliable genotype_information from rna_seq thus making additional genotyping unnecessary if the endpoint is to detect ase instead sequencing the rna_seq libraries at a higher depth is probably a better strategy as it greatly_improves the power to detect ase furthermore as sequencing_costs decrease rapidly ase methods are becoming very attractive in applications where eqtl studies have been previously used this is of increased importance in scenarios where collecting a large number of samples is expensive or infeasible large_scale eqtl studies are still very much necessary for fine_mapping but analysis of ase can provide_unique mechanisms that are uncovered only under specific experimental_conditions e g as a result of gene x environment interactions 
