a general species_delimitation method with applications to phylogenetic placements motivation sequence_based to delimit species are central to dna taxonomy microbial_community surveys and dna metabar coding studies current approaches either rely on simple sequence_similarity thresholds otu_picking or on complex and compute intensive evolutionary_models the otu_picking methods scale well on large_datasets but the results are highly_sensitive to the similarity threshold coalescent_based species_delimitation approaches often rely on bayesian statistics and markov_chain and can therefore only be applied to small_datasets results we introduce the poisson tree processes ptp model to infer putative species boundaries on a given phylogenetic input tree we also integrate ptp with our evolutionary placement algorithm epa ptp to count the number of species in phylogenetic placements we compare our approaches with popular otu_picking methods and the general mixed yule coalescent gmyc model for de_novo species_delimitation the stand alone ptp model generally out performs gymc as well as otu_picking methods when evolutionary_distances between species are small ptp neither requires an ultra metric input tree nor a sequence_similarity threshold as input in the open reference species_delimitation approach epa ptp yields more accurate results than de_novo species_delimitation methods finally epa ptp scales on large_datasets because it relies on the parallel implementations of the epa and raxml thereby allowing to delimit species in high_throughput sequencing_data availability_and the code is freely_available at www exelixis lab org software html dna_barcoding studies mostly rely on a single marker gene and are widely used for dna taxonomy more recently highthroughput_sequencing of barcoding genes has been deployed to disentangle the structure of microbial_communities and in metabarcoding biodiversity studies a central analytical task in such studies is to classify molecular sequences into entities that correspond to species this is commonly denoted as otu_picking in metagenomic_studies the main goals of such methods are to identify known species and delimit new species numerous approaches exist for associating anonymous reads query_sequences with known species for instance nearest_neighbor blast or the navenave bayesian_classifier these methods use sequence_similarity to associate reads with taxonomic ranks phylogeny aware methods for identifying reads were introduced independently and simultaneously with the evolutionary placement algorithm epa and pplacer instead of sequence_similarity they use the phylogenetic_signal in the reference and query_sequences to attain higher classification_accuracy note that obtaining a taxonomic_classification from phylogenetic placements represents a difficult_task because phylogenies and taxonomies are frequently incongruent placement methods are similar to closed reference otupicking or taxonomy dependent methods their ability to associate query_sequences with species depends on the completeness of the taxon sampling in the reference data closed reference or taxonomy dependent methods generally lack the ability to delimit new species consequently they may underestimate the number of species and hence the diversity in the query_sequences see example in supplementary to identify new species taxonomy independent methods or de_novo otu_picking approaches are used to initially cluster sequences into so_called molecular operational_taxonomic motus then one can use a representative sequence from each motu cluster and assign a taxonomic rank via taxonomy dependent methods although taxonomic_assignments may still be inaccurate due to incomplete reference data coarse grain biodiversity estimates can be accurate when motus are assigned to higher taxonomic ranks de_novo otu_picking usually relies on unsupervised machine_learning that to whom correspondence should be addressed the author published_by all_rights this is an open_access the terms of the creative commons attribution license http creativecommons org licenses by which_permits distribution and reproduction in any medium provided the original_work cluster sequences based on mostly arbitrary sequence_similarity thresholds however it is currently unclear how motus correspond to species to delimit species using molecular sequences we initially need to define our species concept the phylogenetic species concept psc was initially introduced by eldredge and cracraft and subsequently refined by and nixon and wheeler for a review of pscs definitions please refer to in general phylogenetic species are the smallest units for which phylogenetic_relationships can be reliably inferred the psc in particular from the genealogical point_of states that species reside at the transition_point between evolutionary_relationships that are best represented phylogenetically and relationships that are best reflected by reticulating genealogical connections there already exist several psc based species_delimitation approaches e g see reviews in the general mixed yule coalescent gmyc model for delimiting species on single genes is frequently used in empirical_studies the gmyc method models speciation among species branching events via a pure birth process and within species branching events as neutral coalescent processes gmyc identifies the transition_points between inter_and species branching rates on a time calibrated ultrametric tree by maximizing the likelihood_score of the model it assumes that all lineages leading from the root to the transition_points are different species gmyc has been shown to work well for comparatively_small population_sizes and low birth_rates one drawback of gmyc is that it depends on the accuracy of the ultrametric input tree obtaining an ultrametric tree from a given phylogeny is a compute intensive and potentially error_prone process most state of the art likelihood_based tree calibration_methods such as beast or dppdiv rely on bayesian sampling using mcmc markov_chain when delimiting species in phylogenetic placements which requires calibrating thousands of trees it is almost impossible to deploy these methods in an automated pipeline given the difficulties to assess mcmc chain convergence for instance inspired by the psc we introduce the ptp model that can delimit species using non ultrametric phylogenies ultrametricity is not required because we model speciation rate by directly using the number of substitutions the psc implies that deploying phylogenetic_reconstruction methods within a species is inappropriate a hierarchical relationship can nonetheless be inferred for intra species sequences using phylogenetic_methods however we expect to observe significant in the statistical sense differences between the relationships reconstructed among and within species these differences are reflected by branch_lengths that represent the mean expected number of substitutions per site between two branching events thus our fundamental assumption is that the number of substitutions between species is significantly_higher than the number of substitutions within species in a sense this is analogous to the gmyc approach that intends to identify significant changes in the pace of branching events on the tree however gmyc uses time to identify branching rate transition_points whereas in contrast ptp directly uses the number of substitutions ptp is simple fast and robust thus it can easily be integrated with the epa to calculate the number of species in a set of query_sequences that have been placed into a specific branch of the reference phylogeny we implemented an open reference species_delimitation pipeline by integrating ptp with the epa to identify known and new species initially we assess the performance of gmyc and the ptp approach as general de_novo species_delimitation methods using real and simulated_data we then compare ptp and gmyc with two representative otu_picking methods uclust edgar and crop uclust represents a fixed threshold otu_picking approach whereas crop is a soft threshold method that attempts to detect sequence clusters using a gaussian_mixture finally we evaluate the performance of our open reference approach epa ptp for a fair comparison we also integrated crop with the epa epacrop we introduced implemented and made available a new model ptp for species_delimitation that is mainly intended for delimiting species in single locus molecular phylogenies ptp can propose species boundaries that are consistent with the psc an important advantage of our method is that it models speciation in terms of the number of substitutions thereby it circumvents the potentially error_prone and compute intensive process of generating time calibrated ultrametric trees which are required as an input for gmyc using real_datasets we show that delimitations inferred with ptp are comparable with delimitations obtained via gmyc simulations suggest ptp outperforms gmyc in addition it is more straightforward to use because it only requires a standard phylogenetic_tree as input and because it also is substantially faster on the taxon metabarcoding dataset using a modern intel desktop processor for instance r s requires days to complete whereas raxml in combination with ptp only requires a total of about min to return a species_delimitation we also compared gmyc and ptp with two clustering_algorithms crop and uclust from our point_of the problem of species_delimitation needs to incoporate data from various sources e g sequences and trees and also depends heavily on the species definition used thus gmyc and ptp yield comparable results on real_data because they are based on the psc in contrast by their very definition crop and uclust simply identify sequence clusters the fact that there is a difference between sequence clusters and psc based species_delimitation is underpinned by our simulations we simulate the data in accordance with the gmyc model that essentially adopts the psc to demonstrate the impact of the b parameter on clustering based delimitation accuracy we plotted the pairwise sequence distances within species and between directly adjacent species in the simulated tree for b and b in supplementary figures s and s of the online supplement lower b values lead to larger evolutionary_distances between species that is the so_called barcoding gap is present increasing b reduces the evolutionary_distances between species and the barcoding gap disappears see puillandre et_al for examples of this phenomenon on real_data therefore our simulations show that clustering_algorithms work on datasets with the barcoding gap because phylogenetic species are mostly consistent with sequence clusters in this case however clustering_methods are prone to fail when the barcoding gap is not present because sequences cannot be told apart any more via sequence_similarity alone as we show gmyc and ptp delimitation performance is more robust to the absence of barcoding gap thus when no prior information barcoding gap presence about the dataset is available and the goal is to delimit phylogenetic species gmyc and ptp should be preferred note sanger data the reference dataset has a total of motus the indicates that the number is not available in the original publication apart from the stand alone ptp code we also introduced the epa ptp pipeline that combines the epa with ptp the epa ptp pipeline represents the first integrated approach for analyzing metagenomic_data that combines the phylogenetic placement approach with an explicit statistical criterion for species_delimitation on a representative empirical dataset our pipeline yields a substantially more accurate diversity estimate than traditional otu_picking methods using simulated_data we show that open reference based_approaches can improve delimitation accuracy compared with de_novo approaches more importantly the epa ptp pipeline allows for deploying a widely_accepted species concept to metagenomic_data where millions of sequences need to be processed epa crop with the default setting of mcmc generations is approximately twice as fast as epa ptp on the metabarcoding dataset note that generations may not be sufficient and that crop does not offer a built in mcmc convergence assessment criterion in the following we discuss the current_limitations of our approach readers should keep in mind that entities delimited by ptp are putative species only the phylogenetic_trees inferred on single gene molecular sequences are gene_trees rather than species_trees albeit the hierarchical relationships above the species boundaries are expected to be mostly consistent with the species_tree however the boundaries inferred by ptp are only approximate additional data need to be integrated to further validate the delimitations such as morphological_characters and multigene sequence_data within an integrative taxonomy framework the putative species delimited by ptp can for instance be used as initial_hypothesis that can be further scrutinized with multilocus coalescent based_methods such as bp p bp p requires prior_knowledge of species boundaries and it represents a validation method rather than a delimitation method owing to its computational_complexity bp p can currently only handle up to species compared with otu_picking methods ptp and epa ptp require substantially more cpu time because of the phylogenetic calculations although most otu_picking methods can run on an off_the desktop computer the epa ptp pipeline requires a multicore server for analyzing_large metagenomic_datasets because ptp initiates the search for the maximum_likelihood delimitation at the root of the input phylogeny the tree has to be correctly rooted to obtain accurate estimates also ptp should be used with caution on datasets where the number of individuals sampled per species is unbalanced and where the over sampled species exhibit small within species variation see supplementary tables s through in such cases the inferred phylogeny will comprise both subtrees comprising one species and many individuals with a large number of extremely short branches and subtrees comprising one species but only few individuals with short but not extremely short branches such unbalanced samples may require the introduction of a third parameter class of branches to accommodate i over sampled within species branches ii within species branches and iii among species branches otherwise the species that are not over sampled cannot be delimited properly that is each individual is likely to be identified as a separate species hence we either need a criterion for removing over sampled sequences or a criterion to decide when and how many additional classes of ptp parameters need to be introduced however a major_drawback of introducing additional ptp classes is that the delimitation search_space becomes significantly_larger hence finding the maximum_likelihood delimitation or a best known delimitation represents a challenging_task thus before extending the number of classes we feel that more work on the design and performance of heuristic search_strategies for species_delimitation is required to better characterize and understand the problem this also applies to the heuristics used in gmyc given that the underlying optimization_problems are similar 
