efficient bayesian_inference under the structured_coalescent motivation population_structure significantly_affects evolutionary_dynamics such structure may be due to spatial segregation but may also reflect any other gene_flow limiting aspect of a model in combination with the structured_coalescent this fact can be used to inform phylogenetic_tree as well as to infer parameters such as migration_rates and subpopulation sizes from annotated sequence_data however conducting bayesian_inference under the structured_coalescent is impeded by the difficulty of constructing markov_chain mcmc sampling algorithms samplers capable of efficiently exploring the state_space results in this article we present a new mcmc sampler capable of sampling from posterior distributions over structured trees timed phylogenetic_trees in which lineages are associated with the distinct subpopulation in which they lie the sampler includes a set of mcmc proposal functions that offer significant mixing improvements over a previously_published method furthermore its implementation as a beast package ensures maximum flexibility with respect to model and prior specification we demonstrate the usefulness of this new sampler by using it to infer migration_rates and effective_population of h n influenza between new_zealand new_york and hong_kong from publicly_available hemagglutinin ha gene sequences under the structured_coalescent availability_and the sampler has been implemented as a publicly_available beast package that is distributed under version of the gnu_general at http compevol github io multitypetree contact model based phylogenetic_inference has become one of the principal methods of using genetic sequence_data to test scientific hypotheses pertaining to evolving populations its wide_spread adoption has been driven not only by improvements in computational and sequencing hardware but also by advances in methods of statistical_inference an important initial step in this development was the derivation of the n coalescent_process which probabilistically ties the shape of a rooted phylogenetic_tree of n randomly_chosen individuals to the parameters of an underlying wrightfisher population_genetics model in conjunction with felsensteins pruning algorithm this allowed for the computational inference of the sample genealogy itself alongside population_genetic parameters such as the effective_population since these beginnings an array of sophisticated models and inference methods has been developed allowing molecular mutation_rates population_size histories and other population_genetic parameters of interest to be inferred alongside increasingly_sophisticated phylogenetic_tree reconstructions which for example do away with the assumption of a strict molecular_clock rapidly_evolving populations such as viruses and bacteria are of particular interest as such populations may undergo significant demographic variation over timescales comparable with the age of the genealogy of sampled data such data form the basis of the emerging field of phylodynamics which exploits these overlapping timescales by using the genetic data to select and infer parameters of sophisticated epidemiological models many of the models that are of interest to population geneticists and epidemiologists are structured in some way this structure may represent the spatial subdivision of a population into several distinct demes or it may represent some other logical categorization of individuals such as the temporal subdivision used in compartmental epidemiological models such structure can strongly_affect the shape of inferred genealogies and can provide a source of statistical bias when ignored a time tested means of including this structure in phylogenetic_analyses is through the use of the structured_coalescent an extension of kingmans coalescent in which the unstructured wrightfisher model is replaced by a structured equivalent encompassing a number of discrete subpopulations phylogenetic_analyses based on this model are capable of both i reducing model_misspecification bias in the inference of the genealogy and ii estimating parameters specific to structured models such as migration_rates and effective subpopulation sizes while similar this model is distinct from the character based treatment of lineage locations used by in that the structured_coalescent allows to whom correspondence should be addressed schemes for conducting inference under the structured_coalescent exist in the literature both of these schemes use an mcmc_algorithm to explicitly sample both the demographic and evolutionary model_parameters and the structured genealogy a phylogenetic_tree annotated with individual migration events the first of these schemes is the method of beerli and felsenstein which is implemented in the software_package migrate n at its core this method involves a single proposal function which updates the structured tree by dissolving a randomly_selected edge and drawing a new edge by simulating from the structured_coalescent conditional on the remaining edges the other scheme is the work of who have published a set of simple and fast proposal functions that act solely on the migration events on the structured genealogy in combination with those for traversing the space of unstructured trees ewing et_al showed that an mcmc_algorithm based on these moves is capable not only of jointly inferring the structured tree and migration model_parameters but also of exploiting the additional information contained in serially sampled data to infer absolute migration_rates while certainly functional and useful this scheme suffers from performance issues which arise in the form of slow mixing meaning that mcmc calculations must be run for a long time to obtain useful information about the posterior probability_distribution an additional issue is that no implementation of the sampler has been made widely available in this article we introduce a new set of mcmc proposal functions or operators that provide an efficient means of using serially sampled sequence_data to infer the full structured tree and related model_parameters including mutation_rates under the structured_coalescent these operators together with the data_structure representing the structured tree itself and the probability density calculation algorithm for the structured_coalescent are implemented and distributed as a package extension to beast http www beast org when applied to equivalent data and assuming equivalent evolutionary_models and parameter priors this new package yields posterior distributions which are exactly equivalent to those obtained using migrate n however the use of the beast platform for our implementation gives our sampler access to a large array of molecular_evolution models and parameter priors not yet available in migrate n additionally we have implemented the operators described by ewing et_al allowing direct comparison between the two sampling methods this comparison shows that the new operators achieve significantly_faster mixing when applied to simulated_data with an order of magnitude improvement in some cases we go on to demonstrate the practicality of the new sampler by using it to infer mutation_rates effective_population and the structured tree from geographically annotated ha gene sequences derived from the influenza a subtype h n strain we interpret these results in light of recent work by taken together the results above are strong evidence that our new algorithm and its implementation are correct computationally_efficient and capable of analysing large_datasets however the algorithm presented here does not address problems that are fundamental to the structured_coalescent as discussed in detail by the structured_coalescent tree density summary of results from spatial h n influenza analysis including a the taxon maximum sampled posterior structured tree the sampled posterior probability_distributions for b the root location c the subpopulation sizes and d the base substitution_rate substitutions site year the grey lines in c and d show the visible portions of the log n prior used for all of these parameters scaled vertically for clarity t g vaughan et_al 
