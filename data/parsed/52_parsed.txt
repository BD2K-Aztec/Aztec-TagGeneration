accurate extension of multiple_sequence using a phylogeny aware graph algorithm motivation accurate alignment of large_numbers of sequences is demanding and the computational_burden is further increased by downstream_analyses depending on these alignments with the abundance of sequence_data an integrative approach of adding new sequences to existing alignments without their full re computation and maintaining the relative matching of existing sequences is an attractive option another current challenge is the extension of reference alignments with fragmented sequences as those coming from next generation metagenomics that contain relatively little information widely used methods for alignment extension are based on profile representation of reference_sequences these do not incorporate and use phylogenetic_information and are affected by the composition of the reference alignment and the phylogenetic positions of query_sequences results we have developed a method for phylogeny aware alignment of partial order sequence graphs and apply it here to the extension of alignments with new data our new method called pagan infers ancestral sequences for the reference alignment and adds new sequences in their phylogenetic context either to predefined positions or by finding the best placement for sequences of unknown_origin unlike profile_based alternatives pagan considers the phylogenetic_relatedness of the sequences and is not affected by inclusion of more diverged sequences in the reference_set our analyses show that pagan outperforms alternative_methods for alignment extension and provides superior accuracy for both dna and protein data the improvement being especially large for fragmented sequences moreover pagan generated alignments of noisy next_generation ngs sequences are accurate enough for the use of rna_seq in evolutionary_analyses availability pagan is written in c licensed under the gpl and its source_code is available atsequence alignment has numerous applications but its role is especially central in evolutionary_analyses of molecular sequences to whom correspondence should be addressed these inferences are based on the identities and differences detected between homologous characters and errors in these homology statements that is errors in the alignment of the sequences are likely to lead to errors in any downstream_analyses the generation of high_quality alignments can be computationally laborious and the solutions often require manual assessment or editing when such alignments need to be extended e g after new sequences become available it may be preferable to keep the relative alignment of existing sequences intact and have the new sequences aligned to this reference alignment such addition of sequences should take into account the evolutionary_relationships of all the sequences and be performed in the correct phylogenetic context alignment extension has interesting applications in the analyses of next_generation ngs_data fast profile based_methods have been used for the alignment of metagenomic sequence_reads of unknown_origin against a set of reference_sequences in phylogenetic placement studies these do not use all information available in the data however and flatten the reference alignment into a consensus profile that only models conserved_regions shared by most sequences on the other hand existing read placement methods based on phylogenyaware alignment handle the query_sequences separately and delete sites inferred as insertions limiting their use to phylogenetic placement only accurate alignment of complete ngs_reads is of interest e g in analyses of rna_seq that come nearly exclusively from the gene regions of the genomes with appropriate handling of short and noisy reads rna_seq allow for inexpensive large_scale comparative_studies of proteincoding_genes such as inferences of selection and extend the use of ngs methods to evolutionary_analyses of non model_organisms e g http www onekp com popular progressive alignment programs e g indirectly exploit the connection between alignment and phylogeny as they divide the computationally_intractable multiple_alignment problem into many pairwise tasks yet they ignore the phylogeny during the remainder of the alignment process and produce alignments whose gap patterns are not evolutionarily meaningful we showed earlier that phylogenetic_information can be used to distinguish insertions from deletions and these two very different mutation_events can then be treated correctly in the progressive alignment the phylogeny aware algorithm based on these ideas and implemented in the program prank performs very well in evolutionary alignment comparisons the first alignment creates graph x to represent the inferred ancestor of a and b in x the character state of vertex is y representing both pyrimidines and has two incoming edges from vertices and to indicate that the presence of vertices and is uncertain the optimal alignment path for graphs x and c jumps from vertex in graph x to vertex using the direct connecting edge the edges flanking the skipped over fragment are recorded as unused asterisks here we outline a new general_purpose method for phylogenyaware alignment of sequence graphs and apply it to phylogenetic extension of existing alignments our method called pagan is based on the same principle as prank and uses evolutionary_information to distinguish insertions from deletions in contrast to the greedy insertion calling of the original approach sequence graphs provide a flexible framework to model the phylogenetic evidence from related sequences and allow building a robust progressive aligner that tolerates errors in the guide phylogeny the idea of using graphs to represent a sequence_alignment is old and has been revisited regularly our approach has similarities to earlier methods for global_alignment of multiple_sequences especially the tree alignment_method and the sequence representation with partial order graphs but differs from these in its emphasis on phylogenetic calling of insertion_and the key_advantage of our graph_representation of sequences is the ability to describe uncertainty regarding the presence of characters at certain sequence_positions this is beneficial during the progressive alignment of sequences but it can also be used to represent uncertainties in unaligned sequences or in the inferred ancestral sequences as our approach considers all sequences as graphs that can be aligned against each other it is easily extended to the placement of new sequences into existing reference alignments unlike most existing_methods based on consensus sequence_profiles our approach correctly considers the phylogenetic context as it aligns new sequences against inferred ancestors moreover it can add multiple related sequences to specific positions in the tree and thus correctly accounts for their relatedness and shared insertion_and sequences assumed to come from the species shown in red to the same target node in a progressive manner it reconstructs sequence graphs to represent the ancestral nodes and aligns the new sequences against the ancestor of their sister clade indicated by x each alignment of a sequence r n creates a new parent node p n against which the next sequence is aligned after finishing the alignment the sub tree with the new sequences is inserted back to the tree structurewe tested pagan in the extension of real reference alignments with new protein and dna_sequences and found that it can successfully handle data of great variety in length and evolutionary_divergence as well as different sizes of reference alignments the accuracy of alignment cannot be tested with real_data so we simulated_datasets representing gene_families of closely_related paralogues we used pagan to extend both protein and dna reference alignments with new data and compared its performance with that of alternative extension approaches to test larger problems we used pagan and the best alternative method hmmalign for a re analysis of metagenomic_data ofconsisting of reference alignments of sequences and addition of sequence_fragments finally we quantified the effects of different factors on alignment_accuracy and compared pagan and hmmalign under a simplified setup that allowed changing the different parameters independently our results show that pagan produces exceptionally accurate alignments and its phylogenetic_approach can efficiently use the evolutionary_information available while remaining unimpaired by more distantly_related sequences in the reference alignment we have generalized the concepts of our phylogeny aware alignment algorithm and developed a method for phylogenetic alignment of partial order sequence graphs in this article we focus on one specific application for the new method that has no satisfactory previous solution the phylogeny aware extension of existing alignments with new data re computation of alignments for largely the same sets of sequences is wasteful and may occasionally introduce errors that require manual verification and corrections extension of existing alignments with new sequences avoids these problems and guarantees that the relative alignment of reference_sequences is not changed the new sequences should also be accurately aligned however and we strongly believe that this is best achieved by aligning them in their phylogenetic context against the targets resembling them most this is true for all sequences but its importance is even more pronounced in the alignment of short sequence_fragments containing little information we performed comprehensive simulation_studies to compare the performance of our new method pagan to that of alternative_methods for alignment extension and to test how the different approaches utilize the information available in related sequences we focused on the accuracy of inferred evolutionary homology with the aim of using the resulting alignments for evolutionary_studies our analyses show that pagans phylogenetic_approach clearly outperforms most alternative_methods the improvement being especially striking in the alignment of short sequence_fragments we were impressed by the good performance of hmmalign but also noticed that its performance is highly dependent on the reference alignment used for the construction of the profile hmm with a carefully_chosen reference alignment hmmaligns accuracy was in some cases comparable to that of pagan in reallife analyses one cannot typically maximize both the sensitivity of the profile hmm and the breath of sequences included and the widely used practice of including all the diversity available heavily penalizes hmmaligns performance in contrast pagan is a truly phylogenetic method and while it efficiently uses the information from closely_related sequences it is not affected by the inclusion of more distantly_related ones in the reference_set we tested pagan in the extension of large_alignments and found the initial results very promising we believe that improvements in the assignment of queries to target nodes and speed ups in the algorithm will make pagan also a competitive method for largescale metagenomic analyses unlike alternative_methods for the task pagan aligns also insertion_sites and includes full_length sequences in the resulting multiple_alignment the latter may not be crucial in phylogenetic placement of query fragments relative to the reference_sequences but it will provide_additional to resolve the relations between the newly added sequences and will allow connecting related fragments to longer contigs alignment extension and phylogenetic placement has interesting applications in the analyses of increasingly abundant sequencing 
