computer vision based automated peak_picking applied to protein nmr_spectra motivation a detailed analysis of multidimensional nmr_spectra of macromolecules requires the identification of individual resonances peaks this task can be tedious and time consuming and often requires support by experienced users automated peak_picking algorithms were introduced more than years_ago but there are still major deficiencies flaws that often prevent complete and error_free peak_picking of biological macromolecule spectra the major challenges of automated peak_picking algorithms is both the distinction of artifacts from real peaks particularly from those with irregular shapes and also picking peaks in spectral_regions with overlapping resonances which are very hard to resolve by existing computer algorithms in both of these cases a visual_inspection approach could be more effective than a blind algorithm results we present a novel approach using computer vision cv methodology which could be better adapted to the problem of peak recognition after suitable training we successfully_applied the cv algorithm to spectra of medium_sized soluble_proteins up to molecular_weights of kda and to a kda complex of a tetrameric membrane_protein in detergent_micelles our cv approach outperforms commonly used programs with suitable training_datasets the application of the presented method can be extended to automated peak_picking in multidimensional spectra of nucleic_acids or carbohydrates and adapted to solid_state nmr_spectra nuclear_magnetic nmr_spectroscopy has become a standard_technique in biological_research nmr applied on solutions of biological_macromolecules provides data on their structural as well as dynamic_properties and supplies detailed information on molecular_interactions the analysis of the nmr_spectra often still includes substantial manual work even though a broad range of automated procedures have been developed automation of spectral_analysis is particularly important in nmr based_drug where hundreds of two_dimensional spectra are measured during screening of libraries of chemical_compounds moreover the increasing amount of structural_genomics and proteomics using nmr necessitate fast automated procedures to alleviate the time consuminguser dependent classical analysis of spectra a rapid and robust user independent pipeline in nmr_data analysis would relieve many nmr spectroscopists from routine tasks the first step in a fully computerized_analysis of nmr_spectra is automated peak_picking a task that has attracted substantial interest and there are numerous algorithms available and yet manual peak_picking usually still provides superior results existing programs for automated peak_picking can suffer from limited ability to discriminate between signals artifacts and noise requiring external intervention by experienced spectroscopists for an exhaustive recognition of all resonances in manual peak_picking a researcher visually selects peaks with the expected shapes that from experience represent real signals thus he relies on his prior_knowledge about the appearance of real peaks as local extrema in the spectrum an analogous approach is used by people to recognize solid objects in planar images where small patches are analyzed for the decision whether or not they contain an object computer vision is a rapidly developing branch of computer science that attempts to automate this process known as the object_detection problem computer vision techniques have been successfully_applied in many areas as e g in face detection for pedestrian detection or car detection object_detection is usually a two phase process where binary_classification is followed by feature_extraction from a local image patch different image_features and binary classifiers are available to our knowledge such an image_processing approach has not been applied to automate peak_picking in which it could provide a reliable algorithm for the identification of peaks in multidimensional nmr_spectra in this work we developed a peak_picking algorithm based on computer vision which uses a technique called histogram of oriented gradients hog as a feature_extraction procedure and support_vector svm as a binary classifier for reasons discussed later in the text as input the cv_peak accepts any kind of spectra with different data_formats sparky topspinor vnmr and returns peak lists for a given spectrum in sparky format http www cgl ucsf edu home sparky the general_scheme of the cv_peak function is illustrated in we evaluated the cv_peak algorithm by comparing the results with those of established programs picky wavpeak using a set of benchmark spectra and additional spectra spectra of only proteins from the original benchmark set were made available to us by the authors of picky and wavpeak we also tested our cv based algorithm on a set of different spectra obtained for proteins with molecular_weights from to kda to test the high potential of the cv software all spectra were picked independently of any other spectrum or input i e the number of artifacts will be reduced when combining peak lists from different spectra which is necessary for sequence specific assignments or structure calculations for most spectra all real peaks were correctly picked with a remarkably small number of artifacts in the evaluation of our results we used generally_accepted statistical_measures precision recall and f measure precision p and recall r are defined as p tp tp fp and r tp tp fn where tp stands for true_positives real peaks which were classified as true peaks fn stands for false_negatives real peaks which were classified as artifacts and fp stands for false_positives false peaks classified as real peaks combination of these two measures is represented as f measure f rp r p and allows for direct comparisons of performance between different methods values of the f measure fall into the range from to where represents highest performance of the method the correlation_coefficient was calculated with the standard function correlation_coefficient in microsoft_excel compares the peak_picking performance of cv_peak picky and wavpeak on the set of benchmarked spectra as introduced by and on more challenging spectra selected by us a comparison of the f measures between cvpeak picker picky and wavpeak shows that cv_peak performs substantially better on each of the benchmark spectra in the same table correlation_coefficient between f measure and signal tonoise ratio is presented in we summarize peak_picking results for spectra which are more challenging than the benchmark spectra in two cases for the highly overlapped spectra of the kda helical membrane_protein kcsa alpha and of intrinsically_disordered nlgn cv_peak reaches f measures of about for the remaining proteins high f measure scores of approximately are achieved exemplary planes of these five spectra are shown in supplementary the reference peak lists for the spectra in were obtained from original peak lists provided by the authors or found in assignment papers which we manually corrected as they contained only assigned peaks and not all real peaks the performance of cv_peak is exemplified in supplementarywith six consecutive cross_sections of the hn co ca spectrum of kcsa lists the parameters obligatory and optional which must be set before running the cv_peak in the supporting_information we graphically represent the dependence of the performance f measure of cv_peak on the selection of the size of bounding box supplementary and on the threshold value r supplementary these figures show that the values for the bounding box and r can be chosen in a wide_range without substantially changing the resulting peak list further in supplementary table s we provide average scanning times per d layer of various d heteronuclear correlation_spectra measured with different proteins the application of computer vision techniques for a peak_picking algorithm applied to nmr_spectra described here results in fully_automated peak recognition in a wide_range of triple resonance spectra obtained with five different globular_proteins with molecular_weights between and kda and a uniformly deuterated tetrameric kda alpha_helical membrane_protein in detergent_micelles kda in complex moreover it outperforms other currently used peak pickers as evaluated by benchmark spectra features and system requirements of the most popular peak_picking programs are presented in supplementary table s a standard measure used for comparison of the performance of peak_picking algorithms the f measure is a combination of two components recall and precision the precision measure contains information on the excessively picked artifacts while recall contains information on missed real peaks in practice for structural studies recall has significantly_higher importance than precision as loss of information missed real peaks often cannot be compensated and thus it may lead to incomplete assignments conversely excessively picked artifacts are rather easily rejected in an assignment process inthe performance of cv_peak and wavpeak as well as picky are compared cv_peak always has superior precision scores and overall f measures however in ten cases cv_peak reaches slightly worse recall scores than picky and or wavpeak although these differences are relatively small weobligatory estimation of the proper size of the scanning window is crucial for the scanning procedure the peak picker performs well if the side length of the window selected by the user varies up to from the optimal one cv_peak offers an interactive tool which allows a user to draw a scanning window on the contour plot of the spectrum threshold r optional the parameter can be used for fine_tuning after all peaks are evaluated using svm often change of the default value is not necessary the parameter can be adjusted using an interactive graphical_user which updates visualization of the scanning results in real_time according to the value of r number of scanned peaks per layer optional the parameter is introduced exclusively for performance optimization a user can request to scan all peaks in the spectrum even small artifacts by assigning an arbitrarily large value to this parameter nevertheless scanning the biggest peaks on each layer of a tripleresonance spectrum is usually sufficient the parameter can be specified in the cv_peak configuration file speculate that a substantial increase of the number of peaks in the cv peak pickers training_set might help reaching higher recall scores on the other hand wavpeak requires a preset number of the expected real peaks in the spectrum which results in a classification of questionable peaks as real also presents a correlation between the f measure and the signal_to snr cvpeak picker reaches the similar f measure at low snr which is a substantial advantage for its versatility and usefulness in real spectra with suboptimal snr the applications of cv_peak in this work demonstrate that the analysis of nmr_spectra of proteins with difficult highly overlapped spectra including idps or molten globules can be fully_automated user attention can be focused on validation of the results we believe that highest_accuracy can be achieved by coupling our software with powerful assignment programs as e g flya l pez mndez and g ntert the methodology_presented in this paper has high potential for investigations and analysis of nmr_spectra of nucleic_acids and carbohydrates and could be adapted for peak_picking of solid_state nmr_spectra 
