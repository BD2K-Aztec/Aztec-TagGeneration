pong fast analysis and visualization of latent clusters in population_genetic data motivation a series of methods in population_genetics use multilocus genotype data to assign individuals membership in latent clusters these methods belong to a broad class of mixed membership models such as latent_dirichlet used to analyze text corpora inference from mixed membership models can produce different output matrices when repeatedly applied to the same inputs and the number of latent clusters is a parameter that is often varied in the analysis_pipeline for these reasons quantifying visualizing and annotating the output from mixed membership models are bottlenecks for investigators across multiple_disciplines from ecology to text data_mining results we introduce pong a network graphical approach for analyzing and visualizing membership in latent clusters with a native interactive d js visualization pong leverages efficient algorithms for solving the assignment problem to dramatically reduce runtime while increasing accuracy compared with other methods that process output from mixed membership models we apply pong to unlinked genome_wide single_nucleotide from unrelated_individuals in the genomes_project and identify previously overlooked aspects of global human population_structure we show that pong outpaces current solutions by more than an order of magnitude in runtime while providing a customizable and interactive_visualization of population_structure that is more accurate than those produced by current_tools availability_and pong is freely_available and can be installed using the python_package management system pip pongs source_code is available at https github com abehr pong a series of generative_models known as mixed membership models have been developed that model grouped data where each group is characterized by a mixture of latent components one well known example of a mixed membership model is latent_dirichlet in which documents are modeled as a mixture of latent topics another widely used example is the model implemented in the population_genetic program structure where individuals are assigned to a mixture of latent clusters or populations based on multilocus genotype data in this article we focus on the population_genetic application of mixed membership models and refer to this application as clustering inference see novembre for a review of multiple population_genetic clustering inference methods including structure in structures bayesian_markov algorithm individuals are modeled as deriving ancestry from k clusters where the value of k is user specified each cluster is constrained to be in hardy_weinberg and clusters vary in their characteristic allele_frequencies at each locus clustering inference using genetic data is a crucial step in many ecological and evolutionary_studies for example identifying genetic subpopulations provides key insight into a samples ecology and evolution reveals ethnic variation in disease_phenotypes and reduces spurious correlations in genome_wide for a given multilocus genotype dataset with n individuals and k clusters the output of a single algorithmic run of clustering inference is an n k matrix denoted as q of membership coefficients these coefficients can be learned using a supervised or unsupervised_approach membership coefficient q ij is the inferred proportion of individual is alleles inherited from cluster j the row vector q i is interpreted as the genome_wide ancestry of individual i and the k elements of q i sum to each column vector q j represents membership in the jth cluster across individuals although covariatessuch as population labels geographic_origin language spoken or method of subsistenceare not used to infer membership coefficients these covariates are essential for interpreting q matrices given that over studies have cited structure to date and or more q matrices are routinely produced in a single study investigators need efficient algorithms that enable accurate processing and interpretation of output from clustering inference algorithms designed to process q matrices face three challenges first a given run which yields a single q matrix is equally likely to reach any of k column permutations of the same collection of estimated membership coefficients due to the stochastic_nature of clustering inference this is known as label switching for a fixed value of k and identical genetic input column q j in the q matrix produced by one run may not correspond to column q j in the q matrix produced by another run in our analyses of the genomes phase label switching occurred in of pairwise_comparisons among runs that is many matrices of membership coefficients were identical once columns were permuted to match and rapidly finding permutations that maximize similarity between q matrices is computationally_expensive as k increases second even after adjusting for label switching q matrices with the same input genotype data and the same value of k may differ non trivially this is known as multimodality and occurs when multiple sets of membership coefficients can be inferred from the data we refer to runs that despite identical inputs differ non trivially as belonging to different modes for a fixed value of k a set of runs grouped into the same mode based on some measure of similarity can be represented by a single q matrix in that mode many studies using the maximumlikelihood approach for clustering inference implemented in admixture ignore manifestations of multimodality despite the fact that admixture can identify different local maxima across different runs for a given value of k e g the complete characterization of modes present in clustering inference output gives unique insight into genetic_differentiation within a sample a third complication arises for interpreting clustering inference output when the input parameter k is varied all other inputs being equal there is no column permutation of a q nk matrix that exactly corresponds to any q nk matrix we refer to this as the alignment across k problem a common pipeline when applying clustering inference methods to genotype data is to increment k from to some user_defined maximum value k max although some clustering inference methods also assist with choosing the value of k that best explains the data accurate and automated analysis of clustering inference output across values of k is essential both for understanding a samples evolutionary_history and for model_selection the label switching multimodality and alignment across k challenges must all be resolved in order to fully and accurately characterize genetic_differentiation and shared_ancestry in a dataset of interest here we present pong a new algorithm for fast post_hoc of clustering inference output from population_genetic data combined with an interactive javascript visualization using datadriven documents d js https github com mbostock d our package accounts for label switching characterizes modes and aligns q matrices across values of k by constructing weighted bipartite graphs for each pair of q matrices based on similarity in membership coefficients between clusters our construction of these graphs draws on efficient algorithms for solving the combinatorial_optimization known as the assignment problem thereby allowing pong to process hundreds of q matrices in seconds pong displays a representative q matrix for each mode for each value of k and identifies differences among modes that are easily missed during visual_inspection we compare pong against current solutions clumpp by augmented as clumpak by and find our approach reduces runtime by more than an order of magnitude we also apply pong to clustering inference output from the genomes phase and present the most comprehensive depiction of global human population_structure in this dataset to date pong has the potential to be applied broadly to identify modes align output and visualize output from inference based on mixed membership models from clustering inference with admixture in order to generate visualizations highlighting similarities and differences among q matrices pong generates weighted bipartite graphs connecting clusters between runs within and across values of k sections our goal of matching clusters across runs is analogous to the combinatorial_optimization known as the assignment problem for which numerous efficient algorithms exist pongs novel approach of comparing clusters column vectors of q matricesdramatically reduces runtime relative to existing_methods that rely on permuting entire matrices consider two q matrices q q ij and r r ij each weighted bipartite_graph gq r f q j g f r k g e encodes pairwise similarities between clusters in q and clusters in r edges in g are weighted according to a similarity_metric computed between clusters detailed in supplementary_information pongs default similarity_metric is derived from the jaccard_index used in set comparison and emphasizes overlap in membership coefficients without incorporating individuals who have no membership in the clusters under comparison we define an alignment of q and r as a bipartite perfect matching of their column vectors pongs first objective is to find the maximum_weight alignment for each pair of runs for a fixed value of k section this information is used to identify modes within k and we randomly choose a representative run q matrix for each mode found in clustering inference we call the mode containing the most runs within each value of k the major mode for that k value ties are decided uniformly at random pongs second objective is to find the maximum_weight alignment between the representative run of each major mode across values of k section supplementary identifying the maximum_weight alignment within and across k inherently solves the label switching problem without performing the computationally_costly task of comparing whole matrix permutations last pong colors the visualization and highlights differences among modes based on these maximum_weight alignments we ran admixture on unlinked genome_wide single_nucleotide from unrelated_individuals in the genomes_project phase consortium see supplementary_materials to characterize population_structure among globally_distributed human populations admixture was run with k ranging from to and runs were generated per value of k thus a total of q matrices were produced figures and depict pongs analysis of of these runs we also applied clumpak the state of the art method for automated post_processing and visualization of clustering inference output to these runs partial results shown in figures b and c see also supplementary clumpak automatically runs clumpp for each value of k as part of its pipeline and produces visualizations within and across values of k using distruct displaying one barplot per mode shows clumpaks reported major mode in the genomes dataset at k which averages over six runs all major modes reported by clumpak can be viewed in supplementary using clumpaks web_server http clumpak tau ac il with its default_settings including using clumps fastest algorithm largekgreedy for aligning q matrices for a fixed value of k took min and s for post_processing of these runs we could not apply other clumpp algorithms to the genomes dataset using clumpaks web_server due to the servers restrictions against exhaustive running_times we also installed clumpak locally on linux machines running debian gnu linux with gb of ram processing these q matrices took hours using clumpps largekgreedy algorithm using clumpps greedy_algorithm which has increased accuracy over largekgreedy clumpak did not complete processing these q matrices after four days we also applied clumpps fullsearch algorithm its most accurate algorithm to the q matrices where k after days the job had still not completed under its default_settings pong parsed input characterized modes and aligned q matrices within each value of k and aligned q matrices across k in seconds on a mid macbook pro with gb ram after opening a web_browser pongs interactive_visualization loaded in an additional s supplementaryshows the main visualization in pong identifies four modes at k in the genomes dataset phase light blue represents the cluster of membership coefficients first identified at k see also supplementary figures s and s in run k r representing out of runs light blue represents british central european_ancestry in the major mode ceu and gbr however light blue represents south_asian ancestry gih in out of runs e g run k r puerto_rican ancestry pur in out of runs e g run k r and han_chinese ancestry in run k r pongs display of representative runs for each mode allows the user to observe and interpret multiple sets of membership coefficients inferred from the data at a given value of k in contrast the minor mode clumpak outputs is the same as pongs major mode while clumpaks major mode reported at k averages over all minor modes identified by pong the light blue in clumpaks reported major mode could be easily misinterpreted as shared_ancestry among south_asian east_asian and puerto_rican individuals when in actuality these are distinct modes we note that the highest likelihood value of k for the genomes data we analyzed is k at that value of k we also see that clumpaks major mode suggests shared_ancestry among individuals that are actually identified as having non overlapping membership coefficients when individual runs are examined supplementary figures s and s shows pongs visualization with consistent colors of all q matrices released by k through pong was able to process these q matrices and render its visualization in s the modes identified in and supplementarydiffer substantially from the results reported by for example in pong depicts substructure in puerto_rico and in china that is not observed in extended databy this could be due to different filters applied to the input snp data e g we removed relatives from data but did not filter_based on minor_allele see supplementary_information and we further note that these contrasting_results indicate the need for efficient and accurate methods for processing and visualizing q matrices here we introduce pong a freely_available user_friendly networkgraphical method for post_processing output from clustering inference using population_genetic data we demonstrate that pong accurately aligns q matrices orders_of more quickly than do existing_methods it also provides a detailed characterization of modes among runs and produces a customizable interactive d js visualization securely displayed using any modern web_browser without requiring an internet connection pongs algorithm deviates from existing_approaches by finding the maximum_weight perfect matching between column vectors of membership coefficients for pairs of q matrices and leverages the hungarian algorithm to pong analysis and visualization of latent clustersefficiently solve this series of optimization_problems interpreting the results from multiple runs of clustering inference is a difficult process investigators often choose a single q matrix at each value of k to display or discuss overlooking complex signals present in their data because the process of producing the necessary visualizations is too time consuming pongs speed allows the investigator to focus instead on conducting more runs of clustering inference in order to fully interpret the clustering in her sample of interest currently many population genetic_studies only carry out one run of a b c visualizations of modes in population_structure identified by pong and clumpak at k for clustering inference with admixture applied to genomes data phase the new cluster of membership coefficients first identified at k is denoted by light blue in each barplot a pongs dialog box of modes at k with multimodality highlighted b clumpaks major mode at k averages over six runs of clustering inference output the reported mean similarity_score among these six runs is south_asian gih han_chinese chb and chs and puerto_rican pur individuals all have ancestry depicted by the light blue cluster in this plot the six runs averaged here are instead partitioned into three minor modes by pong in panel a c clumpaks minor mode at k averages over four identical runs mean similarity_score is this barplot contains the same information as the barplot of k r representing pongs major mode in panel a clustering inference per value of k particularly when using admixtures maximum_likelihood approach to the inferential framework implemented in structure the likelihood landscape of the input genotype data is complex and can hold different local maxima for a given value of k see combining pongs rapid algorithm and detailed interactive_visualization with posterior_probabilities for k reported by clustering inference methods will allow investigators to accurately interpret results from clustering inference thereby advancing our knowledge of the genetic_structure of natural_populations for a wide_range of organisms we further plan to extend pong to visualize results from other applications of mixedmembership models and to leverage the dynamic nature of bound data to increase the information provided by pongs visualization 
