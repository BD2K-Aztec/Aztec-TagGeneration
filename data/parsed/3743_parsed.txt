protein evolution along phylogenetic histories under structurally constrained substitution models_motivation models of molecular_evolution aim at describing the evolutionary_processes at the molecular level however current models rarely incorporate information from protein_structure conversely structure based models of protein evolution have not been commonly_applied to simulate sequence_evolution in a phylogenetic framework and they often ignore relevant evolutionary_processes such as recom bination a simulation evolutionary framework that integrates substitution models that account for protein_structure stability should be able to generate more realistic in silico evolved proteins for a variety of purposes results we developed a method to simulate protein evolution that combines models of protein_folding stability such that the fitness depends on the stability of the native_state both with respect to unfolding and misfolding with phylogenetic histories that can be either specified by the user or simulated with the coalescent under complex evolutionary_scenarios including recombination demographics and migration we have implemented this framework in a computer program called proteinevolver remarkably comparing these models with empirical amino_acid models we found that the former produce amino_acid distributions closer to distributions observed in real protein_families and proteins that are predicted to be more stable therefore we conclude that evolutionary_models that consider protein_stability and realistic evolutionary_histories constitute a better approximation of the real evolutionary_process availability proteinevolver is written in c can run in parallel and is freely_available fromthe simulation of molecular_evolution is commonly used to mimic real_world processes allowing the study of complex systems that are analytically intractable or to understand the mechanisms by which an evolutionary_process is modified a key mechanism in the simulation of molecular sequences is the substitution or replacement process markov substitution replacement models are commonly used in population_genetics and molecular_evolution to mimic evolutionary_processes at the molecular level seeli and nevertheless most substitution models assume that sites evolve independently and they cannot incorporate information on the structural and functional role of amino_acids within proteins which is determined by the interactions of different sites it is known that these interactions may lead to non independent evolution as the evolutionary_rate at a site is influenced by substitutions at neighboring sites e g and references therein moreover the conformational diversity of proteins may also influence their molecular_evolution models of evolution that incorporate structure are therefore of increasing importance recently structurally constrained models of protein evolution have been introduced to represent folding stability of a target structure as a proxy for fitness reviewed in these models have been studied assuming a neutral fitness_landscape e g b and as a function of population_size e g however these models have been seldom used to obtain evolutionary insights from real_data probably because of the lack of widely available and easy to use software furthermore proteins simulated under a given substitution process might be unrealistic if common evolutionary_processes are ignored for example recombination constitutes a fundamental evolutionary force at the molecular level that can affect the estimation of different evolutionary_parameters like molecular adaptation by increasing the number of false positively_selected substitution_rate lack of molecular_clock or ancestral states similarly population_genetics processes such as demographic changes population_structure and migration may influence evolutionary_histories for example branches are short when the population_size undergoes a bottleneck e g and deme sizes in structured populations may influence the topology of genealogical trees as lineages are assumed to be in the same deme to coalesce e g neuhauser and tavare tavare these aspects could influence the number of substitutions and evolutionary_trajectories generated in the simulations which consequently influence the simulated_data in our view it is important that a simulation framework allows reproducing and to whom correspondence should be addressed testing these evolutionary features to be able to address wider biological_questions in this study we have implemented structurally constrained substitution models hereafter scs models that allow for sitedependent substitutions under neutral and non neutral fitness_landscapes that depend on protein_stability in the freely_available computer program proteinevolver which is able to simulate the evolution of proteins and protein_coding along evolutionary_histories such as phylogenetic_trees or ancestral recombinant graphs args these phylogenetic histories can be specified by the user or simulated through the coalescent with recombination demographics and migration see the reviews recently grahnen and liberles introduced the computer program cass that simulates protein sequence_evolution under selection to fold into a specific conformation our program differs from cass in two main aspects the representation of the protein_structure which influences the way in which we treat misfolding stability and the possibility to represent a broad variety of demographic and evolutionary_scenarios for instance varying recombination_rates and mutation grahnen and liberles adopt explicit side chain representation and we also adopt contact matrices which are less precise but allow a statistical_mechanical treatment of the ensemble of misfolded conformations that is computationally affordable and actually very fast with our approximation e g misfolding stability is important because if only the unfolded_state is considered selection tends to artificially favor very hydrophobic sequences therefore the structural approach taken by the two programs is complementary and each of them may be suited to address different kinds of biological_questions through extensive simulations we compared the scs models with commonly used empirical amino_acid models using as a benchmark well known protein_families we found that sequences simulated under our scs models produce amino_acid distributions closer to the observed ones furthermore the folding stability of the native_state assessed by building structural_models by homology and predicting their stability with a method different from the one adopted in the simulations is significantly_larger for proteins simulated under the scs model we conclude that substitution models that incorporate protein_structure information are better approximations to the real evolutionary_process and may provide more meaningful evolutionary inferences than site independent substitution models during protein evolution interactions within the protein_structure lead to correlated_evolution as the rate at which a siteleibler distance to the real protein_alignments of the simulated alignments by the neutral and fitness scs models with respect to the empirical amino_acid model the y axis indicates decline of the distance of the neutral and fitness best and worst conditions scs models with respect to the distance of the empirical model note that the neutral scs model was overall more robust than the fitness scs model under different thermodynamic conditions see supplementaryand b on the other hand the fitness scs model under the best conditions see supplementary figs s a b and s left could improve the neutral model in half of protein_families however the worst conditions may lead to results without any improvement respect to the empirical model dope energy computed in the simulated proteins under the empirical and the neutral scs substitution models and in the native protein for the protein_family phototactive yellow proteins note that the dope energy is unnormalized with respect to the protein size and therefore scores from different proteins cannot be compared directly experiences change is influenced by replacements at neighboring sites to adequately model these correlations we developed the simulation framework proteinevolver that integrates structurebased models of protein evolution and evolutionary_histories that can be simulated under diverse evolutionary_scenarios such as recombination including hotspots and coldspots migration and demographics importantly our scs models consider both the stability against unfolding and the stability against misfolding which is difficult to estimate as it requires the use of a set of alternative conformations and it is frequently neglected in simulations of protein evolution despite the importance of negative design moreover our approximation of the free_energy of the misfolded state allows us to estimate the effect of each mutation on both unfolding and misfolding performing a number of computations that grow only linearly with the number of amino_acids as a consequence these models can be applied along long phylogenetic histories the recently_developed cass tool grahnen and liberles can simulate protein sequence_evolution accounting for selection to fold into a specific conformation cass is based on an explicit side chain representation of the protein which can make it more accurate than our contact matrix based method although it is known that contact matrices allow reconstruction of all atom coordinates with precision and with treatment of the misfolded ensemble which is important to avoid bias toward hydrophobic sequences that are often unrealistically favored by energy_functions however additional considerations in the latter might avoid this effect an important characteristic of cass not included in our program is that it allows selecting for structures that bind a target_molecule therefore allowing investigation of an important aspect of protein_function which is nevertheless intimately_related with structural_stability e g another important feature of our framework which is not present in the cass approach is that it allows modeling evolutionary_mechanisms other than point_mutations such as recombination which has been shown to be a key element in protein_engineering and could affect structural constraints for example have shown that recombination may influence structural divergence in addition we can simulate molecular_evolution in population_genetics scenarios including_demographics population_structure and migration which allows us to address a wide_range of biological_problems by investigating how these evolutionary_scenarios influence the properties of the evolved sequences by altering the underlying genealogies and the properties of the substitution process which in non neutral fitness_landscapes strongly depend on population_size on the other hand including or ignoring structural considerations can affect population_genetic inferences i e inferences on recombination demographics or migration we assessed the performance of the scs models versus more traditional empirical replacement matrices for all protein_families studied and tested combinations of temperature and configurational entropy parameters the neutral scs model always simulated sequences with amino_acid frequencies closer to the observed ones than the best fit empirical amino_acid model on the other hand the fitness scs model may outperform the neutral model under optimal thermodynamic_parameters but it is very sensitive to the correct choice of parameters consequently we recommend the use of the neutral scs substitution model by default because it is more robust whereas the fitness scs model should be only used with the default thermodynamic_parameters in which case it may simulate more realistic proteins for some protein_families this difference stems from the fact that the non neutral model optimizes protein_stability when the population_size is large and it may bias the evolutionary_process if the thermodynamic_model is not reliable on the other hand we think that this dependence on parameters is reassuring as it shows that the agreement between observed and simulated distributions that proteinevolver achieves is not a trivial result the benefits of using the scs substitution models instead of the empirical substitution models were also observed by evaluating the adequacy between the simulated sequence and its best homology_model with the dope energy in particular we found that the dope energy from proteins simulated by the scs neutral model was always more negative more stable d proteins than proteins simulated under the empirical substitution model although not surprisingly less negative than the energy of the experimentally_observed sequence structure pair these findings were expected because the empirical_models consider independent sites and therefore they are unable to account for physical_interactions that promote stability e g nevertheless they constitute a minimal test that indicates the consistency of scs models and confirms the limitation of empirical substitution matrices the consideration of structural_information should result in more sensitive and more accurate representations of molecular_evolution than those based on sequence_data alone our structure based models could help for a more realistic benchmarking of methods trying to take into account site dependency induced by protein_structure e g and the important influences of the unfolded and misfolded configurations on the protein_stability at the population level the framework may help e g i to evaluate the range of proteins that one may expect to observe in different populations where these populations can change their sizes with time and can exchange migration ii to validate analytical frameworks e g methods for the inference of args ancestral protein reconstruction recombination breakpoints and recombination_rates from proteins or protein_coding while accounting for structural constrains or even iii to infer evolutionary_parameters of interest and carry out model choice in an approximate_bayesian abc approach e g estimate recombination_rates or select among different demographic and migration models from protein data while accounting for structural_information at the molecular level the framework may help for example to study the influence of recombination_events on the structure based stability of the resulting proteins or to perform structurally constrained substitution model choice by using abc 
