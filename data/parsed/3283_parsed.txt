gene_expression normalization of metabolomics_data with applications to correlation maps motivation in metabolomics the goal is to identify and measure the concentrations of different metabolites small_molecules in a cell or a biological system the metabolites form an important layer in the complex metabolic_network and the interactions between different metab olites are often of interest it is crucial to perform proper normalization of metabolomics_data but current methods may not be applicable when estimating interactions in the form of correlations between me tabolites we propose a normalization approach based on a mixed model with simultaneous estimation of a correlation_matrix we also investigate how the common use of a calibration standard in nuclear_magnetic nmr_experiments affects the estimation of correlations results we show with both real and simulated_data that our proposed normalization method is robust and has good performance when discovering true correlations between metabolites the standardization of nmr_data is shown in simulation_studies to affect our ability to discover true correlations to a small extent however comparing standardized and non standardized real_data does not result in any large differences in correlation estimates availability_and source_code is freely_available at https sourceforge net_projects metabnorm in metabolomics the ultimate_goal is to determine quantitatively the levels of all metabolites small_molecules in a biological_sample at present it is not possible to measure the complete metabolome and depending on the purpose of the experiment the number of features measured can range from a handful to a couple of thousands usually in targeted experiments a small number of features are measured and the metabolites are completely identified in untargeted experiments many more features are quantified but a majority of them cannot be identified as a specific metabolite subsets of the metabolome are sometimes referred to as metabolic_profiles several methods are at our disposal for metabolomic analyses e g nuclear_magnetic nmr_spectroscopy or gas_chromatography in this article we focus on metabolomics_data from nmr_experiments when quantifying metabolite_levels by using proton nmr the protons in a molecule give rise to a signal that appears as one or several peaks in a spectrum because of spin quantum_effects peaks split in different ways and may overlap but it is often possible to assign and quantify peaks that belong to a single metabolite or group of metabolites usually the signal from a metabolite is quantified by calculating the area of a peak that can be uniquely assigned to it although peak_heights are also sometimes used to quantify the concentrations of the metabolites it is common practice to add a known amount of a certain compound to each sample when the compound is dissolved in the sample itself it is called an internal_standard in contrast an external_standard would be either a solution of the compound in a capillary or the compound run as a separate sample but with the same experimental_setup the added calibration compound then gives rise to a control peak in the spectrum of the sample compounds commonly used as internal calibration standards in proton nmr are trimethylsilyl propionate tsp and tetramethylsilane the following formula is used to calculate the concentration of the metabolites using the calibration standard let c i be the concentration of metabolite i and c the known concentration of the control compound setwhere n is the known number of protons in the control molecule n i is the known number of protons in metabolite i a i is the measured peak_area of metabolite i and a is the peak_area of the standard besides helping with quantification a calibration standard is useful for chemical_shift calibration which helps in identifying the metabolites by using the chemical_shift values in the literature however the use of the standard can be troublesome in some scenarios as we show in appendix a in the supplementary_information the fact that the standardization is done as a ratio will induce apparent correlations between metabolites even if none exists in the first place to whom correspondence should be addressed metabolites in the cell participate in enzyme_catalyzed that form complex biochemical_networks there are often interactions between metabolites affecting their concentrations when they appear in the same biochemical sub network or pathway if for instance there is a rise in the cellular concentration of a metabolite that is the substrate of an enzyme then the catalyzed_reaction will usually proceed more rapidly so that the product of the reaction will also tend to increase in concentration thus the concentrations of substrate and product would tend to be positively correlated in the same way negative correlations may occur when an increase in concentration of one metabolite leads to the depletion of the second metabolite an example might be an enzyme that is subject to allosteric inhibition a rise in the cellular concentration of the inhibitor metabolite would then tend to reduce the cellular concentration of the enzymes product thus the inhibitor and the product would be negatively_correlated analysis of the positive_and correlations between metabolites can be performed by preparing a large number typically of apparently identical samples of for instance cultured_cells although the measured concentrations of cellular_metabolites in the individual samples will be identical within biological_variation that uniformity is achieved by numerous homeostatic_mechanisms that will give rise to positive_and correlations between metabolite_concentrations this type of analysis is often referred to as metabolitemetabolite correlation_analysis mmca the terms mmca correlation_analysis and estimation of correlation maps will be used interchangeably in this article commonly pearson_correlations are used to estimate the interactions between metabolites the use of mutual_information has also been suggested as a dependency measure as it captures more than linear relationships between metabolites however as metabolomics_data generally are quite skewed even after transformation with a standard as in equation the pearson coefficient may not be a good estimate of the correlations see further discussion below a transformation of the data may therefore be needed before further analysis estimating interactions with mutual_information can also benefit from such transformations the need for normalization for metabolomics_data is crucial just as with other types of omics_data nmr samples are affected by technical_artifacts and may exhibit inflated between sample variation owing to batch_effects for correlation_analysis these batch_effects together with effects from standardization will result in large positive correlations as illustrated in a few normalization_methods for metabolomics_data have been suggested in the literature the nomis method is based on the presence of multiple internal_standards in each sample the optimal_combination of standards is selected and used to remove systematic_error also dependent on multiple internal_standards is the ccmn method which is mainly aimed at mass_spectrometry based metabolomics_data a recent addition to the field is the ruv method which is shown to be powerful for removal of unwanted variability while not being dependent on internal_standards however ruv is not a global normalization method in the sense that it does not produce a complete normalized dataset but rather a compressed set suitable for detecting differentially_abundant metabolites hence ruv is not recommended in connection to classification clustering problems or mmca in situations when these metabolomics normalization_methods are not appropriate normalization_methods adapted from the single_channel microarray literature are commonly used however the nature of some common single_channel methods e g quantile normalization renders them inappropriate to use on the smaller datasets that are usually produced in metabolomics in quantile normalization the idea is to give each sample the same distribution over features e g metabolites this is achieved by sorting the values in each sample calculating a mean quantile over the samples and substituting the value of the data item in the original dataset with the mean followed by a re sort of each sample this can be problematic for features in the tails of the distribution as it is possible that a feature could receive the same value across all samples the result of this is that as happens with our dataset described in section some correlations between metabolites cannot be calculated the median centering normalization also proves to be relatively non robust if the number of metabolites is small see discussion below in this article we investigate how the use of a calibration standard for quantitation affects the reliable estimation of correlation maps we argue that log transformations are reasonable for metabolomics_data and we suggest a global normalization method suitable for smaller targeted metabolomics datasets that is robust in connection to mmca the purpose of this normalization is to remove variation due to sources other than homeostatic changes the proposed global normalization method is intended to be a complement to existing_methods dependent on multiple internal_standards and methods that only function in differential_expression settings the purpose of this article is two fold first we propose a global normalization method intended for use with smaller metabolomics datasets and second we investigate how well correlations can be discovered when we have the option of using nmr_data calibrated using a standard or not when comparing raw and standardized metabolite_levels peak_areas concentration for the real hdf dataset we observed large positive correlations in the non normalized data such large correlations are not biologically reasonable as we expect both negative and positive correlations to be present and we argue that they are caused by batch_effects and the calibration standard the positive correlations were more pronounced for the standardized data which is a cause for concern however after normalization both the raw and standardized data exhibited better correspondence and large differences in estimated correlations could not be found most likely the influence of the calibration standard is at least partly removed by the inclusion of a random_sample effect in our normalization model our simulation_study on the discovery of true metabolitemetabolite correlations included cohort batch and sample effects in the simulated_data as well as a simulated calibration compound although true nmr_data are more complex and the calibration standard affects the data in a more intricate way than by simple scaling we think the study gives some pointers concerning performance of different normalization_methods and how the power is affected when we use either raw or standardized data in summary our simulations show that using raw_data compared with standardized data has a slight edge when it comes to performance measured as average auc however the loss in power using standardized data compared with raw_data is small and the added advantages of better metabolite quantitation and chemical_shift calibration render standardized data a feasible choice when estimating correlations in our correlation robustness study based on real_data we investigate how stable the correlations are when removing one or several metabolites from the set and re normalizing without the removed metabolites the study shows that methods developed for high_dimensional like the loess smoother perform poorly for smaller datasets if at all applicable the commonly raw nmr_data compared with the standardized counterpart the inter metabolite correlations for five metabolites alanine choline glutamate glycine and valine are compared in raw and standardized data for three normalization_methods and non normalized data in the hdf datasetnote the columns represent the different methods used mixed model quantile normalization qn and variance stabilizing normalization vsn the average auc value of repeats of each scenario is given with the standard_deviation in parenthesis a graphical_representation of the results is provided in appendix e supplementary used median normalization is also problematic when removing certain sets of metabolites and the same trend can be seen for the sum scaling method the mixed model we propose is a robust choice in this article we focus on low_dimensional metabolomics datasets for two main reasons first the normalization_methods adopted from the microarray community e g quantile normalization are usually not applicable to these sets and as current methods for metabolomics_data have restrictions either demanding presence of multiple standards or intended for differential analysis customized methods are needed second in mmca the focus is usually to unravel metabolitemetabolite correlations for a smaller set of metabolites and targeted datasets are mainly used for this when evaluating our mixed model for larger datasets varying_size between features contrasting it with quantile and variance stabilizing normalization vsn we conclude that a model based_approach is to prefer for datasets with less than features for larger sets the variance stabilizing approach performs equally well as a mixed model and better than quantile normalization as mixed models are hard to adapt for large_scale sets vsn is a good alternative the real_data we use in this article have a complex structure with cohorts batches and samples the normalization method based on the mixed model can also be applied to simpler designs e g when the nesting consists of samples within batches making it applicable to many scenarios the estimation of the fixed and random_effects in the mixed model is coupled to an iterative procedure to estimate the correlation_matrix of the metabolites simultaneously however it is also possible to apply the method for just one iteration and ignore the estimation of the correlation_matrix in the first step as we do in one of the simulation_studies this is a feasible option when the purpose is only to normalize the data in e g a p n more metabolites than samples setting we present a mixed model approach to normalization of lowdimensional metabolomics datasets we show that this method_performs compared with competing_methods with respect to robustness and discovery of true correlations we also use real and simulated_data to infer how standardization with a calibration compound affects the estimation of correlations although the performance for non standardized data is slightly better than for standardized data the benefits of chemical_shift calibration in identifying metabolites as well as in quantitation of metabolite_concentrations motivate the use of a calibration standard in nmr_experiments 
