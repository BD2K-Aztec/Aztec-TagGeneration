a counting renaissance combining stochastic mapping and empirical_bayes to quickly detect amino_acid under positive_selection motivation statistical_methods for comparing relative rates of synonymous and non synonymous_substitutions maintain a central role in detecting positive_selection to identify selection researchers often estimate the ratio of these relative rates d n d s at individual alignment sites fitting a codon substitution model that captures het erogeneity in d n d s across sites provides a reliable way to perform such estimation but it remains computationally prohibitive for massive datasets by using crude estimates of the numbers of synonymous and non synonymous_substitutions at each site counting approaches scale well to large_datasets but they fail to account for ancestral state reconstruction uncertainty and to provide site_specific d n d s estimates results we propose a hybrid solution that borrows the computational strength of counting_methods but augments these methods with empirical_bayes modeling to produce a relatively fast and reliable method capable of estimating site_specific d n d s values in large_datasets importantly our hybrid_approach set in a bayesian_framework integrates over the posterior_distribution of phylogenies and ancestral reconstructions to quantify uncertainty about site_specific d n d s estimates simulations_demonstrate that this method competes well with more principled statistical_procedures and in some cases even out performs them we illustrate the utility of our method using human_immunodeficiency feline panleukopenia and canine_parvovirus evolution examples availability renaissance counting is implemented in the development branch of beast freely_available atquantifying selective_pressures on protein_coding is central to the goal of characterizing darwinian processes in evolutionary_biology among comparative and summary_statistic approaches the relative rate of silent and replacement substitutions represents one of the most popular measures to detect the molecular footprint of selection non synonymous mutations that offer fitness advantages are expected to become fixed at a higher rate than synonymous mutations implying that a non synonymous synonymous substitution_rate ratio d n d s greater than one provides evidence for diversifying positive_selection although estimation of has led to the identification of positive_selection in several systems e g there are clear boundaries to the conditions under which it can reveal an unambiguous trace of molecular adaptation first an excess of non synonymous_substitutions over synonymous_substitutions is almost invariably restricted to a handful of amino_acid responsible for adaptive_evolution therefore sensible estimates need to take into account the variation in selection intensity across codon sites moreover although divergent sequences can yield considerable information to estimate nonsynonymous and synonymous_substitution the ratio of these rates may offer little insight when inferred from segregating polymorphisms within a single population finally it is also important to distinguish between different selective regimes underlying molecular adaptation diversifying selection maintains amino_acid diversity at a given site and naturally results in elevated values whereas directional_selection may operate through a restricted number of amino_acid which has less impact on but can lead to rapid fixation of a new allele in the population the former is ubiquitous in antagonistic systems such as pathogen host interactions not surprisingly d n d s estimation methods have been frequently_applied to viral gene sequences to detect escape from host_immune or adaptation to novel hosts rapidly_evolving viruses benefit from the ability to generate adaptive mutations de_novo whereas other organisms must rely on pre_existing to whom correspondence should be addressed variation maintained by population_structure or balancing_selection the impact of immune pressure on the genetic_diversity of viruses can be highly dependent on how potent the immune_responses are to different viral_variants a concept that has been put forward within the framework of phylodynamics for this reason methods to estimate have become an integral part of the phylodynamic toolbox which generally refers to recent statistical and computational developments to simultaneously estimate epidemic and spatiotemporal_dynamics from viral_genes sequences in this article we are interested in site_specific estimation of d n d s ratios there are two main classes of methods designed for this task the first class prescribes to build a model of codon evolution with the d n d s ratio as a model parameter that is allowed to vary across sites although we fully endorse these approaches and use them whenever possible codon based models become computationally prohibitive when analyzing large_datasets that include hundreds if not thousands of molecular sequences because of this computational limitation researchers often turn to a second class of methods that are based on imputing counting unobserved synonymous and non synonymous_substitutions these substitution counts are then used to construct a test_statistic to assess the null_hypothesis of neutrality h d n d s such counting_methods enjoy computational_efficiency and often work well in practice kosakovsky but have two important shortcomings first counting approaches experience difficulties in handling uncertainty about the phylogenetic_tree and about other nuisance parameters that play a role in counting unobserved synonymous and non synonymous_substitutions propose to overcome this problem by combining stochastic mapping introduced by nielsen with traditional counting_methods test_statistics as discrepancy measures in a posterior predictive diagnostics framework however posterior predictive diagnostics undoubtedly useful for visual_exploration of model_fit are difficult to calibrate and to use in a semi_automatic fashion the second limitation shared by all counting_methods is their inability to provide reliable sites specific d n d s estimates and to quantify the relative strengths of selection across amino_acid we present a novel and efficient bayesian_method for detecting positive diversifying selection in molecular sequences our method combines the computational speed of counting_methods and statistical efficiency of empirical_bayes approaches a further strength of the method is its simplicity of implementation thanks to recent algorithmic advances in stochastic mapping stochastic mapping has been used before to speed up mcmc based bayesian_estimation of codon based models but this and subsequent approaches still operate within the codon based modeling framework in contrast our method uses stochastic mapping to quickly approximate codon based models that account for rate variation of d n d s over sites our analysis of simulated_and demonstrates that the proposed approach competes well with more computationally_demanding methods in recovering site_specific d n d s ratios and in accurately identifying sites under positive diversifying selection the main distinction between renaissance counting and previous attempts to use stochastic mapping to detect diversifying positive_selection is the ability of our renaissance method to directly estimate d n d s ratios and to quantify uncertainty in these estimates this advance is important because all counting_methods including stochastic mapping based ones can only produce site_specific p values resulting from testing a null_hypothesis of neutrality however it is well known that using p values has limitations in particular as p values are always calculated by conditioning on the null_hypothesis itwould be inappropriate to use the magnitude of p values as evidence in favor of the null the task of comparing p values becomes even more challenging in the method ofbecause these authors use notoriously hard tocalibrate posterior predictive p values therefore it is difficult to use previously_developed counting_methods to quantify relative_strength of selection at amino_acid although our method cannot possibly resolve the long_standing statistical controversy of quantifying evidence in hypothesis_testing renaissance counting offers a straightforward estimation alternative by producing site_specific posterior distributions of d n d s ratios importantly this uniquely positions renaissance counting among other positive_selection detection methods as a method that also appropriately quantifies the relative strengths of selection at individual sites when imputing counting the unobserved synonymous and non synonymous_substitutions we produce substitution counts on each branch of the phylogenetic_tree and then sum them up for each site if a scientifically meaningful partition of branches into groups exists we can easily sum the substitutions within each group separately and apply our empirical_bayes procedure to the site_specific counts in each group for applications to within host hiv evolution for example we can consider synonymous and non synonymous_substitutions only on internal branches of the phylogeny this partition of branch_lengths is motivated by a widely_accepted hypothesis that many terminal branches of intrahost hiv phylogenies represent lineages that are weeded out by selection therefore it is reasonable if not advisable to avoid the mutational load on these branches and their impact on substitution_rates by excluding them when identifying positive diversifying selection concerning the identification site_specific selection patterns the development of renaissance counting was clearly not to replace but to complement existing methodology even after a comprehensive evaluation of several counting based and maximum_likelihood methods kosakovsky pond and frost found it difficult to make definitive recommendations on which methods to use in particular cases in fact they concluded that a consensus of several methods but each accepting relatively high nominal levels would be a reasonable_approach to rule out spurious_results in many ways renaissance counting presents an interesting candidate method to include in such a consensus approach embedded in a bayesian_inference framework renaissance counting accounts for phylogenetic error when estimating d n d s ratios perhaps more importantly our approach uses a test_statistic that is very different from both previous counting_methods and maximum_likelihood methods for small or less divergent datasets for example the test used in previous counting_methods is notoriously conservative kosakovsky which is also confirmed by our comparison of the ebin test to the ci coverage test empirical bayesian_analysis of random_effects on the other hand can suffer from large type_i owing to excessive errors in the parameter_estimates used kosakovsky renaissance counting avoids the estimation of codon model_parameters and estimation uncertainty will be taken into account by the ci coverage test approach the nucleotide model approximation also offers a significant speed up compared with fitting a codon model but considerable computation time may still need to be invested in integrating over the posterior_distribution of phylogenies in this respect we emphasize that renaissance counting is implemented in a bayesian_inference framework that provides access to an array of flexible models for estimating genealogical history divergence times flexible semi_parametric demographic and phylogeographic histories although site_specific selection patterns may not be of prime interest when engaging in such analyses renaissance counting readily delivers d n d s ratios for any coding sequence_alignment which may offer a starting_point for in depth characterization of selection_pressures involving different methods 
