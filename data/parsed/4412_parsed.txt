data_and statistical agglomeration peak summarization for direct_infusion lipidomics motivation quantification of lipids is a primary goal in lipidomics in direct_infusion injection or shotgun lipidomics accurate downstream identification and quantitation requires accurate summarization of repetitive peak measurements imprecise peak summarization multiplies downstream error by propagating into species identification and intensity estimation to our knowledge this is the first analysis of direct_infusion peak summarization in the literature results we present two novel peak summarization algorithms for direct_infusion samples and compare them with an off machine ad_hoc summarization algorithm as well as with the propriety xcalibur algorithm our statistical agglomeration algorithm reduces peakwise error by mass charge m z and intensity compared with the ad_hoc method over three datasets pointwise error is reduced by m z compared with xcalibur our statistical agglomeration algorithm produces less m z error and less intensity error on average on two comparable datasets availability the source_code for statistical agglomeration and the datasets used are freely_available purposes at https github com optimusmoose statistical agglomeration modified bin aggolmeration is freely_available in mspire an open_source mass_spectrometry package at https github com princelab mspire direct_infusion injection lipidomics sometimes called shotgun lipidomics for its similarity to shotgun genomics is an emerging but a well studied field here a liquid sample is injected into a mass_spectrometer yielding a set of mass charge m z intensity retention time rt tuples for our purposes we define a data point as a single m z and intensity observation of a given isotope at a particular rt and a peak as the data_points that comprise the observation of a distinct isotope hereafter we will more accurately use the term ridge instead of peak because of the fact that direct_injection lipid intensity does not vary as a function of time because there is no chromatographic_separation in direct_infusion lipidomics each rt scan represents an independent measurement of the sample ideally the species in the sample would be uniformly_distributed across rt and measured in near identical intensities across rt making reduction to a single d vector of unique ridges trivial unfortunately there are several noise factors that appear in real_world direct_infusion samples sample distribution heterogeneity results in inter scan variance in both m z and intensity what is more technical and mechanical limitations in the mass_spectrometer inculcate even more error into the output accurately estimating the true ridge values from the resulting output_file is a non trivial challenge to identify and quantify each lipid its component ridges must somehow be isolated one from another and the additive noise ridges removed we will call this process ridge summarization only after ridge summarization can the isotopic envelopes be compared with theoretical databases to identify and quantify the individual lipids in the sample the necessity of a solution for the ridge summarization problem in every direct_infusion lipidomics application and the presumed effect of the results of such a solution on downstream quantitation would suggest that a description of ridge summarization be found in every shotgun lipidomics study however it is frequently left unmentioned e g although direct_infusion methods have been around since the mid s we are only aware of two published solutions to this segment of the quantitation pipeline the first is that of treating a survey scan as a true ridge measurement from a glance at a typical shotgun lipidomics plot it should be clear that treating any single rt scan of data as a representative set of true ridges would be less than ideal as the scan would include many ridges with incorrect m z and intensity and exclude many other true ridges the second a more robust approach applies to shotgun lipidomics a technique that has been used in several proteomics_studies this approach which we label the fixed width algorithm averages scans across the rt dimension to yield an estimation of the true contents of the sample though this approach is simple to code and runs in linear time it is nonstatistical and does not take into account the data densities along the m z axis here we present two statistical_approaches to solving the ridge summarization problem and evaluate them against both synthetic and real_world ridge summarization problems we also provide the first comparative performance analysis of xcalibur and the fixed width algorithm on the ridge summarization problem to whom correspondence should be addressed sa generally outperforms the other methods under consideration across all datasets on both the qualitative_and measures considered in this study sa and mba outperform all other methods on ntpd m z mba had a slightly_lower ntpd rate on sample whereas sa outperformed all other methods are sliced into bins of width resolution the colors delineate observed ridges the red segments along the x axis indicate bin boundaries see online version for color on the other two datasets the relative performance was identical for ntpd intensity with the exception being more disparity between the sa and mba scores and fixed width on the noyce dataset xcalburs ntpd is dramatically higher for both ntpd intensity and ntpd m z than all other methods on the two datasets that were comparable given xcaliburs proprietary data limitations sa predicted the number of ridges far more accurately than any other method tested including xcalibur which was furthest from the actual number of ridges mba was second best on average at predicting the correct number of ridges on average each of the three methods performs rather similarly on purity the scores averaged across all three datasets are and for sa mba and fixed width respectively supplementary_material because we are ignoring all noise points real or assigned and because fixed width produces the narrowest ridges it is not surprising that fixed width performed so well on purity the nmi scores averaged across all three datasets are and for sa mba and fixed width respectively supplementary_material it is surprising that they are so close but this is likely a result of the modifications to this metric to handle noise each of the three methods performs inconsistently on sse sa outperforms the other methods on both sample datasets for m z sse but mba has a dramatically lower sse for the noyce dataset than either of the other methods fixed width has a dramatically lower_intensity sse than either of the other methods on the noyce dataset but only slightly less sse than sa on the sample dataset supplementary_material mba noticeably outperforms other methods on the sample dataset although the aforementioned metrics should give an overall quantitative measure of the performance of each method the segments of the spectra in figures and provide a qualitativexcalibur only accepts data in its proprietary format the results are not available for the noyce dataset note the different scales see online version for color see online version for color ntpdintensity here we compare predicted ridge intensities to the nearest observed ridge for each of the four methods statistical agglomeration modified bin agglomeration and fixed width using the a noyce b sample and c sample datasets sa outperforms the other methods on average providing a error_reduction from xcalibur for the two measurable datasets given xcaliburs proprietary data restrictions sa provides a reduction on average over fixed width note the different scales see online version for color sa bin agglomeration after sorting the data by m z value and assigning data_points to bins of fixed width a t test is conducted on the intensity and m z means of the first two bins a if either of the t tests fails to show a high_confidence that the means are different the bins are not combined and the algorithm considers the next two bins for agglomeration b otherwise the two bins are agglomerated and the algorithm considers the agglomerated bin and the next bin for agglomeration c dotted lines indicate ridge boundaries see online version for color assessment of each method on the sample datasets supplementary_material for quantitative results for the noyce dataset the pattern that emerges across datasets is that at least on these random segments sa consistently summarizes ridges exactly or very close to the hand annotation mba also performs well fixed width is not consistent in performance but usually adds extra ridges and or shifts m z values of ridges substantially across both sample datasets xcalibur drastically increases the number of ridges in the segment xcaliburs predicted ridges are also notably less intense than the hand annotated dataset the supplementary_information provides more metric results and an in depth discussion of how noise is treated in this article fixed width to our knowledge the only extant algorithmic solution to this problem is simple to code yet has some obvious limitations in mass_spectrometry the intra sample resolution is inherently variable at least for the orbitrap low_intensity signal groups are more dispersed whereas high_intensity signal groups have less m z variance any fixed width solution will either chop low_intensity ridges into incorrect component ridges incorrectly agglomerate highintensity ridges or both as shown in the results fixed width methods significantly overestimate the number of ridges cascading error downstream into identification and quantitation mba attempts to provide robust means for dealing with ridges that overlap and builds on the idea of fixed width binning by agglomerating any adjacent non empty bins although the initial fixed width and the choice of which bin splitting options to use are parameters that must be determined and set by the operator the information in manufacturer specifications such as resolution should assist in deciding the mba parameters in practice the machine calibration to which the specifications are tied is not always the setup desired for the practitioner due to time requirements desire to use ms_ms and so forth also the true machine resolution can vary_widely outside of the m z value the specification is provided for however practical experience may assist in knowing when the manufacturer specs are sufficient and what changes need to be made when they are not because each ridge can be a different width sa addresses the problem of bin size in a flexible data_driven manner the ridge agglomeration procedure is statistically driven using the data itself handling problems like overlapping ridges and avoiding the need for users to set parameters or for a priori_knowledge about the dataset noise filtering allows for the avoidance of boundary_conditions found in fixed width methods such as ridges with just one data point we consider s n to be a useful a priori setting as it was the ideal setting across all three of our datasets sas ability to predict a far more accurate number of ridges than the other methods suggests it will increase accuracy in downstream_processes over the current methods used including xcalibur one troubling observation from this study is the difficulty in accurately assessing intensity of discovered ridges both species identification and quantitation require an accurate intensity measurement yet even sas performance is simply the best of several inaccurate methods given the amount of lipid quantitation performed currently and also the state of the art better methods of estimating intensity are needed we have described the need for accurate ridge summarization in direct_injection lipidomics samples interestingly despite the importance of accuracy in this first step of the analysis_pipeline there has been no study of solutions to this version of the ridgesummarization problem to our knowledge we present our estimate of what is currently done in the community and also propose two novel algorithms mba and sa for resolving ridges in shotgun lipidomics samples we show that sa outperforms open_source and proprietary methods on average in a measure of ridgewise error ntpd on three datasets we also show that sa significantly_outperforms the proprietary program xcalibur on the two datasets for which we could use xcalibur incorporation of sa into existing analysis_pipelines could drastically improve downstream quantitation and identification results in a variety of lipidomics experiments future work should continue improving our capacity to produce summarized ridges that more accurately estimate intensity in light of the recent calls for greater reproducibility in mass_spectrometry and to foster development of improved algorithms these datasets and the sa algorithm with ample documentation are available freely for non commercial use at http github com optimusmoose statistical agglomeration 
