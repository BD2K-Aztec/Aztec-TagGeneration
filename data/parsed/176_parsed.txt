a hidden markov_random based bayesian_method for the detection of long_range chromosomal interactions in hi c data downloaded from motivation advances in chromosome_conformation and next_generation are enabling genome_wide investigation of dynamic chromatin_interactions for example hi c experiments generate genome_wide contact frequencies between pairs of loci by sequencing dna_segments ligated from loci in close spatial_proximity one essential task in such studies is peak_calling that is detecting non random interactions between loci from the two_dimensional contact_frequency matrix successful fulfillment of this task has many important implications including identifying long_range that assist interpreting a sizable fraction of the results from genome_wide the task distinguishing biologically_meaningful chromatin_interactions from massive numbers of random interactions poses great challenges both statistically and computationally model based_methods to address this challenge are still lacking in particular no statistical_model exists that takes the underlying dependency_structure into consideration results in this paper we propose a hidden markov_random hmrf based bayesian_method to rigorously model interaction probabilities in the two dimensional_space based on the contact_frequency matrix by borrowing information from neighboring loci pairs our method demonstrates superior reproducibility and statistical_power in both simulation_studies analysis availability_and the source codes can be downloaded at chromosomal_dna must be tightly_packed to fit within the limited_space of the nucleus the intricate highly compacted folding of the chromosomes however is by no means random chromatin architectures are closely_linked to genomic functions by influencing how genetic_information is accessed read and interpreted in a given cell and under certain local micro environmental_conditions via dynamic interactions among genes and their regulatory_elements for example a long_range loop structure can be formed to link a distant enhancer with its target_gene to regulate gene_transcription hence characterization of the three_dimensional d genome organizations is critical to understanding genomic function recent advancements in chromosome_conformation c and derived methods such as c c c and hi c allow the study of d chromosome organization with increasing resolution and throughput these c based_methods quantify the interaction or contact_frequency how often any pair of loci in the genome is in close spatial_proximity for c a locus is the unit of analysis and corresponds to one restriction_enzyme fragment hereafter termed fragment approaches to analyze interaction frequencies fall largely into two complementary categories d model reconstruction and peak_calling the first set of methods simultaneously model contact frequencies of all pairs of loci in the genome to reconstruct d structure the second set of methods aim to identify interaction peaks meaning pairs of loci where the observed contact_frequency is higher than expected from non random chromatin looping or co location events to answer many important biological_questions e g pinpointing individual cis_regulatory higher_resolution for the contributing loci is highly_desirable if not indispensable this paper focuses on peak_calling identifying non random contacts is of fundamental biological interest to researchers due to their relevance for functional regulation for instance it can shed light on the functional mechanisms of non coding complex_trait associations identified in genome_wide gwas gwas have been resoundingly successful identifying thousands of variants associated with complex_traits only a small proportion fall in protein_coding making interpretation of non coding variants imperative although a large number of regulatory_elements have been annotated their target_genes are largely_unknown recent c based studies are generating an increasingly comprehensive catalog of interactions between genes and their regulatory_elements in different cell_types at varying resolution across multiple_organisms including drosophila yeast mouse and human such information will be fundamental to understanding functional mechanisms for example a recent study used c data to identify longrange at megabase distances interactions between the obesityassociated intronic variants in fto and the homeobox_gene irx with the expression of irx rather than fto being directly linked to body_mass this study showcased the value of interactions identified from the c based studies for shedding light on the functional mechanisms of genetic_variants implicated by gwas several computational and statistical_methods have been developed for this important peak_calling task for data generated from c based_methods developed a c peaking calling algorithm where they first estimated the null contact frequencies average and standard_deviation using nonparametric lowess smoothing over genomic_distance using all pairs with the assumption that the vast_majority of interactions are random collisions then calculated standardized z scores and raw p values by fitting the z scores to a weibull distribution followed finally by converting the raw p values into q values for fdr analysis binned pairs of loci according to genomic_distance estimated null contact probabilities within each bin and called peaks by assuming the contact_frequency of every pair in each bin followed an identical binomial_distribution developed a pipeline to estimate the expected contact_frequency accounting for locus length inter locus distance mappability and gc_content and then tested for significant interaction by assuming the observed contact_frequency followed a negative_binomial most recently refined the binning method in duan et_al and to develop fit hi c specifically fit hi c provided more accurate estimates of the contact probabilities by fitting nonparametric spline curves across genomic distances instead of discrete binning re fitting spline curves after filtering non random collisions based on the initial spline and modeling other hi c biases by incorporating locus specific correction_factors inferred from a previously_published iterative correction and eigenvector decomposition method these existing_methods have advanced the field by improving the accuracy in the estimation of the expected contact frequencies under the null i e random collisions all these methods take into account genomic_distance between the pair of loci under inference during the estimation with some incorporating other genomic biases however all existing_methods by testing each individual pair of loci independently ignore the potential correlation among pairs of loci this was less of an issue with lower_resolution data when multiple fragments combined into metafragments served as the units of analysis when analyzing a fragment resolution hi c data jin et_al recognized this potential issue and developed the anchorfragment caller afc an ad_hoc approach to accommodate the correlation of peak status among neighboring fragment pairs in afc one anchor was fixed either a fragment or mega fragment from consecutive smaller fragments and one dimensional peak_calling was performed for each anchor the algorithm started with the identification of candidate peak regions a candidate peak region could encompass multiple consecutive fragments with moderate marginal evidence for non random interaction with the anchor and importantly afc allows for small gaps peaks were called by aggregating information across the entire candidate peak region via assigning thresholds on read_counts and p values from contributing fragment pairs as well as from the entire_region cumulatively as an initial attempt to model the spatial dependency of the underlying peak status afc performed reasonably we believe that the existing_methods are not yet optimal and that improvements in multiple aspects are needed first an improved analysis suite for data from c derived methods should be based on an explicit model that yields clear and reproducible expectations for genome_wide interaction frequencies second existing_approaches choose anchor fragment s arbitrarily and also ignore any correlations between neighboring fragments or anchors for example we found that neighboring anchors often interact with the same target fragments suggesting that these anchors are parts of a bigger region involved in the same dna looping event therefore an ideal peak caller should consider correlations between neighboring a hidden markov_random based hi c peak callerfragments in the context of a two_dimensional d contact matrix generated from c derived technologies third onedimensional calling approaches are not optimal do not incorporate useful existing information and considerable benefits can be gained using a d approach for example we observed afc asymmetric peak calls supplementary figs s and s and lower power in the identification of non random interactions details in section thus these observations motivated us to develop rigorous statistical_models that efficiently use information from neighbors in the d space here we present a hidden markov_random hmrf based bayesian_method for peak_calling using hi c data our approach improves on prior methods by explicitly borrowing information from neighboring fragment pairs via modeling the dependency in the d space our results in real_data and from extensive simulations indicate superior_performance of our method over existing_methods across a range of underlying dependency_structure comprehensive simulation_studies have demonstrated the superior_performance of our hmrf bayesian caller over other available methods in particular our simulations showed that our model is able to accurately estimate the inverse temperature parameter w across a wide_range of spatially dependent patterns and as a result improved power for calling peaks detailed in supplementary_material section next we showcase the improved reproducibility and statistical_power of our method in real_data analysis as aforementioned our method was motivated by our observations in real_data and was developed for re analysis of the fragment resolution hi c data generated by in the original study twelve replicates of primary imr human fibroblast cells including six replicates untreated cells and six replicates after tnf a treatment were used to generate billion paired_end this unprecedented sequencing_depth allowed direct identification of interacting fragments one major finding of this study is that tnfa responsive enhancers are already in contact with their target promoters before signaling manifested by similar peak patterns observed under each condition separately motivated by this finding and the insufficient sequencing_depth in each condition i e before or after tnf a treatment we combined data from the two conditions to achieve_higher statistical_power in detecting fragment resolution chromatin_interaction we thus first test our hmrf bayesian caller in this hi c data_set we analyzed three datasets imr before tnf a treatment imr after tnf a treatment and the combined dataset dataset by pooling data from datasets and under the rationale that peak patterns of the two conditions are shared a robust caller is expected to identify similar patterns for the three datasets shows peak_calling results from one domain chr mb we observed that fewer peaks were called in datasets and particularly dataset where the total number of reads was of that in the dataset comparatively our method encourages more clustering of peaks and more consistent results across the three datasets for example within this particular domain and of the peaks called in the combined dataset were detected using only dataset and respectively by our method compared with and and by afc fit hic genome_wide quantitative comparisons are presented below tables and we next proceeded to quantitatively and systematically evaluate the performance based on genome_wide calling for all domains for a fair comparison we selected thresholds based on posterior peak probabilities for our method and p values for fit hi c to match the number of peaks called by afc for each dataset we also performed other comparisons where we matched the number of peaks called by either our method or fit hi c or where we let each method call peaks according to its own criterion and found similar patterns detailed in supplementary_material section treating peaks called in the combined dataset as truth we gauged performance in single condition datasets using the following three statistics false_positive fpr false_discovery fdr and recovery_rate rr denote the number_of true_positives false_negatives and true_negatives as fp tp fn and tn where the truth is defined according to afc results from the combined dataset and the four numbers sum up to the total number of intra domain fragment pairs we have fpr fp fp tn fdr fp fp tp and rr tp tp tn as shown inupper panel methods accounting for potential dependency of underlying peak statuses afc and our hmrf bayesian caller resulted in better performance than fit hi c which models fragment pairs independently furthermore our method outperformed the others for all three measures for example for imr before tnf a treatment we obtained fpr fdr and rr for our hmrf bayesian caller compared with fpr fdr and rr for afc and fpr fdr and rr for fit hi c by borrowing information from neighboring fragment pairs in a probabilistic_framework our method lead to more robust inference with simultaneously lower false_positive false_discovery and higher recovery_rate in addition for each caller we calculated the jaccard_index between the peak sets from the two conditions defined as the ratio of number of peaks identified under both conditions over the number of peaks identified by either average jaccard_index across all domains genome_wide is shown infor each method again methods accounting for the dependency of underlying peak status show higher concordance across conditions average jaccard_index improved by and respectively from fit hi c to afc and hmrf to avoid_potential systematic_differences between treated and untreated conditions in terms of peak status although not supported by results in we also analyzed two randomly split datasets as described by results shown in lower panel and rightmost column similarly show better reproducibility and robustness of our methods over existing ones given one important utility of called peaks is to illuminate biologically_meaningful interactions we directly evaluated the power to identify one important category of biological_interactions between enhancers and transcription_start tss we used the enhancerpromoter connection map based on multi tissue correlations between distal and promoter chromatin_accessibility augmented with results from multi tissue correlations between chromatin_accessibility and gene_expression retrieved from http dnase med unc edu supplement allgenecorrelations p txt gz we left fit hi c out in the comparison as it showed incomparable reproducibility with the other callers supplementarydemonstrates the increased power of hmrf over afc with up to more enhancer tss interactions identified by hmrf given the same number of peak regions called by two methods in addition supplementaryshows one particular example where the potential target_gene ctsb of a gwas variant rs was missed by afc but captured by our method peak_calling from data generated by c derived methods is a fundamental task for the identification of chromatin_interactions in d space however model based_methods for this important task are still lacking existing_methods focus on the calibration of expected count frequency distribution under random collision accounting for multiple biases behind c analysis including but not limited to density of restriction_enzyme sites mappability and gc_content we have found existing_methods rather mature for the purpose of calibrating expected counts with results robust to different methods used establishing the expected count distribution is nevertheless a prerequisite not peak_calling itself none of the existing_methods consider the dependency underlying the peak status with statistical rigor in this work we propose a hmrf based bayesian_method that explicitly_models the dependency of the underlying peak pattern the true peak pattern is unknown and can take different forms in the presence of dependency we simplify the problem by assuming an ising distribution prior and learn the level of dependency from data in a bayesian_framework our extensive simulations indicate superior_performance in terms of both the estimation of the extent of dependency and the statistical_power to distinguish peaks from background across a range of underlying dependency patterns there are several aspects where the model can be further elaborated first our model has one h one w and one thus assuming that peaks are of similar strength and clustering patterns and that reads have similar levels of over dispersion while the first two are simplifying assumptions bypassing issues including model_selection difficulty and parameter non identifiability the last has been shown to be reasonable sensitivity analysis with the imr combined dataset suggests these assumptions are reasonable splitting each domain into two equal sub domains resulted in highly_consistent peak calls spearman_correlation detailed in supplementary_material section second we use a one parameter ising prior with the parameter controlling both the peak proportion and level of dependency a two parameter ising prior would allow more flexibility particularly when the underlying dependency is weak third our method could allow incorporation of prior_knowledge when available into the model for instance a hyper prior could be imposed on the inverse temperature parameter based on estimated distribution from similar existing datasets finally the computational_complexity of our bayesian modeling is quadratic in terms of the number of fragments under consideration our java implementation takes minutes for a typical domain with fragments and with parallel_computing genome_wide analysis can be easily accomplished within a few hours in contrast fit hi c and our r implementation of afc take seconds and minutes respectively therefore for future work computationally more efficient algorithms warrant consideration we attempted to apply the iterative conditional mode algorithm but observed unsatisfactory performance with weak peak signals data not shown despite these possible further model improvements our method has demonstrated favorable performance over existing_methods by borrowing information from neighboring fragment pairs via statistically modeling the potential dependency among the underlying peaks using a bayesian_framework our extensive_simulation supplementary_material section show the advantage of our method across a range of dependency patterns and its ability to learn the level of dependency as modeled by the inverse temperature parameter from data both are valuable since we have limited if any prior_knowledge regarding the extent of dependency in real_data re analysis of several published hi c datasets including the imr h hesc and mesc data confirmed the value of dependency modeling as taking dependency into consideration resulted in better concordance improvement as measured by jaccard_index of peak sets across two imr datasets and lower false_positive false_discovery and higher recovery_rate our method is the first to model dependency in a statistically_rigorous manner and to borrowinformation from neighboring fragment pairs through a probabilistic_model was able to call up to more enhancer tss interactions than the ad_hoc method given the same number of peak regions called we acknowledge that there is currently no genomewide gold_standard for real_data for example from large_scale genome_wide imaging based experiments we therefore made special efforts to benchmark the methods across multiple datasets and for each dataset against the most reasonable silver standard for example for the imr cell_lines we compared against results from the combined dataset with the highest sequencing_depth for h hesc and mesc we used results from independent technologies c and chia_pet respectively with the continuing drop in sequencing_costs and the intensive interest in chromatin_structure as a way to understand gwas results we anticipate in the near future more high_resolution fragment level hi c data where our method have demonstrated key_advantage given the non negligible dependency_structure 
